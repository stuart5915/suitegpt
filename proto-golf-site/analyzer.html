<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Swing Analyzer | Proto Golf</title>
    <meta name="description" content="Get instant AI-powered swing analysis and personalized club recommendations. Free swing analysis from Proto Golf.">

    <link rel="icon" type="image/png" href="assets/images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Analyzer-specific styles */
        .analyzer-page {
            min-height: 100vh;
            padding-top: 70px;
        }

        .analyzer-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .analyzer-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .analyzer-header h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .analyzer-header p {
            color: var(--color-white-70);
            font-size: 1.1rem;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 40px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--color-white-10);
            transition: all 0.3s;
        }

        .step-dot.active {
            background: var(--color-accent);
            width: 32px;
            border-radius: 6px;
        }

        .step-dot.completed {
            background: var(--color-accent);
        }

        /* Step Cards */
        .step-card {
            background: var(--color-white-05);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: 40px;
            display: none;
        }

        .step-card.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .step-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .step-subtitle {
            color: var(--color-white-50);
            margin-bottom: 32px;
        }

        /* Analysis Type Selection */
        .type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .type-card {
            background: var(--color-white-05);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-card:hover {
            background: var(--color-white-10);
            border-color: var(--color-white-30);
        }

        .type-card.selected {
            border-color: var(--color-accent);
            background: rgba(74, 222, 128, 0.1);
        }

        .type-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .type-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .type-desc {
            color: var(--color-white-50);
            font-size: 0.9rem;
        }

        /* Camera View */
        .camera-container {
            position: relative;
            background: #000;
            border-radius: var(--radius-lg);
            overflow: hidden;
            aspect-ratio: 16/9;
            margin-bottom: 24px;
        }

        .camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
        }

        .camera-placeholder {
            text-align: center;
            color: var(--color-white-50);
        }

        .camera-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .camera-guide {
            position: absolute;
            inset: 20px;
            border: 2px dashed rgba(74, 222, 128, 0.3);
            border-radius: var(--radius-md);
            pointer-events: none;
        }

        .camera-guide::before {
            content: 'Position yourself in frame';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(13, 31, 13, 0.9);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--color-accent);
        }

        .camera-recording {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 16px;
            border-radius: 100px;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .camera-recording.active {
            opacity: 1;
        }

        .recording-dot {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        .camera-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .capture-btn {
            width: 80px;
            height: 80px;
            background: var(--color-accent);
            border: 4px solid var(--color-white);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .capture-btn:hover {
            transform: scale(1.05);
        }

        .capture-btn.recording {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        /* Upload Option */
        .upload-divider {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 32px 0;
            color: var(--color-white-30);
        }

        .upload-divider::before,
        .upload-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--color-border);
        }

        .upload-zone {
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-lg);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-zone:hover {
            border-color: var(--color-accent);
            background: rgba(74, 222, 128, 0.05);
        }

        .upload-zone-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .upload-zone input {
            display: none;
        }

        /* Analysis Loading */
        .analysis-loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--color-white-10);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--color-white-70);
        }

        .loading-progress {
            margin-top: 24px;
        }

        .progress-bar {
            background: var(--color-white-10);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-accent);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-steps {
            font-size: 0.85rem;
            color: var(--color-white-50);
        }

        /* Results */
        .results-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .results-header h2 {
            font-size: 1.75rem;
            margin-bottom: 8px;
        }

        .overall-score {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(74, 222, 128, 0.15);
            padding: 8px 20px;
            border-radius: 100px;
            color: var(--color-accent);
            font-weight: 700;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .score-item {
            background: var(--color-white-05);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }

        .score-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-accent);
        }

        .score-label {
            font-size: 0.85rem;
            color: var(--color-white-50);
            margin-top: 4px;
        }

        .issues-section {
            background: var(--color-white-05);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .issues-section h3 {
            font-size: 1.1rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--color-border);
        }

        .issue-item:last-child {
            border-bottom: none;
        }

        .issue-icon {
            width: 32px;
            height: 32px;
            background: rgba(251, 191, 36, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .issue-text {
            flex: 1;
        }

        .issue-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .issue-desc {
            font-size: 0.9rem;
            color: var(--color-white-50);
        }

        .recommendations-section {
            background: linear-gradient(135deg, var(--color-bg-light), var(--color-bg));
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .recommendations-section h3 {
            font-size: 1.1rem;
            margin-bottom: 16px;
            color: var(--color-accent);
        }

        .rec-list {
            list-style: none;
        }

        .rec-list li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            color: var(--color-white-70);
        }

        .rec-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 16px;
            width: 8px;
            height: 8px;
            background: var(--color-accent);
            border-radius: 50%;
        }

        .product-recommendations {
            margin-top: 32px;
        }

        .product-recommendations h3 {
            font-size: 1.1rem;
            margin-bottom: 16px;
        }

        .rec-products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .rec-product {
            background: var(--color-white-05);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rec-product:hover {
            background: var(--color-white-10);
        }

        .rec-product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .rec-product-name {
            font-weight: 700;
        }

        .rec-product-price {
            color: var(--color-accent);
            font-weight: 700;
        }

        .rec-product-reason {
            font-size: 0.85rem;
            color: var(--color-white-50);
        }

        .results-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 32px;
        }

        /* Print Styles */
        @media print {
            .nav, .results-actions, .btn {
                display: none !important;
            }

            .step-card {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }

        @media (max-width: 768px) {
            .type-grid {
                grid-template-columns: 1fr;
            }

            .score-breakdown {
                grid-template-columns: 1fr;
            }

            .rec-products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <div class="nav-logo">P</div>
                <span class="nav-title">Proto <span>Golf</span></span>
            </a>

            <ul class="nav-links" id="navLinks">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="shop.html" class="nav-link">Shop</a></li>
                <li><a href="analyzer.html" class="nav-link active">AI Analyzer</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>

            <div class="nav-cta">
                <a href="shop.html" class="btn btn-primary btn-sm">Shop</a>
                <button class="nav-toggle" onclick="toggleNav()">
                    <span id="navIcon">&#9776;</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="analyzer-page">
        <div class="analyzer-container">
            <div class="analyzer-header">
                <h1>AI Swing Analyzer</h1>
                <p>Get instant feedback and personalized recommendations</p>
            </div>

            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step-dot active" id="stepDot1"></div>
                <div class="step-dot" id="stepDot2"></div>
                <div class="step-dot" id="stepDot3"></div>
                <div class="step-dot" id="stepDot4"></div>
            </div>

            <!-- Step 1: Choose Type -->
            <div class="step-card active" id="step1">
                <h2 class="step-title">What would you like to analyze?</h2>
                <p class="step-subtitle">Select the type of swing analysis</p>

                <div class="type-grid">
                    <div class="type-card" onclick="selectType('full')">
                        <div class="type-icon">D</div>
                        <h3 class="type-name">Full Swing</h3>
                        <p class="type-desc">Analyze your driver, iron, or wedge swing for power and accuracy</p>
                    </div>
                    <div class="type-card" onclick="selectType('putt')">
                        <div class="type-icon">P</div>
                        <h3 class="type-name">Putting Stroke</h3>
                        <p class="type-desc">Analyze your putting stroke for consistency and alignment</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Capture -->
            <div class="step-card" id="step2">
                <h2 class="step-title">Capture Your Swing</h2>
                <p class="step-subtitle" id="captureInstructions">Stand sideways to the camera and take a swing</p>

                <div class="camera-container">
                    <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                    <div class="camera-overlay" id="cameraOverlay">
                        <div class="camera-placeholder">
                            <div class="camera-placeholder-icon">CAM</div>
                            <p>Click "Start Camera" to begin</p>
                        </div>
                    </div>
                    <div class="camera-guide" id="cameraGuide" style="display: none;"></div>
                    <div class="camera-recording" id="recordingIndicator">
                        <div class="recording-dot"></div>
                        <span>Recording...</span>
                    </div>
                </div>

                <div class="camera-controls">
                    <button class="btn btn-secondary" id="startCameraBtn" onclick="startCamera()">
                        Start Camera
                    </button>
                    <button class="capture-btn" id="captureBtn" onclick="toggleRecording()" style="display: none;"></button>
                    <button class="btn btn-primary" id="analyzeBtn" onclick="analyzeSwing()" style="display: none;">
                        Analyze Swing
                    </button>
                </div>

                <div class="upload-divider">or upload a video</div>

                <div class="upload-zone" onclick="document.getElementById('videoUpload').click()">
                    <div class="upload-zone-icon">UP</div>
                    <p>Click to upload a video of your swing</p>
                    <p class="text-muted" style="font-size: 0.85rem; margin-top: 8px;">MP4, MOV, or WebM</p>
                    <input type="file" id="videoUpload" accept="video/*" onchange="handleVideoUpload(event)">
                </div>
            </div>

            <!-- Step 3: Analyzing -->
            <div class="step-card" id="step3">
                <div class="analysis-loading">
                    <div class="loading-spinner"></div>
                    <p class="loading-text" id="loadingText">Analyzing your swing...</p>
                    <div class="loading-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p class="progress-steps" id="progressSteps">Extracting key frames...</p>
                    </div>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div class="step-card" id="step4">
                <div class="results-header">
                    <h2>Analysis Complete!</h2>
                    <div class="overall-score">
                        <span>Overall Score:</span>
                        <span id="overallScore">85</span>/100
                    </div>
                </div>

                <div class="score-breakdown" id="scoreBreakdown">
                    <!-- Populated by JS -->
                </div>

                <div class="issues-section">
                    <h3>Areas for Improvement</h3>
                    <div id="issuesList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="recommendations-section">
                    <h3>Recommendations</h3>
                    <ul class="rec-list" id="recList">
                        <!-- Populated by JS -->
                    </ul>
                </div>

                <div class="product-recommendations">
                    <h3>Recommended Equipment</h3>
                    <div class="rec-products-grid" id="recProducts">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="window.print()">Print Results</button>
                    <button class="btn btn-secondary" onclick="saveResults()">Save Results</button>
                    <button class="btn btn-primary" onclick="startOver()">Analyze Another Swing</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-bottom">
                <p class="footer-copy">&copy; 2026 Proto Golf. All rights reserved.</p>
                <p class="footer-telos">A <strong>Telos Manufacturing</strong> Brand</p>
            </div>
        </div>
    </footer>

    <script>
        let currentStep = 1;
        let selectedType = null;
        let mediaStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let capturedFrames = [];
        let isRecording = false;

        // Check URL params for type
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const type = params.get('type');
            if (type === 'full' || type === 'putt') {
                selectType(type);
            }
        });

        function goToStep(step) {
            currentStep = step;

            // Update step indicators
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById('stepDot' + i);
                dot.classList.remove('active', 'completed');
                if (i < step) dot.classList.add('completed');
                if (i === step) dot.classList.add('active');
            }

            // Show/hide step cards
            for (let i = 1; i <= 4; i++) {
                const card = document.getElementById('step' + i);
                card.classList.remove('active');
                if (i === step) card.classList.add('active');
            }
        }

        function selectType(type) {
            selectedType = type;

            // Update UI
            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event?.currentTarget?.classList.add('selected');

            // Update instructions based on type
            const instructions = type === 'full'
                ? 'Stand sideways to the camera. Take 2-3 full swings.'
                : 'Position the camera to see your putting stance. Take 2-3 putts.';
            document.getElementById('captureInstructions').textContent = instructions;

            // Move to next step after brief delay
            setTimeout(() => goToStep(2), 300);
        }

        async function startCamera() {
            try {
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment', width: 1280, height: 720 },
                    audio: false
                });

                const video = document.getElementById('cameraVideo');
                video.srcObject = mediaStream;

                document.getElementById('cameraOverlay').style.display = 'none';
                document.getElementById('cameraGuide').style.display = 'block';
                document.getElementById('startCameraBtn').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'block';

            } catch (error) {
                console.error('Camera error:', error);
                alert('Could not access camera. Please upload a video instead.');
            }
        }

        function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            isRecording = true;
            recordedChunks = [];
            capturedFrames = [];

            const video = document.getElementById('cameraVideo');
            const captureBtn = document.getElementById('captureBtn');
            const recordingIndicator = document.getElementById('recordingIndicator');

            captureBtn.classList.add('recording');
            recordingIndicator.classList.add('active');

            // Start media recorder
            mediaRecorder = new MediaRecorder(mediaStream, { mimeType: 'video/webm' });
            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };
            mediaRecorder.start(100);

            // Capture frames every 500ms for analysis
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');

            const frameInterval = setInterval(() => {
                if (!isRecording) {
                    clearInterval(frameInterval);
                    return;
                }
                ctx.drawImage(video, 0, 0);
                capturedFrames.push(canvas.toDataURL('image/jpeg', 0.8));
            }, 500);

            // Auto-stop after 10 seconds
            setTimeout(() => {
                if (isRecording) stopRecording();
            }, 10000);
        }

        function stopRecording() {
            isRecording = false;

            const captureBtn = document.getElementById('captureBtn');
            const recordingIndicator = document.getElementById('recordingIndicator');
            const analyzeBtn = document.getElementById('analyzeBtn');

            captureBtn.classList.remove('recording');
            recordingIndicator.classList.remove('active');

            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }

            captureBtn.style.display = 'none';
            analyzeBtn.style.display = 'inline-flex';
        }

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Extract frames from video
            const video = document.createElement('video');
            video.src = URL.createObjectURL(file);
            video.muted = true;

            video.onloadeddata = () => {
                extractFramesFromVideo(video);
            };
        }

        async function extractFramesFromVideo(video) {
            capturedFrames = [];
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');

            const duration = video.duration;
            const frameCount = Math.min(10, Math.floor(duration * 2)); // 2 frames per second, max 10

            for (let i = 0; i < frameCount; i++) {
                video.currentTime = (duration / frameCount) * i;
                await new Promise(resolve => {
                    video.onseeked = () => {
                        ctx.drawImage(video, 0, 0);
                        capturedFrames.push(canvas.toDataURL('image/jpeg', 0.8));
                        resolve();
                    };
                });
            }

            analyzeSwing();
        }

        async function analyzeSwing() {
            if (capturedFrames.length === 0) {
                alert('No frames captured. Please record or upload a video.');
                return;
            }

            goToStep(3);

            // Simulate progress
            const progressFill = document.getElementById('progressFill');
            const progressSteps = document.getElementById('progressSteps');
            const steps = [
                { progress: 20, text: 'Extracting key frames...' },
                { progress: 40, text: 'Analyzing posture and stance...' },
                { progress: 60, text: 'Evaluating swing plane...' },
                { progress: 80, text: 'Detecting issues...' },
                { progress: 100, text: 'Generating recommendations...' }
            ];

            for (const step of steps) {
                progressFill.style.width = step.progress + '%';
                progressSteps.textContent = step.text;
                await new Promise(r => setTimeout(r, 800));
            }

            // Call API or use demo data
            try {
                const response = await fetch('/api/analyze-swing', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        frames: capturedFrames.slice(0, 5), // Send max 5 frames
                        swing_type: selectedType
                    })
                });

                const results = await response.json();
                displayResults(results);
            } catch (error) {
                console.error('API error, using demo results:', error);
                displayResults(getDemoResults());
            }
        }

        function getDemoResults() {
            const isPutt = selectedType === 'putt';

            return {
                overall_score: isPutt ? 82 : 78,
                scores: isPutt ? {
                    alignment: 85,
                    tempo: 80,
                    stroke_path: 82
                } : {
                    posture: 75,
                    swing_plane: 80,
                    tempo: 78
                },
                issues: isPutt ? [
                    { title: 'Slight decel through impact', desc: 'Putter head slows before striking the ball, causing distance control issues.' },
                    { title: 'Eyes slightly behind ball', desc: 'Optimal eye position is directly over or slightly inside the ball.' }
                ] : [
                    { title: 'Early extension', desc: 'Hips move toward the ball during downswing, causing inconsistent contact.' },
                    { title: 'Grip too strong', desc: 'Left hand is rotated too far right, promoting a hook.' },
                    { title: 'Weight shift timing', desc: 'Weight transfers to front foot slightly late in the downswing.' }
                ],
                recommendations: isPutt ? [
                    'Practice with a metronome to maintain consistent tempo',
                    'Use a putting mirror to check eye position at address',
                    'Focus on accelerating through the ball, not to it'
                ] : [
                    'Practice maintaining your spine angle through impact',
                    'Rotate your left hand slightly left on the grip',
                    'Start your weight shift earlier in the transition',
                    'Use alignment sticks to check your swing plane'
                ],
                products: isPutt ? [
                    { id: 'mallet', name: 'Mallet Putter', price: 279, reason: 'High MOI design helps with distance control on off-center hits' },
                    { id: 'blade', name: 'Blade Putter', price: 249, reason: 'Better feedback helps develop consistent tempo' }
                ] : [
                    { id: 'proDriver', name: 'Proto Driver X1', price: 449, reason: 'Adjustable weights help correct your hook tendency' },
                    { id: 'blade', name: 'Blade Putter', price: 249, reason: 'Precision-milled for feel and feedback' }
                ]
            };
        }

        function displayResults(results) {
            // Overall score
            document.getElementById('overallScore').textContent = results.overall_score;

            // Score breakdown
            const scoreBreakdown = document.getElementById('scoreBreakdown');
            scoreBreakdown.innerHTML = Object.entries(results.scores).map(([key, value]) => `
                <div class="score-item">
                    <div class="score-value">${value}</div>
                    <div class="score-label">${formatLabel(key)}</div>
                </div>
            `).join('');

            // Issues
            const issuesList = document.getElementById('issuesList');
            issuesList.innerHTML = results.issues.map(issue => `
                <div class="issue-item">
                    <div class="issue-icon">!</div>
                    <div class="issue-text">
                        <div class="issue-title">${issue.title}</div>
                        <div class="issue-desc">${issue.desc}</div>
                    </div>
                </div>
            `).join('');

            // Recommendations
            const recList = document.getElementById('recList');
            recList.innerHTML = results.recommendations.map(rec => `
                <li>${rec}</li>
            `).join('');

            // Product recommendations
            const recProducts = document.getElementById('recProducts');
            recProducts.innerHTML = results.products.map(p => `
                <div class="rec-product" onclick="location.href='shop.html?product=${p.id}'">
                    <div class="rec-product-header">
                        <span class="rec-product-name">${p.name}</span>
                        <span class="rec-product-price">$${p.price}</span>
                    </div>
                    <p class="rec-product-reason">${p.reason}</p>
                </div>
            `).join('');

            goToStep(4);
        }

        function formatLabel(key) {
            return key.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        }

        function saveResults() {
            // In a real implementation, this would save to Supabase
            alert('Results saved! You can view them in your account.');
        }

        function startOver() {
            // Stop camera if running
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }

            // Reset state
            capturedFrames = [];
            recordedChunks = [];
            isRecording = false;
            selectedType = null;

            // Reset UI
            document.getElementById('cameraOverlay').style.display = 'flex';
            document.getElementById('cameraGuide').style.display = 'none';
            document.getElementById('startCameraBtn').style.display = 'inline-flex';
            document.getElementById('captureBtn').style.display = 'none';
            document.getElementById('analyzeBtn').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
            document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));

            goToStep(1);
        }

        // Mobile nav toggle
        function toggleNav() {
            const navLinks = document.getElementById('navLinks');
            const navIcon = document.getElementById('navIcon');
            navLinks.classList.toggle('open');
            navIcon.innerHTML = navLinks.classList.contains('open') ? '&times;' : '&#9776;';
        }
    </script>
</body>
</html>
