<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Dashboard | SUITE</title>
    <link rel="icon" type="image/png" href="assets/suite-token.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="suite-styles.css">
    <link rel="stylesheet" href="nav.css">
    <style>
        /* Critical nav styles inline */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 16px 24px;
            background: transparent;
        }

        .nav-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(20px);
            padding: 12px 28px;
            border-radius: 100px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            font-size: 1.4rem;
            color: #2d1b4e;
            text-decoration: none;
        }

        .nav-logo-img {
            width: 36px !important;
            height: 36px !important;
            max-width: 36px !important;
            border-radius: 8px;
            object-fit: contain;
            flex-shrink: 0;
        }

        /* Override global img rule */
        .nav img,
        .nav-inner img,
        .nav-logo img {
            max-width: 36px !important;
            width: 36px !important;
            height: 36px !important;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-links a {
            font-size: 0.95rem;
            font-weight: 600;
            padding: 10px 18px;
            color: #5a4a6f;
            text-decoration: none;
            border-radius: 100px;
        }

        .nav-cta {
            background: linear-gradient(135deg, #ff9500, #ff6b9d) !important;
            color: white !important;
        }

        body {
            background: linear-gradient(135deg, #fff5eb 0%, #ffe4d4 20%, #ffd4e3 50%, #e8d5f9 80%, #d4e5ff 100%);
            min-height: 100vh;
            font-family: 'Nunito', sans-serif;
        }

        /* Canvas wrapper */
        .canvas-container {
            width: 100%;
            min-height: 100vh;
            padding: 90px 24px 40px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            box-sizing: border-box;
        }

        /* Main dashboard wrapper - similar to docs */
        .dashboard-wrapper {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 32px;
            box-shadow: 0 16px 80px rgba(0, 0, 0, 0.08);
            padding: 30px;
            width: 100%;
            max-width: 1500px;
            min-height: 600px;
            margin: 0 auto;
            display: flex;
            gap: 30px;
        }

        /* Sidebar */
        .dashboard-sidebar {
            width: 240px;
            flex-shrink: 0;
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            padding-right: 24px;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.1), rgba(255, 107, 157, 0.1));
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .sidebar-user img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .sidebar-user-info {
            flex: 1;
            min-width: 0;
        }

        .sidebar-user-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: #2d1b4e;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-user-logout {
            font-size: 0.75rem;
            color: #ff6b9d;
            cursor: pointer;
            text-decoration: none;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #9ca3af;
            margin-bottom: 12px;
            padding-left: 14px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            color: #2d1b4e;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .sidebar-link:hover {
            background: rgba(255, 149, 0, 0.1);
            color: #ff9500;
        }

        .sidebar-link.active {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            color: white;
        }

        .sidebar-link-icon {
            font-size: 1.1rem;
        }

        .sidebar-link-badge {
            margin-left: auto;
            background: rgba(255, 149, 0, 0.2);
            color: #ff9500;
            padding: 2px 8px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .sidebar-link.active .sidebar-link-badge {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        /* Main content area */
        .dashboard-main {
            flex: 1;
            min-width: 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .dashboard-header h1 {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        /* Section panels (one shown at a time) */
        .section-panel {
            display: none;
        }

        .section-panel.active {
            display: block;
        }

        /* Hide scrollbars in AI Fleet panel */
        #panel-ai-fleet,
        #panel-ai-fleet * {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }

        #panel-ai-fleet::-webkit-scrollbar,
        #panel-ai-fleet *::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }

        .panel-header {
            margin-bottom: 24px;
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2d1b4e;
            margin: 0 0 8px 0;
        }

        .panel-desc {
            color: #6b7280;
            font-size: 0.95rem;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.08), rgba(255, 107, 157, 0.05));
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: #ff9500;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        /* ═══ ULTRA-COMPACT AI FLEET STYLES ═══ */
        /* Force entire panel to fit in one viewport */

        #panel-ai-fleet {
            max-height: calc(100vh - 140px) !important;
            overflow-y: auto !important;
        }

        #fleet-division-apps {
            padding: 10px !important;
        }

        /* Compact header area */
        #panel-ai-fleet .panel-header {
            padding: 10px 0 !important;
            margin-bottom: 8px !important;
        }

        #panel-ai-fleet .panel-title {
            font-size: 1.2rem !important;
        }

        #panel-ai-fleet .panel-desc {
            font-size: 0.8rem !important;
            margin-bottom: 8px !important;
        }

        /* Compact tabs */
        #fleetDivisionTabs {
            gap: 6px !important;
            margin-bottom: 10px !important;
        }

        #fleetDivisionTabs button {
            padding: 6px 12px !important;
            font-size: 0.75rem !important;
        }

        /* Ultra-compact TELOS toggle box */
        #fleet-division-apps>div:first-of-type {
            padding: 12px !important;
            margin-bottom: 10px !important;
        }

        #telosStatusText {
            font-size: 0.8rem !important;
        }

        #telosExplanation {
            margin-bottom: 10px !important;
            padding: 8px 12px !important;
        }

        #telosExplanation p {
            font-size: 0.75rem !important;
        }

        /* Compact Forge status */
        #fleet-division-apps>div:nth-of-type(3) {
            padding: 8px 12px !important;
            margin-bottom: 10px !important;
        }

        /* Ultra-compact stat cards */
        #fleet-division-apps>div[style*="grid-template-columns: repeat(4"] {
            gap: 8px !important;
            margin-bottom: 12px !important;
        }

        #fleet-division-apps>div[style*="grid-template-columns: repeat(4"]>div {
            padding: 10px 8px !important;
        }

        #aiAppsTotal,
        #aiAppsToday,
        #aiAppsInProgress,
        #aiTotalIterations {
            font-size: 1.5rem !important;
        }

        /* Compact Ideas/Review sections */
        #telosIdeasQueue,
        #fleet-division-apps>div[style*="margin-bottom: 24px"][style*="background: linear-gradient"] {
            padding: 12px !important;
            margin-bottom: 10px !important;
            max-height: 150px !important;
            overflow-y: auto !important;
        }

        #telosIdeasQueue h4,
        #fleet-division-apps h4 {
            font-size: 0.9rem !important;
            margin-bottom: 8px !important;
        }

        /* Two-column bottom layout: Activity + Config */
        #fleet-division-apps>div:last-child,
        #fleet-division-apps>div[style*="display: flex"][style*="gap: 24px"] {
            gap: 12px !important;
        }

        #aiActivityFeed {
            max-height: 120px !important;
            overflow-y: auto !important;
            font-size: 0.75rem !important;
        }

        #aiFleetConfigPanel {
            padding: 10px !important;
            max-height: 180px !important;
            overflow-y: auto !important;
        }

        #aiFleetConfigPanel summary {
            padding: 6px !important;
            font-size: 0.8rem !important;
        }

        #aiFleetConfigPanel details {
            margin-bottom: 4px !important;
        }

        /* Hide less important things */
        #panel-ai-fleet .learn-more-btn {
            display: none !important;
        }

        /* Content cards within panels */
        .content-card {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .content-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .content-card h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0;
            color: #2d1b4e;
        }

        /* Login banner */
        .login-banner {
            background: linear-gradient(135deg, #5865F2, #7289da);
            padding: 16px 20px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }

        .login-banner-text {
            color: white;
        }

        .login-banner-text strong {
            font-size: 1rem;
        }

        .login-banner-text p {
            margin: 2px 0 0;
            opacity: 0.9;
            font-size: 0.85rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .dashboard-wrapper {
                flex-direction: column;
                padding: 20px;
            }

            .dashboard-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.06);
                padding-right: 0;
                padding-bottom: 20px;
                margin-bottom: 20px;
            }

            .sidebar-section {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 12px;
            }

            .sidebar-title {
                width: 100%;
                margin-bottom: 8px;
            }

            .sidebar-link {
                padding: 10px 14px;
                margin-bottom: 0;
            }
        }

        /* Keep old .dashboard-container for backward compat during transition */
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 20px 40px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .dashboard-header h1 {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-pill {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 100px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .user-pill img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            color: #ff9500;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 8px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 0;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: rgba(255, 149, 0, 0.05);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-info {
            flex: 1;
        }

        .section-desc {
            font-size: 0.85rem;
            color: #888;
            font-weight: 400;
            margin-top: 4px;
        }

        .section-toggle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .section.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-content {
            padding: 0 32px 32px;
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.2s ease;
            opacity: 1;
        }

        .section.collapsed .section-content {
            max-height: 0;
            padding: 0 32px;
            opacity: 0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 700;
            font-size: 0.9rem;
            color: #444;
        }

        .form-group input,
        .form-group select {
            padding: 14px 18px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff9500;
            box-shadow: 0 0 0 4px rgba(255, 149, 0, 0.1);
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .toggle-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #ff9500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 100px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 30px rgba(255, 149, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(255, 149, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .campaigns-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .campaign-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 16px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .campaign-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .campaign-info img {
            width: 50px;
            height: 50px;
            border-radius: 12px;
        }

        .campaign-stats {
            display: flex;
            gap: 24px;
            font-size: 0.9rem;
        }

        .campaign-stats span {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .campaign-stats strong {
            font-size: 1.1rem;
            color: #ff9500;
        }

        .badge {
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .badge-active {
            background: #dcfce7;
            color: #16a34a;
        }

        .badge-paused {
            background: #fef3c7;
            color: #d97706;
        }

        .badge-depleted {
            background: #fee2e2;
            color: #dc2626;
        }

        .login-section {
            text-align: center;
            padding: 80px 20px;
        }

        .discord-btn {
            background: #5865F2;
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 100px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        /* TELOS Tooltip Hover */
        span:has(.telos-tooltip):hover .telos-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Fleet Division Tabs */
        .fleet-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Tooltip for TELOS */
        .telos-tooltip-wrapper:hover .telos-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        span:hover>.telos-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Pulse animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Active division styling */
        .fleet-division.active {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        /* ============================================
           COSMIC COCKPIT STYLING
           Dashboard as living control center
        ============================================ */

        /* Cosmic background gradient */
        .dashboard-wrapper {
            background:
                radial-gradient(ellipse at 30% 20%, rgba(255, 149, 0, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 107, 157, 0.05) 0%, transparent 60%),
                linear-gradient(180deg, #1a0a2e 0%, #16082a 50%, #0f0518 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Subtle energy grid lines */
        .dashboard-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 149, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 149, 0, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
        }

        /* Animated energy particles */
        .dashboard-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(2px 2px at 20% 30%, rgba(255, 149, 0, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 80% 70%, rgba(168, 85, 247, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 40% 60%, rgba(255, 107, 157, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 60% 20%, rgba(255, 200, 100, 0.5) 0%, transparent 100%);
            animation: particleDrift 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes particleDrift {

            0%,
            100% {
                transform: translateY(0) translateX(0);
                opacity: 0.6;
            }

            50% {
                transform: translateY(-20px) translateX(10px);
                opacity: 1;
            }
        }

        /* Sidebar as control panel */
        .dashboard-sidebar {
            background: linear-gradient(180deg,
                    rgba(26, 10, 46, 0.95) 0%,
                    rgba(22, 8, 42, 0.98) 100%) !important;
            border-right: 1px solid rgba(255, 149, 0, 0.2) !important;
            box-shadow:
                inset -10px 0 30px rgba(0, 0, 0, 0.3),
                4px 0 20px rgba(255, 149, 0, 0.1) !important;
            position: relative;
            z-index: 10;
        }

        /* Sidebar section glow */
        .sidebar-section {
            border-bottom: 1px solid rgba(255, 149, 0, 0.1);
            padding-bottom: 12px;
            margin-bottom: 12px;
        }

        .sidebar-title {
            color: rgba(255, 149, 0, 0.7) !important;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1.5px;
            padding: 8px 16px;
        }

        /* Sidebar links as control buttons */
        .sidebar-link {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 149, 0, 0.1);
            border-radius: 8px;
            margin: 4px 8px;
            padding: 10px 14px;
            color: rgba(255, 255, 255, 0.8) !important;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sidebar-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: transparent;
            transition: all 0.3s ease;
        }

        .sidebar-link:hover {
            background: rgba(255, 149, 0, 0.1);
            border-color: rgba(255, 149, 0, 0.3);
            transform: translateX(4px);
            box-shadow: 0 0 15px rgba(255, 149, 0, 0.2);
        }

        .sidebar-link:hover::before {
            background: linear-gradient(180deg, #ff9500, #ff6b9d);
            box-shadow: 0 0 10px rgba(255, 149, 0, 0.5);
        }

        .sidebar-link.active {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(168, 85, 247, 0.15)) !important;
            border-color: rgba(255, 149, 0, 0.4);
            color: white !important;
            box-shadow:
                0 0 20px rgba(255, 149, 0, 0.15),
                inset 0 0 20px rgba(255, 149, 0, 0.05);
        }

        .sidebar-link.active::before {
            background: linear-gradient(180deg, #ff9500, #a855f7);
            box-shadow: 0 0 15px rgba(255, 149, 0, 0.6);
        }

        .sidebar-link-icon {
            font-size: 1.1rem;
            margin-right: 10px;
            filter: drop-shadow(0 0 3px rgba(255, 149, 0, 0.3));
        }

        /* Status badges glow */
        .sidebar-status {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 700;
            margin-left: auto;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {

            0%,
            100% {
                box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
            }

            50% {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
            }
        }

        /* Main content area as viewport */
        .dashboard-main {
            background: transparent !important;
            position: relative;
            z-index: 5;
        }

        /* Section panels as holographic displays */
        .section-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.15);
            border-radius: 16px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 0 60px rgba(255, 149, 0, 0.02);
        }

        /* Panel headers */
        .panel-header {
            border-bottom: 1px solid rgba(255, 149, 0, 0.15);
            background: linear-gradient(180deg, rgba(255, 149, 0, 0.05), transparent);
        }

        .panel-title {
            color: white !important;
            text-shadow: 0 0 20px rgba(255, 149, 0, 0.3);
        }

        /* Cards as control modules */
        .content-card,
        .stat-card,
        .fleet-stat {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 149, 0, 0.1) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .content-card:hover,
        .stat-card:hover {
            border-color: rgba(255, 149, 0, 0.3) !important;
            box-shadow:
                0 8px 30px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 149, 0, 0.1);
            transform: translateY(-2px);
        }

        /* Toggle switches as energy controls */
        input[type="checkbox"]+label,
        .toggle-switch {
            box-shadow: 0 0 10px rgba(255, 149, 0, 0.2);
        }

        /* Buttons as action triggers */
        button,
        .btn {
            position: relative;
            overflow: hidden;
        }

        button::after,
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        button:active::after,
        .btn:active::after {
            width: 200px;
            height: 200px;
        }

        /* Energy flow animation for active elements */
        @keyframes energyFlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Text colors for dark theme */
        .dashboard-wrapper h1,
        .dashboard-wrapper h2,
        .dashboard-wrapper h3,
        .dashboard-wrapper h4 {
            color: white !important;
        }

        .dashboard-wrapper p,
        .dashboard-wrapper span,
        .dashboard-wrapper label {
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
    <script src="js/dashboard-config.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav id="main-nav"></nav>
    <script src="nav-component.js"></script>

    <div class="canvas-container">
        <div class="dashboard-wrapper">
            <!-- Sidebar -->
            <aside class="dashboard-sidebar">
                <!-- User Info (shown when logged in) -->
                <div id="sidebarUser" class="sidebar-user" style="display: none;">
                    <div class="user-avatar" id="sidebarAvatar"></div>
                    <div class="user-name" id="sidebarName">Loading...</div>
                    <div class="user-email" id="sidebarEmail"></div>
                </div>

                <!-- Nav generated from dashboard-config.js -->
                <div id="dashboard-sidebar"></div>

                <!-- Login prompt (shown when not logged in) -->
                <div id="loginPrompt" class="login-prompt">
                    <p>Connect wallet to access dashboard</p>
                    <button class="connect-btn" onclick="connectWallet()">Connect Wallet</button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="dashboard-main">
                <!-- Overview Section (default view) -->
                <div id="panel-overview" class="section-panel active">
                    <div class="dashboard-header">
                        <h1>????? Developer Dashboard</h1>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalApps">-</div>
                            <div class="stat-label">Your Apps</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalCampaigns">-</div>
                            <div class="stat-label">Active Campaigns</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalClaims">-</div>
                            <div class="stat-label">Total Claims</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="suiteBalance">-</div>
                            <div class="stat-label">SUITE Balance</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="content-card">
                        <h3 style="margin-bottom: 16px;">?? Quick Actions</h3>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                            <button onclick="showSection('apps')" class="btn-primary"
                                style="padding: 14px 20px; font-size: 0.95rem;">
                                ?? Manage Apps
                            </button>
                            <button onclick="showSection('campaigns')" class="btn-primary"
                                style="padding: 14px 20px; font-size: 0.95rem; background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                                ?? Create Campaign
                            </button>
                            <button onclick="showSection('studio')" class="btn-primary"
                                style="padding: 14px 20px; font-size: 0.95rem; background: linear-gradient(135deg, #22c55e, #16a34a);">
                                ?? Content Studio
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Apps Section -->
                <div id="panel-apps" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Your Apps</h2>
                        <p class="panel-desc">Apps you've published to the SUITE Store. Manage settings and track
                            performance.</p>
                    </div>
                    <div id="appsList">
                        <div class="empty-state">
                            <p>No apps found. <a href="start-building.html" style="color: #ff9500;">Start building</a>
                                or submit via Discord!</p>
                        </div>
                    </div>
                </div>

                <!-- Treasury Section (Admin) -->
                <div id="panel-treasury" class="section-panel">
                    <div class="section" id="section-treasury" data-section="treasury"
                        style="border: 2px solid rgba(168, 85, 247, 0.3); background: linear-gradient(135deg, rgba(168, 85, 247, 0.05), rgba(99, 102, 241, 0.05));">
                        <div class="section-header" onclick="toggleSection('treasury')">
                            <div class="section-info">
                                <h3 class="section-title">?? Treasury Operations</h3>
                                <div class="section-desc">Weekly yield distributions, buffer management, and REP
                                    tracking
                                    (Admin)</div>
                            </div>
                            <div class="section-toggle">?</div>
                        </div>
                        <div class="section-content">
                            <!-- This Week's Yield -->
                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                                <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                                    <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">This Week's
                                        Yield</div>
                                    <div style="font-size: 1.8rem; font-weight: 900; color: #22c55e;">$2,340</div>
                                </div>
                                <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                                    <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Liquid Buffer
                                    </div>
                                    <div style="font-size: 1.8rem; font-weight: 900; color: #8b5cf6;">$12,500</div>
                                    <div style="font-size: 0.75rem; color: #22c55e;">? 10% (healthy)</div>
                                </div>
                                <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                                    <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Total REP Issued
                                    </div>
                                    <div style="font-size: 1.8rem; font-weight: 900; color: #ff9500;">142,500</div>
                                </div>
                            </div>

                            <!-- Pending Distributions -->
                            <h4 style="font-weight: 700; margin-bottom: 12px;">?? Pending Distributions</h4>
                            <div style="background: #f8f9fa; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>?? Reinvest to Treasury</span>
                                    <span style="font-weight: 700; color: #22c55e;">$1,800 (77%)</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>?? Charities</span>
                                    <span style="font-weight: 700; color: #8b5cf6;">$340 (15%)</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>?? Self-claims</span>
                                    <span style="font-weight: 700; color: #6b7280;">$200 (8%)</span>
                                </div>
                            </div>

                            <!-- Weekly Checklist -->
                            <h4 style="font-weight: 700; margin-bottom: 12px;">?? Weekly Checklist</h4>
                            <div
                                style="background: rgba(255, 149, 0, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                                <label
                                    style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;">
                                    <input type="checkbox" style="width: 20px; height: 20px; accent-color: #ff9500;">
                                    <span>Review pending distributions</span>
                                </label>
                                <label
                                    style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;">
                                    <input type="checkbox" style="width: 20px; height: 20px; accent-color: #ff9500;">
                                    <span>Check buffer levels (target 10%)</span>
                                </label>
                                <label
                                    style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;">
                                    <input type="checkbox" style="width: 20px; height: 20px; accent-color: #ff9500;">
                                    <span>Execute yield distribution</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                    <input type="checkbox" style="width: 20px; height: 20px; accent-color: #ff9500;">
                                    <span>Update REP leaderboard</span>
                                </label>
                            </div>

                            <!-- Action Buttons -->
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button onclick="runDistribution()" style="
                            padding: 14px 24px;
                            background: linear-gradient(135deg, #22c55e, #16a34a);
                            border: none;
                            border-radius: 12px;
                            color: white;
                            font-weight: 700;
                            cursor: pointer;
                        ">?? Run Distribution Now</button>
                                <button onclick="rebalanceBuffer()" style="
                            padding: 14px 24px;
                            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                            border: none;
                            border-radius: 12px;
                            color: white;
                            font-weight: 700;
                            cursor: pointer;
                        ">?? Rebalance Buffer</button>
                                <a href="https://docs.getsuite.app/learn/utility" style="
                            padding: 14px 24px;
                            background: #f3f4f6;
                            border: none;
                            border-radius: 12px;
                            color: #5a4a6f;
                            font-weight: 700;
                            text-decoration: none;
                        ">?? View Docs</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PC Prompt Server Panel (Admin) -->
                <div id="panel-prompt-server" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">??? PC Prompt Server</h2>
                        <p class="panel-desc">Remote coding system - send prompts to your PC's Antigravity</p>
                    </div>
                    <div class="section" id="section-prompt-server" data-section="prompt-server"
                        style="border: 2px solid rgba(34, 197, 94, 0.3); background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(22, 163, 74, 0.05));">
                        <div class="section-header" onclick="toggleSection('prompt-server')">
                            <div class="section-info">
                                <h3 class="section-title">??? PC Prompt Server</h3>
                                <div class="section-desc">Remote coding system - send prompts to PC Antigravity (Owner
                                    only)
                                </div>
                            </div>
                            <div class="section-toggle">?</div>
                        </div>
                        <div class="section-content">
                            <div style="text-align: center; padding: 24px;">
                                <div style="font-size: 3rem; margin-bottom: 16px;">???</div>
                                <p style="font-size: 1.1rem; color: #444; margin-bottom: 20px;">
                                    Send prompts to your PC's Antigravity from anywhere!
                                </p>
                                <a href="http://10.0.0.142:3000/" target="_blank" style="
                            display: inline-block;
                            padding: 16px 32px;
                            background: linear-gradient(135deg, #22c55e, #16a34a);
                            color: white;
                            font-weight: 700;
                            font-size: 1.1rem;
                            border-radius: 100px;
                            text-decoration: none;
                            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.3);
                        ">??? Open PC Prompt Server</a>
                                <p style="font-size: 0.85rem; color: #888; margin-top: 16px;">
                                    http://10.0.0.142:3000/
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaigns Panel -->
                <div id="panel-campaigns" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Campaigns</h2>
                        <p class="panel-desc">Pay users SUITE to try your app. Grow your user base with quality
                            engagement.</p>
                    </div>
                    <div class="section" id="section-campaigns" data-section="campaigns">
                        <div class="section-header" onclick="toggleSection('campaigns')">
                            <div class="section-info">
                                <h3 class="section-title">?? Create Campaign</h3>
                                <div class="section-desc">Pay users SUITE to try your app. Grow your user base with
                                    quality
                                    engagement.</div>
                            </div>
                            <div class="section-toggle">?</div>
                        </div>
                        <div class="section-content">
                            <p style="color: #666; margin-bottom: 24px;">Pay SUITE to get users to try your app. Set
                                requirements to ensure quality engagement.</p>

                            <form id="campaignForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Select App</label>
                                        <select id="appSelect" required>
                                            <option value="">Choose an app...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Reward per User (SUITE)</label>
                                        <input type="number" id="rewardAmount" value="100" min="10" max="1000" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Total Budget (SUITE)</label>
                                        <input type="number" id="totalBudget" value="1000" min="100" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Max Claims (optional)</label>
                                        <input type="number" id="maxClaims" placeholder="Unlimited">
                                    </div>
                                </div>

                                <div style="margin-top: 24px;">
                                    <h4 style="margin-bottom: 16px; color: #444;">Requirements (Optional)</h4>
                                    <div class="form-grid">
                                        <div class="toggle-group">
                                            <input type="checkbox" id="requireTime">
                                            <div>
                                                <label for="requireTime">Minimum Time in App</label>
                                                <input type="number" id="minTime" placeholder="10"
                                                    style="width: 80px; margin-left: 12px;"> minutes
                                            </div>
                                        </div>
                                        <div class="toggle-group">
                                            <input type="checkbox" id="requireActions">
                                            <div>
                                                <label for="requireActions">Minimum Unique Actions</label>
                                                <input type="number" id="minActions" placeholder="50"
                                                    style="width: 80px; margin-left: 12px;"> actions
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    style="margin-top: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                                    <div style="color: #666;">
                                        Cost: <strong id="campaignCost" style="color: #ff9500; font-size: 1.2rem;">1,000
                                            SUITE</strong>
                                    </div>
                                    <button type="submit" class="btn-primary" id="createCampaignBtn">
                                        ?? Launch Campaign
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Your Campaigns -->
                    <div class="section collapsed" id="section-my-campaigns" data-section="my-campaigns">
                        <div class="section-header" onclick="toggleSection('my-campaigns')">
                            <div class="section-info">
                                <h3 class="section-title">?? Your Campaigns</h3>
                                <div class="section-desc">Track performance, claims, and budget for your active user
                                    acquisition
                                    campaigns.</div>
                            </div>
                            <div class="section-toggle">?</div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Panel -->
                <div id="panel-reviews" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">? Reviews</h2>
                        <p class="panel-desc">Request and manage app reviews from the community.</p>
                    </div>
                    <div class="content-card">
                        <p style="color: #888; text-align: center; padding: 40px;">Coming soon - request authentic
                            reviews from
                            SUITE users!</p>
                    </div>
                </div>

                <!-- Power-Ups Panel -->
                <div id="panel-powerups" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">? Power-Ups</h2>
                        <p class="panel-desc">Boost your app's visibility and features.</p>
                    </div>
                    <div class="content-card">
                        <p style="color: #888; text-align: center; padding: 40px;">Coming soon - featured placements,
                            boost badges,
                            and more!</p>
                    </div>
                </div>

                <!-- Cadence Panel -->
                <div id="panel-cadence" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Cadence</h2>
                        <p class="panel-desc">Build daily habits and track your routines.</p>
                    </div>
                    <div class="iframe-container"
                        style="background: white; border-radius: 20px; overflow: hidden; height: calc(100vh - 200px); min-height: 500px;">
                        <iframe src="cadence.html" style="width: 100%; height: 100%; border: none;"></iframe>
                    </div>
                </div>

                <!-- Marketplace Panel -->
                <div id="panel-marketplace" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Content Marketplace</h2>
                        <p class="panel-desc">Post bounties for content, submit work, earn SUITE from the community.</p>
                    </div>
                    <div class="iframe-container"
                        style="background: white; border-radius: 20px; overflow: hidden; height: calc(100vh - 200px); min-height: 500px;">
                        <iframe src="content.html" style="width: 100%; height: 100%; border: none;"></iframe>
                    </div>
                </div>

                <!-- SUITEHub Panel -->
                <div id="panel-suitehub" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? SUITEHub</h2>
                        <p class="panel-desc">Your community hub for building and collaboration.</p>
                    </div>
                    <div class="iframe-container"
                        style="background: white; border-radius: 20px; overflow: hidden; height: calc(100vh - 200px); min-height: 500px;">
                        <iframe src="suitehub.html" style="width: 100%; height: 100%; border: none;"></iframe>
                    </div>
                </div>

                <!-- LP Incentives Panel (Admin) -->
                <div id="panel-lp-incentives" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? LP Incentives</h2>
                        <p class="panel-desc">Manage liquidity provider incentives and rewards.</p>
                    </div>
                    <div class="content-card">
                        <p style="color: #888; text-align: center; padding: 40px;">Coming soon - LP staking rewards and
                            incentive
                            management.</p>
                    </div>
                </div>

                <!-- AI Fleet Panel (Public) - Direct Embed -->
                <div id="panel-ai-fleet" class="section-panel">
                    <style>
                        #panel-ai-fleet {
                            --af-bg: #0a0a0c;
                            --af-card: #1c1c21;
                            --af-border: #2c2c35;
                            --af-green: #39ff14;
                            --af-cyan: #00f0ff;
                            --af-red: #ff4757;
                            --af-text: #ffffff;
                            --af-muted: #5c6066;
                            background: var(--af-bg);
                            border-radius: 16px;
                            padding: 16px;
                            color: var(--af-text);
                            font-family: 'Inter', -apple-system, sans-serif;
                        }

                        .af-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 12px;
                        }

                        .af-header h3 {
                            margin: 0;
                            font-size: 1.1rem;
                        }

                        .af-status {
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            font-size: 0.8rem;
                            color: var(--af-green);
                        }

                        .af-status::before {
                            content: '';
                            width: 8px;
                            height: 8px;
                            background: var(--af-green);
                            border-radius: 50%;
                            box-shadow: 0 0 8px var(--af-green);
                        }

                        .af-toggle-row {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            background: var(--af-card);
                            padding: 12px 16px;
                            border-radius: 10px;
                            margin-bottom: 12px;
                            border: 1px solid var(--af-border);
                        }

                        .af-toggle-row h4 {
                            margin: 0;
                            font-size: 1rem;
                        }

                        .af-toggle-row small {
                            color: var(--af-muted);
                            font-size: 0.8rem;
                        }

                        .af-toggle {
                            width: 50px;
                            height: 26px;
                            background: var(--af-border);
                            border-radius: 13px;
                            cursor: pointer;
                            position: relative;
                            transition: background 0.3s;
                        }

                        .af-toggle.on {
                            background: var(--af-green);
                        }

                        .af-toggle::after {
                            content: '';
                            position: absolute;
                            top: 3px;
                            left: 3px;
                            width: 20px;
                            height: 20px;
                            background: white;
                            border-radius: 50%;
                            transition: transform 0.3s;
                        }

                        .af-toggle.on::after {
                            transform: translateX(24px);
                        }

                        .af-kpis {
                            display: grid;
                            grid-template-columns: repeat(4, 1fr);
                            gap: 10px;
                            margin-bottom: 12px;
                        }

                        .af-kpi {
                            background: var(--af-card);
                            border: 1px solid var(--af-border);
                            border-radius: 8px;
                            padding: 10px;
                            text-align: center;
                        }

                        .af-kpi-val {
                            font-size: 1.5rem;
                            font-weight: 700;
                            color: var(--af-green);
                            font-family: 'JetBrains Mono', monospace;
                        }

                        .af-kpi-label {
                            font-size: 0.7rem;
                            color: var(--af-muted);
                        }

                        .af-grid {
                            display: grid;
                            grid-template-columns: 1fr 1.5fr;
                            gap: 12px;
                            margin-bottom: 12px;
                        }

                        .af-panel {
                            background: var(--af-card);
                            border: 1px solid var(--af-border);
                            border-radius: 10px;
                            overflow: hidden;
                        }

                        .af-panel-header {
                            padding: 10px 12px;
                            border-bottom: 1px solid var(--af-border);
                            font-weight: 600;
                            font-size: 0.85rem;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }

                        .af-panel-body {
                            padding: 10px 12px;
                            font-size: 0.8rem;
                            max-height: 180px;
                            overflow-y: auto;
                        }

                        .af-badge {
                            font-size: 0.65rem;
                            padding: 2px 6px;
                            border-radius: 4px;
                            font-weight: 700;
                        }

                        .af-badge.offline {
                            background: rgba(255, 71, 87, 0.2);
                            color: var(--af-red);
                        }

                        .af-badge.streaming {
                            background: rgba(0, 240, 255, 0.2);
                            color: var(--af-cyan);
                            animation: pulse 2s infinite;
                        }

                        .af-badge.approved {
                            background: rgba(57, 255, 20, 0.2);
                            color: var(--af-green);
                        }

                        .af-empty {
                            color: var(--af-muted);
                            text-align: center;
                            padding: 20px;
                        }

                        .af-feed-item {
                            padding: 4px 0;
                            border-bottom: 1px solid var(--af-border);
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 0.75rem;
                        }

                        .af-feed-time {
                            color: var(--af-muted);
                        }

                        .af-left-col {
                            display: flex;
                            flex-direction: column;
                            gap: 10px;
                        }

                        @keyframes pulse {

                            0%,
                            100% {
                                opacity: 1
                            }

                            50% {
                                opacity: 0.5
                            }
                        }

                        .af-layout {
                            display: grid;
                            grid-template-columns: 160px 1fr 200px;
                            gap: 12px;
                            height: 100%;
                        }

                        .af-sidebar {
                            background: var(--af-card);
                            border: 1px solid var(--af-border);
                            border-radius: 10px;
                            padding: 12px;
                        }

                        .af-nav-item {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 8px 10px;
                            border-radius: 8px;
                            margin-bottom: 4px;
                            cursor: pointer;
                            font-size: 0.8rem;
                            transition: all 0.2s;
                        }

                        .af-nav-item:hover {
                            background: rgba(57, 255, 20, 0.1);
                        }

                        .af-nav-item.active {
                            background: linear-gradient(135deg, rgba(57, 255, 20, 0.2), rgba(0, 240, 255, 0.1));
                            border: 1px solid var(--af-green);
                        }

                        .af-nav-badge {
                            font-size: 0.6rem;
                            padding: 2px 6px;
                            border-radius: 4px;
                            font-weight: 700;
                        }

                        .af-nav-badge.live {
                            background: var(--af-green);
                            color: #000;
                        }

                        .af-nav-badge.soon {
                            background: var(--af-border);
                            color: var(--af-muted);
                        }

                        .af-config-section {
                            margin-bottom: 12px;
                        }

                        .af-config-title {
                            font-size: 0.7rem;
                            font-weight: 700;
                            color: var(--af-muted);
                            text-transform: uppercase;
                            margin-bottom: 6px;
                        }

                        .af-config-row {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 4px;
                            font-size: 0.75rem;
                        }

                        .af-config-input {
                            background: var(--af-border);
                            border: none;
                            color: var(--af-text);
                            padding: 4px 8px;
                            border-radius: 4px;
                            width: 50px;
                            text-align: center;
                            font-size: 0.75rem;
                        }

                        .af-checkbox {
                            width: 14px;
                            height: 14px;
                            accent-color: var(--af-green);
                        }

                        .af-save-btn {
                            width: 100%;
                            padding: 8px;
                            background: var(--af-green);
                            color: #000;
                            border: none;
                            border-radius: 6px;
                            font-weight: 700;
                            font-size: 0.75rem;
                            cursor: pointer;
                            margin-top: 8px;
                        }
                    </style>

                    <div class="af-layout">
                        <!-- Left Sidebar: Fleet Divisions -->
                        <div class="af-sidebar">
                            <div style="font-weight: 700; margin-bottom: 10px; font-size: 0.85rem;">Fleet Divisions
                            </div>
                            <div class="af-nav-item active"><span>Apps</span><span class="af-nav-badge live">LIVE</span>
                            </div>
                            <div class="af-nav-item"><span>Entrepreneurial</span><span
                                    class="af-nav-badge soon">SOON</span>
                            </div>
                            <div class="af-nav-item"><span>Influencers</span><span class="af-nav-badge soon">SOON</span>
                            </div>
                            <div class="af-nav-item"><span>Robots</span><span class="af-nav-badge soon">SOON</span>
                            </div>
                            <div class="af-nav-item"><span>Drones</span><span class="af-nav-badge soon">SOON</span>
                            </div>
                            <div class="af-nav-item"><span>Microfarms</span><span class="af-nav-badge soon">SOON</span>
                            </div>
                            <div class="af-nav-item"><span>External AI</span><span class="af-nav-badge soon">SOON</span>
                            </div>
                        </div>

                        <!-- Center: Main Content -->
                        <div>
                            <div class="af-header">
                                <h3>🤖 AI Fleet Command</h3>
                                <div class="af-status" id="afForgeStatus">Forge (PC) Connected</div>
                            </div>

                            <div class="af-toggle-row">
                                <div>
                                    <h4>TELOS MODE</h4>
                                    <small id="afTelosStatus">AI creates apps autonomously 24/7</small>
                                </div>
                                <div class="af-toggle" id="afTelosToggle" onclick="toggleAfTelos()"></div>
                            </div>

                            <div class="af-kpis">
                                <div class="af-kpi">
                                    <div class="af-kpi-val" id="afKpiTotal">0</div>
                                    <div class="af-kpi-label">Total Apps</div>
                                </div>
                                <div class="af-kpi">
                                    <div class="af-kpi-val" id="afKpiToday">0</div>
                                    <div class="af-kpi-label">Today</div>
                                </div>
                                <div class="af-kpi">
                                    <div class="af-kpi-val" id="afKpiProgress">0</div>
                                    <div class="af-kpi-label">In Progress</div>
                                </div>
                                <div class="af-kpi">
                                    <div class="af-kpi-val" id="afKpiIters">0</div>
                                    <div class="af-kpi-label">Iterations</div>
                                </div>
                            </div>

                            <div class="af-grid">
                                <div class="af-left-col">
                                    <div class="af-panel">
                                        <div class="af-panel-header">Ideas Queue</div>
                                        <div class="af-panel-body" id="afIdeasQueue">
                                            <div class="af-empty">No pending ideas</div>
                                        </div>
                                    </div>
                                    <div class="af-panel">
                                        <div class="af-panel-header">Ready for Review <span class="af-badge approved"
                                                id="afReviewCount">0</span></div>
                                        <div class="af-panel-body" id="afReviewQueue">
                                            <div class="af-empty">No apps ready</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="af-panel">
                                    <div class="af-panel-header">Live Activity <span class="af-badge offline"
                                            id="afFeedStatus">OFFLINE</span></div>
                                    <div class="af-panel-body" id="afFeedBody">
                                        <div class="af-empty">No activity yet. Start the watcher.</div>
                                    </div>
                                </div>
                            </div>

                            <div class="af-panel" style="margin-bottom: 0;">
                                <div class="af-panel-header">Ideas History <span><span class="af-badge approved"
                                            id="afHistApproved">0</span> <span class="af-badge offline"
                                            id="afHistRejected">0</span></span></div>
                                <div class="af-panel-body" id="afHistoryBody" style="max-height: 60px;">
                                    <div class="af-empty">No ideas generated yet</div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Sidebar: TELOS Configuration -->
                        <div class="af-sidebar">
                            <div style="font-weight: 700; margin-bottom: 10px; font-size: 0.85rem;">⚙️ TELOS Config
                            </div>
                            <div
                                style="font-size: 0.6rem; background: rgba(255,149,0,0.2); color: #ff9500; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 10px;">
                                Owner Only</div>

                            <div class="af-config-section">
                                <div class="af-config-title">Research Focus</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                    <span
                                        style="padding: 3px 8px; background: var(--af-green); color: #000; border-radius: 4px; font-size: 0.65rem; font-weight: 600;">Productivity</span>
                                    <span
                                        style="padding: 3px 8px; background: var(--af-green); color: #000; border-radius: 4px; font-size: 0.65rem; font-weight: 600;">Health</span>
                                    <span
                                        style="padding: 3px 8px; background: var(--af-border); color: var(--af-muted); border-radius: 4px; font-size: 0.65rem; font-weight: 600;">Finance</span>
                                    <span
                                        style="padding: 3px 8px; background: var(--af-border); color: var(--af-muted); border-radius: 4px; font-size: 0.65rem; font-weight: 600;">Social</span>
                                </div>
                            </div>

                            <div class="af-config-section">
                                <div class="af-config-title">Scheduling</div>
                                <div class="af-config-row"><span>Max Apps/Day</span><input class="af-config-input"
                                        type="number" value="5"></div>
                                <div class="af-config-row"><span>Iter/App</span><input class="af-config-input"
                                        type="number" value="28"></div>
                            </div>

                            <div class="af-config-section">
                                <div class="af-config-title">Workflow</div>
                                <div class="af-config-row"><label><input class="af-checkbox" type="checkbox">
                                        Auto-Deploy</label></div>
                                <div class="af-config-row"><label><input class="af-checkbox" type="checkbox" checked>
                                        GitHub Auto</label></div>
                            </div>

                            <button class="af-save-btn">Save Config</button>
                        </div>
                    </div>
                </div>


                <!-- Earn Panel -->
                <div id="panel-earn" class="section-panel">

                    <div class="panel-header">
                        <h2 class="panel-title">💰 Earn SUITE</h2>
                        <p class="panel-desc">Watch ads, complete tasks, and earn free SUITE tokens.</p>
                    </div>
                    <div class="content-card">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            <!-- Watch Ad -->
                            <div style="background: rgba(255, 149, 0, 0.08); border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s;"
                                onclick="window.location.href='earn.html'">
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div
                                        style="font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 12px;">
                                        ??</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 1.1rem; color: #2d1b4e;">Watch
                                            Video Ad
                                        </div>
                                        <div style="font-size: 0.9rem; color: #5a4a6f;">30 seconds</div>
                                    </div>
                                    <div
                                        style="background: linear-gradient(135deg, #ff9500, #ff6b9d); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">
                                        +2 SUITE</div>
                                </div>
                            </div>
                            <!-- Try App -->
                            <div style="background: rgba(255, 149, 0, 0.08); border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s;"
                                onclick="window.location.href='apps.html'">
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div
                                        style="font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 12px;">
                                        ??</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 1.1rem; color: #2d1b4e;">Try an App
                                        </div>
                                        <div style="font-size: 0.9rem; color: #5a4a6f;">Use for 5 minutes</div>
                                    </div>
                                    <div
                                        style="background: linear-gradient(135deg, #ff9500, #ff6b9d); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">
                                        +100 SUITE</div>
                                </div>
                            </div>
                            <!-- Daily Bonus -->
                            <div style="background: rgba(255, 149, 0, 0.08); border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s;"
                                onclick="window.location.href='earn.html'">
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div
                                        style="font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 12px;">
                                        ??</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 1.1rem; color: #2d1b4e;">Daily
                                            Bonus
                                        </div>
                                        <div style="font-size: 0.9rem; color: #5a4a6f;">Claim once per day</div>
                                    </div>
                                    <div
                                        style="background: linear-gradient(135deg, #ff9500, #ff6b9d); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">
                                        +5 SUITE</div>
                                </div>
                            </div>
                            <!-- Referral -->
                            <div style="background: rgba(255, 149, 0, 0.08); border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s;"
                                onclick="window.location.href='earn.html'">
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div
                                        style="font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 12px;">
                                        ??</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 1.1rem; color: #2d1b4e;">Refer a
                                            Friend
                                        </div>
                                        <div style="font-size: 0.9rem; color: #5a4a6f;">Share your link</div>
                                    </div>
                                    <div
                                        style="background: linear-gradient(135deg, #ff9500, #ff6b9d); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">
                                        +25 SUITE</div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 24px;">
                            <a href="earn.html" class="btn-primary"
                                style="display: inline-block; text-decoration: none;">??
                                Open
                                Full Earn Page</a>
                        </div>
                    </div>
                </div>

                <!-- Store Panel -->
                <div id="panel-store" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? SUITE Store</h2>
                        <p class="panel-desc">Buy powerups and items with $SUITE to supercharge your apps.</p>
                    </div>
                    <div class="content-card">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px;">
                            <!-- Priority Queue -->
                            <div
                                style="background: linear-gradient(to bottom, rgb(255, 210, 190) 50%, white 50%); border-radius: 16px; text-align: center; overflow: hidden;">
                                <div style="padding: 20px 16px 16px;">
                                    <div style="font-size: 3rem; margin-bottom: 8px;">?</div>
                                </div>
                                <div style="padding: 0 16px 20px; background: white;">
                                    <div style="font-weight: 800; margin-bottom: 6px;">Priority Queue</div>
                                    <div
                                        style="color: #ff9500; font-weight: 700; font-size: 0.85rem; margin-bottom: 12px;">
                                        500
                                        $SUITE</div>
                                    <button
                                        style="width: 100%; padding: 10px; background: linear-gradient(90deg, #ff8c42, #ff6b9d); border: none; border-radius: 50px; color: white; font-weight: 700; cursor: pointer;">BUY</button>
                                </div>
                            </div>
                            <!-- AI Pack -->
                            <div
                                style="background: linear-gradient(to bottom, rgb(255, 210, 190) 50%, white 50%); border-radius: 16px; text-align: center; overflow: hidden;">
                                <div style="padding: 20px 16px 16px;">
                                    <div style="font-size: 3rem; margin-bottom: 8px;">??</div>
                                </div>
                                <div style="padding: 0 16px 20px; background: white;">
                                    <div style="font-weight: 800; margin-bottom: 6px;">AI Pack</div>
                                    <div
                                        style="color: #ff9500; font-weight: 700; font-size: 0.85rem; margin-bottom: 12px;">
                                        200
                                        $SUITE</div>
                                    <button
                                        style="width: 100%; padding: 10px; background: linear-gradient(90deg, #ff8c42, #ff6b9d); border: none; border-radius: 50px; color: white; font-weight: 700; cursor: pointer;">BUY</button>
                                </div>
                            </div>
                            <!-- App Slot -->
                            <div
                                style="background: linear-gradient(to bottom, rgb(255, 210, 190) 50%, white 50%); border-radius: 16px; text-align: center; overflow: hidden;">
                                <div style="padding: 20px 16px 16px;">
                                    <div style="font-size: 3rem; margin-bottom: 8px;">??</div>
                                </div>
                                <div style="padding: 0 16px 20px; background: white;">
                                    <div style="font-weight: 800; margin-bottom: 6px;">App Slot</div>
                                    <div
                                        style="color: #ff9500; font-weight: 700; font-size: 0.85rem; margin-bottom: 12px;">
                                        1,000
                                        $SUITE</div>
                                    <button
                                        style="width: 100%; padding: 10px; background: linear-gradient(90deg, #ff8c42, #ff6b9d); border: none; border-radius: 50px; color: white; font-weight: 700; cursor: pointer;">BUY</button>
                                </div>
                            </div>
                            <!-- Featured Week -->
                            <div
                                style="background: linear-gradient(to bottom, rgb(255, 210, 190) 50%, white 50%); border-radius: 16px; text-align: center; overflow: hidden;">
                                <div style="padding: 20px 16px 16px;">
                                    <div style="font-size: 3rem; margin-bottom: 8px;">?</div>
                                </div>
                                <div style="padding: 0 16px 20px; background: white;">
                                    <div style="font-weight: 800; margin-bottom: 6px;">Featured Week</div>
                                    <div
                                        style="color: #ff9500; font-weight: 700; font-size: 0.85rem; margin-bottom: 12px;">
                                        2,000
                                        $SUITE</div>
                                    <button
                                        style="width: 100%; padding: 10px; background: linear-gradient(90deg, #ff8c42, #ff6b9d); border: none; border-radius: 50px; color: white; font-weight: 700; cursor: pointer;">BUY</button>
                                </div>
                            </div>
                            <!-- 2x Earn -->
                            <div
                                style="background: linear-gradient(to bottom, rgb(255, 210, 190) 50%, white 50%); border-radius: 16px; text-align: center; overflow: hidden;">
                                <div style="padding: 20px 16px 16px;">
                                    <div style="font-size: 3rem; margin-bottom: 8px;">2??</div>
                                </div>
                                <div style="padding: 0 16px 20px; background: white;">
                                    <div style="font-weight: 800; margin-bottom: 6px;">2x Earn</div>
                                    <div
                                        style="color: #ff9500; font-weight: 700; font-size: 0.85rem; margin-bottom: 12px;">
                                        500
                                        $SUITE</div>
                                    <button
                                        style="width: 100%; padding: 10px; background: linear-gradient(90deg, #ff8c42, #ff6b9d); border: none; border-radius: 50px; color: white; font-weight: 700; cursor: pointer;">BUY</button>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 24px;">
                            <a href="boost.html" class="btn-primary"
                                style="display: inline-block; text-decoration: none;">??
                                Visit
                                Full Store</a>
                        </div>
                    </div>
                </div>

                <!-- Apologetics Arena Panel -->
                <div id="panel-constitution" class="section-panel">
                    <!-- Header -->
                    <div class="panel-header"
                        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px;">
                        <div>
                            <h2 class="panel-title" style="display: flex; align-items: center; gap: 12px;">
                                <img src="assets/emojis/clay-trophy.png" alt="" style="width: 32px; height: 32px;">
                                The Constitution
                            </h2>
                            <p class="panel-desc">TELOS.md — The master constitution governing all AI systems in the
                                SUITE ecosystem.</p>
                        </div>
                        <a href="TELOS.md" target="_blank"
                            style="background: linear-gradient(135deg, #a855f7, #6366f1); color: white; padding: 10px 18px; border-radius: 100px; font-size: 0.85rem; font-weight: 700; text-decoration: none;">
                            <img src="assets/emojis/clay-book.png" alt=""
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">View
                            TELOS.md
                        </a>
                    </div>

                    <!-- Governance Explainer -->
                    <div
                        style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(99, 102, 241, 0.05)); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 24px;">
                        <h3
                            style="margin: 0 0 12px; font-size: 1.1rem; color: #a855f7; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.3rem;">🏛️</span> Governance Model
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px;">
                                <div style="font-weight: 700; color: #22c55e; margin-bottom: 8px;">📍 Current Phase:
                                    Founder Stewardship</div>
                                <p
                                    style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7); line-height: 1.6;">
                                    TELOS.md is maintained by Stuart Hollinger. All refinements are publicly
                                    documented,
                                    but final approval rests with the founder during this bootstrap phase.
                                </p>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px;">
                                <div style="font-weight: 700; color: #ff9500; margin-bottom: 8px;">🔮 Future Phase:
                                    Council Governance</div>
                                <p
                                    style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7); line-height: 1.6;">
                                    Holders who <strong style="color: #ff9500;">permanently lock SUITE</strong> in
                                    the
                                    Treasury
                                    become Council members with voting rights on TELOS.md amendments.
                                </p>
                            </div>
                        </div>
                        <p
                            style="margin: 16px 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.5); text-align: center; font-style: italic;">
                            "Locked forever = permanent voice in SUITE's direction"
                        </p>
                    </div>

                    <!-- Stats -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div
                            style="text-align: center; padding: 20px; background: linear-gradient(135deg, #22c55e, #16a34a); border-radius: 16px; color: white;">
                            <div style="font-size: 2rem; font-weight: 900;">5</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Core Principles</div>
                        </div>
                        <div
                            style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 16px; border: 1px solid rgba(255, 149, 0, 0.2);">
                            <div id="totalRefinements" style="font-size: 2rem; font-weight: 900; color: #ff9500;">0
                            </div>
                            <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">Refinements Submitted
                            </div>
                        </div>
                        <div
                            style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 16px; border: 1px solid rgba(168, 85, 247, 0.2);">
                            <div id="novelAttacksCount" style="font-size: 2rem; font-weight: 900; color: #a855f7;">0
                            </div>
                            <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">Novel Attacks Refuted
                            </div>
                        </div>
                        <div
                            style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 16px; border: 1px solid rgba(34, 197, 94, 0.2);">
                            <div style="font-size: 2rem; font-weight: 900; color: #22c55e;">v1.0</div>
                            <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">Current Version</div>
                        </div>
                    </div>

                    <!-- Core Principle Box -->
                    <div
                        style="background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; padding: 16px 20px; border-radius: 0 12px 12px 0; margin-bottom: 24px;">
                        <div style="font-weight: 700; color: #22c55e; margin-bottom: 4px;">CORE PRINCIPLE #1</div>
                        <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 1.1rem;">Truth wins over
                            untruth.
                            Always.</p>
                    </div>

                    <!-- Two Column Layout -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">

                        <!-- TELOS.md Viewer -->
                        <div
                            style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 24px; border: 1px solid rgba(255, 149, 0, 0.1);">
                            <h3
                                style="margin: 0 0 16px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                                <img src="assets/emojis/clay-book.png" alt="" style="width: 24px; height: 24px;">
                                TELOS.md Principles
                            </h3>

                            <div id="telosPrinciples" style="max-height: 350px; overflow-y: auto;">
                                <!-- Principle 1 -->
                                <details
                                    style="margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid #22c55e;">
                                    <summary
                                        style="padding: 12px 16px; cursor: pointer; font-weight: 600; color: white;">
                                        1. Truth Over Untruth
                                        <span style="float: right; font-size: 0.75rem; color: rgba(255,255,255,0.5);">0
                                            claims | 0 attacks</span>
                                    </summary>
                                    <div style="padding: 0 16px 16px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                        Truth wins. Always. All AI outputs must be grounded in verifiable truth.
                                    </div>
                                </details>

                                <!-- Principle 2 -->
                                <details
                                    style="margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid #22c55e;">
                                    <summary
                                        style="padding: 12px 16px; cursor: pointer; font-weight: 600; color: white;">
                                        2. Human Flourishing
                                        <span style="float: right; font-size: 0.75rem; color: rgba(255,255,255,0.5);">0
                                            claims | 0 attacks</span>
                                    </summary>
                                    <div style="padding: 0 16px 16px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                        All systems exist to serve human flourishing — spiritually, mentally,
                                        physically, and financially.
                                    </div>
                                </details>

                                <!-- Principle 3 -->
                                <details
                                    style="margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid #22c55e;">
                                    <summary
                                        style="padding: 12px 16px; cursor: pointer; font-weight: 600; color: white;">
                                        3. Transparency
                                        <span style="float: right; font-size: 0.75rem; color: rgba(255,255,255,0.5);">0
                                            claims | 0 attacks</span>
                                    </summary>
                                    <div style="padding: 0 16px 16px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                        All operations must be visible and auditable. No hidden agendas.
                                    </div>
                                </details>

                                <!-- Principle 4 -->
                                <details
                                    style="margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid #22c55e;">
                                    <summary
                                        style="padding: 12px 16px; cursor: pointer; font-weight: 600; color: white;">
                                        4. Sustainability
                                        <span style="float: right; font-size: 0.75rem; color: rgba(255,255,255,0.5);">0
                                            claims | 0 attacks</span>
                                    </summary>
                                    <div style="padding: 0 16px 16px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                        The ecosystem must be self-sustaining and perpetual.
                                    </div>
                                </details>

                                <!-- Principle 5 -->
                                <details
                                    style="margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid #a855f7;">
                                    <summary
                                        style="padding: 12px 16px; cursor: pointer; font-weight: 600; color: white;">
                                        5. Alignment with Creator's Intent
                                        <span style="float: right; font-size: 0.75rem; color: rgba(255,255,255,0.5);">0
                                            claims | 0 attacks</span>
                                    </summary>
                                    <div style="padding: 0 16px 16px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                        All AI behavior aligns with Christian values as interpreted through
                                        Scripture.
                                    </div>
                                </details>
                            </div>
                        </div>

                        <!-- Submit Refinement Form -->
                        <div
                            style="background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 24px; border: 1px solid rgba(255, 149, 0, 0.1);">
                            <h3
                                style="margin: 0 0 16px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                                <img src="assets/emojis/clay-chat.png" alt="" style="width: 24px; height: 24px;">
                                Submit Refinement
                            </h3>

                            <div style="margin-bottom: 12px;">
                                <label
                                    style="font-size: 0.85rem; font-weight: 600; color: rgba(255,255,255,0.6); display: block; margin-bottom: 8px;">Target
                                    Principle</label>
                                <select id="targetPrinciple"
                                    style="width: 100%; padding: 12px; border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 10px; background: rgba(0,0,0,0.2); color: white; font-size: 0.95rem;">
                                    <option value="1">1. Truth Over Untruth</option>
                                    <option value="2">2. Human Flourishing</option>
                                    <option value="3">3. Transparency</option>
                                    <option value="4">4. Sustainability</option>
                                    <option value="5">5. Alignment with Creator's Intent</option>
                                    <option value="new">+ Propose New Principle</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 12px;">
                                <label
                                    style="font-size: 0.85rem; font-weight: 600; color: rgba(255,255,255,0.6); display: block; margin-bottom: 8px;">Position</label>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                    <label
                                        style="padding: 10px 8px; background: rgba(168, 85, 247, 0.1); border: 2px solid rgba(168, 85, 247, 0.3); border-radius: 10px; cursor: pointer; text-align: center;">
                                        <input type="radio" name="submissionType" value="above" style="display: none;">
                                        <span style="color: #a855f7; font-weight: 600;">↑ Above</span>
                                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Higher tier
                                        </div>
                                    </label>
                                    <label
                                        style="padding: 10px 8px; background: rgba(255, 149, 0, 0.1); border: 2px solid rgba(255, 149, 0, 0.3); border-radius: 10px; cursor: pointer; text-align: center;">
                                        <input type="radio" name="submissionType" value="alongside" checked
                                            style="display: none;">
                                        <span style="color: #ff9500; font-weight: 600;">↔ Alongside</span>
                                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Equal weight
                                        </div>
                                    </label>
                                    <label
                                        style="padding: 10px 8px; background: rgba(34, 197, 94, 0.1); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 10px; cursor: pointer; text-align: center;">
                                        <input type="radio" name="submissionType" value="below" style="display: none;">
                                        <span style="color: #22c55e; font-weight: 600;">↓ Below</span>
                                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Sub-principle
                                        </div>
                                    </label>
                                </div>
                                <div
                                    style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 8px;">
                                    <label
                                        style="padding: 10px 8px; background: rgba(255, 107, 157, 0.1); border: 2px solid rgba(255, 107, 157, 0.3); border-radius: 10px; cursor: pointer; text-align: center;">
                                        <input type="radio" name="submissionType" value="refine" style="display: none;">
                                        <span style="color: #ff6b9d; font-weight: 600;">✏️ Refine</span>
                                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Edit wording
                                        </div>
                                    </label>
                                    <label
                                        style="padding: 10px 8px; background: rgba(239, 68, 68, 0.1); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 10px; cursor: pointer; text-align: center;">
                                        <input type="radio" name="submissionType" value="challenge"
                                            style="display: none;">
                                        <span style="color: #ef4444; font-weight: 600;">⚔️ Challenge</span>
                                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Test strength
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div style="margin-bottom: 16px;">
                                <label
                                    style="font-size: 0.85rem; font-weight: 600; color: rgba(255,255,255,0.6); display: block; margin-bottom: 8px;">Your
                                    Argument</label>
                                <textarea id="challengeInput"
                                    placeholder="Describe your attack, supporting evidence, or proposed refinement..."
                                    style="width: 100%; min-height: 100px; padding: 14px; border: 2px solid rgba(255, 149, 0, 0.2); border-radius: 12px; background: rgba(0,0,0,0.2); color: white; font-size: 0.95rem; resize: vertical;"></textarea>
                            </div>

                            <div
                                style="margin-bottom: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Submission
                                        Cost:</span>
                                    <span style="font-weight: 700; color: #ff9500;">0.5 SUITE <span
                                            style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">(~$0.002)</span></span>
                                </div>
                                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 8px;">🏆
                                    Rewards for Accepted Submissions:</div>
                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.85rem;">
                                    <div
                                        style="background: rgba(34, 197, 94, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 3px solid #22c55e;">
                                        <span style="color: #22c55e; font-weight: 700;">+10 SUITE</span>
                                        <span style="color: rgba(255,255,255,0.6);"> Supporting Claim</span>
                                    </div>
                                    <div
                                        style="background: rgba(255, 149, 0, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 3px solid #ff9500;">
                                        <span style="color: #ff9500; font-weight: 700;">+25 SUITE</span>
                                        <span style="color: rgba(255,255,255,0.6);"> Novel Attack</span>
                                    </div>
                                    <div
                                        style="background: rgba(168, 85, 247, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 3px solid #a855f7;">
                                        <span style="color: #a855f7; font-weight: 700;">+50 SUITE</span>
                                        <span style="color: rgba(255,255,255,0.6);"> Accepted Refinement</span>
                                    </div>
                                    <div
                                        style="background: rgba(255, 107, 157, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 3px solid #ff6b9d;">
                                        <span style="color: #ff6b9d; font-weight: 700;">+100 SUITE</span>
                                        <span style="color: rgba(255,255,255,0.6);"> New Principle</span>
                                    </div>
                                </div>
                            </div>

                            <button onclick="submitChallenge()"
                                style="width: 100%; padding: 14px; background: linear-gradient(135deg, #ff9500, #ff6b9d); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                                Submit for Review
                            </button>
                        </div>
                    </div>

                    <!-- TELOS.md History & Changelog -->
                    <div
                        style="margin-top: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 24px; border: 1px solid rgba(255, 149, 0, 0.1);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                                <img src="assets/emojis/clay-book.png" alt="" style="width: 24px; height: 24px;">
                                TELOS.md History
                            </h3>
                            <span style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">Immutable audit
                                trail</span>
                        </div>

                        <div
                            style="margin-bottom: 16px; padding: 12px 16px; background: rgba(168, 85, 247, 0.1); border-radius: 10px; border-left: 3px solid #a855f7;">
                            <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                                Every submission, refinement, and version change is permanently recorded here.
                                This log will exist as long as the SUITE ecosystem exists —
                                <strong style="color: #a855f7;">a living record from Day 1</strong>.
                            </p>
                        </div>

                        <!-- Version History -->
                        <div id="telosHistory" style="max-height: 300px; overflow-y: auto;">
                            <!-- Initial Version -->
                            <div
                                style="display: flex; gap: 16px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 12px; border-left: 3px solid #22c55e;">
                                <div style="flex-shrink: 0; width: 80px; text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: 900; color: #22c55e;">v1.0</div>
                                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">GENESIS</div>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: white; margin-bottom: 4px;">Initial
                                        Constitution Created</div>
                                    <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">
                                        5 core principles established: Truth Over Untruth, Human Flourishing,
                                        Transparency, Sustainability, Alignment with Creator's Intent
                                    </div>
                                    <div
                                        style="display: flex; justify-content: space-between; font-size: 0.75rem; color: rgba(255,255,255,0.5);">
                                        <span>👤 Stuart Hollinger (Founder)</span>
                                        <span>📅 Jan 11, 2026</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Placeholder for future entries -->
                            <div
                                style="text-align: center; padding: 20px; color: rgba(255,255,255,0.4); font-style: italic;">
                                Future refinements will appear here...
                            </div>
                        </div>
                    </div>

                    <!-- Beyond Good and Evil -->
                    <details
                        style="margin-top: 24px; background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 16px;">
                        <summary style="padding: 16px 20px; cursor: pointer; font-weight: 700; color: #a855f7;">
                            Beyond Good and Evil — Meta-Perspectives
                        </summary>
                        <div style="padding: 0 20px 20px; color: rgba(255,255,255,0.8); line-height: 1.7;">
                            <p>While TELOS.md operates on clear principles, the SUITE School acknowledges deeper
                                frameworks:</p>
                            <ul style="margin: 12px 0; padding-left: 20px;">
                                <li><strong>Moment View</strong> — Reality through present-moment consciousness</li>
                                <li><strong>Existential Matrix</strong> — The interconnected web of being</li>
                                <li><strong>Shape Meanings</strong> — Truth beyond language</li>
                            </ul>
                            <a href="https://docs.getsuite.app/school" target="_blank"
                                style="color: #a855f7; font-weight: 600;">Explore SUITE School →</a>
                        </div>
                    </details>
                </div>

                <!-- Giving Panel -->
                <div id="panel-giving" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Giving</h2>
                        <p class="panel-desc">10% of SUITE treasury yield goes to charity. Vote on causes that
                            matter.
                        </p>
                    </div>
                    <div class="iframe-container"
                        style="background: white; border-radius: 20px; overflow: hidden; height: calc(100vh - 200px); min-height: 500px;">
                        <iframe src="giving.html" style="width: 100%; height: 100%; border: none;"></iframe>
                    </div>
                </div>

                <!-- Content Studio Panel -->
                <div id="panel-studio" class="section-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">?? Content Studio</h2>
                        <p class="panel-desc">Create stunning promo videos & voiceovers for your apps using AI.</p>
                    </div>
                    <div class="section" id="section-content-studio" data-section="content-studio"
                        style="border: 2px solid rgba(255, 107, 157, 0.3); background: linear-gradient(135deg, rgba(255, 107, 157, 0.05), rgba(255, 149, 0, 0.05));">
                        <div class="section-header" onclick="toggleSection('content-studio')">
                            <div class="section-info">
                                <h3 class="section-title">?? Content Studio</h3>
                                <div class="section-desc">Create stunning promo videos & voiceovers for your apps
                                    using
                                    AI</div>
                            </div>
                            <div class="section-toggle">?</div>
                        </div>
                        <div class="section-content">
                            <!-- Owner Badge (shown for Stuart) -->
                            <div id="studioOwnerBadge"
                                style="display: none; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 12px 20px; border-radius: 12px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 1.5rem;">??</span>
                                <div>
                                    <div style="font-weight: 700;">Owner Access</div>
                                    <div style="font-size: 0.85rem; opacity: 0.9;">All content generation is FREE
                                        for
                                        you!</div>
                                </div>
                            </div>

                            <!-- Video Generation -->
                            <div style="background: white; border-radius: 20px; padding: 28px; margin-bottom: 20px;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px; margin-bottom: 20px;">
                                    <div>
                                        <h4
                                            style="font-size: 1.2rem; font-weight: 800; margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;">
                                            ?? Video Clips (Veo 2)
                                        </h4>
                                        <p style="color: #666; font-size: 0.9rem; margin: 0;">Generate 8-second
                                            claymation-style
                                            promo clips</p>
                                    </div>
                                    <div id="videoPricingBadge"
                                        style="background: linear-gradient(135deg, #ff9500, #ff6b9d); color: white; padding: 8px 16px; border-radius: 100px; font-weight: 700; font-size: 0.85rem;">
                                        100 SUITE / clip
                                    </div>
                                </div>

                                <!-- Template Selection -->
                                <div style="margin-bottom: 20px;">
                                    <label
                                        style="font-weight: 700; font-size: 0.9rem; color: #444; display: block; margin-bottom: 8px;">Choose
                                        Template</label>
                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="videoTemplate" value="builder-journey" checked
                                                style="display: none;">
                                            <div class="template-option"
                                                style="background: rgba(255, 149, 0, 0.1); border: 2px solid #ff9500; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700; font-size: 0.9rem;">Builder Journey
                                                </div>
                                                <div style="font-size: 0.75rem; color: #666;">6 panels</div>
                                            </div>
                                        </label>
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="videoTemplate" value="app-launch"
                                                style="display: none;">
                                            <div class="template-option"
                                                style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700; font-size: 0.9rem;">App Launch</div>
                                                <div style="font-size: 0.75rem; color: #666;">4 panels</div>
                                            </div>
                                        </label>
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="videoTemplate" value="feature-highlight"
                                                style="display: none;">
                                            <div class="template-option"
                                                style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">?</div>
                                                <div style="font-weight: 700; font-size: 0.9rem;">Feature Highlight
                                                </div>
                                                <div style="font-size: 0.75rem; color: #666;">3 panels</div>
                                            </div>
                                        </label>
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="videoTemplate" value="custom"
                                                style="display: none;">
                                            <div class="template-option"
                                                style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700; font-size: 0.9rem;">Custom</div>
                                                <div style="font-size: 0.75rem; color: #666;">Your idea</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Custom Prompt (shown for custom template) -->
                                <div id="customPromptSection" style="display: none; margin-bottom: 20px;">
                                    <label
                                        style="font-weight: 700; font-size: 0.9rem; color: #444; display: block; margin-bottom: 8px;">Describe
                                        Your Video</label>
                                    <textarea id="customVideoPrompt"
                                        placeholder="Describe what you want in your claymation video..."
                                        style="width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; font-size: 1rem; min-height: 100px; resize: vertical;"></textarea>
                                </div>

                                <!-- App Selection -->
                                <div style="margin-bottom: 20px;">
                                    <label
                                        style="font-weight: 700; font-size: 0.9rem; color: #444; display: block; margin-bottom: 8px;">Select
                                        App (optional)</label>
                                    <select id="videoAppSelect"
                                        style="width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; font-size: 1rem;">
                                        <option value="">General promo video</option>
                                    </select>
                                </div>

                                <!-- Pricing Tiers -->
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                    <label style="cursor: pointer;">
                                        <input type="radio" name="videoPriority" value="batch" style="display: none;">
                                        <div class="priority-option"
                                            style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px;">
                                            <div style="font-weight: 700; margin-bottom: 4px;">?? Batch</div>
                                            <div style="font-size: 0.85rem; color: #666;">24-hour delivery</div>
                                            <div style="font-weight: 800; color: #22c55e; margin-top: 8px;"
                                                id="batchPrice">50
                                                SUITE</div>
                                        </div>
                                    </label>
                                    <label style="cursor: pointer;">
                                        <input type="radio" name="videoPriority" value="priority" checked
                                            style="display: none;">
                                        <div class="priority-option"
                                            style="background: rgba(255, 149, 0, 0.1); border: 2px solid #ff9500; padding: 16px; border-radius: 12px;">
                                            <div style="font-weight: 700; margin-bottom: 4px;">? Priority</div>
                                            <div style="font-size: 0.85rem; color: #666;">1-2 hour delivery</div>
                                            <div style="font-weight: 800; color: #ff9500; margin-top: 8px;"
                                                id="priorityPrice">
                                                100 SUITE</div>
                                        </div>
                                    </label>
                                </div>

                                <button onclick="generateVideo()" class="btn-primary" style="width: 100%;">
                                    ?? Generate Video Clips
                                </button>
                            </div>

                            <!-- Voice Generation -->
                            <div style="background: white; border-radius: 20px; padding: 28px; margin-bottom: 20px;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px; margin-bottom: 20px;">
                                    <div>
                                        <h4
                                            style="font-size: 1.2rem; font-weight: 800; margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;">
                                            ??? Voice Generation (ElevenLabs)
                                        </h4>
                                        <p style="color: #666; font-size: 0.9rem; margin: 0;">Professional
                                            voiceovers
                                            for your
                                            videos and apps</p>
                                    </div>
                                </div>

                                <!-- Voice Selection -->
                                <div style="margin-bottom: 20px;">
                                    <label
                                        style="font-weight: 700; font-size: 0.9rem; color: #444; display: block; margin-bottom: 8px;">Select
                                        Voice</label>
                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="voiceSelect" value="adam" checked
                                                style="display: none;">
                                            <div class="voice-option"
                                                style="background: rgba(99, 102, 241, 0.1); border: 2px solid #6366f1; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700;">Adam</div>
                                                <div style="font-size: 0.75rem; color: #666;">Male</div>
                                            </div>
                                        </label>
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="voiceSelect" value="rachel"
                                                style="display: none;">
                                            <div class="voice-option"
                                                style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700;">Rachel</div>
                                                <div style="font-size: 0.75rem; color: #666;">Female</div>
                                            </div>
                                        </label>
                                        <label style="cursor: pointer;">
                                            <input type="radio" name="voiceSelect" value="sam" style="display: none;">
                                            <div class="voice-option"
                                                style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px; text-align: center;">
                                                <div style="font-size: 1.5rem; margin-bottom: 8px;">??</div>
                                                <div style="font-weight: 700;">Sam</div>
                                                <div style="font-size: 0.75rem; color: #666;">Neutral</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Voice Script -->
                                <div style="margin-bottom: 20px;">
                                    <label
                                        style="font-weight: 700; font-size: 0.9rem; color: #444; display: block; margin-bottom: 8px;">Script</label>
                                    <textarea id="voiceScript" placeholder="Enter the text you want spoken..."
                                        style="width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
                                    <div
                                        style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.85rem; color: #888;">
                                        <span>Suggested: "Build. Earn. Give."</span>
                                        <span id="voiceCharCount">0 / 500 chars</span>
                                    </div>
                                </div>

                                <!-- Voice Pricing -->
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                    <label style="cursor: pointer;">
                                        <input type="radio" name="voicePriority" value="standard" checked
                                            style="display: none;">
                                        <div class="priority-option"
                                            style="background: rgba(99, 102, 241, 0.1); border: 2px solid #6366f1; padding: 16px; border-radius: 12px;">
                                            <div style="font-weight: 700; margin-bottom: 4px;">⚙️ Standard</div>
                                            <div style="font-size: 0.85rem; color: #666;">Pre-made voices</div>
                                            <div style="font-weight: 800; color: #6366f1; margin-top: 8px;"
                                                id="voiceStandardPrice">
                                                50 SUITE</div>
                                        </div>
                                    </label>
                                    <label style="cursor: pointer;">
                                        <input type="radio" name="voicePriority" value="clone" style="display: none;">
                                        <div class="priority-option"
                                            style="background: #f8f9fa; border: 2px solid transparent; padding: 16px; border-radius: 12px;">
                                            <div style="font-weight: 700; margin-bottom: 4px;">?? Voice Clone</div>
                                            <div style="font-size: 0.85rem; color: #666;">Clone your own voice</div>
                                            <div style="font-weight: 800; color: #8b5cf6; margin-top: 8px;"
                                                id="voiceClonePrice">200
                                                SUITE</div>
                                        </div>
                                    </label>
                                </div>

                                <button onclick="generateVoice()" class="btn-primary"
                                    style="width: 100%; background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                                    ??? Generate Voiceover
                                </button>
                            </div>

                            <!-- Your Content Orders -->
                            <div style="background: #f8f9fa; border-radius: 16px; padding: 24px;">
                                <h4 style="font-weight: 700; margin: 0 0 16px 0;">?? Your Orders</h4>
                                <div id="contentOrdersList">
                                    <div class="empty-state" style="padding: 20px;">
                                        <p style="color: #888; margin: 0;">No content orders yet. Generate your
                                            first
                                            video or
                                            voiceover above!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        <!-- Content Marketplace Panel -->
        <div id="panel-marketplace" class="section-panel">
            <div class="panel-header">
                <h2 class="panel-title">?? Content Marketplace</h2>
                <p class="panel-desc">Post bounties for content, submit work, earn SUITE from the community.</p>
            </div>
            <div class="section" id="section-marketplace" data-section="marketplace"
                style="border: 2px solid rgba(139, 92, 246, 0.3); background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(99, 102, 241, 0.05));">
                <div class="section-header" onclick="toggleSection('marketplace')">
                    <div class="section-info">
                        <h3 class="section-title">?? Content Marketplace</h3>
                        <div class="section-desc">Post bounties for content, submit work, earn SUITE from the
                            community
                        </div>
                    </div>
                    <div class="section-toggle">?</div>
                </div>
                <div class="section-content">
                    <!-- Marketplace Stats -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                            <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Open Bounties
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 900; color: #ff9500;"
                                id="dashboardOpenBounties">�
                            </div>
                        </div>
                        <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                            <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">SUITE Paid Out
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 900; color: #22c55e;" id="dashboardTotalPaid">�
                            </div>
                        </div>
                        <div style="background: white; border-radius: 16px; padding: 20px; text-align: center;">
                            <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Your Submissions
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 900; color: #6366f1;"
                                id="dashboardYourSubmissions">
                                �</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
                        <button onclick="openBountyModal()" style="
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                            padding: 14px 28px;
                            background: linear-gradient(135deg, #8b5cf6, #6366f1);
                            color: white;
                            border: none;
                            border-radius: 100px;
                            font-weight: 700;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'"
                            onmouseout="this.style.transform='translateY(0)'">
                            ?? Post a Bounty
                        </button>
                        <a href="content.html" style="
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                            padding: 14px 28px;
                            background: rgba(255, 255, 255, 0.9);
                            color: #2d1b4e;
                            border: 1px solid rgba(0, 0, 0, 0.1);
                            border-radius: 100px;
                            font-weight: 700;
                            font-size: 1rem;
                            text-decoration: none;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='white'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.9)'">
                            ?? Browse All Bounties
                        </a>
                    </div>

                    <!-- Featured Bounties -->
                    <h4 style="font-weight: 700; margin: 0 0 16px 0;">?? Featured Bounties</h4>
                    <div id="featuredBounties"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <!-- Will be populated by JS -->
                        <div
                            style="background: white; border-radius: 16px; padding: 24px; text-align: center; color: #888;">
                            Loading bounties...
                        </div>
                    </div>

                    <!-- Your Bounties -->
                    <h4 style="font-weight: 700; margin: 0 0 16px 0;">?? Your Posted Bounties</h4>
                    <div id="yourBounties" style="background: #f8f9fa; border-radius: 16px; padding: 20px;">
                        <div class="empty-state" style="padding: 20px; text-align: center;">
                            <p style="color: #888; margin: 0;">You haven't posted any bounties yet. Post one to
                                get
                                content for your apps!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </main>
    </div>
    </div>

    <script>
        // Show LP Incentives section only for admin (Stuart)
        const isAdmin = true; // TODO: Check actual admin status
        if (isAdmin) {
            document.getElementById('lpIncentivesSection').style.display = 'block';
        }

        // Calculate estimated APY when inputs change
        function updateApyEstimate() {
            const amount = parseFloat(document.getElementById('lpIncentiveAmount').value) || 0;
            const months = parseInt(document.getElementById('lpIncentiveDuration').value);
            const monthlyAmount = amount / months;

            document.getElementById('monthlyEmission').textContent = monthlyAmount.toLocaleString() + ' SUITE';

            // Assuming pool TVL and SUITE price - this would be dynamic in prod
            const poolTvl = 3500; // $3500 example
            const yearlyRewards = monthlyAmount * 12;
            const apy = (yearlyRewards / poolTvl) * 100;
            document.getElementById('estimatedApy').textContent = apy.toFixed(1) + '%';
        }

        document.getElementById('lpIncentiveAmount')?.addEventListener('input', updateApyEstimate);
        document.getElementById('lpIncentiveDuration')?.addEventListener('change', updateApyEstimate);

        function allocateLpIncentives() {
            alert('LP Incentive allocation will be connected to smart contract. Coming soon!');
        }
    </script>
    <div id="editAppModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div
            style="background: white; border-radius: 24px; padding: 32px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 1.5rem; font-weight: 800; margin: 0;">?? Edit App</h3>
                <button onclick="closeEditAppModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">�</button>
            </div>

            <form id="editAppForm">
                <input type="hidden" id="editAppId">

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: 700; display: block; margin-bottom: 8px;">App Name</label>
                    <input type="text" id="editAppName" disabled
                        style="padding: 14px; border: 2px solid #eee; border-radius: 12px; width: 100%; background: #f8f9fa;">
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: 700; display: block; margin-bottom: 8px;">Icon URL</label>
                    <input type="url" id="editAppIconUrl" placeholder="https://example.com/icon.png"
                        style="padding: 14px; border: 2px solid #eee; border-radius: 12px; width: 100%;">
                    <small style="color: #888; font-size: 0.8rem;">Upload your icon to Imgur, Discord CDN,
                        or your
                        own hosting</small>
                    <div id="iconPreview" style="margin-top: 12px; text-align: center;"></div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: 700; display: block; margin-bottom: 8px;">Description</label>
                    <textarea id="editAppDescription" placeholder="What does your app do?" rows="3"
                        style="padding: 14px; border: 2px solid #eee; border-radius: 12px; width: 100%; resize: vertical;"></textarea>
                </div>

                <div class="form-group" style="margin-bottom: 24px;">
                    <label style="font-weight: 700; display: block; margin-bottom: 8px;">Category</label>
                    <select id="editAppCategory"
                        style="padding: 14px; border: 2px solid #eee; border-radius: 12px; width: 100%;">
                        <option value="productivity">Productivity</option>
                        <option value="health">Health & Fitness</option>
                        <option value="finance">Finance</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="education">Education</option>
                        <option value="utilities">Utilities</option>
                        <option value="social">Social</option>
                    </select>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" onclick="closeEditAppModal()"
                        style="padding: 14px 24px; border: 2px solid #eee; background: white; border-radius: 12px; cursor: pointer; font-weight: 600;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 14px 24px;">?? Save
                        Changes</button>
                </div>
            </form>
        </div>
    </div>
    </div>









    <script>

        const SUPABASE_URL = 'https://rdsmdywbdiskxknluiym.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkc21keXdiZGlza3hrbmx1aXltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODk3MTgsImV4cCI6MjA4MzM2NTcxOH0.DcLpWs8Lf1s4Flf54J5LubokSYrd7h-XvI_X0jj6bLM';
        const DISCORD_CLIENT_ID = '1457474266390986865';
        const REDIRECT_URI = window.location.origin + '/dashboard.html';

        let currentUser = null;

        // ========== COLLAPSIBLE SECTIONS ==========
        function toggleSection(sectionName) {
            const section = document.getElementById(`section-${sectionName}`);
            if (!section) return;

            section.classList.toggle('collapsed');

            // Save state to localStorage
            const states = JSON.parse(localStorage.getItem('dashboardSections') || '{ }');
            states[sectionName] = section.classList.contains('collapsed');
            localStorage.setItem('dashboardSections', JSON.stringify(states));
        }

        function initSectionStates() {
            const states = JSON.parse(localStorage.getItem('dashboardSections') || '{ }');

            // Default: apps open, others collapsed
            const defaults = {
                'campaigns': true,
                'my-campaigns': true,
                'apps': false,  // Open by default
                'reviews': true,
                'powerups': true
            };

            Object.keys(defaults).forEach(sectionName => {
                const section = document.getElementById(`section-${sectionName}`);
                if (!section) return;

                const isCollapsed = states[sectionName] !== undefined ? states[sectionName] : defaults[sectionName];
                if (isCollapsed) {
                    section.classList.add('collapsed');
                } else {
                    section.classList.remove('collapsed');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize collapsible sections
            initSectionStates();

            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const accessToken = params.get('access_token');

            if (accessToken) {
                handleOAuthCallback(accessToken);
            } else {
                const savedUser = localStorage.getItem('suiteDev');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    showDashboard();
                }
            }
        });

        function loginWithDiscord() {
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;
            window.location.href = authUrl;
        }

        async function handleOAuthCallback(accessToken) {
            try {
                const response = await fetch('https://discord.com/api/users/@me', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const user = await response.json();

                currentUser = {
                    id: user.id,
                    username: user.username,
                    avatar: user.avatar
                        ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
                        : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`
                };

                localStorage.setItem('suiteDev', JSON.stringify(currentUser));
                history.replaceState(null, '', window.location.pathname);
                showDashboard();
            } catch (error) {
                console.error('OAuth error:', error);
                alert('Login failed. Please try again.');
            }
        }

        function showDashboard() {
            // Hide login banner, show user pill
            document.getElementById('loginBanner').style.display = 'none';
            document.getElementById('userPill').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userAvatar').src = currentUser.avatar;

            loadDevData();
        }

        async function loadDevData() {
            await Promise.all([
                loadApps(),
                loadCampaigns(),
                loadBalance()
            ]);
        }

        async function loadApps() {
            try {
                // Query suite_apps table for apps created by this user
                const url = `${SUPABASE_URL}/rest/v1/suite_apps?creator_discord_id=eq.${currentUser.id}&select=*`;
                console.log('?? Loading apps for Discord ID:', currentUser.id);
                console.log('?? API URL:', url);

                const response = await fetch(url, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const apps = await response.json();

                console.log('?? API Response:', apps);
                console.log('?? Apps count:', Array.isArray(apps) ? apps.length : 'Not an array');

                document.getElementById('totalApps').textContent = Array.isArray(apps) ? apps.length : 0;

                const select = document.getElementById('appSelect');
                const powerupSelect = document.getElementById('powerupAppSelect');
                const reviewSelect = document.getElementById('reviewAppSelect');
                select.innerHTML = '<option value="">Choose an app...</option>';
                if (powerupSelect) powerupSelect.innerHTML = '<option value="">Choose an app...</option>';
                if (reviewSelect) reviewSelect.innerHTML = '<option value="">Choose an app...</option>';

                if (Array.isArray(apps)) {
                    apps.forEach(app => {
                        const option = `<option value="${app.id}">${app.name}</option>`;
                        select.innerHTML += option;
                        if (powerupSelect) powerupSelect.innerHTML += option;
                        if (reviewSelect) reviewSelect.innerHTML += option;
                    });
                }

                const appsList = document.getElementById('appsList');
                if (!Array.isArray(apps) || apps.length === 0) {
                    appsList.innerHTML = '<div class="empty-state"><p>No apps yet. <a href="start-building.html" style="color: #ff9500;">Submit your first app!</a></p></div>';
                } else {
                    appsList.innerHTML = apps.map(app => `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <img src="${app.icon_url || 'assets/suite-mascot.png'}" alt="${app.name}" style="border-radius: 12px;" onerror="this.src='assets/suite-mascot.png'">
                                <div>
                                    <strong>${app.name}</strong>
                                    <div style="font-size: 0.85rem; color: #888;">${app.tagline || app.description || 'No description'}</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <button onclick="openEditAppModal('${app.id}', '${app.name}', '${app.icon_url || ''}', '${(app.description || '').replace(/'/g, "\\'")}', '${app.category || ''}')" 
                                    style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-weight: 600; cursor: pointer;">
                                    ?? Edit
                                </button>
                                <span class="badge badge-${app.status === 'published' || app.status === 'approved' ? 'active' : 'paused'}">${app.status || 'development'}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading apps:', error);
                document.getElementById('totalApps').textContent = '0';
            }
        }

        async function loadCampaigns() {
            try {
                // Note: app_campaigns references suite_apps via app_id
                const response = await fetch(`${SUPABASE_URL}/rest/v1/app_campaigns?developer_discord_id=eq.${currentUser.id}&select=*,suite_apps(name,icon_url)`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const campaigns = await response.json();

                if (!Array.isArray(campaigns)) {
                    document.getElementById('totalCampaigns').textContent = '0';
                    document.getElementById('totalClaims').textContent = '0';
                    return;
                }

                const active = campaigns.filter(c => c.status === 'active');
                document.getElementById('totalCampaigns').textContent = active.length;
                document.getElementById('totalClaims').textContent = campaigns.reduce((sum, c) => sum + (c.claims_count || 0), 0).toLocaleString();

                const list = document.getElementById('campaignsList');
                if (campaigns.length === 0) {
                    list.innerHTML = '<div class="empty-state"><p>No campaigns yet. Create one above!</p></div>';
                } else {
                    list.innerHTML = campaigns.map(c => `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <img src="${c.suite_apps?.icon_url || 'assets/suite-mascot.png'}" alt="" style="border-radius: 12px;">
                                <div>
                                    <strong>${c.suite_apps?.name || 'Unknown App'}</strong>
                                    <div style="font-size: 0.85rem; color: #888;">+${c.suite_per_claim} SUITE per user</div>
                                </div>
                            </div>
                            <div class="campaign-stats">
                                <span><strong>${c.claims_count || 0}</strong> Claims</span>
                                <span><strong>${c.remaining_budget?.toLocaleString() || 0}</strong> Budget Left</span>
                            </div>
                            <span class="badge badge-${c.status}">${c.status}</span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading campaigns:', error);
                document.getElementById('totalCampaigns').textContent = '0';
                document.getElementById('totalClaims').textContent = '0';
            }
        }

        async function loadBalance() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/user_credits?discord_id=eq.${currentUser.id}&select=suite_balance`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const data = await response.json();
                const balance = data[0]?.suite_balance || 0;
                document.getElementById('suiteBalance').textContent = balance;
            } catch (error) {
                console.error('Error loading balance:', error);
            }
        }

        // Update cost display
        document.getElementById('totalBudget').addEventListener('input', (e) => {
            document.getElementById('campaignCost').textContent = parseInt(e.target.value || 0).toLocaleString() + ' SUITE';
        });

        // Form submission
        document.getElementById('campaignForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const appId = document.getElementById('appSelect').value;
            const rewardAmount = parseInt(document.getElementById('rewardAmount').value);
            const totalBudget = parseInt(document.getElementById('totalBudget').value);
            const maxClaims = document.getElementById('maxClaims').value ? parseInt(document.getElementById('maxClaims').value) : null;
            const requireTime = document.getElementById('requireTime').checked;
            const minTime = requireTime ? parseInt(document.getElementById('minTime').value || 10) * 60 : 0;
            const requireActions = document.getElementById('requireActions').checked;
            const minActions = requireActions ? parseInt(document.getElementById('minActions').value || 50) : 0;

            if (!appId) {
                alert('Please select an app');
                return;
            }

            // Check balance
            const balance = parseInt(document.getElementById('suiteBalance').textContent);
            if (balance < totalBudget) {
                alert(`Insufficient SUITE balance. You have ${balance} but need ${totalBudget}.`);
                return;
            }

            try {
                const btn = document.getElementById('createCampaignBtn');
                btn.disabled = true;
                btn.textContent = 'Creating...';

                const response = await fetch('/api/create-campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        app_id: appId,
                        developer_discord_id: currentUser.id,
                        suite_per_claim: rewardAmount,
                        total_budget: totalBudget,
                        max_claims: maxClaims,
                        require_time: requireTime,
                        min_time_seconds: minTime,
                        require_actions: requireActions,
                        min_actions: minActions
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('Campaign created successfully!');
                    await loadDevData();
                    document.getElementById('campaignForm').reset();
                } else {
                    alert(result.error || 'Failed to create campaign');
                }

                btn.disabled = false;
                btn.textContent = '?? Launch Campaign';
            } catch (error) {
                console.error('Error creating campaign:', error);
                alert('Error creating campaign');
            }
        });

        function logout() {
            localStorage.removeItem('suiteDev');
            currentUser = null;
            // Show login banner, hide user pill, reset to dashes
            document.getElementById('loginBanner').style.display = 'flex';
            document.getElementById('userPill').style.display = 'none';
            // Reset to dashes (not logged in state)
            document.getElementById('totalApps').textContent = '-';
            document.getElementById('totalCampaigns').textContent = '-';
            document.getElementById('totalClaims').textContent = '-';
            document.getElementById('suiteBalance').textContent = '-';
        }

        // ========== POWER-UP FUNCTIONS ==========

        let userApps = []; // Store apps for power-up dropdown

        async function loadPowerups() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/store_powerups?creator_discord_id=eq.${currentUser.id}&select=*`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const powerups = await response.json();

                const list = document.getElementById('powerupsList');
                if (!powerups || powerups.length === 0) {
                    list.innerHTML = '<div class="empty-state"><p>No power-ups yet. Create your first one above!</p></div>';
                } else {
                    list.innerHTML = powerups.map(p => `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <div style="font-size: 2rem; margin-right: 8px;">${p.icon || '?'}</div>
                                <div>
                                    <strong>${p.name}</strong>
                                    <div style="font-size: 0.85rem; color: #888;">${p.description}</div>
                                </div>
                            </div>
                            <div class="campaign-stats">
                                <span><strong>${p.total_sales || 0}</strong> Sales</span>
                                <span><strong>${p.price}</strong> SUITE</span>
                            </div>
                            <span class="badge ${p.status === 'active' ? 'badge-active' : 'badge-paused'}">${p.status || 'pending'}</span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading power-ups:', error);
            }
        }

        function populatePowerupAppSelect(apps) {
            userApps = apps;
            const select = document.getElementById('powerupAppSelect');
            select.innerHTML = '<option value="">Choose an app...</option>';
            apps.forEach(app => {
                select.innerHTML += `<option value="${app.id}">${app.name}</option>`;
            });
        }

        // Power-up form submission
        document.getElementById('powerupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const appId = document.getElementById('powerupAppSelect').value;
            const name = document.getElementById('powerupName').value;
            const description = document.getElementById('powerupDesc').value;
            const icon = document.getElementById('powerupIcon').value || '?';
            const price = parseInt(document.getElementById('powerupPrice').value);
            const duration = parseInt(document.getElementById('powerupDuration').value);

            if (!appId) {
                alert('Please select an app');
                return;
            }

            const selectedApp = userApps.find(a => a.id == appId);

            try {
                const btn = document.getElementById('createPowerupBtn');
                btn.disabled = true;
                btn.textContent = 'Creating...';

                const response = await fetch(`${SUPABASE_URL}/rest/v1/store_powerups`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        creator_discord_id: currentUser.id,
                        app_id: appId,
                        app_name: selectedApp?.name || 'Unknown',
                        name: name,
                        description: description,
                        icon: icon,
                        price: price,
                        duration_days: duration,
                        status: 'pending', // Requires approval
                        total_sales: 0,
                        revenue_earned: 0
                    })
                });

                if (response.ok) {
                    alert('Power-up submitted for review! It will appear in the Store once approved.');
                    document.getElementById('powerupForm').reset();
                    document.getElementById('powerupIcon').value = '??';
                    await loadPowerups();
                } else {
                    throw new Error('Failed to create power-up');
                }

                btn.disabled = false;
                btn.textContent = '? Create Power-Up';
            } catch (error) {
                console.error('Error creating power-up:', error);
                alert('Error creating power-up. Please try again.');
                document.getElementById('createPowerupBtn').disabled = false;
                document.getElementById('createPowerupBtn').textContent = '? Create Power-Up';
            }
        });

        // Update loadApps to also populate power-up dropdown
        const originalLoadApps = loadApps;
        loadApps = async function () {
            await originalLoadApps();
            // Get apps for power-up select
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/apps?creator_discord_id=eq.${currentUser.id}&select=*`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const apps = await response.json();
                populatePowerupAppSelect(apps);
            } catch (e) { console.error('Error populating power-up select:', e); }
        };

        // Load power-ups when dashboard loads
        const originalLoadDevData = loadDevData;
        loadDevData = async function () {
            await originalLoadDevData();
            await loadPowerups();
            await loadReviewCampaigns();
        };

        // ========== REVIEW CAMPAIGN FUNCTIONS ==========

        // Update review count estimate
        function updateReviewEstimate() {
            const budget = parseInt(document.getElementById('reviewBudget').value) || 500;
            const reward = parseInt(document.getElementById('reviewReward').value) || 50;
            const estimate = Math.floor(budget / reward);
            document.getElementById('reviewCountEstimate').textContent = estimate;
        }

        document.getElementById('reviewBudget')?.addEventListener('input', updateReviewEstimate);
        document.getElementById('reviewReward')?.addEventListener('input', updateReviewEstimate);

        // Load existing review campaigns
        async function loadReviewCampaigns() {
            if (!currentUser) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/review_campaigns?developer_discord_id=eq.${currentUser.id}&select=*,suite_apps(name,icon_url)`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });
                const campaigns = await response.json();

                const list = document.getElementById('reviewCampaignsList');
                if (!campaigns || campaigns.length === 0 || campaigns.error) {
                    list.innerHTML = '<div class="empty-state"><p>No review campaigns yet. Create one above to get feedback!</p></div>';
                } else {
                    list.innerHTML = campaigns.map(c => {
                        const minMins = Math.floor(c.min_usage_seconds / 60);
                        return `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <div style="font-size: 2rem; margin-right: 8px;"></div>
                                <div>
                                    <strong>${c.suite_apps?.name || 'Unknown App'}</strong>
                                    <div style="font-size: 0.85rem; color: #888;">+${c.suite_per_review} SUITE per review ? ${minMins}min min</div>
                                </div>
                            </div>
                            <div class="campaign-stats">
                                <span><strong>${c.reviews_count || 0}</strong> Reviews</span>
                                <span><strong>${c.remaining_budget}</strong> Budget Left</span>
                            </div>
                            <span class="badge badge-${c.status}">${c.status}</span>
                        </div>
                    `}).join('');
                }
            } catch (error) {
                console.error('Error loading review campaigns:', error);
            }
        }

        // Create review campaign form handler
        document.getElementById('reviewCampaignForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) {
                alert('Please log in first');
                return;
            }

            const appId = document.getElementById('reviewAppSelect').value;
            const suitePerReview = parseInt(document.getElementById('reviewReward').value);
            const minUsageSeconds = parseInt(document.getElementById('reviewMinTime').value);
            const totalBudget = parseInt(document.getElementById('reviewBudget').value);

            if (!appId) {
                alert('Please select an app');
                return;
            }

            // Check balance
            const balance = parseInt(document.getElementById('suiteBalance').textContent.replace(/,/g, '')) || 0;
            if (balance < totalBudget) {
                alert(`Insufficient SUITE balance. You have ${balance} but need ${totalBudget}.`);
                return;
            }

            const btn = document.getElementById('createReviewCampaignBtn');
            btn.disabled = true;
            btn.textContent = 'Creating...';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/review_campaigns`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        app_id: appId,
                        developer_discord_id: currentUser.id,
                        suite_per_review: suitePerReview,
                        min_usage_seconds: minUsageSeconds,
                        total_budget: totalBudget,
                        remaining_budget: totalBudget,
                        status: 'active'
                    })
                });

                if (response.ok) {
                    alert('Review campaign created! Users can now earn SUITE by reviewing your app.');
                    document.getElementById('reviewCampaignForm').reset();
                    document.getElementById('reviewReward').value = '50';
                    document.getElementById('reviewBudget').value = '500';
                    updateReviewEstimate();
                    await loadReviewCampaigns();
                } else {
                    const err = await response.json();
                    throw new Error(err.message || 'Failed to create campaign');
                }
            } catch (error) {
                console.error('Error creating review campaign:', error);
                alert('Error creating review campaign: ' + error.message);
            }

            btn.disabled = false;
            btn.textContent = '?? Start Review Campaign';
        });

        // ========== EDIT APP MODAL ==========
        function openEditAppModal(id, name, iconUrl, description, category) {
            document.getElementById('editAppId').value = id;
            document.getElementById('editAppName').value = name;
            document.getElementById('editAppIconUrl').value = iconUrl;
            document.getElementById('editAppDescription').value = description;
            document.getElementById('editAppCategory').value = category || 'productivity';

            // Show icon preview
            updateIconPreview(iconUrl);

            document.getElementById('editAppModal').style.display = 'flex';
        }

        function closeEditAppModal() {
            document.getElementById('editAppModal').style.display = 'none';
        }

        function updateIconPreview(url) {
            const preview = document.getElementById('iconPreview');
            if (url) {
                preview.innerHTML = `<img src="${url}" alt="Preview" style="width: 80px; height: 80px; border-radius: 16px; object-fit: cover;" onerror="this.outerHTML='<span style=\\'color: red; font-size: 0.9rem;\\'>?? Invalid image URL</span>'">`;
            } else {
                preview.innerHTML = '';
            }
        }

        // Live preview as user types icon URL
        document.getElementById('editAppIconUrl').addEventListener('input', (e) => {
            updateIconPreview(e.target.value);
        });

        // Save app changes
        document.getElementById('editAppForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('editAppId').value;
            const iconUrl = document.getElementById('editAppIconUrl').value;
            const description = document.getElementById('editAppDescription').value;
            const category = document.getElementById('editAppCategory').value;

            try {
                // Try updating suite_apps first
                let response = await fetch(`${SUPABASE_URL}/rest/v1/suite_apps?id=eq.${id}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        icon_url: iconUrl || null,
                        description: description,
                        category: category
                    })
                });

                // Also try updating the apps table (for apps there)
                await fetch(`${SUPABASE_URL}/rest/v1/apps?id=eq.${id}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        icon_url: iconUrl || null,
                        description: description,
                        category: category
                    })
                });

                alert('? App updated successfully!');
                closeEditAppModal();
                loadApps(); // Reload apps list
            } catch (error) {
                console.error('Error updating app:', error);
                alert('Error updating app: ' + error.message);
            }
        });

        // Close modal when clicking outside
        document.getElementById('editAppModal').addEventListener('click', (e) => {
            if (e.target.id === 'editAppModal') {
                closeEditAppModal();
            }
        });

        // --- PC PROMPT SERVER FUNCTIONS (Owner Only) ---
        const PC_SERVER_URL = 'http://10.0.0.142:3000';  // Stuart's PC
        const OWNER_DISCORD_ID = '1135315153824993402';  // Stuart's Discord ID

        // Show prompt server section only for owner
        function checkOwnerAccess() {
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const savedUser = localStorage.getItem('suiteDev');
            let isOwner = false;

            if (savedUser) {
                const user = JSON.parse(savedUser);
                isOwner = user.id === OWNER_DISCORD_ID;
            }

            // Show on localhost (for testing) OR if logged in as Stuart
            if (isLocalhost || isOwner) {
                document.getElementById('section-prompt-server').style.display = 'block';
                checkPcStatus();
                setInterval(checkPcStatus, 10000); // Check every 10 sec
            }
        }

        async function checkPcStatus() {
            try {
                const res = await fetch(`${PC_SERVER_URL}/status`);
                const data = await res.json();
                document.getElementById('pcStatus').textContent = '?? Connected';
                document.getElementById('pcStatus').style.color = '#22c55e';
                document.getElementById('pendingPrompts').textContent = data.pending_prompts || 0;

                // Update auto-pull status
                if (data.auto_pull) {
                    document.getElementById('autoPullStatus').textContent = 'ON';
                    document.getElementById('autoPullStatus').style.color = '#22c55e';
                    document.getElementById('autoPullBtn').innerHTML = '?? Auto-Pull: ON';
                    document.getElementById('autoPullBtn').style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    document.getElementById('autoPullBtn').style.color = 'white';
                } else {
                    document.getElementById('autoPullStatus').textContent = 'OFF';
                    document.getElementById('autoPullStatus').style.color = '#6b7280';
                    document.getElementById('autoPullBtn').innerHTML = '?? Auto-Pull: OFF';
                    document.getElementById('autoPullBtn').style.background = '#f3f4f6';
                    document.getElementById('autoPullBtn').style.color = '#5a4a6f';
                }
            } catch (err) {
                document.getElementById('pcStatus').textContent = '?? Offline';
                document.getElementById('pcStatus').style.color = '#ef4444';
            }
        }

        async function sendPcPrompt() {
            const prompt = document.getElementById('pcPrompt').value.trim();
            const responseEl = document.getElementById('pcResponse');

            if (!prompt) {
                responseEl.style.display = 'block';
                responseEl.style.background = 'rgba(239, 68, 68, 0.1)';
                responseEl.style.color = '#ef4444';
                responseEl.textContent = '? Please enter a prompt';
                return;
            }

            try {
                const res = await fetch(`${PC_SERVER_URL}/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });
                const data = await res.json();

                responseEl.style.display = 'block';
                if (data.success) {
                    responseEl.style.background = 'rgba(34, 197, 94, 0.1)';
                    responseEl.style.color = '#22c55e';
                    responseEl.textContent = '? Sent to PC! Watcher will process it.';
                    document.getElementById('pcPrompt').value = '';
                    checkPcStatus();
                } else {
                    responseEl.style.background = 'rgba(239, 68, 68, 0.1)';
                    responseEl.style.color = '#ef4444';
                    responseEl.textContent = '? ' + (data.error || 'Failed to send');
                }
            } catch (err) {
                responseEl.style.display = 'block';
                responseEl.style.background = 'rgba(239, 68, 68, 0.1)';
                responseEl.style.color = '#ef4444';
                responseEl.textContent = '? PC offline or not reachable';
            }
        }

        async function gitPullNow() {
            const responseEl = document.getElementById('pcResponse');
            try {
                const res = await fetch(`${PC_SERVER_URL}/pull`, { method: 'POST' });
                const data = await res.json();

                responseEl.style.display = 'block';
                if (data.success) {
                    responseEl.style.background = 'rgba(34, 197, 94, 0.1)';
                    responseEl.style.color = '#22c55e';
                    responseEl.textContent = '?? ' + (data.output || 'Already up to date');
                } else {
                    responseEl.style.background = 'rgba(239, 68, 68, 0.1)';
                    responseEl.style.color = '#ef4444';
                    responseEl.textContent = '? Pull failed: ' + data.error;
                }
            } catch (err) {
                responseEl.style.display = 'block';
                responseEl.style.background = 'rgba(239, 68, 68, 0.1)';
                responseEl.style.color = '#ef4444';
                responseEl.textContent = '? Could not reach PC';
            }
        }

        async function toggleAutoPull() {
            try {
                const res = await fetch(`${PC_SERVER_URL}/auto-pull`, { method: 'POST' });
                const data = await res.json();
                checkPcStatus(); // Refresh status
            } catch (err) {
                console.error('Failed to toggle auto-pull:', err);
            }
        }

        function sendQuickPrompt(prompt) {
            document.getElementById('pcPrompt').value = prompt;
            sendPcPrompt();
        }

        // --- CONTENT STUDIO FUNCTIONS ---
        const OWNER_USER_ID = OWNER_DISCORD_ID;
        let isOwnerUser = false;

        // Check if user is owner for free access
        function checkContentStudioOwner() {
            const savedUser = localStorage.getItem('suiteDev');
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

            if (savedUser) {
                const user = JSON.parse(savedUser);
                isOwnerUser = user.id === OWNER_USER_ID;
            }

            if (isLocalhost || isOwnerUser) {
                // Show owner badge and set free pricing
                document.getElementById('studioOwnerBadge').style.display = 'flex';
                document.getElementById('videoPricingBadge').innerHTML = '<span style="text-decoration: line-through; opacity: 0.6;">100 SUITE</span> FREE';
                document.getElementById('batchPrice').innerHTML = '<span style="text-decoration: line-through;">50</span> FREE';
                document.getElementById('priorityPrice').innerHTML = '<span style="text-decoration: line-through;">100</span> FREE';
                document.getElementById('voiceStandardPrice').innerHTML = '<span style="text-decoration: line-through;">50</span> FREE';
                document.getElementById('voiceClonePrice').innerHTML = '<span style="text-decoration: line-through;">200</span> FREE';
            }
        }

        // Template selection handling
        document.querySelectorAll('input[name="videoTemplate"]').forEach(radio => {
            radio.addEventListener('change', function () {
                // Update visual selection
                document.querySelectorAll('.template-option').forEach(opt => {
                    opt.style.background = '#f8f9fa';
                    opt.style.borderColor = 'transparent';
                });
                this.nextElementSibling.style.background = 'rgba(255, 149, 0, 0.1)';
                this.nextElementSibling.style.borderColor = '#ff9500';

                // Show/hide custom prompt
                const customSection = document.getElementById('customPromptSection');
                customSection.style.display = this.value === 'custom' ? 'block' : 'none';
            });
        });

        // Priority selection handling for video
        document.querySelectorAll('input[name="videoPriority"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.querySelectorAll('input[name="videoPriority"]').forEach(r => {
                    const div = r.nextElementSibling;
                    if (r.checked) {
                        div.style.background = 'rgba(255, 149, 0, 0.1)';
                        div.style.borderColor = '#ff9500';
                    } else {
                        div.style.background = '#f8f9fa';
                        div.style.borderColor = 'transparent';
                    }
                });
            });
        });

        // Voice selection handling
        document.querySelectorAll('input[name="voiceSelect"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.querySelectorAll('.voice-option').forEach(opt => {
                    opt.style.background = '#f8f9fa';
                    opt.style.borderColor = 'transparent';
                });
                this.nextElementSibling.style.background = 'rgba(99, 102, 241, 0.1)';
                this.nextElementSibling.style.borderColor = '#6366f1';
            });
        });

        // Voice script character counter
        document.getElementById('voiceScript')?.addEventListener('input', function () {
            const count = this.value.length;
            document.getElementById('voiceCharCount').textContent = `${count} / 500 chars`;
        });

        // Generate video function
        function generateVideo() {
            const template = document.querySelector('input[name="videoTemplate"]:checked').value;
            const priority = document.querySelector('input[name="videoPriority"]:checked').value;
            const app = document.getElementById('videoAppSelect').value;
            const customPrompt = document.getElementById('customVideoPrompt')?.value || '';

            const cost = isOwnerUser ? 0 : (priority === 'batch' ? 50 : 100);

            if (cost > 0) {
                const confirm = window.confirm(`This will cost ${cost} SUITE. Proceed?`);
                if (!confirm) return;
            }

            // For now, show confirmation
            alert(`?? Video generation request submitted!\n\nTemplate: ${template}\nPriority: ${priority}\nCost: ${cost === 0 ? 'FREE (Owner)' : cost + ' SUITE'}\n\nYou'll receive your clips within ${priority === 'batch' ? '24 hours' : '1-2 hours'}.`);
        }

        // Generate voice function
        function generateVoice() {
            const voice = document.querySelector('input[name="voiceSelect"]:checked').value;
            const priority = document.querySelector('input[name="voicePriority"]:checked').value;
            const script = document.getElementById('voiceScript').value;

            if (!script.trim()) {
                alert('Please enter a script to generate voiceover.');
                return;
            }

            const cost = isOwnerUser ? 0 : (priority === 'clone' ? 200 : 50);

            if (cost > 0) {
                const confirm = window.confirm(`This will cost ${cost} SUITE. Proceed?`);
                if (!confirm) return;
            }

            alert(`??? Voiceover generation submitted!\n\nVoice: ${voice}\nType: ${priority === 'clone' ? 'Voice Clone' : 'Standard'}\nCost: ${cost === 0 ? 'FREE (Owner)' : cost + ' SUITE'}\n\nYour audio will be ready shortly.`);
        }

        // --- CONTENT MARKETPLACE FUNCTIONS ---
        async function loadMarketplaceBounties() {
            try {
                const { data: bounties, error } = await supabase
                    .from('content_bounties')
                    .select('*')
                    .eq('status', 'open')
                    .order('reward_amount', { ascending: false })
                    .limit(3);

                if (error) throw error;

                // Update stats
                const openCount = bounties?.length || 0;
                document.getElementById('dashboardOpenBounties').textContent = openCount;

                // Get total paid
                const { data: completed } = await supabase
                    .from('content_bounties')
                    .select('reward_amount')
                    .eq('status', 'completed');

                const totalPaid = (completed || []).reduce((sum, b) => sum + b.reward_amount, 0);
                document.getElementById('dashboardTotalPaid').textContent = totalPaid > 0 ? totalPaid.toLocaleString() : '0';

                // Render featured bounties
                const container = document.getElementById('featuredBounties');
                if (bounties && bounties.length > 0) {
                    container.innerHTML = bounties.map(b => `
                            <div onclick="window.location='content.html'" style="background: white; border-radius: 16px; padding: 20px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="background: rgba(255, 149, 0, 0.1); color: #ff9500; padding: 4px 10px; border-radius: 100px; font-size: 0.75rem; font-weight: 700;">
                                        ${b.content_type === 'video' ? '??' : b.content_type === 'graphic' ? '??' : '??'} ${b.content_type}
                                    </span>
                                    <span style="font-weight: 800; color: #ff9500;">${b.reward_amount} SUITE</span>
                                </div>
                                <div style="font-weight: 700; color: #2d1b4e; margin-bottom: 4px;">${escapeHtml(b.title)}</div>
                                <div style="color: #6b7280; font-size: 0.85rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${escapeHtml(b.description || '')}</div>
                            </div>
                        `).join('');
                } else {
                    container.innerHTML = '<div style="background: white; border-radius: 16px; padding: 24px; text-align: center; color: #888; grid-column: 1/-1;">No open bounties right now. Post the first one!</div>';
                }
            } catch (err) {
                console.error('Error loading marketplace:', err);
                document.getElementById('featuredBounties').innerHTML = '<div style="background: white; border-radius: 16px; padding: 24px; text-align: center; color: #888;">Unable to load bounties</div>';
            }
        }

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function openBountyModal() {
            window.location = 'content.html';
        }

        // Initialize Content Studio and Marketplace
        setTimeout(() => {
            checkContentStudioOwner();
            loadMarketplaceBounties();
        }, 500);

        // --- SIDEBAR NAVIGATION ---
        function showSection(sectionId) {
            // Hide all panels
            document.querySelectorAll('.section-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // Show selected panel
            const panel = document.getElementById('panel-' + sectionId);
            if (panel) {
                panel.classList.add('active');
            }

            // Update sidebar active state
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });

            // Find and activate clicked link
            document.querySelectorAll('.sidebar-link').forEach(link => {
                if (link.textContent.toLowerCase().includes(sectionId) ||
                    (sectionId === 'overview' && link.textContent.includes('Overview')) ||
                    (sectionId === 'apps' && link.textContent.includes('Your Apps')) ||
                    (sectionId === 'studio' && link.textContent.includes('Content Studio')) ||
                    (sectionId === 'prompt-server' && link.textContent.includes('PC Prompt'))) {
                    link.classList.add('active');
                }
            });

            // Save to localStorage
            localStorage.setItem('dashboardSection', sectionId);

            // Update URL hash
            history.replaceState(null, '', '#' + sectionId);
        }

        // Update sidebar user info when logged in
        function updateSidebarUser(user) {
            if (user) {
                document.getElementById('sidebarUser').style.display = 'flex';
                document.getElementById('sidebarLoginPrompt').style.display = 'none';
                document.getElementById('sidebarAvatar').src = user.avatar || 'assets/suite-mascot.png';
                document.getElementById('sidebarUserName').textContent = user.username || 'Developer';

                // Show admin section for owner
                const isOwner = user.id === OWNER_DISCORD_ID;
                const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                if (isOwner || isLocalhost) {
                    document.getElementById('adminSection').style.display = 'block';
                }
            } else {
                document.getElementById('sidebarUser').style.display = 'none';
                document.getElementById('sidebarLoginPrompt').style.display = 'block';
            }
        }

        // Restore last section or check URL hash
        function initSidebarNavigation() {
            const hash = window.location.hash.slice(1);
            const savedSection = localStorage.getItem('dashboardSection');

            if (hash && document.getElementById('panel-' + hash)) {
                showSection(hash);
            } else if (savedSection && document.getElementById('panel-' + savedSection)) {
                showSection(savedSection);
            }

            // Check if user is logged in and update sidebar
            const savedUser = localStorage.getItem('suiteDev');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                updateSidebarUser(user);
            }
        }

        // Initialize navigation on load
        setTimeout(initSidebarNavigation, 200);

        // Check owner access on load
        setTimeout(checkOwnerAccess, 1000);

        // --- AI FLEET FUNCTIONS ---
        async function saveAIConfig() {
            const config = {
                iterations_per_app: document.getElementById('configIterations').value,
                max_apps_per_day: document.getElementById('configMaxApps').value,
                auto_deploy: document.getElementById('configAutoDeploy').checked.toString(),
                telos_enabled: document.getElementById('configTelosEnabled').checked.toString()
            };

            try {
                // Save each config value
                for (const [key, value] of Object.entries(config)) {
                    await fetch(`${SUPABASE_URL}/rest/v1/ai_config?key=eq.${key}`, {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({ value: value, updated_at: new Date().toISOString() })
                    });
                }
                alert('? AI Fleet configuration saved!');
            } catch (error) {
                console.error('Error saving AI config:', error);
                alert('? Failed to save configuration');
            }
        }


        async function loadAIFleetStats() {
            try {
                // 1. Total AI Apps - count deployed apps with status='review' or 'deployed'
                const aiAppsResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=in.(review,deployed)&select=id`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const aiApps = await aiAppsResponse.json();
                const totalApps = Array.isArray(aiApps) ? aiApps.length : 0;
                const el1 = document.getElementById('aiAppsTotal');
                if (el1) el1.textContent = totalApps;

                // 2. Created Today - ideas created today
                const today = new Date().toISOString().split('T')[0];
                const todayAppsResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?created_at=gte.${today}T00:00:00&select=id`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const todayApps = await todayAppsResponse.json();
                const createdToday = Array.isArray(todayApps) ? todayApps.length : 0;
                const el2 = document.getElementById('aiAppsToday');
                if (el2) el2.textContent = createdToday;

                // 3. In Progress - ideas currently being built
                const inProgressResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.building&select=id`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const inProgress = await inProgressResponse.json();
                const buildingCount = Array.isArray(inProgress) ? inProgress.length : 0;
                const el3 = document.getElementById('aiAppsInProgress');
                if (el3) el3.textContent = buildingCount;

                // 4. Total Iterations - sum of all build_iterations across ideas
                const iterationsResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?select=build_iterations`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const allIdeas = await iterationsResponse.json();
                let totalIterations = 0;
                if (Array.isArray(allIdeas)) {
                    totalIterations = allIdeas.reduce((sum, idea) => sum + (idea.build_iterations || 0), 0);
                }
                const el4 = document.getElementById('aiTotalIterations');
                if (el4) el4.textContent = totalIterations;

                // Load config values
                const configResponse = await fetch(`${SUPABASE_URL}/rest/v1/ai_config?select=key,value`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const configs = await configResponse.json();

                // DEFAULT: Start with toggle OFF
                const telosToggle = document.getElementById('telosMainToggle');
                const telosCheckbox = document.getElementById('configTelosEnabled');
                if (telosToggle) telosToggle.checked = false;
                if (telosCheckbox) telosCheckbox.checked = false;
                updateTelosUI(false);

                if (Array.isArray(configs)) {
                    configs.forEach(c => {
                        if (c.key === 'iterations_per_app') document.getElementById('configIterations').value = c.value;
                        if (c.key === 'max_apps_per_day') document.getElementById('configMaxApps').value = c.value;
                        if (c.key === 'auto_deploy') document.getElementById('configAutoDeploy').checked = c.value === 'true';
                        if (c.key === 'telos_enabled' && c.value === 'true') {
                            // Only turn ON if explicitly 'true' in DB
                            if (telosToggle) telosToggle.checked = true;
                            if (telosCheckbox) telosCheckbox.checked = true;
                            updateTelosUI(true);
                        }
                    });
                }

                // Check for pending human requests
                await checkHumanPriority();

                // Load activity feed
                await loadActivityFeed();

            } catch (error) {
                console.error('Error loading AI Fleet stats:', error);
            }
        }

        // Toggle TELOS mode from the hero toggle
        async function toggleTelosMode() {
            const toggle = document.getElementById('telosMainToggle');
            const isEnabled = toggle.checked;

            // Sync with config checkbox
            document.getElementById('configTelosEnabled').checked = isEnabled;

            // Update UI
            updateTelosUI(isEnabled);

            // Save to Supabase
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/ai_config?key=eq.telos_enabled`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({ value: isEnabled ? 'true' : 'false', updated_at: new Date().toISOString() })
                });
            } catch (error) {
                console.error('Error saving TELOS state:', error);
            }
        }

        // Update TELOS UI based on state
        function updateTelosUI(isEnabled) {
            const slider = document.getElementById('telosSlider');
            const knob = document.getElementById('telosKnob');
            const onLabel = document.getElementById('telosOnLabel');
            const offLabel = document.getElementById('telosOffLabel');
            const explanation = document.getElementById('telosExplanation');
            const statusText = document.getElementById('telosStatusText');

            if (isEnabled) {
                slider.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                slider.style.boxShadow = '0 4px 12px rgba(34, 197, 94, 0.3)';
                knob.style.left = '44px';
                onLabel.style.color = '#22c55e';
                onLabel.style.fontWeight = '700';
                offLabel.style.color = '#888';
                offLabel.style.fontWeight = '600';
                explanation.style.background = 'rgba(34, 197, 94, 0.1)';
                explanation.style.borderLeftColor = '#22c55e';
                explanation.innerHTML = '<p style="margin: 0; font-size: 0.9rem; color: #16a34a; font-weight: 600;">✅ ACTIVE: AI is researching markets, building apps, and deploying automatically.</p>';
                statusText.textContent = 'AI creates apps autonomously 24/7';
            } else {
                slider.style.background = '#ccc';
                slider.style.boxShadow = 'none';
                knob.style.left = '4px';
                onLabel.style.color = '#888';
                onLabel.style.fontWeight = '600';
                offLabel.style.color = '#6b7280';
                offLabel.style.fontWeight = '700';
                explanation.style.background = 'rgba(107, 114, 128, 0.1)';
                explanation.style.borderLeftColor = '#6b7280';
                explanation.innerHTML = '<p style="margin: 0; font-size: 0.9rem; color: #6b7280; font-weight: 600;">?? PAUSED: AI only responds to human requests (bugs, features)</p>';
                statusText.textContent = 'AI responds to human requests only';
            }
        }

        // Check if there are pending human requests
        async function checkHumanPriority() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/prompts?status=eq.pending&select=id`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const pending = await response.json();
                const banner = document.getElementById('humanPriorityBanner');
                const countEl = document.getElementById('humanRequestCount');

                if (Array.isArray(pending) && pending.length > 0) {
                    banner.style.display = 'flex';
                    countEl.textContent = pending.length === 1 ? '1 in queue' : `${pending.length} in queue`;
                } else {
                    banner.style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking human priority:', error);
            }
        }

        // Load activity feed from ai_activity_log
        async function loadActivityFeed() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_activity_log?order=timestamp.desc&limit=20`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const logs = await response.json();
                const feedContainer = document.getElementById('aiActivityFeed');

                if (Array.isArray(logs) && logs.length > 0) {
                    feedContainer.innerHTML = logs.map(log => {
                        const time = new Date(log.timestamp).toLocaleTimeString('en-US', { hour12: false });
                        let color = '#888';
                        let emoji = '??';

                        switch (log.action_type) {
                            case 'research': color = '#fbbf24'; emoji = '??'; break;
                            case 'iteration': color = '#60a5fa'; emoji = '??'; break;
                            case 'deploy': color = '#4ade80'; emoji = '?'; break;
                            case 'error': color = '#f87171'; emoji = '?'; break;
                            case 'start_build': color = '#a78bfa'; emoji = '??'; break;
                            case 'telos_on': color = '#22c55e'; emoji = '??'; break;
                            case 'telos_off': color = '#6b7280'; emoji = '??'; break;
                        }

                        return `<div style="color: ${color};">${time} ${emoji} ${log.message}</div>`;
                    }).join('');
                } else {
                    feedContainer.innerHTML = '<div style="color: #888;">� No activity yet. Enable TELOS to start! �</div>';
                }
            } catch (error) {
                console.error('Error loading activity feed:', error);
                // Keep existing mock data if fetch fails
            }
        }

        // Load AI Fleet stats when the panel is shown
        document.addEventListener('DOMContentLoaded', () => {
            // Check if AI Fleet panel exists
            if (document.getElementById('panel-ai-fleet')) {
                loadAIFleetStats();
                setupAIFleetPermissions();

                // Refresh every 30 seconds
                setInterval(() => {
                    loadAIFleetStats();
                }, 30000);
            }
        });

        // Setup owner-only permissions for AI Fleet controls
        function setupAIFleetPermissions() {
            const isOwner = checkIfOwner();
            const toggleControls = document.getElementById('telosToggleControls');
            const statusBadge = document.getElementById('telosStatusBadge');
            const configPanel = document.getElementById('aiFleetConfigPanel');

            if (isOwner) {
                // Owner: show toggle controls, hide status badge
                if (toggleControls) toggleControls.style.display = 'flex';
                if (statusBadge) statusBadge.style.display = 'none';
                if (configPanel) configPanel.style.display = 'block';
            } else {
                // Non-owner: hide toggle controls, show status badge, hide config
                if (toggleControls) toggleControls.style.display = 'none';
                if (statusBadge) statusBadge.style.display = 'block';
                if (configPanel) configPanel.style.display = 'none';
            }
        }

        // Check if current user is the owner
        function checkIfOwner() {
            // Check if logged in as owner via localStorage
            const savedUser = localStorage.getItem('suite_user');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    // Replace with your actual Discord ID
                    const OWNER_ID = '287364619419049984';
                    if (user.id === OWNER_ID) return true;
                } catch (e) { }
            }

            // Also allow on localhost for testing
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return true;
            }

            return false;
        }

        // Toggle focus category pills
        function toggleFocusPill(el) {
            el.classList.toggle('active');
            if (el.classList.contains('active')) {
                el.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                el.style.color = 'white';
            } else {
                el.style.background = 'rgba(99, 102, 241, 0.1)';
                el.style.color = '#6366f1';
            }
        }

        // Toggle audience pills
        function toggleAudiencePill(el) {
            el.classList.toggle('active');
            if (el.classList.contains('active')) {
                el.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                el.style.color = 'white';
            } else {
                el.style.background = 'rgba(34, 197, 94, 0.1)';
                el.style.color = '#16a34a';
            }
        }

        // Collect TELOS configuration from the form
        function collectTelosConfig() {
            // Research focus categories
            const focusPills = document.querySelectorAll('.focus-pill.active');
            const researchFocus = Array.from(focusPills).map(p => p.getAttribute('data-category'));

            // Target audience
            const audiencePills = document.querySelectorAll('.audience-pill.active');
            const targetAudience = Array.from(audiencePills).map(p => p.getAttribute('data-audience'));

            return {
                // Autonomous Behavior
                research_focus: researchFocus,
                target_audience: targetAudience,
                complexity: document.getElementById('configComplexity')?.value || 'standard',

                // Scheduling
                active_hours_enabled: document.getElementById('configActiveHoursEnabled')?.checked || false,
                active_start: document.getElementById('configActiveStart')?.value || '09:00',
                active_end: document.getElementById('configActiveEnd')?.value || '22:00',
                cooldown_hours: parseInt(document.getElementById('configCooldown')?.value || 2),
                max_apps_per_day: parseInt(document.getElementById('configMaxApps')?.value || 6),
                iterations_per_app: parseInt(document.getElementById('configIterations')?.value || 50),

                // Workflow
                auto_deploy: document.getElementById('configAutoDeploy')?.checked || false,
                auto_submit: document.getElementById('configAutoSubmit')?.checked || false,
                github_create: document.getElementById('configGitHubCreate')?.checked || false,
                discord_notify: document.getElementById('configDiscordNotify')?.checked || false,
                expo_qr: document.getElementById('configExpoQR')?.checked || false,

                // Constraints
                ignored_keywords: document.getElementById('configIgnoredKeywords')?.value || '',
                max_concurrent: parseInt(document.getElementById('configMaxConcurrent')?.value || 3),
                budget_enabled: document.getElementById('configBudgetEnabled')?.checked || false,
                budget_amount: parseInt(document.getElementById('configBudgetAmount')?.value || 50),
                require_approval: document.getElementById('configRequireApproval')?.checked || false,

                // Metadata
                updated_at: new Date().toISOString()
            };
        }

        // Save TELOS configuration to Supabase
        async function saveTelosConfig() {
            const btn = document.getElementById('saveTelosConfigBtn');
            const statusEl = document.getElementById('saveTelosStatus');

            // Show saving state
            btn.disabled = true;
            btn.innerHTML = '<span>?</span> Saving...';
            statusEl.textContent = '';
            statusEl.style.color = '#888';

            try {
                const config = collectTelosConfig();

                // Upsert to ai_config table (single row with id=1)
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_config?id=eq.1`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(config)
                });

                if (!response.ok) {
                    // If PATCH fails (no row exists), try POST
                    const insertResponse = await fetch(`${SUPABASE_URL}/rest/v1/ai_config`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({ id: 1, ...config })
                    });

                    if (!insertResponse.ok) {
                        throw new Error('Failed to save configuration');
                    }
                }

                // Success
                btn.innerHTML = '<span>?</span> Saved!';
                btn.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                statusEl.textContent = 'Configuration saved successfully';
                statusEl.style.color = '#22c55e';

                setTimeout(() => {
                    btn.innerHTML = '<span>??</span> Save TELOS Configuration';
                    btn.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Error saving TELOS config:', error);
                btn.innerHTML = '<span>?</span> Error';
                btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                statusEl.textContent = 'Failed to save. Check console for details.';
                statusEl.style.color = '#ef4444';

                setTimeout(() => {
                    btn.innerHTML = '<span>??</span> Save TELOS Configuration';
                    btn.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                    btn.disabled = false;
                }, 3000);
            }
        }

        // Load saved TELOS config on page load
        async function loadTelosConfig() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_config?id=eq.1&select=*`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const data = await response.json();

                if (Array.isArray(data) && data.length > 0) {
                    const config = data[0];

                    // Research focus pills
                    if (config.research_focus) {
                        document.querySelectorAll('.focus-pill').forEach(pill => {
                            const cat = pill.getAttribute('data-category');
                            if (config.research_focus.includes(cat)) {
                                pill.classList.add('active');
                                pill.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                                pill.style.color = 'white';
                            } else {
                                pill.classList.remove('active');
                                pill.style.background = 'rgba(99, 102, 241, 0.1)';
                                pill.style.color = '#6366f1';
                            }
                        });
                    }

                    // Audience pills
                    if (config.target_audience) {
                        document.querySelectorAll('.audience-pill').forEach(pill => {
                            const aud = pill.getAttribute('data-audience');
                            if (config.target_audience.includes(aud)) {
                                pill.classList.add('active');
                                pill.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                                pill.style.color = 'white';
                            } else {
                                pill.classList.remove('active');
                                pill.style.background = 'rgba(34, 197, 94, 0.1)';
                                pill.style.color = '#16a34a';
                            }
                        });
                    }

                    // Other fields
                    if (config.complexity) document.getElementById('configComplexity').value = config.complexity;
                    if (config.active_hours_enabled !== undefined) document.getElementById('configActiveHoursEnabled').checked = config.active_hours_enabled;
                    if (config.active_start) document.getElementById('configActiveStart').value = config.active_start;
                    if (config.active_end) document.getElementById('configActiveEnd').value = config.active_end;
                    if (config.cooldown_hours !== undefined) document.getElementById('configCooldown').value = config.cooldown_hours;
                    if (config.max_apps_per_day !== undefined) document.getElementById('configMaxApps').value = config.max_apps_per_day;
                    if (config.iterations_per_app !== undefined) document.getElementById('configIterations').value = config.iterations_per_app;
                    if (config.auto_deploy !== undefined) document.getElementById('configAutoDeploy').checked = config.auto_deploy;
                    if (config.auto_submit !== undefined) document.getElementById('configAutoSubmit').checked = config.auto_submit;
                    if (config.github_create !== undefined) document.getElementById('configGitHubCreate').checked = config.github_create;
                    if (config.discord_notify !== undefined) document.getElementById('configDiscordNotify').checked = config.discord_notify;
                    if (config.expo_qr !== undefined) document.getElementById('configExpoQR').checked = config.expo_qr;
                    if (config.ignored_keywords) document.getElementById('configIgnoredKeywords').value = config.ignored_keywords;
                    if (config.max_concurrent !== undefined) document.getElementById('configMaxConcurrent').value = config.max_concurrent;
                    if (config.budget_enabled !== undefined) document.getElementById('configBudgetEnabled').checked = config.budget_enabled;
                    if (config.budget_amount !== undefined) document.getElementById('configBudgetAmount').value = config.budget_amount;
                    if (config.require_approval !== undefined) document.getElementById('configRequireApproval').checked = config.require_approval;
                }
            } catch (error) {
                console.error('Error loading TELOS config:', error);
            }
        }

        // Also load config on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('aiFleetConfigPanel')) {
                loadTelosConfig();
            }
        });


        // Fleet Division Tab Switching
        function showFleetDivision(divisionId) {
            // Hide all divisions
            document.querySelectorAll('.fleet-division').forEach(div => {
                div.style.display = 'none';
                div.classList.remove('active');
            });

            // Show target division
            const target = document.getElementById('fleet-division-' + divisionId);
            if (target) {
                target.style.display = 'block';
                target.classList.add('active');
            }

            // Update tab styles
            document.querySelectorAll('.fleet-tab').forEach(tab => {
                if (tab.getAttribute('data-division') === divisionId) {
                    tab.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                    tab.style.borderColor = '#6366f1';
                    tab.style.color = 'white';
                    tab.classList.add('active');
                } else {
                    tab.style.background = 'white';
                    tab.style.borderColor = '#ddd';
                    tab.style.color = '#666';
                    tab.classList.remove('active');
                }
            });
        }

        // Toggle focus pill selection
        function toggleFocusPill(el) {
            el.classList.toggle('active');
            if (el.classList.contains('active')) {
                el.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                el.style.color = 'white';
            } else {
                el.style.background = 'rgba(99, 102, 241, 0.1)';
                el.style.color = '#6366f1';
            }
        }

        // Toggle TELOS mode
        function toggleTelosMode() {
            const toggle = document.getElementById('telosMainToggle');
            const isEnabled = toggle.checked;
            updateTelosUI(isEnabled);
        }

        // Update TELOS UI based on state
        function updateTelosUI(isEnabled) {
            const slider = document.getElementById('telosSlider');
            const knob = document.getElementById('telosKnob');
            const onLabel = document.getElementById('telosOnLabel');
            const offLabel = document.getElementById('telosOffLabel');
            const explanation = document.getElementById('telosExplanation');
            const statusText = document.getElementById('telosStatusText');

            if (isEnabled) {
                slider.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                slider.style.boxShadow = '0 4px 12px rgba(34, 197, 94, 0.3)';
                knob.style.left = '44px';
                onLabel.style.color = '#22c55e';
                onLabel.style.fontWeight = '700';
                offLabel.style.color = '#888';
                offLabel.style.fontWeight = '600';
                explanation.style.background = 'rgba(34, 197, 94, 0.1)';
                explanation.style.borderLeftColor = '#22c55e';
                explanation.innerHTML = '<p style="margin: 0; font-size: 0.9rem; color: #16a34a; font-weight: 600;">ACTIVE: AI is researching markets, building apps, and deploying automatically.</p>';
                statusText.textContent = 'AI creates apps autonomously 24/7';
            } else {
                slider.style.background = '#ccc';
                slider.style.boxShadow = 'none';
                knob.style.left = '4px';
                onLabel.style.color = '#888';
                onLabel.style.fontWeight = '600';
                offLabel.style.color = '#6b7280';
                offLabel.style.fontWeight = '700';
                explanation.style.background = 'rgba(107, 114, 128, 0.1)';
                explanation.style.borderLeftColor = '#6b7280';
                explanation.innerHTML = '<p style="margin: 0; font-size: 0.9rem; color: #6b7280; font-weight: 600;">PAUSED: AI only responds to human requests (bugs, features)</p>';
                statusText.textContent = 'AI responds to human requests only';
            }
        }

        // Placeholder for saving TELOS config
        function saveTelosConfig() {
            alert('Configuration saved! (Supabase integration coming soon)');
        }



        // ============================================
        // APOLOGETICS ARENA FUNCTIONS
        // ============================================

        // Submit a challenge to the Apologetics Arena
        async function submitChallenge() {
            const input = document.getElementById('challengeInput');
            const challengeText = input.value.trim();

            if (!challengeText) {
                alert('Please enter your challenge first.');
                return;
            }

            if (challengeText.length < 20) {
                alert('Please provide a more substantial challenge (at least 20 characters).');
                return;
            }

            // TODO: Check wallet connection and SUITE balance
            // TODO: Deduct 10 SUITE and send to Giving Fund

            try {
                // Insert challenge into Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/apologetics_challenges`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        challenge_text: challengeText,
                        submitter_wallet: null, // TODO: Get connected wallet
                        status: 'pending',
                        suite_cost: 10
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    input.value = '';
                    alert('Challenge submitted! The AI Judge will analyze it shortly.');
                    loadRecentChallenges();
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('Error submitting challenge:', error);
                alert('Submission system coming soon. Your challenge has been noted!');
            }
        }

        // Load recent challenges from Supabase
        async function loadRecentChallenges() {
            const container = document.getElementById('recentChallenges');
            if (!container) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/apologetics_challenges?order=created_at.desc&limit=5`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const challenges = await response.json();

                if (Array.isArray(challenges) && challenges.length > 0) {
                    container.innerHTML = challenges.map(c => `
                        <div style="padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px; border-left: 3px solid ${c.status === 'refuted' ? '#22c55e' : '#ff9500'};">
                            <p style="margin: 0 0 8px; font-size: 0.9rem; color: rgba(255,255,255,0.9);">${c.challenge_text.substring(0, 100)}${c.challenge_text.length > 100 ? '...' : ''}</p>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: rgba(255,255,255,0.5);">
                                <span>${c.status === 'refuted' ? '✅ Refuted' : '⏳ Pending'}</span>
                                <span>${new Date(c.created_at).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading challenges:', error);
            }
        }

        // Load apologetics stats
        async function loadApologeticsStats() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/apologetics_challenges?select=is_novel,reward_paid`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const challenges = await response.json();

                if (Array.isArray(challenges)) {
                    const novelCount = challenges.filter(c => c.is_novel).length;
                    const totalRewards = challenges.reduce((sum, c) => sum + (c.reward_paid || 0), 0);

                    const novelEl = document.getElementById('novelAttacksCount');
                    const totalEl = document.getElementById('totalChallenges');
                    const rewardEl = document.getElementById('suiteRewarded');

                    if (novelEl) novelEl.textContent = novelCount;
                    if (totalEl) totalEl.textContent = challenges.length;
                    if (rewardEl) rewardEl.textContent = totalRewards;
                }
            } catch (error) {
                console.error('Error loading apologetics stats:', error);
            }
        }

        // Initialize apologetics if panel exists
        if (document.getElementById('panel-constitution')) {
            loadRecentChallenges();
            loadApologeticsStats();
        }



        // ============================================
        // CONSTITUTION ADMIN FUNCTIONS
        // ============================================

        // Check if user is admin for constitution submissions
        function checkConstitutionAdmin() {
            const costDisplay = document.getElementById('submissionCostDisplay');
            if (!costDisplay) return;

            // Check if owner (same logic as rest of dashboard)
            if (typeof isOwner !== 'undefined' && isOwner) {
                costDisplay.innerHTML = '<span style="color: #22c55e; font-weight: 700;">FREE</span> <span style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">(Admin)</span>';
            }
        }

        // Load TELOS history from Supabase
        async function loadTelosHistory() {
            const container = document.getElementById('telosHistory');
            if (!container) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/telos_history?order=created_at.desc&limit=20`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const history = await response.json();

                if (Array.isArray(history) && history.length > 0) {
                    // Prepend fetched history to existing genesis entry
                    const genesisHtml = container.innerHTML;
                    container.innerHTML = history.map(entry => `
                        <div style="display: flex; gap: 16px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 12px; border-left: 3px solid ${entry.type === 'refinement' ? '#a855f7' : entry.type === 'addition' ? '#22c55e' : '#ff9500'};">
                            <div style="flex-shrink: 0; width: 80px; text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: 900; color: ${entry.type === 'refinement' ? '#a855f7' : '#22c55e'};">v${entry.version}</div>
                                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">${entry.type.toUpperCase()}</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 700; color: white; margin-bottom: 4px;">${entry.title}</div>
                                <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">${entry.description}</div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: rgba(255,255,255,0.5);">
                                    <span>👤 ${entry.author || 'Anonymous'}</span>
                                    <span>📅 ${new Date(entry.created_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    `).join('') + genesisHtml;
                }
            } catch (error) {
                console.error('Error loading TELOS history:', error);
            }
        }

        // Initialize constitution panel when ready
        if (document.getElementById('panel-constitution')) {
            checkConstitutionAdmin();
            loadTelosHistory();
        }

        // Also check when section changes
        document.addEventListener('hashchange', () => {
            if (window.location.hash === '#constitution') {
                setTimeout(checkConstitutionAdmin, 100);
            }
        });



        // ============================================
        // TELOS IDEAS QUEUE FUNCTIONS
        // ============================================

        // Load pending ideas from Supabase
        async function loadTelosIdeas() {
            const container = document.getElementById('telosIdeasQueue');
            if (!container) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.pending&order=created_at.desc`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const ideas = await response.json();

                if (Array.isArray(ideas) && ideas.length > 0) {
                    // Group by batch_id for visual grouping
                    const batches = {};
                    ideas.forEach(idea => {
                        const batchId = idea.batch_id || 'single';
                        if (!batches[batchId]) batches[batchId] = [];
                        batches[batchId].push(idea);
                    });

                    let html = '';

                    // Show batch count
                    const totalIdeas = ideas.length;
                    html += `<div style="margin-bottom: 12px; padding: 10px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; text-align: center;">
                        <span style="font-weight: 700; color: #6366f1;">🎯 ${totalIdeas} ideas awaiting your decision</span>
                    </div>`;

                    // Render ideas as grid (2 columns for batches)
                    html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">`;

                    ideas.forEach(idea => {
                        const features = typeof idea.features === 'string' ? JSON.parse(idea.features) : (idea.features || []);
                        html += `
                        <div class="telos-idea-card" style="background: white; border-radius: 12px; padding: 16px; border: 2px solid rgba(255, 149, 0, 0.2); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.borderColor='#ff9500'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='rgba(255, 149, 0, 0.2)'; this.style.transform='translateY(0)';">
                            <div style="margin-bottom: 10px;">
                                <h5 style="margin: 0 0 4px; font-size: 1.1rem; font-weight: 800; color: #2d1b4e;">${idea.name}</h5>
                                <p style="margin: 0; color: #666; font-size: 0.85rem; font-style: italic;">${idea.tagline || ''}</p>
                            </div>
                            <p style="margin: 0 0 10px; color: #5a4a6f; font-size: 0.85rem; line-height: 1.4;">${idea.description?.substring(0, 120) || 'No description'}${idea.description?.length > 120 ? '...' : ''}</p>
                            ${idea.why_now ? `<div style="margin-bottom: 10px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border-left: 3px solid #22c55e;">
                                <span style="font-size: 0.75rem; color: #16a34a; font-weight: 600;">⏰ Why now: ${idea.why_now}</span>
                            </div>` : ''}
                            ${features.length > 0 ? `
                            <div style="margin-bottom: 12px;">
                                ${features.slice(0, 3).map(f => `<span style="display: inline-block; background: rgba(99, 102, 241, 0.1); color: #6366f1; padding: 3px 8px; border-radius: 100px; font-size: 0.7rem; margin-right: 4px; margin-bottom: 4px;">${f}</span>`).join('')}
                            </div>
                            ` : ''}
                            <div style="display: flex; gap: 8px;">
                                <button onclick="approveIdea('${idea.id}')" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 0.85rem;">
                                    ✅ Build This
                                </button>
                                <button onclick="rejectIdea('${idea.id}')" style="padding: 8px 12px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.85rem;">
                                    ❌
                                </button>
                            </div>
                        </div>`;
                    });

                    html += `</div>`;

                    // Add "Reject All + New Direction" section
                    html += `
                    <div style="margin-top: 16px; padding: 16px; background: rgba(99, 102, 241, 0.05); border-radius: 12px; border: 2px dashed rgba(99, 102, 241, 0.2);">
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="newDirectionInput" placeholder="Try: 'focus on AI tools' or 'fitness apps'" style="flex: 1; min-width: 200px; padding: 10px 14px; border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 8px; font-size: 0.9rem;">
                            <button onclick="rejectAllWithDirection()" style="padding: 10px 16px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap;">
                                🔄 New Direction
                            </button>
                            <button onclick="rejectAllIdeas()" style="padding: 10px 16px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                                ❌ Reject All
                            </button>
                        </div>
                    </div>`;

                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #888;">
                            <img src="assets/emojis/clay-rocket.png" alt="" style="width: 40px; height: 40px; opacity: 0.5; margin-bottom: 10px;">
                            <p style="margin: 0 0 12px;">No pending ideas. Generate a batch of 5 ideas!</p>
                            <button onclick="generateNewIdeas()" style="padding: 12px 24px; background: linear-gradient(135deg, #ff9500, #ff6b9d); color: white; border: none; border-radius: 100px; font-weight: 700; cursor: pointer;">
                                🚀 Generate 5 Ideas
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading ideas:', error);
            }
        }

        // Load apps ready for review
        async function loadTelosReview() {
            const container = document.getElementById('telosReviewQueue');
            const countEl = document.getElementById('reviewCount');
            if (!container) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.review&order=build_completed_at.desc`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const apps = await response.json();

                if (countEl) countEl.textContent = apps.length || 0;

                if (Array.isArray(apps) && apps.length > 0) {
                    container.innerHTML = apps.map(app => `
                        <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 10px; border-left: 4px solid #a855f7;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <h5 style="margin: 0; font-weight: 700;">${app.name}</h5>
                                <span style="font-size: 0.75rem; color: #888;">${app.build_iterations || 0} iterations</span>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="deployApp('${app.id}')" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #a855f7, #6366f1); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.85rem; cursor: pointer;">
                                    🏪 Deploy
                                </button>
                                <button onclick="refineApp('${app.id}')" style="padding: 8px 12px; background: rgba(255, 149, 0, 0.1); color: #f59e0b; border: none; border-radius: 8px; font-weight: 600; font-size: 0.85rem; cursor: pointer;">
                                    ✏️ Refine
                                </button>
                                <button onclick="scrapApp('${app.id}')" style="padding: 8px 12px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: none; border-radius: 8px; font-weight: 600; font-size: 0.85rem; cursor: pointer;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;"><p style="margin: 0;">No apps ready for review yet</p></div>';
                }
            } catch (error) {
                console.error('Error loading review queue:', error);
            }
        }

        // Approve an idea and start building
        async function approveIdea(ideaId) {
            if (!confirm('Approve this idea and start building?')) return;

            try {
                // Get the idea with its generated prompt
                const getResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const ideas = await getResponse.json();
                if (!ideas.length) return;

                const idea = ideas[0];

                // Update idea status to 'building'
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'building',
                        approved_at: new Date().toISOString(),
                        build_started_at: new Date().toISOString()
                    })
                });

                // Insert the build prompt into prompts table
                const promptResponse = await fetch(`${SUPABASE_URL}/rest/v1/prompts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        prompt: idea.generated_prompt,
                        status: 'pending',
                        prompt_type: 'telos_build',
                        source: `TELOS: ${idea.name}`,
                        metadata: JSON.stringify({ idea_id: ideaId, app_name: idea.name })
                    })
                });

                if (promptResponse.ok) {
                    alert(`✅ ${idea.name} approved! Building will start shortly.`);
                    loadTelosIdeas();
                }
            } catch (error) {
                console.error('Error approving idea:', error);
                alert('Failed to approve idea');
            }
        }

        // Reject an idea
        async function rejectIdea(ideaId) {
            const reason = prompt('Rejection reason (optional):');

            try {
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'rejected',
                        rejection_reason: reason || 'No reason provided'
                    })
                });

                loadTelosIdeas();
            } catch (error) {
                console.error('Error rejecting idea:', error);
            }
        }

        // Generate a new idea to replace the current one (legacy - calls batch)
        async function regenerateIdea(ideaId) {
            await rejectIdea(ideaId);
            generateNewIdeas();
        }

        // Reject all pending ideas
        async function rejectAllIdeas() {
            if (!confirm('Reject all pending ideas?')) return;

            try {
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.pending`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'rejected',
                        rejection_reason: 'Batch rejected'
                    })
                });
                loadTelosIdeas();
            } catch (error) {
                console.error('Error rejecting all:', error);
            }
        }

        // Reject all and generate with new direction
        async function rejectAllWithDirection() {
            const direction = document.getElementById('newDirectionInput')?.value || '';

            if (!direction) {
                alert('Please enter a direction (e.g., "focus on AI tools" or "fitness apps")');
                return;
            }

            // First reject all pending
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.pending`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'rejected',
                        rejection_reason: `Redirected: ${direction}`
                    })
                });
            } catch (e) {
                console.error('Error rejecting:', e);
            }

            // Then generate with direction
            generateNewIdeas(direction);
        }

        // Legacy single idea function (redirects to batch)
        async function generateNewIdea() {
            generateNewIdeas();
        }

        // Generate batch of 5 intelligent ideas
        async function generateNewIdeas(direction = '') {
            alert('🚀 Generating 5 intelligent app ideas...\n\nThis uses:\n• 30-day history (novelty)\n• Rejection patterns (learning)\n• Seasonal context (timeliness)\n\nIdeas will appear in ~2-3 minutes.');

            const batchId = Date.now().toString();

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/prompts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: `[TELOS MODE - INTELLIGENT BATCH IDEATION]

You are generating 5 diverse app ideas for the SUITE ecosystem.
Batch ID: ${batchId}
${direction ? `\nUSER DIRECTION: ${direction}\nPrioritize this direction while ensuring diversity.\n` : ''}

═══ REQUIREMENTS ═══
1. Generate 5 DIVERSE app ideas
2. Each must be buildable in ~50 iterations
3. All must align with Christian values
4. Each should serve different use cases
5. Consider current trends and seasons
6. React Native / Expo compatible

═══ OUTPUT ═══
Create the file: prompt-server/telos_ideas_batch.json
Write a JSON array with 5 ideas:

[
  {
    "name": "AppName1",
    "tagline": "Short catchy description",
    "description": "2-3 sentences about what it does",
    "features": ["Feature 1", "Feature 2", "Feature 3"],
    "target_audience": "Who this is for",
    "monetization": "How it makes money",
    "why_now": "Why this idea is timely",
    "batch_id": "${batchId}"
  },
  ... 4 more ideas with same structure ...
]

IMPORTANT: Write to prompt-server/telos_ideas_batch.json
Make each idea genuinely DIFFERENT (different categories, audiences, purposes).`,
                        status: 'pending',
                        prompt_type: 'telos_batch',
                        source: 'TELOS Mode (Intelligent Batch)',
                        metadata: JSON.stringify({ batch_id: batchId, direction: direction })
                    })
                });

                if (response.ok) {
                    console.log('Batch ideation request sent');
                }
            } catch (error) {
                console.error('Error generating ideas:', error);
                alert('Failed to send request. Check console for details.');
            }
        }

        // Deploy an app to stores
        async function deployApp(ideaId) {
            if (!confirm('Deploy this app to Expo/App Stores?')) return;

            try {
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'deployed',
                        deployed_at: new Date().toISOString()
                    })
                });

                alert('🚀 Deploy triggered! Check EAS Build for progress.');
                loadTelosReview();
            } catch (error) {
                console.error('Error deploying:', error);
            }
        }

        // Add refinement notes and continue building
        async function refineApp(ideaId) {
            const notes = prompt('What refinements are needed?');
            if (!notes) return;

            try {
                // Get the idea
                const getResponse = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY }
                });
                const ideas = await getResponse.json();
                if (!ideas.length) return;

                const idea = ideas[0];

                // Update status back to building
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'building',
                        refinement_notes: notes
                    })
                });

                // Insert refinement prompt
                await fetch(`${SUPABASE_URL}/rest/v1/prompts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: `[REFINEMENT for ${idea.name}]\n\n${notes}`,
                        status: 'pending',
                        prompt_type: 'telos_refine',
                        source: `TELOS Refinement: ${idea.name}`,
                        metadata: JSON.stringify({ idea_id: ideaId })
                    })
                });

                alert('✏️ Refinement request sent!');
                loadTelosReview();
            } catch (error) {
                console.error('Error refining:', error);
            }
        }

        // Scrap/delete an app
        async function scrapApp(ideaId) {
            if (!confirm('Are you sure you want to scrap this app?')) return;

            try {
                await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?id=eq.${ideaId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'scrapped' })
                });

                loadTelosReview();
            } catch (error) {
                console.error('Error scrapping:', error);
            }
        }

        // Initialize TELOS queues when AI Fleet panel is visible
        if (document.getElementById('telosIdeasQueue')) {
            loadTelosIdeas();
            loadTelosReview();
            // Refresh every 30 seconds
            setInterval(() => {
                loadTelosIdeas();
                loadTelosReview();
            }, 30000);
        }

        // ═══ AI FLEET PANEL FUNCTIONS ═══
        async function toggleAfTelos() {
            const toggle = document.getElementById('afTelosToggle');
            const statusText = document.getElementById('afTelosStatus');
            const isOn = toggle.classList.toggle('on');

            statusText.textContent = isOn ? 'ACTIVE: Building apps autonomously' : 'INACTIVE: Systems paused';

            // Save state to Supabase - ai_config table with key telos_mode
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/ai_config?key=eq.telos_mode`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({ value: isOn ? 'true' : 'false' })
                });
                console.log(`TELOS mode ${isOn ? 'ENABLED' : 'DISABLED'}`);
            } catch (e) { console.error('Toggle save error:', e); }
        }

        async function loadAfStats() {
            try {
                // Total apps (review or deployed)
                const total = await (await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=in.(review,deployed)&select=id`, { headers: { 'apikey': SUPABASE_ANON_KEY } })).json();
                document.getElementById('afKpiTotal').textContent = Array.isArray(total) ? total.length : 0;

                // Today's apps
                const today = new Date().toISOString().split('T')[0];
                const todayApps = await (await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?created_at=gte.${today}T00:00:00&select=id`, { headers: { 'apikey': SUPABASE_ANON_KEY } })).json();
                document.getElementById('afKpiToday').textContent = Array.isArray(todayApps) ? todayApps.length : 0;

                // In progress
                const progress = await (await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?status=eq.building&select=id`, { headers: { 'apikey': SUPABASE_ANON_KEY } })).json();
                document.getElementById('afKpiProgress').textContent = Array.isArray(progress) ? progress.length : 0;

                // Total iterations
                const iters = await (await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?select=build_iterations`, { headers: { 'apikey': SUPABASE_ANON_KEY } })).json();
                const totalIters = Array.isArray(iters) ? iters.reduce((sum, i) => sum + (i.build_iterations || 0), 0) : 0;
                document.getElementById('afKpiIters').textContent = totalIters;
            } catch (e) { console.error('Stats error:', e); }
        }

        async function loadAfFeed() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/ai_activity_log?order=timestamp.desc&limit=10`, { headers: { 'apikey': SUPABASE_ANON_KEY } });
                const activities = await res.json();
                const feedBody = document.getElementById('afFeedBody');
                const feedStatus = document.getElementById('afFeedStatus');

                if (Array.isArray(activities) && activities.length > 0) {
                    const latestTime = new Date(activities[0].timestamp);
                    const secondsAgo = (new Date() - latestTime) / 1000;
                    const isLive = secondsAgo < 60;

                    feedStatus.textContent = isLive ? 'STREAMING' : 'OFFLINE';
                    feedStatus.className = isLive ? 'af-badge streaming' : 'af-badge offline';

                    feedBody.innerHTML = activities.slice(0, 6).map(a => {
                        const time = new Date(a.timestamp).toLocaleTimeString('en-US', { hour12: false });
                        return `<div class="af-feed-item"><span class="af-feed-time">[${time}]</span> ${a.message}</div>`;
                    }).join('');
                } else {
                    feedBody.innerHTML = '<div class="af-empty">No activity yet</div>';
                }
            } catch (e) { console.error('Feed error:', e); }
        }

        async function loadAfHistory() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/telos_ideas?order=created_at.desc&limit=50`, { headers: { 'apikey': SUPABASE_ANON_KEY } });
                const ideas = await res.json();
                const histBody = document.getElementById('afHistoryBody');

                if (Array.isArray(ideas) && ideas.length > 0) {
                    const approved = ideas.filter(i => ['approved', 'building', 'review', 'deployed'].includes(i.status)).length;
                    const rejected = ideas.filter(i => i.status === 'rejected').length;
                    document.getElementById('afHistApproved').textContent = approved;
                    document.getElementById('afHistRejected').textContent = rejected;

                    histBody.innerHTML = ideas.slice(0, 5).map(i => `<div style="padding: 4px 0; font-size: 0.75rem;">${i.name || 'Unnamed'} - <span style="color: ${i.status === 'rejected' ? 'var(--af-red)' : 'var(--af-green)'}">${i.status}</span></div>`).join('');
                }
            } catch (e) { console.error('History error:', e); }
        }

        async function loadAfToggleState() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/ai_config?key=eq.telos_mode`, { headers: { 'apikey': SUPABASE_ANON_KEY } });
                const data = await res.json();
                const isOn = data[0]?.value === 'true';
                const toggle = document.getElementById('afTelosToggle');
                if (toggle) {
                    toggle.classList.toggle('on', isOn);
                    document.getElementById('afTelosStatus').textContent = isOn ? 'ACTIVE: Building apps autonomously' : 'INACTIVE: Systems paused';
                }
            } catch (e) { }
        }

        // Initialize AI Fleet panel if visible
        if (document.getElementById('panel-ai-fleet')) {
            loadAfToggleState();
            loadAfStats();
            loadAfFeed();
            loadAfHistory();
            setInterval(loadAfStats, 30000);
            setInterval(loadAfFeed, 30000);
            setInterval(loadAfHistory, 60000);
        }

    </script>

    < !--Stu Helper Widget-->
        <link rel="stylesheet" href="stu-helper.css">
        <script src="stu-helper.js"></script>
</body>

</html>