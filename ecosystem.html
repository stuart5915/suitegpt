<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SUITE Ecosystem | Interactive Overview</title>
    <meta name="description"
        content="Explore the SUITE ecosystem - see how the Treasury, App Store, and token flows connect.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="suite-styles.css">
    <link rel="stylesheet" href="nav.css">

    <style>
        /* Global reset handled by suite-styles.css */

        /* Force nav-links to be visible on desktop */
        @media (min-width: 769px) {
            .nav-links {
                display: flex !important;
            }
        }

        body {
            font-family: 'Nunito', 'Inter', sans-serif;
            background: linear-gradient(135deg, #fff5eb 0%, #ffe4d4 20%, #ffd4e3 50%, #e8d5f9 80%, #d4e5ff 100%);
            color: #2d1b4e;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        /* Floating background blobs */
        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            z-index: 0;
            pointer-events: none;
        }

        body::before {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            top: -100px;
            right: -100px;
        }

        body::after {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #a855f7, #3b82f6);
            bottom: -100px;
            left: -100px;
        }

        /* .header and .logo styles moved to nav.css */


        /* nav-links styles moved to nav.css */

        .canvas-container {
            width: 100%;
            min-height: 100vh;
            padding: 90px 24px 20px 24px;
            padding-right: calc(24px + (100vw - 100%));
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            box-sizing: border-box;
        }

        /* Main ecosystem container - smaller, auto height */
        .ecosystem-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 32px;
            box-shadow: 0 16px 80px rgba(0, 0, 0, 0.08);
            padding: 30px;
            width: 100%;
            max-width: 1200px;
            min-height: 480px;
            margin: 0 auto;
            position: relative;
            display: flex;
            gap: 20px;
            overflow: visible;
            transition: min-height 0.4s ease;
        }

        #canvas {
            flex: 1;
            height: 100%;
            min-height: 450px;
            position: relative;
            transition: min-height 0.4s ease;
        }

        #connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            /* Behind entities so lines don't overlay boxes */
        }

        /* Hide all arrows by default */
        #connections path {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Show arrows only when a flow is active */
        #connections path.flow-active {
            opacity: 1;
        }

        /* Entity nodes - Playful bubbly style */
        .entity {
            position: absolute;
            padding: 16px 20px;
            border-radius: 20px;
            width: 130px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
            z-index: 10;
            user-select: none;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                left 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                top 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                width 0.5s ease,
                height 0.5s ease,
                padding 0.5s ease,
                box-shadow 0.3s ease;
        }

        .entity.no-transition {
            transition: none !important;
        }

        .entity:hover:not(.expanded) {
            transform: scale(1.1) translateY(-4px);
            z-index: 20;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .entity.treasury {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
        }

        .entity.appstore {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .entity.wallet {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .entity.user {
            background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%);
            color: white;
        }

        .entity.developer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .entity.token {
            background: linear-gradient(135deg, #ff9500 0%, #ff6b9d 100%);
            color: white;
        }

        .entity.discord {
            background: linear-gradient(135deg, #5865F2 0%, #7289DA 100%);
            color: white;
        }

        .entity.charity {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            color: white;
        }

        .entity-icon {
            font-size: 24px;
            margin-bottom: 6px;
            transition: font-size 0.5s ease;
        }

        .entity-title {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 2px;
            transition: font-size 0.5s ease;
        }

        .entity-subtitle {
            font-size: 10px;
            opacity: 0.85;
            transition: opacity 0.3s;
        }

        /* Expanded state */
        .entity.expanded {
            width: 360px;
            padding: 24px 28px;
            z-index: 50;
            transform: scale(1);
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.18);
            border-radius: 24px;
        }

        .entity.expanded .entity-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .entity.expanded .entity-title {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .entity.expanded .entity-subtitle {
            opacity: 0;
            height: 0;
            margin: 0;
        }

        .entity-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.5s ease, opacity 0.3s ease, margin-top 0.5s ease;
        }

        .entity.expanded .entity-content {
            max-height: 400px;
            opacity: 1;
            margin-top: 16px;
        }

        .entity-description {
            font-size: 13px;
            line-height: 1.6;
            opacity: 0.95;
            margin-bottom: 16px;
            text-align: left;
        }

        .entity-actions {
            list-style: none;
            text-align: left;
        }

        .entity-actions li {
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s ease;
        }

        .entity-actions li:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .entity-actions li .icon {
            font-size: 16px;
        }

        .close-entity {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: inherit;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.3s, background 0.2s;
        }

        .entity.expanded .close-entity {
            opacity: 1;
        }

        .close-entity:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* Floating animation for displaced entities */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .entity.floating {
            animation: float 2s ease-in-out infinite;
        }

        /* Connection lines */
        .connection {
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            transition: d 0.8s ease;
        }

        .connection-label {
            font-size: 11px;
            font-family: 'Nunito', 'Inter', sans-serif;
            fill: #5a4a6f;
            font-weight: 600;
            transition: all 0.8s ease;
        }

        @keyframes flowAnimation {
            0% {
                stroke-dashoffset: 20;
            }

            100% {
                stroke-dashoffset: 0;
            }
        }

        .connection.animated {
            stroke-dasharray: 5, 5;
            animation: flowAnimation 0.8s linear infinite;
        }

        /* Flow highlight styles for value flow visualization */
        .connection.flow-active {
            stroke-width: 4;
            stroke-opacity: 1;
            filter: drop-shadow(0 0 6px currentColor);
        }

        /* Highlighted arrows should appear above others */
        #connections path.flow-active {
            position: relative;
        }

        @keyframes flowDash {
            to {
                stroke-dashoffset: -20;
            }
        }

        .connection.flow-animated {
            stroke-dasharray: 10 5;
            animation: flowDash 0.4s linear infinite;
        }

        .entity.flow-highlight {
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(255, 149, 0, 0.5), 0 8px 32px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .entity.flow-dim {
            opacity: 0.4;
        }

        /* Legend - Vertical on right side */
        .legend {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #5a4a6f;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Controls hint - Warm glassmorphism */
        .controls-hint {
            position: fixed;
            left: 20px;
            top: 100px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 14px 18px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 50;
            font-size: 12px;
            color: #5a4a6f;
            line-height: 1.8;
        }

        .controls-hint strong {
            color: #2d1b4e;
        }

        /* ============================================
           LEFT SIDEBAR - Journey Tabs (inside container)
           ============================================ */
        .journey-sidebar {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
            padding: 10px 0;
        }

        .journey-tab {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 2px solid transparent;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-size: 14px;
            font-weight: 600;
            color: #5a4a6f;
            min-width: 160px;
        }

        .journey-tab:hover {
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border-color: rgba(255, 149, 0, 0.3);
        }

        .journey-tab.active {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            color: white;
            border-color: transparent;
            box-shadow: 0 8px 32px rgba(255, 149, 0, 0.3);
        }

        .journey-tab .tab-icon {
            font-size: 20px;
        }

        .journey-tab .tab-label {
            flex: 1;
        }

        /* ============================================
           BOTTOM PANEL - Journey Flow (Second Container)
           ============================================ */
        .journey-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 32px;
            box-shadow: 0 16px 80px rgba(0, 0, 0, 0.08);
            padding: 30px;
            width: 100%;
            max-width: 1200px;
            margin: 20px auto 0;
            display: none;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .journey-panel.open {
            display: flex;
        }

        .journey-panel-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 12px 24px;
            margin: 0 auto 16px;
            width: fit-content;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 100px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
        }

        .journey-panel-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d1b4e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-panel-close {
            background: rgba(0, 0, 0, 0.08);
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #5a4a6f;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .journey-panel-close:hover {
            background: rgba(0, 0, 0, 0.15);
            color: #2d1b4e;
        }

        .journey-panel-content {
            padding: 0 32px;
            display: flex;
            justify-content: center;
        }

        /* Journey Steps Flow */
        .journey-steps {
            display: flex;
            align-items: center;
            gap: 0;
            min-width: max-content;
        }

        .journey-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 140px;
            opacity: 0;
            transform: translateY(20px);
            animation: stepFadeIn 0.5s ease forwards;
        }

        .journey-step:nth-child(1) {
            animation-delay: 0.1s;
        }

        .journey-step:nth-child(2) {
            animation-delay: 0.2s;
        }

        .journey-step:nth-child(3) {
            animation-delay: 0.3s;
        }

        .journey-step:nth-child(4) {
            animation-delay: 0.4s;
        }

        .journey-step:nth-child(5) {
            animation-delay: 0.5s;
        }

        .journey-step:nth-child(6) {
            animation-delay: 0.6s;
        }

        @keyframes stepFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-icon {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            animation: iconBounce 2s ease-in-out infinite;
        }

        .journey-step:nth-child(1) .step-icon {
            animation-delay: 0s;
        }

        .journey-step:nth-child(3) .step-icon {
            animation-delay: 0.2s;
        }

        .journey-step:nth-child(5) .step-icon {
            animation-delay: 0.4s;
        }

        .journey-step:nth-child(7) .step-icon {
            animation-delay: 0.6s;
        }

        .journey-step:nth-child(9) .step-icon {
            animation-delay: 0.8s;
        }

        @keyframes iconBounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .step-icon.user {
            background: linear-gradient(135deg, #a855f7, #8b5cf6);
        }

        .step-icon.deposit {
            background: linear-gradient(135deg, #10b981, #34d399);
        }

        .step-icon.treasury {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .step-icon.token {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
        }

        .step-icon.appstore {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .step-icon.discord {
            background: linear-gradient(135deg, #5865F2, #7289DA);
        }

        .step-icon.developer {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .step-icon.charity {
            background: linear-gradient(135deg, #ec4899, #f472b6);
        }

        .step-title {
            font-weight: 700;
            font-size: 14px;
            color: #2d1b4e;
            margin-bottom: 4px;
        }

        .step-description {
            font-size: 12px;
            color: #5a4a6f;
            max-width: 120px;
        }

        /* Clickable step styling */
        .journey-step {
            cursor: pointer;
            position: relative;
        }

        .journey-step:hover .step-icon {
            transform: scale(1.1);
            animation: none;
        }

        .journey-step.active .step-icon {
            transform: scale(1.15);
            animation: none;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        /* Step tooltip/detail popup */
        .step-tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 16px 20px;
            width: 220px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 100;
            pointer-events: none;
        }

        .step-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(255, 255, 255, 0.98);
        }

        .journey-step.active .step-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1);
            pointer-events: auto;
        }

        .tooltip-title {
            font-weight: 700;
            font-size: 14px;
            color: #2d1b4e;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tooltip-text {
            font-size: 13px;
            color: #5a4a6f;
            line-height: 1.5;
        }

        /* Arrow between steps */
        .journey-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            color: #ff9500;
            font-size: 24px;
            opacity: 0;
            animation: arrowFadeIn 0.3s ease forwards;
        }

        .journey-arrow:nth-of-type(2) {
            animation-delay: 0.15s;
        }

        .journey-arrow:nth-of-type(4) {
            animation-delay: 0.25s;
        }

        .journey-arrow:nth-of-type(6) {
            animation-delay: 0.35s;
        }

        .journey-arrow:nth-of-type(8) {
            animation-delay: 0.45s;
        }

        @keyframes arrowFadeIn {
            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation - Playful Style -->
    <style>
        .header {
            display: none;
        }

        /* Hide old header */
    </style>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="index.html" class="nav-logo">
                <img src="assets/suite-mascot.png" alt="SUITE" class="nav-logo-img">
                SUITE
            </a>
            <div class="nav-links">
                <a href="apps.html">Apps</a>
                <a href="developer-portal.html">Build</a>
                <a href="discuss.html">Discuss</a>
                <a href="ecosystem.html" class="active">Ecosystem</a>
                <a href="docs/index.html">Docs</a>
                <a href="wallet.html">Wallet</a>
                <a href="earn.html">Earn</a>
                <a href="boost.html">Boost</a>
                <a href="start-building.html" class="nav-cta">‚ú® Start Building</a>
            </div>
            <button class="mobile-menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <div class="canvas-container">
        <div class="ecosystem-container">
            <!-- Journey Sidebar - inside container -->
            <div class="journey-sidebar">
                <div class="journey-tab" data-journey="use" onclick="showJourney('use')">
                    <span class="tab-icon">üì±</span>
                    <span class="tab-label">Use Apps</span>
                </div>
                <div class="journey-tab" data-journey="premium" onclick="showJourney('premium')">
                    <span class="tab-icon">‚≠ê</span>
                    <span class="tab-label">Go Premium</span>
                </div>
                <div class="journey-tab" data-journey="build" onclick="showJourney('build')">
                    <span class="tab-icon">üõ†Ô∏è</span>
                    <span class="tab-label">Build & Earn</span>
                </div>
                <div class="journey-tab" data-journey="buy" onclick="showJourney('buy')">
                    <span class="tab-icon">ü™ô</span>
                    <span class="tab-label">Buy SUITE</span>
                </div>
                <div class="journey-tab" data-journey="giving" onclick="showJourney('giving')">
                    <span class="tab-icon">üíù</span>
                    <span class="tab-label">Give Back</span>
                </div>
                <div class="journey-tab" data-journey="ads" onclick="showJourney('ads')">
                    <span class="tab-icon">üì∫</span>
                    <span class="tab-label">Watch Ads</span>
                </div>
                <a href="docs/admin-flows.html" class="journey-tab" style="text-decoration: none; margin-top: auto;">
                    <span class="tab-icon">üìñ</span>
                    <span class="tab-label">More Journeys ‚Üí</span>
                </a>
            </div>

            <div id="canvas">
                <svg id="connections"></svg>
            </div>


        </div>

        <!-- Journey Panel (second container) -->
        <div class="journey-panel" id="journeyPanel">
            <div class="journey-panel-content">
                <div class="journey-steps" id="journeySteps">
                    <!-- Steps will be dynamically inserted -->
                </div>
            </div>
        </div>
    </div>

    <div class="controls-hint" style="display: none;">
        <strong>Click</strong> entity to expand<br>
        <strong>Click √ó</strong> or outside to close
    </div>

    <script>
        // 5 Core Entities - simplified ecosystem
        const entities = {
            you: {
                id: 'you', icon: 'üë§', title: 'You', subtitle: 'Build ‚Ä¢ Use ‚Ä¢ Earn', type: 'user',
                x: 60, y: 180, originalX: 60, originalY: 180,
                description: 'You are at the center of SUITE. Buy tokens, use apps, or build your own - no coding required!',
                actions: [
                    { icon: 'üí∞', text: 'Buy SUITE with ETH' },
                    { icon: 'üì±', text: 'Use any app' },
                    { icon: 'üõ†Ô∏è', text: 'Build apps in the Forge' },
                    { icon: 'üí∏', text: 'Earn from your creations' },
                ]
            },
            vault: {
                id: 'vault', icon: 'üè¶', title: 'Vault', subtitle: 'Treasury', type: 'treasury',
                x: 320, y: 40, originalX: 320, originalY: 40,
                description: 'The secure vault holding all ETH that backs SUITE tokens. Your value is always protected.',
                actions: [
                    { icon: 'üíé', text: 'Holds ETH collateral' },
                    { icon: 'üîí', text: 'Fully backed tokens' },
                    { icon: 'üìà', text: 'Earns yield' },
                    { icon: 'üíù', text: '10% to charity' },
                ]
            },
            suite: {
                id: 'suite', icon: 'ü™ô', title: '$SUITE', subtitle: 'Token', type: 'token',
                x: 320, y: 180, originalX: 320, originalY: 180,
                description: 'The SUITE token - your currency for the entire ecosystem. Always backed by ETH.',
                actions: [
                    { icon: '‚ö°', text: 'Instant payments' },
                    { icon: 'üî•', text: 'Burned on withdraw' },
                    { icon: '‚ú®', text: 'Minted on deposit' },
                    { icon: 'üåê', text: 'ERC-20 on Base' },
                ]
            },
            apps: {
                id: 'apps', icon: 'üì±', title: 'Apps', subtitle: 'Marketplace', type: 'appstore',
                x: 580, y: 100, originalX: 580, originalY: 100,
                description: 'Discover and use AI-powered apps. Every app is built by someone like you!',
                actions: [
                    { icon: 'üîç', text: 'Browse 50+ apps' },
                    { icon: '‚≠ê', text: 'Rate and review' },
                    { icon: 'üí≥', text: 'Pay per use' },
                    { icon: 'üöÄ', text: 'Publish your own' },
                ]
            },
            forge: {
                id: 'forge', icon: 'üî•', title: 'Forge', subtitle: 'Build Hub', type: 'discord',
                x: 580, y: 260, originalX: 580, originalY: 260,
                description: 'The Forge is where apps are built. Describe what you want, AI creates it. No coding!',
                actions: [
                    { icon: 'üí¨', text: 'Describe your app' },
                    { icon: 'ü§ñ', text: 'AI builds it' },
                    { icon: 'üöÄ', text: 'Publish to Apps' },
                    { icon: 'üí∏', text: 'Earn $SUITE' },
                ]
            },
            charity: {
                id: 'charity', icon: 'üíù', title: 'Charity', subtitle: '10% Giving', type: 'charity',
                x: 80, y: 20, originalX: 80, originalY: 20,
                description: 'Once the Vault reaches $100k, 10% of all yield goes to charity. Community votes on recipients!',
                actions: [
                    { icon: 'üåç', text: 'Real world impact' },
                    { icon: 'üó≥Ô∏è', text: 'Community decides' },
                    { icon: 'üìä', text: 'Transparent giving' },
                    { icon: '‚ôªÔ∏è', text: '90% reinvested' },
                ]
            },
            earn: {
                id: 'earn', icon: 'üì∫', title: 'Earn', subtitle: 'Watch Ads', type: 'wallet',
                x: 180, y: 300, originalX: 180, originalY: 300,
                description: 'Watch short video ads to earn FREE $SUITE! No payment required - just your time.',
                actions: [
                    { icon: 'üì∫', text: 'Watch 30-sec ads' },
                    { icon: 'ü™ô', text: 'Earn 2 SUITE per ad' },
                    { icon: 'üîÑ', text: 'Unlimited watches' },
                    { icon: 'üÜì', text: '100% free access' },
                ]
            }
        };

        // Connections - only between ADJACENT entities (no crossings!)
        const connections = [
            // You connects to Vault (vertical up), Suite (diagonal), Forge (horizontal), and Earn
            { from: 'you', to: 'vault', label: 'deposits', color: '#667eea' },
            { from: 'you', to: 'suite', label: 'uses', color: '#667eea' },
            { from: 'you', to: 'earn', label: 'watches ads', color: '#22c55e' },
            // Earn connects to Suite
            { from: 'earn', to: 'suite', label: 'earns free', color: '#22c55e', animated: true },
            { from: 'you', to: 'forge', label: 'builds (free!)', color: '#667eea' },
            // Vault connections
            { from: 'vault', to: 'suite', label: 'mints', color: '#ff8e8e', animated: true },
            { from: 'vault', to: 'charity', label: '10% yield', color: '#ec4899' },
            // Suite connects to Apps and Forge
            { from: 'suite', to: 'apps', label: 'unlocks', color: '#4facfe' },
            { from: 'suite', to: 'forge', label: 'optional', color: '#fcb69f' },
            // Forge to Apps
            { from: 'forge', to: 'apps', label: 'publishes', color: '#f093fb' },
            // Earns back
            { from: 'apps', to: 'suite', label: 'earns', color: '#22c55e' },
        ];

        // Flow paths for each journey
        const flowPaths = {
            use: ['you', 'suite', 'apps'],             // You ‚Üí $SUITE ‚Üí Apps
            premium: ['you', 'suite', 'apps'],         // Same path, pay for premium  
            build: ['you', 'forge', 'apps', 'suite'],  // You ‚Üí Forge ‚Üí Apps ‚Üí earn $SUITE
            buy: ['you', 'vault', 'suite'],            // You ‚Üí Vault ‚Üí $SUITE
            giving: ['vault', 'charity'],              // Vault ‚Üí Charity (10% giving)
            ads: ['you', 'earn', 'suite']               // You ‚Üí Earn ‚Üí $SUITE (watch ads)
        };

        let expandedEntity = null;
        const canvas = document.getElementById('canvas');

        // Container is now 900px max-width, so position relative to it

        // Update entity positions - now relative to container
        function repositionEntities() {
            // Layout - You below Vault for vertical connection!
            // [Vault]      [Apps]     [Charity]
            //    ‚Üì           ‚Üë           ‚Üë
            // [$SUITE] ‚îÄ‚îÄ‚Üí [Forge] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            //    ‚Üë           ‚Üë
            // [You] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            const basePositions = {
                vault: { x: 80, y: 20 },     // Top-left
                apps: { x: 300, y: 20 },     // Top-center
                charity: { x: 540, y: 20 },  // Top-right
                suite: { x: 300, y: 180 },   // Center
                you: { x: 80, y: 300 },      // Bottom-left (same column as Vault!)
                earn: { x: 300, y: 340 },    // Bottom-center (below $SUITE)
                forge: { x: 540, y: 300 }    // Bottom-right
            };

            Object.keys(entities).forEach(id => {
                const entity = entities[id];
                const basePos = basePositions[id];
                if (basePos) {
                    entity.x = basePos.x;
                    entity.y = basePos.y;
                    entity.originalX = entity.x;
                    entity.originalY = entity.y;

                    const el = document.getElementById(id);
                    if (el && !el.classList.contains('expanded') && expandedEntity !== id) {
                        // Disable transitions for instant repositioning
                        el.classList.add('no-transition');
                        el.style.left = entity.x + 'px';
                        el.style.top = entity.y + 'px';
                    }
                }
            });

            // Force reflow to apply positions immediately
            void document.body.offsetHeight;

            // Draw connections immediately (positions are now stable)
            drawConnections();

            // Re-enable transitions after a brief moment
            requestAnimationFrame(() => {
                Object.keys(entities).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('no-transition');
                });
            });
        }

        // Create entities
        Object.values(entities).forEach(entity => {
            const el = document.createElement('div');
            el.className = `entity ${entity.type}`;
            el.id = entity.id;
            el.style.left = entity.x + 'px';
            el.style.top = entity.y + 'px';
            el.innerHTML = `
                <button class="close-entity" onclick="event.stopPropagation(); collapseEntity()">√ó</button>
                <div class="entity-icon">${entity.icon}</div>
                <div class="entity-title">${entity.title}</div>
                <div class="entity-subtitle">${entity.subtitle}</div>
                <div class="entity-content">
                    <p class="entity-description">${entity.description}</p>
                    <ul class="entity-actions">
                        ${entity.actions.map(a => `<li><span class="icon">${a.icon}</span>${a.text}</li>`).join('')}
                    </ul>
                    ${entity.subActions ? `
                        <hr style="border: none; border-top: 1px solid rgba(255,255,255,0.2); margin: 12px 0;">
                        <ul class="entity-actions">
                            ${entity.subActions.map(a => `<li><span class="icon">${a.icon}</span>${a.text}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
            el.addEventListener('click', (e) => {
                if (!el.classList.contains('expanded')) {
                    expandEntity(entity.id);
                }
            });
            canvas.appendChild(el);
        });

        // Expand entity - stays in place, others float away
        function expandEntity(id) {
            if (expandedEntity === id) return;

            // Collapse previous if any
            if (expandedEntity) {
                collapseEntity();
            }

            expandedEntity = id;
            const expandedEl = document.getElementById(id);
            const expandedData = entities[id];

            // Expand the clicked entity
            expandedEl.classList.add('expanded');

            // Keep entity in place, but clamp to screen edges
            const canvasRect = canvas.getBoundingClientRect();
            const expandedWidth = 340;
            const expandedHeight = 350;

            // Clamp position so expanded box stays on screen
            let newX = expandedData.originalX;
            let newY = expandedData.originalY;

            // Right edge
            if (newX + expandedWidth > canvasRect.width - 20) {
                newX = canvasRect.width - expandedWidth - 20;
            }
            // Left edge
            if (newX < 20) {
                newX = 20;
            }
            // Bottom edge
            if (newY + expandedHeight > canvasRect.height - 20) {
                newY = canvasRect.height - expandedHeight - 20;
            }
            // Top edge
            if (newY < 80) {
                newY = 80;
            }

            expandedEl.style.left = newX + 'px';
            expandedEl.style.top = newY + 'px';
            expandedData.x = newX;
            expandedData.y = newY;

            // Push other entities away if they would overlap expanded box
            const expandedBox = {
                x: newX - 20, // padding
                y: newY - 20,
                width: expandedWidth + 40,
                height: expandedHeight + 40
            };

            Object.values(entities).forEach(entity => {
                if (entity.id === id) return;

                const el = document.getElementById(entity.id);
                const entityWidth = 120;
                const entityHeight = 100;

                // Check if entity overlaps with expanded box
                const wouldOverlap = !(
                    entity.originalX + entityWidth < expandedBox.x ||
                    entity.originalX > expandedBox.x + expandedBox.width ||
                    entity.originalY + entityHeight < expandedBox.y ||
                    entity.originalY > expandedBox.y + expandedBox.height
                );

                let newEntityX, newEntityY;

                if (wouldOverlap) {
                    // Push entity out of the way
                    const centerExpandedX = newX + expandedWidth / 2;
                    const centerExpandedY = newY + expandedHeight / 2;
                    const centerEntityX = entity.originalX + entityWidth / 2;
                    const centerEntityY = entity.originalY + entityHeight / 2;

                    const dx = centerEntityX - centerExpandedX;
                    const dy = centerEntityY - centerExpandedY;
                    const angle = Math.atan2(dy, dx);

                    // Push distance based on which direction is shortest
                    let pushDist;
                    if (Math.abs(dx) > Math.abs(dy)) {
                        // Push horizontally
                        pushDist = (expandedWidth / 2 + entityWidth / 2 + 40);
                    } else {
                        // Push vertically
                        pushDist = (expandedHeight / 2 + entityHeight / 2 + 40);
                    }

                    newEntityX = centerExpandedX + Math.cos(angle) * pushDist - entityWidth / 2;
                    newEntityY = centerExpandedY + Math.sin(angle) * pushDist - entityHeight / 2;
                } else {
                    // Just subtle push
                    const dx = entity.originalX - expandedData.originalX;
                    const dy = entity.originalY - expandedData.originalY;
                    newEntityX = entity.originalX + dx * 0.15;
                    newEntityY = entity.originalY + dy * 0.15;
                }

                // Keep within bounds
                newEntityX = Math.max(20, Math.min(canvasRect.width - 140, newEntityX));
                newEntityY = Math.max(80, Math.min(canvasRect.height - 100, newEntityY));

                entity.x = newEntityX;
                entity.y = newEntityY;

                el.style.left = newEntityX + 'px';
                el.style.top = newEntityY + 'px';
                el.classList.add('floating');

                // Stop floating after 3 seconds
                setTimeout(() => {
                    el.classList.remove('floating');
                }, 3000);
            });

            // Redraw connections with animation
            setTimeout(drawConnections, 50);
            setTimeout(drawConnections, 300);
            setTimeout(drawConnections, 600);

            // Expand canvas and container to fit expanded entity card
            const canvasEl = document.getElementById('canvas');
            const containerEl = document.querySelector('.ecosystem-container');
            canvasEl.style.minHeight = '650px';
            containerEl.style.minHeight = '680px';
        }

        // Collapse back to normal
        function collapseEntity() {
            if (!expandedEntity) return;

            const el = document.getElementById(expandedEntity);
            el.classList.remove('expanded');

            // Reset all entities to original positions
            Object.values(entities).forEach(entity => {
                entity.x = entity.originalX;
                entity.y = entity.originalY;
                const entityEl = document.getElementById(entity.id);
                entityEl.style.left = entity.originalX + 'px';
                entityEl.style.top = entity.originalY + 'px';
                entityEl.classList.remove('floating');
            });

            expandedEntity = null;

            // Redraw connections
            setTimeout(drawConnections, 50);
            setTimeout(drawConnections, 300);
            setTimeout(drawConnections, 600);

            // Shrink canvas and container back to original size
            const canvasEl = document.getElementById('canvas');
            const containerEl = document.querySelector('.ecosystem-container');
            canvasEl.style.minHeight = '450px';
            containerEl.style.minHeight = '480px';
        }

        // Click outside to collapse
        canvas.addEventListener('click', (e) => {
            if (e.target === canvas || e.target.id === 'connections') {
                collapseEntity();
            }
        });

        // Draw connections - edge to edge, not center to center
        function drawConnections() {
            const svg = document.getElementById('connections');
            svg.innerHTML = '';

            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            connections.forEach((conn, i) => {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                marker.setAttribute('id', `arrow-${i}`);
                marker.setAttribute('markerWidth', '8');
                marker.setAttribute('markerHeight', '8');
                marker.setAttribute('refX', '7');
                marker.setAttribute('refY', '3');
                marker.setAttribute('orient', 'auto');
                marker.innerHTML = `<path d="M0,0 L0,6 L7,3 z" fill="${conn.color}" opacity="0.8" />`;
                defs.appendChild(marker);
            });
            svg.appendChild(defs);

            connections.forEach((conn, i) => {
                const fromEl = document.getElementById(conn.from);
                const toEl = document.getElementById(conn.to);
                if (!fromEl || !toEl) return;

                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();

                // Calculate centers relative to canvas
                const fromCenterX = fromRect.left + fromRect.width / 2 - canvasRect.left;
                const fromCenterY = fromRect.top + fromRect.height / 2 - canvasRect.top;
                const toCenterX = toRect.left + toRect.width / 2 - canvasRect.left;
                const toCenterY = toRect.top + toRect.height / 2 - canvasRect.top;

                // Determine if primarily horizontal or vertical connection
                const dx = toCenterX - fromCenterX;
                const dy = toCenterY - fromCenterY;
                const isHorizontal = Math.abs(dx) > Math.abs(dy);

                let x1, y1, x2, y2, pathD;
                const padding = 15; // Larger gap to keep arrowheads outside entities

                if (isHorizontal) {
                    // Horizontal-first: exit right/left, then go up/down
                    if (dx > 0) {
                        x1 = fromRect.right - canvasRect.left + padding;
                        x2 = toRect.left - canvasRect.left - padding;
                    } else {
                        x1 = fromRect.left - canvasRect.left - padding;
                        x2 = toRect.right - canvasRect.left + padding;
                    }
                    y1 = fromCenterY;
                    y2 = toCenterY;

                    // L-shaped path: go horizontal to midpoint, then vertical
                    const midX = (x1 + x2) / 2;
                    pathD = `M${x1},${y1} L${midX},${y1} L${midX},${y2} L${x2},${y2}`;
                } else {
                    // Vertical-first: exit top/bottom, then go left/right
                    if (dy > 0) {
                        y1 = fromRect.bottom - canvasRect.top + padding;
                        y2 = toRect.top - canvasRect.top - padding;
                    } else {
                        y1 = fromRect.top - canvasRect.top - padding;
                        y2 = toRect.bottom - canvasRect.top + padding;
                    }
                    x1 = fromCenterX;
                    x2 = toCenterX;

                    // L-shaped path: go vertical to midpoint, then horizontal
                    const midY = (y1 + y2) / 2;
                    pathD = `M${x1},${y1} L${x1},${midY} L${x2},${midY} L${x2},${y2}`;
                }

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathD);
                path.setAttribute('stroke', conn.color);
                path.setAttribute('stroke-opacity', '0.6');
                path.setAttribute('class', `connection ${conn.animated ? 'animated' : ''}`);
                path.setAttribute('marker-end', `url(#arrow-${i})`);
                path.setAttribute('data-from', conn.from);
                path.setAttribute('data-to', conn.to);
                svg.appendChild(path);
            });
        }

        // Initial positioning and draw (reposition calls drawConnections internally)
        repositionEntities();

        // Reposition entities dynamically on resize
        window.addEventListener('resize', () => {
            repositionEntities();
        });

        // ============================================
        // JOURNEY PANEL FUNCTIONALITY
        // ============================================

        const journeys = {
            use: {
                icon: 'üì±',
                name: 'Use Apps (Free!)',
                steps: [
                    { icon: 'üë§', iconClass: 'user', title: 'You', desc: 'Start exploring', detail: 'You can use any app in the SUITE ecosystem completely FREE! No tokens, no wallet, no barriers.' },
                    { icon: 'üì±', iconClass: 'appstore', title: 'Browse Apps', desc: '50+ available', detail: 'Explore the App Store filled with AI-powered apps built by the community. Filter by category or popularity.' },
                    { icon: '‚ú®', iconClass: 'appstore', title: 'Use Freely', desc: 'No payment needed', detail: 'Core features of every app are FREE. Just open and use - no accounts, no subscriptions, no hidden costs.' },
                    { icon: '‚≠ê', iconClass: 'appstore', title: 'Love It?', desc: 'Consider premium', detail: 'If you love an app, you can optionally unlock premium features with $SUITE tokens - but it\'s never required!' }
                ]
            },
            premium: {
                icon: '‚≠ê',
                name: 'Go Premium (Optional)',
                steps: [
                    { icon: 'üë§', iconClass: 'user', title: 'You', desc: 'Want more features?', detail: 'You\'ve been using free apps and want to unlock premium features like AI enhancements, advanced tools, or priority access.' },
                    { icon: 'ü™ô', iconClass: 'token', title: 'Get $SUITE', desc: 'If you need tokens', detail: 'Buy $SUITE tokens through the Vault by depositing ETH, or earn them by building your own apps!' },
                    { icon: 'üí≥', iconClass: 'token', title: 'Pay Micro-fee', desc: 'Tiny amounts', detail: 'Premium features cost micro-amounts of $SUITE (often fractions of a cent). Instant, gas-free payments.' },
                    { icon: 'üöÄ', iconClass: 'appstore', title: 'Unlock Premium', desc: 'Enhanced experience', detail: 'Access advanced features, remove limits, get priority support - whatever the app builder offers as premium!' },
                    { icon: 'üí∏', iconClass: 'developer', title: 'Builder Earns', desc: 'Direct payment', detail: 'Your $SUITE goes directly to the person who built the app. This is how builders earn from their creations!' }
                ]
            },
            build: {
                icon: 'üõ†Ô∏è',
                name: 'Build & Earn',
                steps: [
                    { icon: 'üë§', iconClass: 'user', title: 'You', desc: 'Have an idea?', detail: 'Anyone can build apps in SUITE! You don\'t need coding skills - just describe what you want.' },
                    { icon: 'üî•', iconClass: 'discord', title: 'Join the Forge', desc: 'Discord channel', detail: 'Head to our Discord and find the Forge channel. This is where all building happens!' },
                    { icon: 'üí¨', iconClass: 'discord', title: 'Describe It', desc: 'Plain English', detail: 'Just describe your app idea in plain English. "I want an app that..." - our AI takes it from there.' },
                    { icon: 'ü§ñ', iconClass: 'discord', title: 'AI Builds It', desc: 'Automatic coding', detail: 'Our AI generates the complete app code, tests it, and prepares it for publishing. You can request changes anytime.' },
                    { icon: 'üì±', iconClass: 'appstore', title: 'Publish', desc: 'To App Store', detail: 'Your app goes live in the SUITE App Store! Users can discover and use it immediately.' },
                    { icon: 'ü™ô', iconClass: 'token', title: 'Earn $SUITE', desc: 'From premium users', detail: 'When users pay for premium features in YOUR app, you earn $SUITE directly! Set your own pricing.' }
                ]
            },
            buy: {
                icon: 'ü™ô',
                name: 'Buy $SUITE',
                steps: [
                    { icon: 'üë§', iconClass: 'user', title: 'You', desc: 'Want tokens?', detail: 'You want to get $SUITE tokens for premium features, building apps, or just to hold.' },
                    { icon: 'üí≥', iconClass: 'deposit', title: 'Deposit', desc: 'ETH or fiat', detail: 'Send ETH directly or use our fiat on-ramp with a credit card. Your choice!' },
                    { icon: 'üè¶', iconClass: 'treasury', title: 'Vault', desc: 'Receives value', detail: 'Your deposit goes into the Vault - a smart contract that holds all the ETH backing $SUITE tokens.' },
                    { icon: '‚ö°', iconClass: 'treasury', title: 'Mint', desc: 'New tokens created', detail: 'New $SUITE tokens are minted proportional to your deposit. 0.5% fee goes to the community.' },
                    { icon: 'ü™ô', iconClass: 'token', title: '$SUITE', desc: 'In your wallet!', detail: 'Your $SUITE tokens appear in your wallet. Use them for premium features, building, or hold for later!' }
                ]
            },
            giving: {
                icon: 'üíù',
                name: 'Give Back',
                steps: [
                    { icon: 'üè¶', iconClass: 'treasury', title: 'Vault', desc: 'Earns yield', detail: 'The Vault holds all ETH backing $SUITE. This ETH is deployed to earn yield through DeFi strategies.' },
                    { icon: 'üìà', iconClass: 'deposit', title: 'Yield Grows', desc: 'Passive income', detail: 'The yield earned increases the total value backing all $SUITE tokens - everyone benefits!' },
                    { icon: 'üíù', iconClass: 'charity', title: '10% to Charity', desc: 'Automatic giving', detail: 'Once the Vault hits $100k, 10% of all yield is automatically set aside for charitable giving.' },
                    { icon: 'üó≥Ô∏è', iconClass: 'user', title: 'Community Votes', desc: 'Choose recipients', detail: 'SUITE holders vote on which charities receive funds. Stake $SUITE to earn voting power!' },
                    { icon: 'üåç', iconClass: 'charity', title: 'Real Impact', desc: 'Change the world', detail: 'By using SUITE, you\'re automatically contributing to making the world better. No extra effort needed!' }
                ]
            },
            ads: {
                icon: 'üì∫',
                name: 'Watch Ads for SUITE',
                steps: [
                    { icon: 'üë§', iconClass: 'user', title: 'Free Tier', desc: '20 free actions', detail: 'Everyone gets 20 FREE AI actions to start. Use them in any SUITE app - no payment required!' },
                    { icon: '‚ö°', iconClass: 'appstore', title: 'Use Actions', desc: 'AI features', detail: 'Each AI action (meal analysis, workout generation, etc.) uses 1 action from your balance.' },
                    { icon: '‚è∏Ô∏è', iconClass: 'appstore', title: 'Hit Limit?', desc: 'Need more actions', detail: 'Used all 20 free actions? No problem - you can get more without paying!' },
                    { icon: 'üì∫', iconClass: 'discord', title: 'Watch Ad', desc: '15-30 seconds', detail: 'Watch a short video ad (like in mobile games). Takes 15-30 seconds.' },
                    { icon: 'ü™ô', iconClass: 'token', title: 'Get SUITE', desc: 'Instant credits', detail: 'Receive SUITE credits instantly! These work exactly like paid SUITE in all apps.' },
                    { icon: 'üîÑ', iconClass: 'user', title: 'Keep Going!', desc: 'Unlimited access', detail: 'Watch more ads anytime you need more SUITE. Free access to AI features forever!' }
                ]
            }
        };

        let currentJourney = null;
        let activeStep = null;

        // Clear all flow highlights
        function clearFlowHighlights() {
            document.querySelectorAll('.entity').forEach(el => {
                el.classList.remove('flow-highlight', 'flow-dim');
            });
            document.querySelectorAll('.connection').forEach(conn => {
                conn.classList.remove('flow-active', 'flow-animated');
            });
        }

        // Highlight entities and arrows for a journey flow
        function highlightFlow(journeyKey) {
            clearFlowHighlights();

            const flowPath = flowPaths[journeyKey];
            if (!flowPath) return;

            // Dim all entities first
            document.querySelectorAll('.entity').forEach(el => {
                el.classList.add('flow-dim');
            });

            // Highlight entities in the flow with staggered timing
            flowPath.forEach((entityId, index) => {
                setTimeout(() => {
                    const el = document.getElementById(entityId);
                    if (el) {
                        el.classList.remove('flow-dim');
                        el.classList.add('flow-highlight');
                    }
                }, index * 200);
            });

            // Find and highlight connections between flow entities (FORWARD direction only)
            const svg = document.getElementById('connections');
            const allPaths = svg.querySelectorAll('path.connection');

            // Check each path by its data attributes
            allPaths.forEach(pathEl => {
                const fromId = pathEl.getAttribute('data-from');
                const toId = pathEl.getAttribute('data-to');

                const fromIndex = flowPath.indexOf(fromId);
                const toIndex = flowPath.indexOf(toId);

                // Both must be in path AND 'from' must come before 'to' in flow order
                if (fromIndex !== -1 && toIndex !== -1 && fromIndex < toIndex) {
                    setTimeout(() => {
                        pathEl.classList.add('flow-active', 'flow-animated');
                        // Move highlighted path to end of SVG to render on top
                        svg.appendChild(pathEl);
                    }, (fromIndex + 1) * 200);
                }
            });
        }

        function showJourney(journeyKey) {
            const journey = journeys[journeyKey];
            if (!journey) return;

            // Update active tab
            document.querySelectorAll('.journey-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-journey="${journeyKey}"]`).classList.add('active');

            // Highlight the flow on the diagram
            highlightFlow(journeyKey);

            // Build steps HTML with tooltips
            const stepsContainer = document.getElementById('journeySteps');
            stepsContainer.innerHTML = journey.steps.map((step, i) => `
                <div class="journey-step" data-step="${i}" onclick="toggleStep(${i})">
                    <div class="step-tooltip">
                        <div class="tooltip-title">${step.icon} ${step.title}</div>
                        <div class="tooltip-text">${step.detail}</div>
                    </div>
                    <div class="step-icon ${step.iconClass}">${step.icon}</div>
                    <div class="step-title">${step.title}</div>
                    <div class="step-description">${step.desc}</div>
                </div>
                ${i < journey.steps.length - 1 ? '<div class="journey-arrow">‚Üí</div>' : ''}
            `).join('');

            // Open panel
            document.getElementById('journeyPanel').classList.add('open');
            currentJourney = journeyKey;
        }

        function closeJourney() {
            document.getElementById('journeyPanel').classList.remove('open');
            document.querySelectorAll('.journey-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            clearFlowHighlights();
            currentJourney = null;
            activeStep = null;
        }

        function toggleStep(stepIndex) {
            const allSteps = document.querySelectorAll('.journey-step');

            // If clicking the same step, deactivate it
            if (activeStep === stepIndex) {
                allSteps.forEach(s => s.classList.remove('active'));
                activeStep = null;
                return;
            }

            // Deactivate all, activate clicked
            allSteps.forEach(s => s.classList.remove('active'));
            allSteps[stepIndex].classList.add('active');
            activeStep = stepIndex;
        }

        // Close tooltip when clicking outside a step
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.journey-step') && activeStep !== null) {
                document.querySelectorAll('.journey-step').forEach(s => s.classList.remove('active'));
                activeStep = null;
            }
        });

        // Close panel when clicking outside
        document.addEventListener('click', (e) => {
            if (currentJourney &&
                !e.target.closest('.journey-panel') &&
                !e.target.closest('.journey-tab')) {
                closeJourney();
            }
        });
    </script>
</body>

</html>