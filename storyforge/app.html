<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoryForge â€” AI Story Generator</title>
    <link rel="icon" type="image/png" href="/suitegpt-logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0a0a0f; color: #e2e8f0; min-height: 100vh; }

        .header { padding: 20px 24px; border-bottom: 1px solid #1a1a2e; display: flex; align-items: center; justify-content: space-between; }
        .header h1 { font-size: 1.3rem; font-weight: 800; }
        .header h1 span { background: linear-gradient(135deg, #e879f9, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-actions { display: flex; gap: 8px; }
        .header-btn { background: #1a1a2e; border: 1px solid #2a2a3e; color: #94a3b8; padding: 8px 16px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; }
        .header-btn:hover { border-color: #e879f9; color: #e2e8f0; }

        .container { max-width: 900px; margin: 0 auto; padding: 32px 24px; }

        /* Input Form */
        .form-section { margin-bottom: 24px; }
        .form-label { font-size: 0.8rem; font-weight: 600; color: #a855f7; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block; }

        .premise-input {
            width: 100%; padding: 16px; background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
            color: #e2e8f0; font-size: 0.95rem; font-family: 'Inter', sans-serif; resize: vertical; min-height: 100px; line-height: 1.6;
            transition: border-color 0.2s;
        }
        .premise-input:focus { outline: none; border-color: #a855f7; }
        .premise-input::placeholder { color: #4a5568; }

        .text-input {
            width: 100%; padding: 12px 16px; background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 10px;
            color: #e2e8f0; font-size: 0.9rem; font-family: 'Inter', sans-serif; transition: border-color 0.2s;
        }
        .text-input:focus { outline: none; border-color: #a855f7; }
        .text-input::placeholder { color: #4a5568; }

        .options-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        .option-group select {
            width: 100%; padding: 10px 12px; background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 10px;
            color: #e2e8f0; font-size: 0.85rem; font-family: 'Inter', sans-serif; cursor: pointer;
        }
        .option-group select:focus { outline: none; border-color: #a855f7; }

        /* Genre chips */
        .genre-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .genre-chip {
            padding: 8px 16px; background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 20px;
            font-size: 0.8rem; color: #94a3b8; cursor: pointer; transition: all 0.2s; user-select: none;
        }
        .genre-chip:hover { border-color: #a855f7; color: #e2e8f0; }
        .genre-chip.active { background: #a855f715; border-color: #a855f7; color: #e879f9; font-weight: 600; }

        .generate-btn {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #e879f9, #a855f7); color: #fff;
            font-weight: 700; font-size: 1rem; border: none; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .generate-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px #a855f730; }
        .generate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Loading */
        .loading { display: none; text-align: center; padding: 60px 24px; }
        .loading.active { display: block; }
        .spinner {
            width: 48px; height: 48px; border: 3px solid #2a2a3e; border-top-color: #a855f7;
            border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { color: #94a3b8; font-size: 0.95rem; }
        .loading .writing-progress { margin-top: 12px; font-size: 0.8rem; color: #a855f7; font-style: italic; }

        /* Results */
        .results { display: none; }
        .results.active { display: block; }

        .story-header { text-align: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid #2a2a3e; }
        .story-title { font-family: 'Merriweather', serif; font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .story-meta { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
        .story-meta-tag { font-size: 0.75rem; color: #94a3b8; background: #1a1a2e; padding: 4px 12px; border-radius: 12px; }
        .story-hook { font-family: 'Merriweather', serif; font-style: italic; color: #e879f9; font-size: 1.05rem; margin-top: 16px; line-height: 1.6; }

        /* Tabs */
        .tabs { display: flex; gap: 4px; margin-bottom: 24px; border-bottom: 1px solid #2a2a3e; padding-bottom: 0; }
        .tab {
            padding: 10px 20px; font-size: 0.85rem; font-weight: 600; color: #64748b; cursor: pointer;
            border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .tab:hover { color: #94a3b8; }
        .tab.active { color: #e879f9; border-bottom-color: #a855f7; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Story text */
        .story-text {
            font-family: 'Merriweather', serif; font-size: 1rem; line-height: 2; color: #cbd5e1;
            max-width: 680px; margin: 0 auto; padding: 0 16px;
        }
        .story-text p { margin-bottom: 20px; text-indent: 2em; }
        .story-text p:first-child { text-indent: 0; }
        .story-text p:first-child::first-letter {
            font-size: 3.5em; float: left; line-height: 0.8; margin-right: 8px; margin-top: 4px;
            font-weight: 700; color: #e879f9; font-family: 'Merriweather', serif;
        }

        /* Characters */
        .char-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px; }
        .char-card { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px; padding: 16px; }
        .char-name { font-weight: 700; margin-bottom: 4px; }
        .char-role { font-size: 0.75rem; color: #a855f7; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .char-desc { font-size: 0.85rem; color: #94a3b8; line-height: 1.5; }

        /* Info cards */
        .info-section { margin-bottom: 24px; }
        .info-section h3 { font-size: 0.95rem; margin-bottom: 12px; color: #e879f9; }
        .theme-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .theme-tag { background: #a855f715; border: 1px solid #a855f730; color: #e879f9; padding: 6px 14px; border-radius: 8px; font-size: 0.8rem; }
        .writing-notes { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px; padding: 16px; font-size: 0.85rem; color: #94a3b8; line-height: 1.6; }
        .continue-prompt { background: #1a1a2e; border-left: 3px solid #a855f7; padding: 16px; border-radius: 0 12px 12px 0; font-size: 0.9rem; color: #cbd5e1; line-height: 1.5; font-style: italic; }

        /* Continue button */
        .continue-btn {
            display: inline-block; padding: 12px 28px; background: #1a1a2e; border: 1px solid #a855f7; color: #e879f9;
            font-weight: 600; font-size: 0.9rem; border-radius: 10px; cursor: pointer; transition: all 0.2s; margin-top: 16px;
        }
        .continue-btn:hover { background: #a855f715; }

        /* Q&A */
        .qa-container { max-width: 680px; margin: 0 auto; }
        .qa-messages { display: flex; flex-direction: column; gap: 16px; margin-bottom: 16px; max-height: 400px; overflow-y: auto; padding: 4px; }
        .qa-msg { padding: 12px 16px; border-radius: 12px; font-size: 0.9rem; line-height: 1.6; max-width: 85%; }
        .qa-msg.user { background: #a855f720; border: 1px solid #a855f730; align-self: flex-end; color: #e2e8f0; }
        .qa-msg.ai { background: #1a1a2e; border: 1px solid #2a2a3e; align-self: flex-start; color: #cbd5e1; }
        .qa-input-row { display: flex; gap: 8px; }
        .qa-input {
            flex: 1; padding: 12px 16px; background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 10px;
            color: #e2e8f0; font-size: 0.9rem; font-family: 'Inter', sans-serif;
        }
        .qa-input:focus { outline: none; border-color: #a855f7; }
        .qa-send {
            padding: 12px 20px; background: linear-gradient(135deg, #e879f9, #a855f7); color: #fff;
            border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 0.85rem;
        }
        .qa-send:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Copy button */
        .copy-btn {
            display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #1a1a2e;
            border: 1px solid #2a2a3e; border-radius: 8px; color: #94a3b8; font-size: 0.8rem; cursor: pointer; transition: all 0.2s;
        }
        .copy-btn:hover { border-color: #a855f7; color: #e2e8f0; }

        .error { display: none; text-align: center; padding: 40px; }
        .error.active { display: block; }
        .error p { color: #f87171; margin-bottom: 16px; }

        @media (max-width: 640px) {
            .options-row { grid-template-columns: 1fr; }
            .story-title { font-size: 1.5rem; }
            .story-text { font-size: 0.95rem; padding: 0; }
            .tabs { overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>StoryForge <span>AI</span></h1>
        <div class="header-actions">
            <button class="header-btn" onclick="resetAll()">+ New Story</button>
        </div>
    </div>

    <div class="container">
        <!-- Input Form -->
        <div id="inputForm">
            <div class="form-section">
                <label class="form-label">Your Story Premise</label>
                <textarea class="premise-input" id="premiseInput" placeholder="Describe your story idea... e.g. 'A retired astronaut discovers a signal from a planet she visited 30 years ago â€” but the planet was supposed to be uninhabited' or 'Two rival chefs compete in a cooking battle that reveals a shared childhood secret'"></textarea>
            </div>

            <div class="form-section">
                <label class="form-label">Genre</label>
                <div class="genre-grid">
                    <div class="genre-chip active" data-genre="general fiction">General Fiction</div>
                    <div class="genre-chip" data-genre="sci-fi">Sci-Fi</div>
                    <div class="genre-chip" data-genre="fantasy">Fantasy</div>
                    <div class="genre-chip" data-genre="mystery/thriller">Mystery</div>
                    <div class="genre-chip" data-genre="romance">Romance</div>
                    <div class="genre-chip" data-genre="horror">Horror</div>
                    <div class="genre-chip" data-genre="literary fiction">Literary</div>
                    <div class="genre-chip" data-genre="comedy/humor">Comedy</div>
                    <div class="genre-chip" data-genre="historical fiction">Historical</div>
                    <div class="genre-chip" data-genre="adventure">Adventure</div>
                    <div class="genre-chip" data-genre="drama">Drama</div>
                    <div class="genre-chip" data-genre="fairy tale / fable">Fairy Tale</div>
                </div>
            </div>

            <div class="options-row">
                <div class="option-group">
                    <label class="form-label">Length</label>
                    <select id="lengthSelect">
                        <option value="short (500-800 words)">Short (~500 words)</option>
                        <option value="medium (1000-2000 words)" selected>Medium (~1500 words)</option>
                        <option value="long (2500-4000 words)">Long (~3000 words)</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="form-label">Tone</label>
                    <select id="toneSelect">
                        <option value="engaging and vivid">Engaging</option>
                        <option value="dark and atmospheric">Dark</option>
                        <option value="light and whimsical">Whimsical</option>
                        <option value="suspenseful and tense">Suspenseful</option>
                        <option value="heartfelt and emotional">Heartfelt</option>
                        <option value="witty and humorous">Witty</option>
                        <option value="poetic and lyrical">Poetic</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="form-label">Audience</label>
                    <select id="audienceSelect">
                        <option value="general adult">Adult</option>
                        <option value="young adult (13-18)">Young Adult</option>
                        <option value="children (8-12)">Children</option>
                        <option value="mature / literary">Mature</option>
                    </select>
                </div>
            </div>

            <div class="options-row" style="grid-template-columns: 1fr 1fr;">
                <div class="form-section" style="margin-bottom:0;">
                    <label class="form-label">Characters (optional)</label>
                    <input class="text-input" id="charactersInput" placeholder="e.g. 'Maya, a stubborn scientist; Leo, her estranged brother'">
                </div>
                <div class="form-section" style="margin-bottom:0;">
                    <label class="form-label">Setting (optional)</label>
                    <input class="text-input" id="settingInput" placeholder="e.g. 'A floating city above the clouds in 2150'">
                </div>
            </div>

            <div style="margin-top: 24px;">
                <button class="generate-btn" id="generateBtn" onclick="generateStory()">Write My Story</button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loadingView">
            <div class="spinner"></div>
            <p>Crafting your story...</p>
            <div class="writing-progress" id="writingProgress">Building the world, shaping the characters...</div>
        </div>

        <!-- Error -->
        <div class="error" id="errorView">
            <p id="errorMsg">Something went wrong.</p>
            <button class="generate-btn" style="max-width:300px;margin:0 auto;" onclick="resetAll()">Try Again</button>
        </div>

        <!-- Results -->
        <div class="results" id="resultsView">
            <div class="story-header">
                <div class="story-title" id="storyTitle"></div>
                <div class="story-meta" id="storyMeta"></div>
                <div class="story-hook" id="storyHook"></div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="story">Story</div>
                <div class="tab" data-tab="characters">Characters</div>
                <div class="tab" data-tab="details">Details</div>
                <div class="tab" data-tab="qa">Writing Coach</div>
            </div>

            <div class="tab-content active" id="tab-story">
                <div style="display: flex; gap: 8px; margin-bottom: 20px;">
                    <button class="copy-btn" onclick="copyStory()">ðŸ“‹ Copy Story</button>
                    <button class="continue-btn" onclick="continueStory()" id="continueBtn" style="margin-top:0;">Continue Story â†’</button>
                </div>
                <div class="story-text" id="storyText"></div>
            </div>

            <div class="tab-content" id="tab-characters">
                <div class="char-grid" id="charGrid"></div>
            </div>

            <div class="tab-content" id="tab-details">
                <div class="info-section">
                    <h3>Themes</h3>
                    <div class="theme-tags" id="themeTags"></div>
                </div>
                <div class="info-section">
                    <h3>Writing Notes</h3>
                    <div class="writing-notes" id="writingNotes"></div>
                </div>
                <div class="info-section">
                    <h3>Where Could This Go Next?</h3>
                    <div class="continue-prompt" id="continuePrompt"></div>
                    <button class="continue-btn" onclick="continueStory()" id="continueBtn2">Continue the Story â†’</button>
                </div>
            </div>

            <div class="tab-content" id="tab-qa">
                <div class="qa-container">
                    <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 16px;">Ask about your story â€” get feedback, rewrites, plot ideas, or writing advice.</p>
                    <div class="qa-messages" id="qaMessages"></div>
                    <div class="qa-input-row">
                        <input class="qa-input" id="qaInput" placeholder="How can I make the ending more impactful?" onkeydown="if(event.key==='Enter')askQuestion()">
                        <button class="qa-send" id="qaSend" onclick="askQuestion()">Ask</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let storyData = null;
        let fullStoryText = '';
        let qaHistory = [];

        // Genre chips
        document.querySelectorAll('.genre-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.genre-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
            });
        });

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // Writing progress messages
        const progressMsgs = [
            'Building the world, shaping the characters...',
            'Plotting the narrative arc...',
            'Writing vivid scenes and dialogue...',
            'Refining the prose and pacing...',
            'Crafting the perfect ending...',
            'Adding final touches...'
        ];

        function showView(view) {
            document.getElementById('inputForm').style.display = view === 'input' ? 'block' : 'none';
            document.getElementById('loadingView').classList.toggle('active', view === 'loading');
            document.getElementById('errorView').classList.toggle('active', view === 'error');
            document.getElementById('resultsView').classList.toggle('active', view === 'results');
        }

        async function generateStory() {
            const premise = document.getElementById('premiseInput').value.trim();
            if (!premise) { document.getElementById('premiseInput').focus(); return; }

            const genre = document.querySelector('.genre-chip.active')?.dataset.genre || 'general fiction';
            const length = document.getElementById('lengthSelect').value;
            const tone = document.getElementById('toneSelect').value;
            const audience = document.getElementById('audienceSelect').value;
            const characters = document.getElementById('charactersInput').value.trim();
            const setting = document.getElementById('settingInput').value.trim();

            showView('loading');
            let pi = 0;
            const progressInterval = setInterval(() => {
                pi = (pi + 1) % progressMsgs.length;
                document.getElementById('writingProgress').textContent = progressMsgs[pi];
            }, 3000);

            try {
                const resp = await fetch('/api/storyforge', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: 'generate', premise, genre, length, tone, audience, characters: characters || undefined, setting: setting || undefined })
                });
                const data = await resp.json();
                clearInterval(progressInterval);

                if (data.error) throw new Error(data.error);
                if (data.raw) throw new Error('Unexpected response format');

                storyData = data;
                fullStoryText = data.story || '';
                renderResults(data);
                showView('results');
                chargeCredits('generate');
            } catch (err) {
                clearInterval(progressInterval);
                document.getElementById('errorMsg').textContent = err.message || 'Failed to generate story. Please try again.';
                showView('error');
            }
        }

        async function continueStory() {
            const btn = document.getElementById('continueBtn');
            const btn2 = document.getElementById('continueBtn2');
            btn.disabled = true; btn2.disabled = true;
            btn.textContent = 'Writing...';
            btn2.textContent = 'Writing...';

            try {
                const resp = await fetch('/api/storyforge', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: 'continue', context: fullStoryText })
                });
                const data = await resp.json();

                if (data.error) throw new Error(data.error);

                const continuation = data.continuation || data.raw || '';
                fullStoryText += '\n\n' + continuation;

                // Re-render story tab with full text
                renderStoryText(fullStoryText);
                chargeCredits('continue');

                // Switch to story tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-tab="story"]').classList.add('active');
                document.getElementById('tab-story').classList.add('active');
            } catch (err) {
                alert('Failed to continue story: ' + err.message);
            } finally {
                btn.disabled = false; btn2.disabled = false;
                btn.textContent = 'Continue Story â†’';
                btn2.textContent = 'Continue the Story â†’';
            }
        }

        function renderResults(data) {
            document.getElementById('storyTitle').textContent = data.title || 'Untitled Story';
            document.getElementById('storyHook').textContent = data.hookLine || '';

            const meta = document.getElementById('storyMeta');
            meta.innerHTML = '';
            if (data.genre) meta.innerHTML += `<span class="story-meta-tag">${data.genre}</span>`;
            if (data.wordCount) meta.innerHTML += `<span class="story-meta-tag">${data.wordCount.toLocaleString()} words</span>`;

            renderStoryText(data.story || '');

            // Characters
            const charGrid = document.getElementById('charGrid');
            charGrid.innerHTML = '';
            if (data.characters?.length) {
                data.characters.forEach(c => {
                    charGrid.innerHTML += `<div class="char-card">
                        <div class="char-name">${c.name}</div>
                        <div class="char-role">${c.role}</div>
                        <div class="char-desc">${c.description}</div>
                    </div>`;
                });
            }

            // Themes
            const tags = document.getElementById('themeTags');
            tags.innerHTML = '';
            if (data.themes?.length) {
                data.themes.forEach(t => tags.innerHTML += `<span class="theme-tag">${t}</span>`);
            }

            // Writing notes
            document.getElementById('writingNotes').textContent = data.writingNotes || '';

            // Continue prompt
            document.getElementById('continuePrompt').textContent = data.continuePrompt || '';
        }

        function renderStoryText(text) {
            const storyDiv = document.getElementById('storyText');
            const paragraphs = text.split(/\n\n+/).filter(p => p.trim());
            storyDiv.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p.trim())}</p>`).join('');
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function copyStory() {
            const title = storyData?.title || 'Story';
            const text = `${title}\n\n${fullStoryText}`;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'âœ“ Copied!';
                setTimeout(() => btn.innerHTML = 'ðŸ“‹ Copy Story', 2000);
            });
        }

        async function askQuestion() {
            const input = document.getElementById('qaInput');
            const q = input.value.trim();
            if (!q) return;
            input.value = '';

            const msgs = document.getElementById('qaMessages');
            msgs.innerHTML += `<div class="qa-msg user">${escapeHtml(q)}</div>`;

            document.getElementById('qaSend').disabled = true;
            msgs.innerHTML += `<div class="qa-msg ai" id="qaTyping" style="color:#64748b;">Thinking...</div>`;
            msgs.scrollTop = msgs.scrollHeight;

            try {
                const resp = await fetch('/api/storyforge', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: 'qa', question: q, context: fullStoryText, history: qaHistory })
                });
                const data = await resp.json();
                document.getElementById('qaTyping')?.remove();

                const answer = data.answer || data.error || 'No response';
                qaHistory.push({ role: 'user', content: q }, { role: 'model', content: answer });

                msgs.innerHTML += `<div class="qa-msg ai">${formatMarkdown(answer)}</div>`;
                msgs.scrollTop = msgs.scrollHeight;
                chargeCredits('qa');
            } catch (err) {
                document.getElementById('qaTyping')?.remove();
                msgs.innerHTML += `<div class="qa-msg ai" style="color:#f87171;">Error: ${err.message}</div>`;
            } finally {
                document.getElementById('qaSend').disabled = false;
            }
        }

        function formatMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code style="background:#0f0f1a;padding:2px 6px;border-radius:4px;font-size:0.85em;">$1</code>')
                .replace(/\n/g, '<br>');
        }

        function resetAll() {
            storyData = null;
            fullStoryText = '';
            qaHistory = [];
            document.getElementById('qaMessages').innerHTML = '';
            showView('input');
        }

        function chargeCredits(feature) {
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'suite-charge-credits',
                    appId: 'storyforge',
                    feature: feature,
                    chargeId: Date.now().toString(),
                    amount: 5
                }, '*');
            }
        }
    </script>
</body>
</html>
