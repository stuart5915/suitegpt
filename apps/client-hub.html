<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Hub | SUITE</title>
    <link rel="icon" type="image/png" href="/assets/suite-logo-new.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0a;
            --bg-card: #141414;
            --bg-card-hover: #1a1a1a;
            --bg-input: #111;
            --border: #222;
            --border-hover: #333;
            --text: #f0f0f0;
            --text-dim: #888;
            --text-muted: #555;
            --accent: #6366f1;
            --accent-soft: rgba(99,102,241,0.12);
            --green: #22c55e;
            --green-soft: rgba(34,197,94,0.12);
            --orange: #f59e0b;
            --orange-soft: rgba(245,158,11,0.12);
            --red: #ef4444;
            --red-soft: rgba(239,68,68,0.12);
            --blue: #3b82f6;
            --blue-soft: rgba(59,130,246,0.12);
            --purple: #a855f7;
            --purple-soft: rgba(168,85,247,0.12);
        }
        body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

        /* Top Bar */
        .top-bar {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 24px; border-bottom: 1px solid var(--border);
            position: sticky; top: 0; background: var(--bg); z-index: 100;
        }
        .top-bar-left { display: flex; align-items: center; gap: 12px; }
        .top-bar-logo {
            font-size: 1.3rem; font-weight: 800;
            background: linear-gradient(135deg, var(--green), #10b981);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .top-bar-divider { width: 1px; height: 20px; background: var(--border); }
        .top-bar-title { font-size: 0.95rem; color: var(--text-dim); font-weight: 600; }

        /* Tab Nav */
        .tab-nav {
            display: flex; gap: 4px; padding: 12px 24px;
            border-bottom: 1px solid var(--border); overflow-x: auto;
        }
        .tab-btn {
            padding: 8px 18px; border-radius: 10px; border: 1px solid transparent;
            background: transparent; color: var(--text-dim); font-family: inherit;
            font-size: 0.88rem; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.2s;
        }
        .tab-btn:hover { background: var(--bg-card); color: var(--text); }
        .tab-btn.active { background: var(--green-soft); color: var(--green); border-color: rgba(34,197,94,0.2); }

        .main { padding: 24px; max-width: 1200px; margin: 0 auto; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* Stats */
        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 18px; text-align: center;
        }
        .stat-value { font-size: 1.8rem; font-weight: 800; }
        .stat-label { font-size: 0.78rem; color: var(--text-dim); font-weight: 600; margin-top: 4px; }

        /* Client Cards */
        .section-title {
            font-size: 1.1rem; font-weight: 700; margin-bottom: 16px;
            display: flex; align-items: center; gap: 8px;
        }
        .clients-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 16px; margin-bottom: 32px;
        }
        .client-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; overflow: hidden; transition: all 0.2s;
        }
        .client-card:hover { border-color: var(--border-hover); }
        .client-card-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 20px; cursor: pointer;
        }
        .client-card-left { display: flex; align-items: center; gap: 14px; }
        .client-avatar {
            width: 44px; height: 44px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1.1rem; flex-shrink: 0;
        }
        .client-name { font-weight: 700; font-size: 1rem; }
        .client-industry { font-size: 0.8rem; color: var(--text-dim); margin-top: 1px; }
        .client-status-badge {
            padding: 4px 10px; border-radius: 8px; font-size: 0.72rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px;
        }
        .status-trial { background: var(--blue-soft); color: var(--blue); }
        .status-active { background: var(--green-soft); color: var(--green); }
        .status-lead { background: var(--orange-soft); color: var(--orange); }
        .status-churned { background: var(--red-soft); color: var(--red); }

        .client-card-body {
            display: none; padding: 0 20px 20px; border-top: 1px solid var(--border);
        }
        .client-card.expanded .client-card-body { display: block; padding-top: 16px; }

        .client-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        .client-meta-item {}
        .client-meta-label { font-size: 0.72rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px; }
        .client-meta-value { font-size: 0.9rem; font-weight: 600; margin-top: 2px; }

        /* Request log */
        .request-log { margin-top: 12px; }
        .request-log-title {
            font-size: 0.82rem; font-weight: 700; color: var(--text-dim);
            margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.4px;
        }
        .request-item {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 10px 12px; background: rgba(255,255,255,0.02);
            border: 1px solid var(--border); border-radius: 10px; margin-bottom: 6px;
        }
        .request-dot {
            width: 8px; height: 8px; border-radius: 50%; margin-top: 6px; flex-shrink: 0;
        }
        .request-dot.pending { background: var(--orange); }
        .request-dot.done { background: var(--green); }
        .request-text { font-size: 0.85rem; font-weight: 600; }
        .request-date { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }
        .request-actions { margin-left: auto; display: flex; gap: 4px; }
        .request-actions button {
            padding: 3px 8px; border-radius: 6px; border: 1px solid var(--border);
            background: transparent; color: var(--text-dim); font-family: inherit;
            font-size: 0.7rem; font-weight: 600; cursor: pointer;
        }
        .request-actions button:hover { background: var(--green-soft); color: var(--green); }

        .add-request-row {
            display: flex; gap: 8px; margin-top: 10px;
        }
        .add-request-row input {
            flex: 1; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border);
            background: var(--bg-input); color: var(--text); font-family: inherit; font-size: 0.85rem;
        }
        .add-request-row input:focus { outline: none; border-color: var(--green); }

        /* Buttons */
        .btn {
            padding: 10px 20px; border-radius: 10px; border: none;
            font-family: inherit; font-weight: 700; font-size: 0.88rem;
            cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-primary { background: linear-gradient(135deg, var(--green), #10b981); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-sm { padding: 6px 14px; font-size: 0.8rem; }
        .btn-ghost { background: transparent; color: var(--text-dim); border: none; padding: 6px 12px; }

        /* Forms */
        .form-group { margin-bottom: 14px; }
        .form-label {
            display: block; font-size: 0.78rem; font-weight: 700; color: var(--text-dim);
            margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.4px;
        }
        input[type="text"], input[type="url"], input[type="number"], select, textarea {
            width: 100%; padding: 10px 14px; border-radius: 10px;
            border: 1px solid var(--border); background: var(--bg-input);
            color: var(--text); font-family: inherit; font-size: 0.9rem;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--green); }
        select { cursor: pointer; }
        textarea { resize: vertical; min-height: 80px; }

        /* Add Client Form */
        .add-form {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; padding: 20px; margin-bottom: 24px;
        }
        .add-form-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 14px; }
        .add-form-row { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; }

        /* Revenue Tracker */
        .revenue-table {
            width: 100%; border-collapse: collapse;
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden;
        }
        .revenue-table th {
            text-align: left; padding: 12px 16px; font-size: 0.78rem;
            font-weight: 700; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.4px; border-bottom: 1px solid var(--border);
        }
        .revenue-table td {
            padding: 12px 16px; font-size: 0.88rem; border-bottom: 1px solid var(--border);
        }
        .revenue-table tr:last-child td { border-bottom: none; }
        .revenue-table tr:hover td { background: rgba(255,255,255,0.02); }

        /* Monthly summary */
        .month-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-bottom: 24px; }
        .month-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 16px;
        }
        .month-card-label { font-size: 0.78rem; color: var(--text-dim); font-weight: 600; }
        .month-card-value { font-size: 1.4rem; font-weight: 800; margin-top: 4px; }

        /* Outreach templates */
        .template-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 20px; margin-bottom: 12px;
        }
        .template-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 8px; }
        .template-body {
            font-size: 0.88rem; color: var(--text-dim); line-height: 1.6;
            white-space: pre-wrap; background: var(--bg-input);
            border: 1px solid var(--border); border-radius: 10px; padding: 14px;
        }
        .copy-btn {
            padding: 5px 12px; border-radius: 6px; border: 1px solid var(--border);
            background: var(--bg-card); color: var(--text-dim); font-size: 0.75rem;
            font-weight: 600; cursor: pointer; font-family: inherit; margin-top: 8px;
        }
        .copy-btn:hover { color: var(--text); }

        /* Ads & Leads Tab */
        .ads-leads-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
        .filter-bar {
            display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;
        }
        .filter-btn {
            padding: 6px 14px; border-radius: 8px; border: 1px solid var(--border);
            background: transparent; color: var(--text-dim); font-family: inherit;
            font-size: 0.78rem; font-weight: 700; cursor: pointer; transition: all 0.2s;
        }
        .filter-btn:hover { background: var(--bg-card); color: var(--text); }
        .filter-btn.active { background: var(--green-soft); color: var(--green); border-color: rgba(34,197,94,0.2); }
        .leads-table {
            width: 100%; border-collapse: collapse;
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden;
        }
        .leads-table th {
            text-align: left; padding: 10px 14px; font-size: 0.72rem;
            font-weight: 700; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.4px; border-bottom: 1px solid var(--border);
        }
        .leads-table td {
            padding: 10px 14px; font-size: 0.85rem; border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        .leads-table tr:last-child td { border-bottom: none; }
        .leads-table tr:hover td { background: rgba(255,255,255,0.02); }
        .leads-table tr.expanded-row td { background: var(--bg-input); }
        .lead-status-select {
            padding: 3px 8px; border-radius: 6px; border: 1px solid var(--border);
            background: var(--bg-input); color: var(--text); font-family: inherit;
            font-size: 0.78rem; font-weight: 600; cursor: pointer;
        }
        .lead-expand-row { display: none; }
        .lead-expand-row.show { display: table-row; }
        .lead-expand-cell {
            padding: 12px 14px; background: var(--bg-input);
        }
        .lead-notes-area {
            width: 100%; padding: 8px 12px; border-radius: 8px;
            border: 1px solid var(--border); background: var(--bg);
            color: var(--text); font-family: inherit; font-size: 0.85rem;
            resize: vertical; min-height: 60px;
        }
        .lead-detail-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        .lead-detail-label { font-size: 0.7rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; }
        .lead-detail-value { font-size: 0.85rem; font-weight: 600; margin-top: 2px; }
        .ads-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px; margin-bottom: 24px;
        }
        .ad-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 18px; transition: all 0.2s;
        }
        .ad-card:hover { border-color: var(--border-hover); }
        .ad-card-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .ad-platform-badge {
            padding: 3px 10px; border-radius: 6px; font-size: 0.72rem;
            font-weight: 700; text-transform: uppercase;
        }
        .ad-card-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 6px; }
        .ad-card-meta { font-size: 0.78rem; color: var(--text-dim); display: flex; gap: 16px; }
        .ad-card-actions { display: flex; gap: 6px; margin-top: 12px; }
        .ad-card-actions button {
            padding: 4px 10px; border-radius: 6px; border: 1px solid var(--border);
            background: transparent; color: var(--text-dim); font-family: inherit;
            font-size: 0.72rem; font-weight: 600; cursor: pointer;
        }
        .ad-card-actions button:hover { background: var(--bg-card-hover); color: var(--text); }
        .quick-link-bar {
            display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 24px;
        }
        .quick-link-btn {
            padding: 8px 16px; border-radius: 10px; border: 1px solid var(--border);
            background: var(--bg-card); color: var(--text-dim); font-family: inherit;
            font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .quick-link-btn:hover { border-color: var(--border-hover); color: var(--text); }

        /* Kanban Pipeline */
        .kanban-channel-bar {
            display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
        }
        .channel-btn {
            padding: 7px 16px; border-radius: 10px; border: 1px solid var(--border);
            background: transparent; color: var(--text-dim); font-family: inherit;
            font-size: 0.8rem; font-weight: 700; cursor: pointer; transition: all 0.2s;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .channel-btn:hover { background: var(--bg-card); color: var(--text); }
        .channel-btn.active { background: var(--green-soft); color: var(--green); border-color: rgba(34,197,94,0.2); }
        .channel-btn .ch-count {
            background: rgba(255,255,255,0.08); padding: 1px 7px; border-radius: 6px;
            font-size: 0.7rem; font-weight: 800;
        }
        .channel-btn.active .ch-count { background: rgba(34,197,94,0.2); }

        .kanban-board {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;
            min-height: 400px; align-items: start;
        }
        .kanban-col {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 14px; min-height: 300px;
            transition: border-color 0.2s;
        }
        .kanban-col.drag-over { border-color: var(--green); background: rgba(34,197,94,0.04); }
        .kanban-col-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
        }
        .kanban-col-title {
            font-size: 0.78rem; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px;
        }
        .kanban-col-dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block;
        }
        .kanban-col-count {
            font-size: 0.72rem; font-weight: 800; color: var(--text-muted);
            background: rgba(255,255,255,0.05); padding: 2px 8px; border-radius: 6px;
        }
        .kanban-card {
            background: var(--bg); border: 1px solid var(--border);
            border-radius: 12px; padding: 14px; margin-bottom: 8px;
            cursor: grab; transition: all 0.15s; position: relative;
        }
        .kanban-card:active { cursor: grabbing; }
        .kanban-card:hover { border-color: var(--border-hover); transform: translateY(-1px); }
        .kanban-card.dragging { opacity: 0.4; transform: scale(0.96); }
        .kanban-card-name { font-weight: 700; font-size: 0.9rem; margin-bottom: 3px; }
        .kanban-card-biz { font-size: 0.78rem; color: var(--text-dim); margin-bottom: 8px; }
        .kanban-card-meta {
            display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
        }
        .kanban-card-tag {
            padding: 2px 8px; border-radius: 6px; font-size: 0.68rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px;
        }
        .kanban-card-date { font-size: 0.68rem; color: var(--text-muted); margin-left: auto; }
        .kanban-card-rate { font-size: 0.78rem; font-weight: 700; color: var(--green); }
        .kanban-card-need {
            font-size: 0.76rem; color: var(--text-dim); margin-top: 8px;
            padding-top: 8px; border-top: 1px solid var(--border);
            line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2;
            -webkit-box-orient: vertical; overflow: hidden;
        }
        .kanban-empty {
            text-align: center; padding: 24px 12px; color: var(--text-muted);
            font-size: 0.8rem; font-weight: 600;
        }
        .kanban-stats-row {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px;
        }
        .kanban-stat {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 12px; padding: 14px; text-align: center;
        }
        .kanban-stat-val { font-size: 1.6rem; font-weight: 800; }
        .kanban-stat-label { font-size: 0.72rem; color: var(--text-dim); font-weight: 600; margin-top: 2px; }

        @media (max-width: 1100px) {
            .kanban-board { grid-template-columns: repeat(3, 1fr); }
            .kanban-stats-row { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            .kanban-board { grid-template-columns: 1fr 1fr; }
            .kanban-stats-row { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 500px) {
            .kanban-board { grid-template-columns: 1fr; }
            .kanban-stats-row { grid-template-columns: 1fr; }
        }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            z-index: 200; justify-content: center; align-items: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; padding: 28px; width: 90%; max-width: 500px;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 18px; }
        .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 18px; }

        /* Responsive */
        @media (max-width: 768px) {
            .clients-grid { grid-template-columns: 1fr; }
            .stats-bar, .ads-leads-stats { grid-template-columns: 1fr 1fr; }
            .add-form-row { grid-template-columns: 1fr; }
            .client-meta { grid-template-columns: 1fr; }
            .main { padding: 16px; }
            .ads-grid { grid-template-columns: 1fr; }
            .lead-detail-grid { grid-template-columns: 1fr; }
            .leads-table { font-size: 0.8rem; }
            .leads-table th, .leads-table td { padding: 8px 10px; }
        }
    </style>
</head>
<body>

    <!-- Deprecation Banner -->
    <div style="background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:14px 24px;text-align:center;font-size:0.95rem;font-weight:700;color:#fff;position:sticky;top:0;z-index:200;">
        This app has moved &rarr; <a href="https://suitegpt.app" style="color:#fde68a;text-decoration:underline;">Open SuiteGPT</a> &rarr; Factory &rarr; Clients
    </div>

    <div class="top-bar">
        <div class="top-bar-left">
            <div class="top-bar-logo">SUITE</div>
            <div class="top-bar-divider"></div>
            <div class="top-bar-title">Client Hub</div>
        </div>
    </div>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('overview')">How It Works</button>
        <button class="tab-btn" onclick="switchTab('clients')">Clients</button>
        <button class="tab-btn" onclick="switchTab('revenue')">Revenue</button>
        <button class="tab-btn" onclick="switchTab('ads')">Ads & Leads</button>
        <button class="tab-btn" onclick="switchTab('pipeline')">Pipeline</button>
        <button class="tab-btn" onclick="switchTab('outreach')">Get Clients</button>
    </div>

    <div class="main">

        <!-- ======= HOW IT WORKS TAB ======= -->
        <div class="tab-panel active" id="tab-overview">
            <div class="template-card" style="border-left: 3px solid var(--green); margin-bottom: 24px;">
                <div class="template-title" style="font-size: 1.2rem; margin-bottom: 12px;">Client Hub — The Business Model</div>
                <div class="template-body" style="font-size: 0.92rem; line-height: 1.8;">
<strong>What you're selling:</strong>
Custom AI-powered websites, dashboards, admin panels, marketing plans, whitepapers, smart contracts, Chrome extensions, mobile apps — anything Claude can build. You're a one-man agency powered by AI.

<strong>The offer:</strong>
Everything is FREE for the first 30 days. Free setup, free build, free everything. No risk for the client. They get a fully working product before they ever pay a dollar.

<strong>What they get (free month):</strong>
- Custom website designed for their brand
- Admin dashboard to manage their business
- Whatever they need: inventory system, booking, content management, analytics, etc.
- A chat interface embedded in their dashboard (like Proto Golf) where they can message you requests directly

<strong>The conversion (Day 30):</strong>
By the end of the free month, they're already using the system daily. Their business runs on it. The chat UI is their direct line to you. They're sending requests like "update the homepage banner" or "add a new product" — and you're fulfilling them with Claude in minutes.

Now you say: "$X/month to keep it running and maintained. I handle all updates, hosting, and any changes you need."

<strong>Why it works:</strong>
1. Zero risk for the client = easy yes
2. By day 30 they're dependent on the system
3. The chat UI creates a direct relationship — they feel like they have a personal tech team
4. Your cost to fulfill is near-zero (Claude does the work)
5. Each client is recurring revenue with minimal effort
6. You can run 20-50 clients simultaneously because AI does the heavy lifting

<strong>The flywheel:</strong>
More clients → more portfolio pieces → better demos → easier to close new clients → more clients

<strong>What you deliver per client:</strong>
1. Week 1: Build their site + dashboard + deploy
2. Week 2-3: Integrate chat UI, train them on using it
3. Week 4: They're self-sufficient, sending requests through chat
4. Day 30: Convert to paid monthly subscription
5. Ongoing: Fulfill their chat requests (5-10 min each with Claude)

<strong>Revenue targets:</strong>
- 5 clients @ $500/mo = $2,500/mo
- 10 clients @ $500/mo = $5,000/mo
- 20 clients @ $750/mo = $15,000/mo
- Each client costs you ~$20/mo in hosting + API calls

<strong>Key tools in the stack:</strong>
- Claude Code: builds everything
- Supabase: auth, database, storage for each client
- Vercel: hosting (free tier covers most clients)
- Chat UI: embedded in their dashboard, messages go to your approval queue
- Client request daemon: polls for approved requests, Claude executes them
                </div>
            </div>

            <div class="section-title">Client Lifecycle</div>
            <div class="clients-grid">
                <div class="template-card">
                    <div class="template-title" style="color: var(--orange);">1. Lead</div>
                    <div class="template-body" style="font-size: 0.84rem;">Found via outreach (Kijiji, FB Marketplace, DMs, walk-ins, landing page). They've expressed interest or you've identified them as a good fit. Pitch the free month. Show Proto Golf as the demo.</div>
                </div>
                <div class="template-card">
                    <div class="template-title" style="color: var(--blue);">2. Free Trial (30 days)</div>
                    <div class="template-body" style="font-size: 0.84rem;">Build their full system. Deploy it. Get them using it daily. Integrate the chat UI so they start messaging you requests. The more they use it, the harder it is to leave. Respond fast to their requests — this is where trust is built.</div>
                </div>
                <div class="template-card">
                    <div class="template-title" style="color: var(--green);">3. Active (Paying)</div>
                    <div class="template-body" style="font-size: 0.84rem;">Converted to monthly subscription. They send requests through chat, you approve and Claude executes. Maintenance is lightweight. Upsell opportunities: new features, additional pages, integrations, marketing materials, analytics dashboards.</div>
                </div>
                <div class="template-card">
                    <div class="template-title" style="color: var(--purple);">4. Referral Source</div>
                    <div class="template-body" style="font-size: 0.84rem;">Happy clients refer others. Offer a free month or discount for every referral that converts. Every client should be asked: "Know anyone else who could use something like this?" This becomes your best lead source at scale.</div>
                </div>
            </div>
        </div>

        <!-- ======= CLIENTS TAB ======= -->
        <div class="tab-panel" id="tab-clients">
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--green)" id="statActive">0</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--blue)" id="statTrial">0</div>
                    <div class="stat-label">Free Trial</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--orange)" id="statLeads">0</div>
                    <div class="stat-label">Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--accent)" id="statMRR">$0</div>
                    <div class="stat-label">Monthly Revenue</div>
                </div>
            </div>

            <div class="add-form">
                <div class="add-form-title">Add Client</div>
                <div class="add-form-row">
                    <div class="form-group" style="margin:0">
                        <label class="form-label">Business Name</label>
                        <input type="text" id="addName" placeholder="Proto Golf">
                    </div>
                    <div class="form-group" style="margin:0">
                        <label class="form-label">Industry</label>
                        <input type="text" id="addIndustry" placeholder="Golf / Manufacturing">
                    </div>
                    <div class="form-group" style="margin:0">
                        <label class="form-label">Monthly Rate ($)</label>
                        <input type="number" id="addRate" placeholder="1000" min="0">
                    </div>
                    <button class="btn btn-primary" onclick="addClient()" style="height:42px;">Add</button>
                </div>
            </div>

            <div class="section-title">Your Clients</div>
            <div class="clients-grid" id="clientsGrid"></div>
        </div>

        <!-- ======= REVENUE TAB ======= -->
        <div class="tab-panel" id="tab-revenue">
            <div class="section-title">Revenue Overview</div>
            <div class="month-cards" id="revenueCards"></div>

            <div class="section-title" style="margin-top:24px">Client Breakdown</div>
            <table class="revenue-table">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Status</th>
                        <th>Rate</th>
                        <th>Trial Ends</th>
                        <th>Total Earned</th>
                    </tr>
                </thead>
                <tbody id="revenueTableBody"></tbody>
            </table>
        </div>

        <!-- ======= ADS & LEADS TAB ======= -->
        <div class="tab-panel" id="tab-ads">
            <!-- Stats -->
            <div class="ads-leads-stats">
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--green)" id="adsStatTotal">0</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--blue)" id="adsStatNew">0</div>
                    <div class="stat-label">New This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--orange)" id="adsStatTrial">0</div>
                    <div class="stat-label">In Trial</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color:var(--accent)" id="adsStatConversion">0%</div>
                    <div class="stat-label">Conversion Rate</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-link-bar">
                <button class="quick-link-btn" onclick="copyLandingLink('kijiji')">Copy Link (Kijiji)</button>
                <button class="quick-link-btn" onclick="copyLandingLink('fb')">Copy Link (FB)</button>
                <button class="quick-link-btn" onclick="copyLandingLink('linkedin')">Copy Link (LinkedIn)</button>
                <button class="quick-link-btn" onclick="copyLandingLink('')">Copy Link (Direct)</button>
                <button class="btn btn-primary btn-sm" onclick="openAdModal()">+ Add Ad</button>
                <button class="btn btn-sm" style="background:var(--blue-soft);color:var(--blue);border:1px solid rgba(59,130,246,0.2)" onclick="openLeadModal()">+ Add Lead</button>
            </div>

            <!-- Active Ads -->
            <div class="section-title">Active Ads</div>
            <div class="ads-grid" id="adsGrid">
                <div style="color:var(--text-muted);font-size:0.88rem;padding:20px;">Loading ads...</div>
            </div>

            <!-- Lead Pipeline -->
            <div class="section-title" style="margin-top:24px;">Lead Pipeline</div>
            <div class="filter-bar">
                <button class="filter-btn active" onclick="filterLeads('all')">All</button>
                <button class="filter-btn" onclick="filterLeads('new')">New</button>
                <button class="filter-btn" onclick="filterLeads('contacted')">Contacted</button>
                <button class="filter-btn" onclick="filterLeads('trial')">Trial</button>
                <button class="filter-btn" onclick="filterLeads('active')">Active</button>
                <button class="filter-btn" onclick="filterLeads('churned')">Churned</button>
            </div>
            <div style="overflow-x:auto;">
                <table class="leads-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Business</th>
                            <th>Source</th>
                            <th>Status</th>
                            <th>Rate</th>
                            <th>Created</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody">
                        <tr><td colspan="7" style="color:var(--text-muted);text-align:center;padding:24px;">Loading leads...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Add Ad Modal -->
        <div class="modal-overlay" id="adModal">
            <div class="modal">
                <div class="modal-title">Add Ad Placement</div>
                <div class="form-group">
                    <label class="form-label">Platform</label>
                    <select id="adPlatform">
                        <option value="kijiji">Kijiji</option>
                        <option value="fb-marketplace">Facebook Marketplace</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="instagram">Instagram</option>
                        <option value="reddit">Reddit</option>
                        <option value="facebook-group">Facebook Group</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Title / Description</label>
                    <input type="text" id="adTitle" placeholder="Free custom website for your business">
                </div>
                <div class="form-group">
                    <label class="form-label">Link to Ad (optional)</label>
                    <input type="url" id="adUrl" placeholder="https://kijiji.ca/v-...">
                </div>
                <div class="form-group">
                    <label class="form-label">Budget ($)</label>
                    <input type="number" id="adBudget" placeholder="0" min="0">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-sm" style="background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border)" onclick="closeAdModal()">Cancel</button>
                    <button class="btn btn-sm btn-primary" onclick="saveAd()">Save Ad</button>
                </div>
            </div>
        </div>

        <!-- Add Lead Modal -->
        <div class="modal-overlay" id="leadModal">
            <div class="modal">
                <div class="modal-title">Add Lead Manually</div>
                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" id="leadName" placeholder="Jane Smith">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="text" id="leadEmail" placeholder="jane@business.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="text" id="leadPhone" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label class="form-label">Business Name</label>
                    <input type="text" id="leadBusiness" placeholder="Jane's Bakery">
                </div>
                <div class="form-group">
                    <label class="form-label">Source</label>
                    <select id="leadSource">
                        <option value="walk-in">Walk-in</option>
                        <option value="referral">Referral</option>
                        <option value="kijiji">Kijiji</option>
                        <option value="fb-marketplace">Facebook Marketplace</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="instagram">Instagram</option>
                        <option value="direct">Direct / Landing Page</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">What They Need</label>
                    <textarea id="leadNeed" placeholder="Website, dashboard, inventory system..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="leadNotes" placeholder="Any additional notes..."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-sm" style="background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border)" onclick="closeLeadModal()">Cancel</button>
                    <button class="btn btn-sm btn-primary" onclick="saveLead()">Save Lead</button>
                </div>
            </div>
        </div>

        <!-- ======= PIPELINE TAB ======= -->
        <div class="tab-panel" id="tab-pipeline">
            <!-- Channel selector -->
            <div class="kanban-channel-bar" id="channelBar"></div>

            <!-- Stats -->
            <div class="kanban-stats-row" id="kanbanStats"></div>

            <!-- Quick actions -->
            <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
                <button class="btn btn-primary btn-sm" onclick="openLeadModal()">+ Add Lead</button>
                <button class="btn btn-sm" style="background:var(--bg-card);color:var(--text-dim);border:1px solid var(--border)" onclick="switchTab('ads')">Manage Ads</button>
            </div>

            <!-- Kanban board -->
            <div class="kanban-board" id="kanbanBoard"></div>
        </div>

        <!-- ======= GET CLIENTS TAB ======= -->
        <div class="tab-panel" id="tab-outreach">
            <div class="section-title">Your Pitch</div>
            <div class="template-card">
                <div class="template-title">The Elevator Pitch</div>
                <div class="template-body" id="pitchElevator">I build custom AI-powered dashboards for small businesses. You get a website, an admin panel, and a chat interface where you can request changes and manage everything yourself.

Free setup. Free for 30 days. Then a flat monthly fee to keep it running and make updates whenever you need them.

You don't need to know anything technical. You just tell me what you need, I build it, and you're running.</div>
                <button class="copy-btn" onclick="copyText('pitchElevator')">Copy</button>
            </div>

            <div class="template-card">
                <div class="template-title">DM / Cold Message (Short)</div>
                <div class="template-body" id="pitchDM">Hey — I build custom websites + admin dashboards for small businesses, powered by AI so you can manage everything through a simple chat interface. Free setup, free first month. Would you be open to a quick look at what I built for a golf putter company? Happy to show you.</div>
                <button class="copy-btn" onclick="copyText('pitchDM')">Copy</button>
            </div>

            <div class="template-card">
                <div class="template-title">In-Person Script (Walking Into a Business)</div>
                <div class="template-body" id="pitchInPerson">Hey, I'm Stuart. I help small businesses get set up with a custom website and a dashboard where you can manage inventory, update content, and handle customer stuff — all through a chat interface, no tech skills needed.

I just did this for a custom putter company — built their whole site, inventory system, and now they just type what they need and it happens.

I do free setup and the first month is free. After that it's a flat monthly fee. Want me to show you what it looks like?</div>
                <button class="copy-btn" onclick="copyText('pitchInPerson')">Copy</button>
            </div>

            <div class="template-card">
                <div class="template-title">Follow-Up Message (After Demo/Meeting)</div>
                <div class="template-body" id="pitchFollowup">Hey [Name] — great talking with you. Just wanted to follow up on what we discussed.

I'd build you a custom site + admin dashboard where you can manage everything through a simple chat. Here's what's included:

- Custom website (designed for your brand)
- Admin dashboard (inventory, content, customers)
- AI chat interface (just type what you need changed)
- Ongoing maintenance and updates

Free setup, free first month. After that it's $[X]/month.

Want to get started? I can have something for you to look at within a few days.</div>
                <button class="copy-btn" onclick="copyText('pitchFollowup')">Copy</button>
            </div>

            <div class="section-title" style="margin-top:32px">Outreach Channels (Ranked by Priority)</div>

            <div class="template-card" style="border-left: 3px solid var(--green); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--green);">1. Kijiji / Facebook Marketplace (Local, High Intent)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Business owners already posting here are actively trying to grow. They're selling products/services but have no real web presence. Perfect targets.

<strong>How to automate:</strong>
- Search for businesses posting services: landscaping, cleaning, trades, tutoring, pet grooming, photography, catering, personal training
- Filter for posts with no website link or just a phone number
- Send a message offering a free custom website + dashboard
- Template: "Hey, saw your post for [service]. I build custom websites + business dashboards for free (first month). Would you be interested in a quick look at what I built for a golf company? No strings attached."

<strong>Automation idea:</strong> Script that scrapes Kijiji services categories daily, flags businesses without websites, queues outreach messages for your review.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--blue); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--blue);">2. Landing Page / Business Site (Inbound Funnel)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> A professional landing page that shows your work converts warm leads 24/7. All outreach should point back here.

<strong>What it needs:</strong>
- Hero: "We build your entire business online — for free"
- Demo video or interactive preview of Proto Golf dashboard
- 3-step process: "Tell us what you need → We build it → You manage it through chat"
- Pricing: "Free setup. Free for 30 days. Then $X/month"
- Testimonial section (Proto Golf as first case study)
- Simple intake form: business name, what they need, contact info
- Goes to your Supabase leads table → shows up in Client Hub

<strong>Domain ideas:</strong> builtbysuite.com, suiteagency.com, or a page on getsuite.app</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--purple); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--purple);">3. LinkedIn Outreach (B2B, Highest Value Clients)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Business owners and founders are on LinkedIn. Higher ticket clients. More professional context.

<strong>Strategy:</strong>
- Optimize your LinkedIn profile: "I build custom AI-powered websites and dashboards for small businesses. Free setup."
- Post content: screen recordings of building a site with Claude, before/after transformations, the chat UI in action
- Connect with: small business owners, startup founders, freelancers, agency owners, trades businesses
- After connecting, send: "Hey [Name] — saw you run [business]. I build custom websites + admin dashboards for businesses like yours. Free setup, free first month. Want me to show you what I built for a golf putter company?"

<strong>Automation idea:</strong> Use Claude to draft personalized connection messages based on their profile/business. Batch 20-30 per day. Track responses in Client Hub.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--orange); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--orange);">4. Direct Email Outreach (Scalable, Automatable)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Most scalable channel. Can reach hundreds of businesses per day with the right setup.

<strong>How it works:</strong>
- Use Claude (MoltBot) to search for businesses in target categories
- Find their email from website, Google Maps, Yelp, or social profiles
- Send personalized cold emails at scale

<strong>Target businesses:</strong>
- Google Maps: search "[city] + [industry]" — filter for businesses with bad/no websites
- Yelp: businesses with reviews but outdated web presence
- Industry directories: trades, salons, fitness studios, restaurants

<strong>Email template:</strong>
"Hi [Name], I came across [Business] and noticed you might benefit from a custom website + admin dashboard. I recently built one for a custom golf putter company — they manage their entire inventory and customer requests through a simple chat interface. I'm offering free setup and a free first month to a few businesses this month. Would you be open to a quick look?"

<strong>Automation idea:</strong> Build a MoltBot pipeline: scrape → find emails → draft personalized emails → queue for your approval → send via Resend/SendGrid. Track opens and replies in Client Hub.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--red); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--red);">5. Instagram / Content Strategy (Brand Building)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Visual proof of what you build. Creates credibility. Warm leads come to you.

<strong>Content ideas (post 3-5x/week):</strong>
- Reels: time-lapse of building a site from scratch with Claude (30-60 sec)
- Before/after: "This business had no website. Now they manage everything through a chat."
- Screen recordings: showing the chat UI, sending a request, watching it get fulfilled
- Client spotlights: showcase what you built for each client
- Educational: "5 things every small business website needs" → soft pitch in comments

<strong>Instagram bio:</strong> "I build custom AI websites for businesses — free | DM me"

<strong>Automation idea:</strong> Use Claude + Cadence AI to batch-create content. Schedule a week of posts at once. Repurpose same content across IG, LinkedIn, X/Twitter.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--accent); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--accent);">6. Facebook Groups + Reddit (Community Outreach)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Business owners ask for help in these groups daily. Be the one who answers.

<strong>Where to post:</strong>
- Facebook: local business groups, "[City] Small Business Owners", "Entrepreneurs & Startups"
- Reddit: r/smallbusiness, r/entrepreneur, r/webdev, r/freelance
- Don't hard sell. Provide value first, then mention your offer

<strong>Approach:</strong>
- Answer questions about websites, tech, business tools
- When relevant: "I actually build this for businesses — custom site + dashboard, free setup. Happy to show you what it looks like."
- Post case studies: "How I built a full business platform for a golf company in a week"

<strong>Rule:</strong> 80% value, 20% pitch. Build reputation first.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--green); margin-bottom: 16px;">
                <div class="template-title" style="color: var(--green);">7. Walk-Ins (Highest Conversion, Lowest Scale)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Face-to-face is unbeatable for trust. Show them the demo on your phone. They can see it's real, right now.

<strong>Best targets:</strong>
- Shops with no website or a terrible one
- Businesses still using paper, spreadsheets, or just a phone number
- Trades: plumbers, electricians, landscapers, contractors
- Service: barbershops, salons, gyms, studios, restaurants, cafes

<strong>Script:</strong> "Hey, I'm Stuart. I build custom websites and business dashboards — everything managed through a chat. I just did this for a golf putter company. Free setup, free first month. Want to see it?"

<strong>Always have:</strong> Proto Golf pulled up on your phone as a live demo.</div>
            </div>

            <div class="template-card" style="border-left: 3px solid var(--blue);">
                <div class="template-title" style="color: var(--blue);">8. Referrals (Best ROI Once Rolling)</div>
                <div class="template-body" style="font-size:0.84rem"><strong>Why:</strong> Warm intros from happy clients close at 50%+. Zero acquisition cost.

<strong>System:</strong>
- After every successful delivery, ask: "Know anyone else who could use something like this?"
- Offer incentive: free month or discount for every referral that converts
- Make it easy: "Just tell them to DM me or fill out the form on [landing page]"
- Track referrals in Client Hub — who referred who, conversion status

<strong>When to start:</strong> Once you have 2-3 happy paying clients. This becomes your #1 channel at scale.</div>
            </div>
        </div>

    </div>

    <script>
        // ===== SUPABASE CONFIG =====
        const SB_URL = 'https://rdsmdywbdiskxknluiym.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkc21keXdiZGlza3hrbmx1aXltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODk3MTgsImV4cCI6MjA4MzM2NTcxOH0.DcLpWs8Lf1s4Flf54J5LubokSYrd7h-XvI_X0jj6bLM';

        function sbHeaders(extra) {
            return Object.assign({
                'apikey': SB_KEY,
                'Authorization': 'Bearer ' + SB_KEY,
                'Content-Type': 'application/json'
            }, extra || {});
        }

        async function sbGet(endpoint) {
            const resp = await fetch(SB_URL + '/rest/v1/' + endpoint, { headers: sbHeaders() });
            if (!resp.ok) return [];
            return resp.json();
        }

        async function sbPost(table, data) {
            const resp = await fetch(SB_URL + '/rest/v1/' + table, {
                method: 'POST', headers: sbHeaders({ 'Prefer': 'return=representation' }),
                body: JSON.stringify(data)
            });
            if (!resp.ok) { const t = await resp.text(); throw new Error(t); }
            return resp.json();
        }

        async function sbPatch(table, id, data) {
            const resp = await fetch(SB_URL + '/rest/v1/' + table + '?id=eq.' + id, {
                method: 'PATCH', headers: sbHeaders({ 'Prefer': 'return=minimal' }),
                body: JSON.stringify(data)
            });
            if (!resp.ok) { const t = await resp.text(); throw new Error(t); }
        }

        // ===== TAB SWITCHING =====
        function switchTab(tab) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab)?.classList.add('active');
            const tabs = ['overview', 'clients', 'revenue', 'ads', 'pipeline', 'outreach'];
            document.querySelectorAll('.tab-btn')[tabs.indexOf(tab)]?.classList.add('active');
            if (tab === 'revenue') renderRevenue();
            if (tab === 'ads') loadAdsAndLeads();
            if (tab === 'pipeline') loadPipeline();
        }

        // ===== DATA =====
        function getClients() { return JSON.parse(localStorage.getItem('ch_clients') || '[]'); }
        function saveClients(c) { localStorage.setItem('ch_clients', JSON.stringify(c)); }

        // ===== ADD CLIENT =====
        function addClient() {
            const name = document.getElementById('addName').value.trim();
            const industry = document.getElementById('addIndustry').value.trim();
            const rate = parseFloat(document.getElementById('addRate').value) || 0;
            if (!name) { alert('Business name required.'); return; }

            const clients = getClients();
            const colors = ['var(--green)', 'var(--blue)', 'var(--purple)', 'var(--orange)', 'var(--red)', 'var(--accent)'];
            const bgColors = ['var(--green-soft)', 'var(--blue-soft)', 'var(--purple-soft)', 'var(--orange-soft)', 'var(--red-soft)', 'var(--accent-soft)'];
            const ci = clients.length % colors.length;

            clients.push({
                id: Date.now().toString(),
                name, industry, rate,
                status: 'trial', // lead, trial, active, churned
                color: colors[ci],
                bgColor: bgColors[ci],
                startDate: new Date().toISOString().split('T')[0],
                trialEnd: new Date(Date.now() + 30 * 86400000).toISOString().split('T')[0],
                requests: [],
                totalEarned: 0
            });
            saveClients(clients);
            document.getElementById('addName').value = '';
            document.getElementById('addIndustry').value = '';
            document.getElementById('addRate').value = '';
            renderClients();
        }

        // ===== RENDER CLIENTS =====
        function renderClients() {
            const clients = getClients();
            const grid = document.getElementById('clientsGrid');

            // Stats
            const active = clients.filter(c => c.status === 'active');
            const trial = clients.filter(c => c.status === 'trial');
            const leads = clients.filter(c => c.status === 'lead');
            const mrr = active.reduce((sum, c) => sum + (c.rate || 0), 0);

            document.getElementById('statActive').textContent = active.length;
            document.getElementById('statTrial').textContent = trial.length;
            document.getElementById('statLeads').textContent = leads.length;
            document.getElementById('statMRR').textContent = '$' + mrr.toLocaleString();

            if (!grid) return;
            grid.innerHTML = clients.map(c => {
                const initials = c.name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
                const statusClass = 'status-' + c.status;
                const statusLabel = { lead: 'Lead', trial: 'Free Trial', active: 'Active', churned: 'Churned' }[c.status] || c.status;
                const pendingRequests = (c.requests || []).filter(r => !r.done).length;

                return `
                <div class="client-card" id="client-${c.id}">
                    <div class="client-card-header" onclick="toggleClient('${c.id}')">
                        <div class="client-card-left">
                            <div class="client-avatar" style="background:${c.bgColor};color:${c.color}">${initials}</div>
                            <div>
                                <div class="client-name">${c.name}${pendingRequests ? ` <span style="color:var(--orange);font-size:0.78rem">(${pendingRequests} pending)</span>` : ''}</div>
                                <div class="client-industry">${c.industry || 'No industry set'}</div>
                            </div>
                        </div>
                        <span class="client-status-badge ${statusClass}">${statusLabel}</span>
                    </div>
                    <div class="client-card-body">
                        <div class="client-meta">
                            <div class="client-meta-item">
                                <div class="client-meta-label">Monthly Rate</div>
                                <div class="client-meta-value">$${(c.rate || 0).toLocaleString()}/mo</div>
                            </div>
                            <div class="client-meta-item">
                                <div class="client-meta-label">Started</div>
                                <div class="client-meta-value">${c.startDate || '—'}</div>
                            </div>
                            <div class="client-meta-item">
                                <div class="client-meta-label">Trial Ends</div>
                                <div class="client-meta-value">${c.status === 'trial' ? (c.trialEnd || '—') : '—'}</div>
                            </div>
                            <div class="client-meta-item">
                                <div class="client-meta-label">Total Earned</div>
                                <div class="client-meta-value" style="color:var(--green)">$${(c.totalEarned || 0).toLocaleString()}</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap">
                            ${c.status === 'lead' ? `<button class="btn btn-sm btn-primary" onclick="changeStatus('${c.id}','trial')">Start Free Trial</button>` : ''}
                            ${c.status === 'trial' ? `<button class="btn btn-sm btn-primary" onclick="changeStatus('${c.id}','active')">Convert to Paid</button>` : ''}
                            ${c.status === 'active' ? `<button class="btn btn-sm" style="background:var(--green-soft);color:var(--green);border:1px solid rgba(34,197,94,0.2)" onclick="changeStatus('${c.id}','active')">Active</button>` : ''}
                            <button class="btn btn-sm" style="background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border)" onclick="changeStatus('${c.id}','lead')">Lead</button>
                            <button class="btn btn-sm" style="background:var(--red-soft);color:var(--red);border:1px solid rgba(239,68,68,0.2)" onclick="if(confirm('Mark as churned?'))changeStatus('${c.id}','churned')">Churned</button>
                            <button class="btn btn-sm" style="background:var(--red-soft);color:var(--red);border:1px solid rgba(239,68,68,0.2);margin-left:auto" onclick="if(confirm('Delete ${c.name}?'))deleteClient('${c.id}')">Delete</button>
                        </div>
                        <div class="request-log">
                            <div class="request-log-title">Requests</div>
                            ${(c.requests || []).map((r, i) => `
                                <div class="request-item">
                                    <div class="request-dot ${r.done ? 'done' : 'pending'}"></div>
                                    <div style="flex:1">
                                        <div class="request-text">${r.text}</div>
                                        <div class="request-date">${r.date}</div>
                                    </div>
                                    <div class="request-actions">
                                        ${!r.done ? `<button onclick="completeRequest('${c.id}',${i})">Done</button>` : '<span style="font-size:0.7rem;color:var(--green)">Completed</span>'}
                                    </div>
                                </div>
                            `).join('')}
                            <div class="add-request-row">
                                <input type="text" placeholder="Add a request..." id="reqInput-${c.id}" onkeydown="if(event.key==='Enter')addRequest('${c.id}')">
                                <button class="btn btn-sm btn-primary" onclick="addRequest('${c.id}')">Add</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleClient(id) {
            document.getElementById('client-' + id)?.classList.toggle('expanded');
        }

        function changeStatus(id, status) {
            const clients = getClients();
            const c = clients.find(x => x.id === id);
            if (c) {
                c.status = status;
                if (status === 'trial') c.trialEnd = new Date(Date.now() + 30 * 86400000).toISOString().split('T')[0];
            }
            saveClients(clients);
            renderClients();
        }

        function deleteClient(id) {
            saveClients(getClients().filter(c => c.id !== id));
            renderClients();
        }

        function addRequest(clientId) {
            const input = document.getElementById('reqInput-' + clientId);
            const text = input?.value?.trim();
            if (!text) return;

            const clients = getClients();
            const c = clients.find(x => x.id === clientId);
            if (c) {
                if (!c.requests) c.requests = [];
                c.requests.unshift({ text, date: new Date().toLocaleDateString(), done: false });
            }
            saveClients(clients);
            input.value = '';
            renderClients();
            // Re-expand the card
            setTimeout(() => document.getElementById('client-' + clientId)?.classList.add('expanded'), 10);
        }

        function completeRequest(clientId, idx) {
            const clients = getClients();
            const c = clients.find(x => x.id === clientId);
            if (c && c.requests && c.requests[idx]) c.requests[idx].done = true;
            saveClients(clients);
            renderClients();
            setTimeout(() => document.getElementById('client-' + clientId)?.classList.add('expanded'), 10);
        }

        // ===== REVENUE =====
        function renderRevenue() {
            const clients = getClients();
            const active = clients.filter(c => c.status === 'active');
            const trial = clients.filter(c => c.status === 'trial');
            const mrr = active.reduce((sum, c) => sum + (c.rate || 0), 0);
            const arr = mrr * 12;
            const pipeline = trial.reduce((sum, c) => sum + (c.rate || 0), 0);

            document.getElementById('revenueCards').innerHTML = `
                <div class="month-card">
                    <div class="month-card-label">Monthly Recurring (MRR)</div>
                    <div class="month-card-value" style="color:var(--green)">$${mrr.toLocaleString()}</div>
                </div>
                <div class="month-card">
                    <div class="month-card-label">Annualized (ARR)</div>
                    <div class="month-card-value" style="color:var(--accent)">$${arr.toLocaleString()}</div>
                </div>
                <div class="month-card">
                    <div class="month-card-label">Pipeline (Trials)</div>
                    <div class="month-card-value" style="color:var(--blue)">$${pipeline.toLocaleString()}/mo</div>
                </div>
                <div class="month-card">
                    <div class="month-card-label">Total Clients</div>
                    <div class="month-card-value">${clients.filter(c => c.status !== 'churned').length}</div>
                </div>
            `;

            document.getElementById('revenueTableBody').innerHTML = clients.map(c => {
                const statusLabel = { lead: 'Lead', trial: 'Free Trial', active: 'Active', churned: 'Churned' }[c.status];
                const statusColor = { lead: 'var(--orange)', trial: 'var(--blue)', active: 'var(--green)', churned: 'var(--red)' }[c.status];
                return `<tr>
                    <td style="font-weight:700">${c.name}</td>
                    <td><span style="color:${statusColor};font-weight:600">${statusLabel}</span></td>
                    <td>$${(c.rate || 0).toLocaleString()}/mo</td>
                    <td>${c.status === 'trial' ? c.trialEnd : '—'}</td>
                    <td style="color:var(--green);font-weight:700">$${(c.totalEarned || 0).toLocaleString()}</td>
                </tr>`;
            }).join('');
        }

        // ===== COPY =====
        function copyText(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text);
            const btn = document.getElementById(id).parentElement.querySelector('.copy-btn');
            if (btn) { btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = 'Copy', 1500); }
        }

        // ===== SEED PROTO GOLF =====
        (function seedProtoGolf() {
            const clients = getClients();
            if (clients.length === 0) {
                clients.push({
                    id: 'protogolf',
                    name: 'Proto Golf',
                    industry: 'Golf / Custom Putters',
                    rate: 1000,
                    status: 'trial',
                    color: 'var(--green)',
                    bgColor: 'var(--green-soft)',
                    startDate: new Date().toISOString().split('T')[0],
                    trialEnd: new Date(Date.now() + 30 * 86400000).toISOString().split('T')[0],
                    requests: [
                        { text: 'Product page with variant selector', date: '1/28/2026', done: true },
                        { text: 'Inventory admin dashboard', date: '1/29/2026', done: true },
                        { text: 'Claude chat interface for self-service updates', date: '1/30/2026', done: false }
                    ],
                    totalEarned: 0
                });
                saveClients(clients);
            }
        })();

        // ===== ADS & LEADS (Supabase) =====
        let cachedLeads = [];
        let cachedAds = [];
        let currentLeadFilter = 'all';

        async function loadAdsAndLeads() {
            try {
                const [leads, ads] = await Promise.all([
                    sbGet('client_leads?order=created_at.desc'),
                    sbGet('client_ads?order=created_at.desc')
                ]);
                cachedLeads = leads;
                cachedAds = ads;
                renderAdsStats();
                renderAds();
                renderLeads();
            } catch (e) {
                console.error('Failed to load ads/leads:', e);
            }
        }

        function renderAdsStats() {
            const total = cachedLeads.length;
            const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString();
            const newThisWeek = cachedLeads.filter(l => l.created_at >= weekAgo).length;
            const inTrial = cachedLeads.filter(l => l.status === 'trial').length;
            const active = cachedLeads.filter(l => l.status === 'active').length;
            const conversion = total > 0 ? Math.round((active / total) * 100) : 0;

            document.getElementById('adsStatTotal').textContent = total;
            document.getElementById('adsStatNew').textContent = newThisWeek;
            document.getElementById('adsStatTrial').textContent = inTrial;
            document.getElementById('adsStatConversion').textContent = conversion + '%';
        }

        function renderAds() {
            const grid = document.getElementById('adsGrid');
            if (cachedAds.length === 0) {
                grid.innerHTML = '<div style="color:var(--text-muted);font-size:0.88rem;padding:12px;">No ads yet. Click "+ Add Ad" to track your first ad placement.</div>';
                return;
            }
            const platformColors = {
                'kijiji': { bg: 'var(--green-soft)', color: 'var(--green)' },
                'fb-marketplace': { bg: 'var(--blue-soft)', color: 'var(--blue)' },
                'linkedin': { bg: 'var(--purple-soft)', color: 'var(--purple)' },
                'instagram': { bg: 'var(--red-soft)', color: 'var(--red)' },
                'reddit': { bg: 'var(--orange-soft)', color: 'var(--orange)' },
                'facebook-group': { bg: 'var(--blue-soft)', color: 'var(--blue)' }
            };
            grid.innerHTML = cachedAds.map(ad => {
                const pc = platformColors[ad.platform] || { bg: 'var(--accent-soft)', color: 'var(--accent)' };
                const statusColors = { active: 'var(--green)', paused: 'var(--orange)', draft: 'var(--text-muted)', expired: 'var(--red)' };
                const leadsForAd = cachedLeads.filter(l => l.ad_id === ad.id).length;
                const posted = ad.posted_at ? new Date(ad.posted_at).toLocaleDateString() : '—';
                return `<div class="ad-card">
                    <div class="ad-card-top">
                        <span class="ad-platform-badge" style="background:${pc.bg};color:${pc.color}">${ad.platform}</span>
                        <span style="font-size:0.75rem;font-weight:700;color:${statusColors[ad.status] || 'var(--text-dim)'}">${ad.status}</span>
                    </div>
                    <div class="ad-card-title">${ad.title}</div>
                    <div class="ad-card-meta">
                        <span>Leads: <strong>${leadsForAd}</strong></span>
                        <span>Budget: $${ad.budget || 0}</span>
                        <span>Posted: ${posted}</span>
                    </div>
                    ${ad.url ? `<div style="margin-top:8px"><a href="${ad.url}" target="_blank" style="color:var(--blue);font-size:0.78rem;font-weight:600;">View Ad</a></div>` : ''}
                    <div class="ad-card-actions">
                        <button onclick="toggleAdStatus('${ad.id}','${ad.status === 'active' ? 'paused' : 'active'}')">${ad.status === 'active' ? 'Pause' : 'Activate'}</button>
                        <button onclick="toggleAdStatus('${ad.id}','expired')">Expire</button>
                    </div>
                </div>`;
            }).join('');
        }

        function renderLeads() {
            const tbody = document.getElementById('leadsTableBody');
            let filtered = cachedLeads;
            if (currentLeadFilter !== 'all') {
                filtered = cachedLeads.filter(l => l.status === currentLeadFilter);
            }
            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" style="color:var(--text-muted);text-align:center;padding:24px;">No leads${currentLeadFilter !== 'all' ? ' with status "' + currentLeadFilter + '"' : ''} yet.</td></tr>`;
                return;
            }
            const statusColors = { 'new': 'var(--blue)', contacted: 'var(--orange)', trial: 'var(--purple)', active: 'var(--green)', churned: 'var(--red)' };
            tbody.innerHTML = filtered.map(lead => {
                const created = new Date(lead.created_at).toLocaleDateString();
                const src = lead.source || 'direct';
                return `<tr onclick="toggleLeadExpand('${lead.id}')" style="cursor:pointer;">
                    <td style="font-weight:700">${lead.name}</td>
                    <td>${lead.business_name || '—'}</td>
                    <td><span style="font-size:0.78rem;font-weight:600;color:var(--text-dim)">${src}</span></td>
                    <td>
                        <select class="lead-status-select" style="color:${statusColors[lead.status] || 'var(--text)'}" onchange="updateLeadStatus('${lead.id}', this.value); event.stopPropagation();">
                            <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                            <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                            <option value="trial" ${lead.status === 'trial' ? 'selected' : ''}>Trial</option>
                            <option value="active" ${lead.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="churned" ${lead.status === 'churned' ? 'selected' : ''}>Churned</option>
                        </select>
                    </td>
                    <td>${lead.monthly_rate ? '$' + lead.monthly_rate : '—'}</td>
                    <td style="font-size:0.78rem;color:var(--text-dim)">${created}</td>
                    <td style="font-size:0.78rem;color:var(--text-muted);">&#9660;</td>
                </tr>
                <tr class="lead-expand-row" id="lead-expand-${lead.id}">
                    <td colspan="7" class="lead-expand-cell">
                        <div class="lead-detail-grid">
                            <div>
                                <div class="lead-detail-label">Email</div>
                                <div class="lead-detail-value">${lead.email || '—'}</div>
                            </div>
                            <div>
                                <div class="lead-detail-label">Phone</div>
                                <div class="lead-detail-value">${lead.phone || '—'}</div>
                            </div>
                            <div>
                                <div class="lead-detail-label">Business Type</div>
                                <div class="lead-detail-value">${lead.business_type || '—'}</div>
                            </div>
                        </div>
                        ${lead.what_they_need ? `<div style="margin-bottom:10px;"><div class="lead-detail-label">What They Need</div><div style="font-size:0.85rem;margin-top:4px;color:var(--text-dim);line-height:1.5;">${lead.what_they_need}</div></div>` : ''}
                        <div class="lead-detail-label">Notes</div>
                        <textarea class="lead-notes-area" id="notes-${lead.id}" onclick="event.stopPropagation();" onblur="saveLeadNotes('${lead.id}')">${lead.notes || ''}</textarea>
                        <div style="display:flex;gap:6px;margin-top:8px;">
                            <input type="number" placeholder="Monthly rate" value="${lead.monthly_rate || ''}" id="rate-${lead.id}" style="width:120px;padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-family:inherit;font-size:0.82rem;" onclick="event.stopPropagation();">
                            <button class="btn btn-sm" style="background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border)" onclick="event.stopPropagation(); saveLeadRate('${lead.id}')">Save Rate</button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        function filterLeads(status) {
            currentLeadFilter = status;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderLeads();
        }

        function toggleLeadExpand(id) {
            const row = document.getElementById('lead-expand-' + id);
            if (row) row.classList.toggle('show');
        }

        async function updateLeadStatus(id, status) {
            try {
                await sbPatch('client_leads', id, { status, updated_at: new Date().toISOString() });
                const lead = cachedLeads.find(l => l.id === id);
                if (lead) lead.status = status;
                renderAdsStats();
                renderLeads();
            } catch (e) { alert('Failed to update: ' + e.message); }
        }

        async function saveLeadNotes(id) {
            const notes = document.getElementById('notes-' + id)?.value || '';
            try {
                await sbPatch('client_leads', id, { notes, updated_at: new Date().toISOString() });
                const lead = cachedLeads.find(l => l.id === id);
                if (lead) lead.notes = notes;
            } catch (e) { console.error('Failed to save notes:', e); }
        }

        async function saveLeadRate(id) {
            const rate = parseFloat(document.getElementById('rate-' + id)?.value) || 0;
            try {
                await sbPatch('client_leads', id, { monthly_rate: rate, updated_at: new Date().toISOString() });
                const lead = cachedLeads.find(l => l.id === id);
                if (lead) lead.monthly_rate = rate;
                renderLeads();
            } catch (e) { alert('Failed to save rate: ' + e.message); }
        }

        async function toggleAdStatus(id, newStatus) {
            try {
                await sbPatch('client_ads', id, { status: newStatus });
                const ad = cachedAds.find(a => a.id === id);
                if (ad) ad.status = newStatus;
                renderAds();
            } catch (e) { alert('Failed to update ad: ' + e.message); }
        }

        // Landing page link copy
        function copyLandingLink(ref) {
            const base = 'https://clients.suitegpt.app';
            const url = ref ? base + '?ref=' + ref : base;
            navigator.clipboard.writeText(url);
            event.target.textContent = 'Copied!';
            setTimeout(() => {
                const labels = { kijiji: 'Copy Link (Kijiji)', fb: 'Copy Link (FB)', linkedin: 'Copy Link (LinkedIn)', '': 'Copy Link (Direct)' };
                event.target.textContent = labels[ref] || 'Copied!';
            }, 1500);
        }

        // Ad Modal
        function openAdModal() { document.getElementById('adModal').classList.add('show'); }
        function closeAdModal() {
            document.getElementById('adModal').classList.remove('show');
            document.getElementById('adPlatform').value = 'kijiji';
            document.getElementById('adTitle').value = '';
            document.getElementById('adUrl').value = '';
            document.getElementById('adBudget').value = '';
        }
        async function saveAd() {
            const title = document.getElementById('adTitle').value.trim();
            if (!title) { alert('Title required.'); return; }
            try {
                const data = {
                    platform: document.getElementById('adPlatform').value,
                    title,
                    url: document.getElementById('adUrl').value.trim() || null,
                    budget: parseFloat(document.getElementById('adBudget').value) || 0,
                    status: 'active',
                    posted_at: new Date().toISOString()
                };
                const result = await sbPost('client_ads', data);
                cachedAds.unshift(result[0]);
                renderAds();
                closeAdModal();
            } catch (e) { alert('Failed to save ad: ' + e.message); }
        }

        // Lead Modal
        function openLeadModal() { document.getElementById('leadModal').classList.add('show'); }
        function closeLeadModal() {
            document.getElementById('leadModal').classList.remove('show');
            ['leadName','leadEmail','leadPhone','leadBusiness','leadNeed','leadNotes'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('leadSource').value = 'walk-in';
        }
        async function saveLead() {
            const name = document.getElementById('leadName').value.trim();
            if (!name) { alert('Name required.'); return; }
            try {
                const data = {
                    name,
                    email: document.getElementById('leadEmail').value.trim() || null,
                    phone: document.getElementById('leadPhone').value.trim() || null,
                    business_name: document.getElementById('leadBusiness').value.trim() || null,
                    source: document.getElementById('leadSource').value,
                    what_they_need: document.getElementById('leadNeed').value.trim() || null,
                    notes: document.getElementById('leadNotes').value.trim() || null,
                    status: 'new'
                };
                const result = await sbPost('client_leads', data);
                cachedLeads.unshift(result[0]);
                renderAdsStats();
                renderLeads();
                closeLeadModal();
            } catch (e) { alert('Failed to save lead: ' + e.message); }
        }

        // ===== PIPELINE KANBAN =====
        const CHANNELS = [
            { id: 'all', label: 'All Channels', sources: null },
            { id: 'kijiji', label: 'Kijiji', sources: ['kijiji'], color: 'var(--green)' },
            { id: 'fb', label: 'FB Marketplace', sources: ['fb-marketplace'], color: 'var(--blue)' },
            { id: 'linkedin', label: 'LinkedIn', sources: ['linkedin'], color: 'var(--purple)' },
            { id: 'email', label: 'Email', sources: ['email', 'direct'], color: 'var(--orange)' },
            { id: 'instagram', label: 'Instagram', sources: ['instagram'], color: 'var(--red)' },
            { id: 'social', label: 'Groups / Reddit', sources: ['reddit', 'facebook-group'], color: 'var(--accent)' },
            { id: 'walkin', label: 'Walk-Ins', sources: ['walk-in'], color: 'var(--green)' },
            { id: 'referral', label: 'Referrals', sources: ['referral'], color: 'var(--blue)' },
        ];
        const PIPELINE_STATUSES = [
            { id: 'new', label: 'New', color: 'var(--blue)', dot: '#3b82f6' },
            { id: 'contacted', label: 'Contacted', color: 'var(--orange)', dot: '#f59e0b' },
            { id: 'trial', label: 'Trial', color: 'var(--purple)', dot: '#a855f7' },
            { id: 'active', label: 'Active', color: 'var(--green)', dot: '#22c55e' },
            { id: 'churned', label: 'Churned', color: 'var(--red)', dot: '#ef4444' },
        ];
        let currentChannel = 'all';
        let pipelineLeads = [];

        async function loadPipeline() {
            try {
                pipelineLeads = await sbGet('client_leads?order=created_at.desc');
            } catch (e) {
                pipelineLeads = cachedLeads.length ? cachedLeads : [];
            }
            renderChannelBar();
            renderKanbanStats();
            renderKanban();
        }

        function getFilteredLeads() {
            const ch = CHANNELS.find(c => c.id === currentChannel);
            if (!ch || !ch.sources) return pipelineLeads;
            return pipelineLeads.filter(l => ch.sources.includes(l.source));
        }

        function renderChannelBar() {
            const bar = document.getElementById('channelBar');
            bar.innerHTML = CHANNELS.map(ch => {
                const count = ch.sources
                    ? pipelineLeads.filter(l => ch.sources.includes(l.source)).length
                    : pipelineLeads.length;
                return `<button class="channel-btn ${currentChannel === ch.id ? 'active' : ''}"
                    onclick="selectChannel('${ch.id}')">
                    ${ch.label} <span class="ch-count">${count}</span>
                </button>`;
            }).join('');
        }

        function selectChannel(id) {
            currentChannel = id;
            renderChannelBar();
            renderKanbanStats();
            renderKanban();
        }

        function renderKanbanStats() {
            const leads = getFilteredLeads();
            const stats = document.getElementById('kanbanStats');
            stats.innerHTML = PIPELINE_STATUSES.map(s => {
                const count = leads.filter(l => l.status === s.id).length;
                return `<div class="kanban-stat">
                    <div class="kanban-stat-val" style="color:${s.color}">${count}</div>
                    <div class="kanban-stat-label">${s.label}</div>
                </div>`;
            }).join('');
        }

        function renderKanban() {
            const leads = getFilteredLeads();
            const board = document.getElementById('kanbanBoard');
            const sourceColors = {
                'kijiji': { bg: 'var(--green-soft)', color: 'var(--green)' },
                'fb-marketplace': { bg: 'var(--blue-soft)', color: 'var(--blue)' },
                'linkedin': { bg: 'var(--purple-soft)', color: 'var(--purple)' },
                'instagram': { bg: 'var(--red-soft)', color: 'var(--red)' },
                'walk-in': { bg: 'var(--green-soft)', color: 'var(--green)' },
                'referral': { bg: 'var(--blue-soft)', color: 'var(--blue)' },
                'direct': { bg: 'var(--orange-soft)', color: 'var(--orange)' },
                'email': { bg: 'var(--orange-soft)', color: 'var(--orange)' },
                'reddit': { bg: 'var(--accent-soft)', color: 'var(--accent)' },
                'facebook-group': { bg: 'var(--accent-soft)', color: 'var(--accent)' },
            };

            board.innerHTML = PIPELINE_STATUSES.map(status => {
                const colLeads = leads.filter(l => l.status === status.id);
                return `<div class="kanban-col" data-status="${status.id}"
                    ondragover="kanbanDragOver(event)" ondragleave="kanbanDragLeave(event)" ondrop="kanbanDrop(event)">
                    <div class="kanban-col-header">
                        <div class="kanban-col-title">
                            <span class="kanban-col-dot" style="background:${status.dot}"></span>
                            ${status.label}
                        </div>
                        <span class="kanban-col-count">${colLeads.length}</span>
                    </div>
                    <div class="kanban-col-cards">
                        ${colLeads.length === 0
                            ? `<div class="kanban-empty">No leads</div>`
                            : colLeads.map(lead => {
                                const src = lead.source || 'direct';
                                const sc = sourceColors[src] || { bg: 'var(--accent-soft)', color: 'var(--accent)' };
                                const created = new Date(lead.created_at).toLocaleDateString();
                                const needSnippet = lead.what_they_need
                                    ? `<div class="kanban-card-need">${lead.what_they_need}</div>` : '';
                                return `<div class="kanban-card" draggable="true" data-lead-id="${lead.id}"
                                    ondragstart="kanbanDragStart(event)" ondragend="kanbanDragEnd(event)">
                                    <div class="kanban-card-name">${lead.name}</div>
                                    <div class="kanban-card-biz">${lead.business_name || lead.business_type || 'No business'}</div>
                                    <div class="kanban-card-meta">
                                        <span class="kanban-card-tag" style="background:${sc.bg};color:${sc.color}">${src}</span>
                                        ${lead.monthly_rate ? `<span class="kanban-card-rate">$${lead.monthly_rate}/mo</span>` : ''}
                                        <span class="kanban-card-date">${created}</span>
                                    </div>
                                    ${needSnippet}
                                </div>`;
                            }).join('')
                        }
                    </div>
                </div>`;
            }).join('');
        }

        // Drag & Drop
        let draggedLeadId = null;

        function kanbanDragStart(e) {
            draggedLeadId = e.target.dataset.leadId;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedLeadId);
        }

        function kanbanDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.kanban-col').forEach(c => c.classList.remove('drag-over'));
        }

        function kanbanDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const col = e.target.closest('.kanban-col');
            if (col) col.classList.add('drag-over');
        }

        function kanbanDragLeave(e) {
            const col = e.target.closest('.kanban-col');
            if (col && !col.contains(e.relatedTarget)) col.classList.remove('drag-over');
        }

        async function kanbanDrop(e) {
            e.preventDefault();
            const col = e.target.closest('.kanban-col');
            if (!col) return;
            col.classList.remove('drag-over');

            const newStatus = col.dataset.status;
            const leadId = e.dataTransfer.getData('text/plain') || draggedLeadId;
            if (!leadId || !newStatus) return;

            const lead = pipelineLeads.find(l => l.id === leadId);
            if (!lead || lead.status === newStatus) return;

            // Optimistic update
            lead.status = newStatus;
            renderKanbanStats();
            renderKanban();

            // Persist to Supabase
            try {
                await sbPatch('client_leads', leadId, { status: newStatus, updated_at: new Date().toISOString() });
                // Also update cachedLeads for the Ads & Leads tab
                const cached = cachedLeads.find(l => l.id === leadId);
                if (cached) cached.status = newStatus;
            } catch (err) {
                console.error('Failed to update lead status:', err);
                // Reload to get correct state
                loadPipeline();
            }
            draggedLeadId = null;
        }

        // Close modals on overlay click
        document.getElementById('adModal').addEventListener('click', function(e) {
            if (e.target === this) closeAdModal();
        });
        document.getElementById('leadModal').addEventListener('click', function(e) {
            if (e.target === this) closeLeadModal();
        });

        // ===== INIT =====
        renderClients();
    </script>
</body>
</html>
