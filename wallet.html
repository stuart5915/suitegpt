<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Vault | SUITE</title>
    <link rel="icon" type="image/png" href="assets/suite-token.png">
    <meta name="description"
        content="Your SUITE Vault - deposit, withdraw, earn with Community Arbitrage, and view Treasury stats.">
    <!-- Ethers.js for blockchain interactions -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="suite-styles.css">
    <link rel="stylesheet" href="nav.css">
    <style>
        /* ============================================
           BUBBLY WALLET PAGE - PancakeSwap Vibes
           ============================================ */

        :root {
            --gradient-warm: linear-gradient(135deg, #fff5eb 0%, #ffe4d4 20%, #ffd4e3 50%, #e8d5f9 80%, #d4e5ff 100%);
            --accent-orange: #ff9500;
            --accent-pink: #ff6b9d;
            --accent-purple: #a855f7;
            --text-dark: #2d1b4e;
            --text-medium: #5a4a6f;
            --card-bg: rgba(255, 255, 255, 0.85);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.12);
            --radius-xl: 28px;
            --radius-lg: 20px;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--gradient-warm);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Animated background blobs */
        .bg-blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        .blob-1 {
            width: 500px;
            height: 500px;
            background: #ffb3d9;
            top: -100px;
            left: -100px;
        }

        .blob-2 {
            width: 400px;
            height: 400px;
            background: #b3d4ff;
            top: 50%;
            right: -100px;
            animation-delay: -5s;
        }

        .blob-3 {
            width: 350px;
            height: 350px;
            background: #ffe0b3;
            bottom: -50px;
            left: 30%;
            animation-delay: -10s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            33% {
                transform: translate(30px, -30px) scale(1.05);
            }

            66% {
                transform: translate(-20px, 20px) scale(0.95);
            }
        }

        @keyframes float-reverse {

            0%,
            100% {
                transform: scaleX(-1) translate(0, 0);
            }

            33% {
                transform: scaleX(-1) translate(-30px, 30px);
            }

            66% {
                transform: scaleX(-1) translate(20px, -20px);
            }
        }

        /* Ensure CTA button stays white */
        .nav-links a.nav-cta,
        .nav-links a.nav-cta:hover,
        .nav-links a.nav-cta:active {
            color: #ffffff !important;
        }

        /* Wallet Page Container */
        .wallet-page {
            padding-top: 100px;
            min-height: 100vh;
            position: relative;
        }

        .wallet-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 16px 24px 16px;
        }

        /* Hero Header with Gradient Title */
        .wallet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .wallet-header h1 {
            font-size: 2rem;
            font-weight: 900;
            font-style: italic;
            background: linear-gradient(135deg, #ff9500 0%, #ff6b9d 50%, #ff9a8b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: bounce-in 0.6s ease;
        }

        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wallet-address {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 12px 20px;
            border-radius: 100px;
            font-family: monospace;
            font-size: 0.9rem;
            box-shadow: var(--shadow-soft);
        }

        .wallet-address .dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(0.85);
                opacity: 0.7;
            }
        }

        .disconnect-btn {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: var(--text-medium);
            padding: 10px 20px;
            border-radius: 100px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .disconnect-btn:hover {
            border-color: #ef4444;
            color: #ef4444;
            transform: translateY(-2px);
        }

        .connect-btn-inline {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 100px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 8px 24px rgba(255, 149, 0, 0.3);
        }

        .connect-btn-inline:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 16px 40px rgba(255, 149, 0, 0.4);
        }

        /* Main Content Wrapper - Unified Container */
        .wallet-main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 20px;
        }

        /* UX Notice - Subtle inside wrapper */
        .ux-notice {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 149, 0, 0.06);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .ux-notice-icon {
            font-size: 1.4rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        .ux-notice-text {
            font-size: 0.85rem;
            color: var(--text-medium);
            line-height: 1.5;
        }

        .ux-notice-text strong {
            color: var(--accent-orange);
            font-weight: 700;
        }

        /* Glassmorphism Balance Cards */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .balance-card {
            padding: 14px 12px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .balance-card:hover {
            transform: translateY(-4px);
        }

        .balance-card.primary {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.1), rgba(255, 107, 157, 0.08));
            border-radius: var(--radius-lg);
        }

        .balance-label {
            font-size: 0.7rem;
            color: var(--text-medium);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .balance-value {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--text-dark), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-sub {
            font-size: 0.8rem;
            color: var(--text-medium);
            margin-top: 4px;
            font-weight: 600;
        }

        /* Add to Wallet Button */
        .add-to-wallet-btn {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: var(--text-medium);
            padding: 12px 24px;
            border-radius: 100px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: var(--shadow-soft);
        }

        .add-to-wallet-btn:hover {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
            background: rgba(255, 149, 0, 0.1);
            transform: translateY(-2px);
        }

        /* Treasury Stats - Glassmorphism */
        .treasury-stats {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .treasury-stat {
            flex: 1;
            min-width: 160px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: rgba(34, 197, 94, 0.06);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .treasury-stat:hover {
            background: rgba(34, 197, 94, 0.1);
        }

        .treasury-label {
            font-size: 0.75rem;
            color: var(--text-medium);
            font-weight: 600;
        }

        .treasury-value {
            font-size: 1rem;
            font-weight: 800;
            color: #22c55e;
        }

        .treasury-value-stacked {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .treasury-usd {
            font-size: 1.1rem;
            font-weight: 800;
            color: #22c55e;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }

        .treasury-eth {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-medium);
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }

        /* Admin Panel - Keep functional but style-update */
        .admin-panel {
            border: 2px solid #ef4444 !important;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.02)) !important;
        }

        .admin-notice {
            color: #ef4444;
            font-size: 0.9rem;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .admin-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .admin-stat {
            flex: 1;
            background: rgba(239, 68, 68, 0.1);
            padding: 14px 18px;
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .admin-label {
            font-size: 0.8rem;
            color: var(--text-medium);
        }

        .admin-value {
            font-size: 1.2rem;
            font-weight: 800;
            color: #ef4444;
            font-family: 'SF Mono', monospace;
        }

        .admin-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .admin-btn {
            flex: 1;
            padding: 14px 18px;
            border-radius: 100px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: none;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.25);
        }

        .admin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.35);
        }

        .admin-btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.25);
        }

        .admin-btn.danger:hover {
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.35);
        }

        .admin-btn.secondary {
            background: var(--card-bg);
            color: var(--text-dark);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: var(--shadow-soft);
        }

        .admin-ownership {
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            padding-top: 18px;
        }

        .admin-ownership h4 {
            margin-bottom: 12px;
            color: var(--text-medium);
            font-size: 0.9rem;
            font-weight: 700;
        }

        .admin-input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 100px;
            background: var(--card-bg);
            color: var(--text-dark);
            margin-bottom: 12px;
            font-family: 'SF Mono', monospace;
            font-size: 0.85rem;
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(255, 149, 0, 0.1);
        }

        /* Action Buttons - Bouncy */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border-radius: 100px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.deposit {
            background: linear-gradient(135deg, #22c55e, #10b981);
            border: none;
            color: white;
            box-shadow: 0 8px 28px rgba(34, 197, 94, 0.3);
        }

        .action-btn.deposit:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 14px 40px rgba(34, 197, 94, 0.4);
        }

        .action-btn.withdraw {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: var(--text-dark);
            box-shadow: var(--shadow-soft);
        }

        .action-btn.withdraw:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .action-btn.stake {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(168, 85, 247, 0.05));
            border: 2px solid rgba(168, 85, 247, 0.3);
            color: var(--accent-purple);
        }

        .action-btn.stake:hover {
            transform: translateY(-4px);
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(168, 85, 247, 0.08));
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.2);
        }

        /* Sections - Glassmorphism */
        .wallet-section {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-soft);
            position: relative;
            z-index: 10;
        }

        .wallet-section h3 {
            font-size: 1rem;
            font-weight: 800;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }

        /* Transaction History */
        .tx-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tx-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .tx-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .tx-action {
            font-weight: 500;
        }

        .tx-date {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        .tx-amount {
            font-weight: 600;
        }

        .tx-amount.positive {
            color: #22c55e;
        }

        .tx-amount.negative {
            color: #ef4444;
        }

        /* Voting Section */
        .vote-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .vote-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .vote-option:hover {
            border-color: var(--accent-primary);
        }

        .vote-option input {
            display: none;
        }

        .vote-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            position: relative;
        }

        .vote-option input:checked+.vote-radio {
            border-color: var(--accent-primary);
        }

        .vote-option input:checked+.vote-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            border-radius: 50%;
        }

        .vote-label {
            flex: 1;
        }

        .vote-count {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .vote-btn {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* Connected Apps */
        .apps-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .app-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .app-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.1));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .app-name {
            font-weight: 500;
        }

        .app-status {
            font-size: 0.75rem;
            color: #22c55e;
        }

        /* UX Notice */
        .ux-notice {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(34, 211, 238, 0.1), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .ux-notice-icon {
            font-size: 1.5rem;
        }

        .ux-notice-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .ux-notice-text strong {
            color: #22d3ee;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            z-index: 10000;
            pointer-events: auto;
        }

        .modal * {
            pointer-events: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 1.4rem;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px 12px;
            position: relative;
            z-index: 1001;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        /* Amount Selector */
        .amount-selector {
            margin-bottom: 24px;
        }

        .amount-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .amount-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .amount-option {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .amount-option:hover,
        .amount-option.selected {
            border-color: var(--accent-primary);
            background: rgba(168, 85, 247, 0.1);
        }

        .custom-amount {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .custom-amount input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .custom-amount input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .suite-preview {
            text-align: center;
            padding: 16px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), transparent);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .suite-preview-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .suite-preview-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Payment Options */
        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .payment-option:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }

        .payment-icon {
            font-size: 1.5rem;
        }

        .payment-info {
            flex: 1;
        }

        .payment-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .payment-desc {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        .payment-arrow {
            color: var(--text-tertiary);
        }

        /* Withdraw specific */
        .balance-display {
            text-align: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .balance-display-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .balance-display-label {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        .fee-notice {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-tertiary);
            margin-top: 16px;
        }

        /* Boost Cards */
        .boost-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 149, 0, 0.1);
            border: 2px solid rgba(255, 149, 0, 0.2);
            padding: 12px 16px;
            border-radius: 14px;
            transition: all 0.2s;
        }

        .boost-item:hover {
            border-color: var(--accent-orange);
            transform: translateY(-2px);
        }

        .boost-item-icon {
            font-size: 1.5rem;
        }

        .boost-item-info {
            flex: 1;
        }

        .boost-item-name {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .boost-item-status {
            font-size: 0.75rem;
            color: var(--text-medium);
        }

        .boost-item-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .boost-item-btn.mint {
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-pink));
            color: white;
        }

        .boost-item-btn.mint:hover {
            transform: scale(1.05);
        }

        .boost-item-btn.redeem {
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
        }

        .boost-item-btn.redeem:hover {
            transform: scale(1.05);
        }

        .boost-item-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .info-tooltip {
            cursor: help;
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .info-tooltip:hover {
            opacity: 1;
        }

        /* New Dashboard Grid Layout */
        .wallet-grid {
            display: grid;
            grid-template-columns: 1.6fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 900px) {
            .wallet-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Glassmorphism Card Base */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            /* Readjusted radius */
            padding: 20px;
            /* Reduced from 24px */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }

        /* Vault Hero Card Specifics - Horizontal */
        .vault-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 248, 240, 0.8));
            border: 2px solid rgba(255, 149, 0, 0.1);
            display: flex;
            flex-direction: row;
            /* Horizontal layout */
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            flex-wrap: wrap;
            gap: 20px;
        }

        .vault-content-left {
            text-align: left;
        }

        .vault-content-right {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .dashboard-bottom {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .vault-card {
                flex-direction: column;
                text-align: center;
            }

            .vault-content-left {
                text-align: center;
            }

            .vault-content-right {
                flex-direction: column;
                width: 100%;
            }

            .dashboard-bottom {
                gap: 16px;
            }

            /* Stack Treasury Vault and Open Market cards vertically on mobile */
            .wallet-main-content>div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        .vault-balance-large {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #2d1b4e 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
            line-height: 1.1;
        }

        .vault-actions-row {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            width: 100%;
            justify-content: center;
        }

        .btn-deposit-hero {
            padding: 16px 40px;
            font-size: 1.1rem;
            border-radius: 18px;
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);
            color: white;
            font-weight: 800;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-withdraw-hero {
            padding: 16px 40px;
            font-size: 1.1rem;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid #2d1b4e;
            color: #2d1b4e;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-withdraw-hero:hover {
            background: rgba(45, 27, 78, 0.05);
            transform: translateY(-2px);
        }

        /* Right Sidebar Stack */
        .sidebar-stack {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-pill {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .section-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            margin-top: 40px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: #2d1b4e;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Tabs */
        .wallet-tabs {
            display: flex;
            gap: 20px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .wallet-tab {
            padding: 12px 4px;
            font-weight: 700;
            color: var(--text-tertiary);
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .wallet-tab.active {
            color: var(--accent-primary);
        }

        .wallet-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-primary);
            border-radius: 2px;
        }

        /* Connect Buttons Hover Effects */
        #discordLoginBtn2:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.4);
        }

        #connectWalletBtn2:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.4);
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav id="main-nav"></nav>
    <script src="nav-component.js"></script>

    <!-- Animated Background Blobs -->
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>
    <div class="bg-blob blob-3"></div>

    <main class="wallet-page">
        <div class="wallet-container">
            <!-- Clay Treasure Chest - Fixed to right side of page (behind everything) -->
            <!-- How It Works Tooltip (Hidden by default, positioned near icon) -->
            <div id="howItWorksTooltip"
                style="display: none; position: absolute; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); max-width: 280px; z-index: 100; border: 2px solid rgba(139,92,246,0.2);">
                <div style="font-size: 0.85rem; font-weight: 700; color: #2d1b4e; margin-bottom: 8px;">üí° How it works
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; line-height: 1.5;">Deposit <span
                        style="font-weight: 700; color: #627EEA;">ETH</span> or <span
                        style="font-weight: 700; color: #2775CA;">USDC</span>, and get <span
                        style="font-weight: 700; color: #ff9500;">SUITE</span> tokens! Or buy SUITE on the open market
                    (or execute community arbitrage!)</div>
            </div>

            <img src="assets/clay/treasure-chest.png" alt=""
                style="position: absolute; top: 700px; right: 50px; width: 630px; height: auto; opacity: 1; pointer-events: none; z-index: 0; transform: scaleX(-1);" />

            <!-- Wallet Dashboard (always visible) -->
            <section class="wallet-dashboard connected" id="walletDashboard">

                <!-- Header with Clay Mascot (no wallet address here anymore) -->
                <div class="wallet-header" style="position: relative;">
                    <!-- Clay Wallet with Wings Mascot -->
                    <img src="assets/clay/wallet-wings.png" alt=""
                        style="position: absolute; top: 0px; left: -250px; width: 420px; height: auto; opacity: 0.9; pointer-events: none; animation: float 4s ease-in-out infinite;" />
                </div>

                <!-- Main Content Wrapper -->
                <div class="wallet-main-content" style="position: relative; z-index: 10;">

                    <!-- Top Row: UX Notice removed for compactness -->

                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- DUAL CARD: Treasury Vault + Open Market (50/50) -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">

                        <!-- LEFT: Minted SUITE (Treasury Vault) -->
                        <div class="glass-card"
                            style="background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(252,231,243,0.9)); border: 1px solid rgba(139,92,246,0.15); padding: 24px; position: relative; overflow: hidden;">
                            <!-- Header label -->
                            <div style="text-align: center; margin-bottom: 16px;">
                                <span
                                    style="font-size: 0.7rem; font-weight: 600; color: #8b5cf6; text-transform: uppercase; letter-spacing: 1px; background: rgba(139,92,246,0.1); padding: 4px 12px; border-radius: 100px;">Minted
                                    SUITE</span>
                            </div>

                            <!-- Icon + Title -->
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <!-- Stacked ETH + USDC Icons -->
                                <div style="position: relative; width: 52px; height: 48px;">
                                    <img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/color/eth.svg"
                                        alt="ETH"
                                        style="width: 36px; height: 36px; position: absolute; top: 0; left: 0; border-radius: 50%; background: white; padding: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                    <img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/color/usdc.svg"
                                        alt="USDC"
                                        style="width: 32px; height: 32px; position: absolute; bottom: 0; right: 0; border-radius: 50%; background: white; padding: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                </div>
                                <div>
                                    <div style="position: relative;">
                                        <div
                                            style="font-size: 1.2rem; font-weight: 800; color: #2d1b4e; display: flex; align-items: center; gap: 6px;">
                                            Treasury Vault
                                            <button onclick="toggleTooltip('howItWorksTooltip', event)"
                                                style="background: rgba(139,92,246,0.1); border: none; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.7rem; color: #8b5cf6; font-weight: 700;">
                                                ‚ÑπÔ∏è
                                            </button>
                                        </div>
                                        <div style="font-size: 0.8rem; color: #6b7280;">Deposit ETH or USDC ‚Ä¢ Mint SUITE
                                        </div>
                                    </div>
                                </div>

                                <!-- Stats Row -->
                                <div
                                    style="display: flex; justify-content: space-between; margin-bottom: 20px; padding: 12px 16px; background: rgba(139,92,246,0.05); border-radius: 12px;">
                                    <div style="text-align: center;">
                                        <div
                                            style="font-size: 0.65rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">
                                            Est. APY</div>
                                        <div
                                            style="font-size: 1.1rem; font-weight: 800; color: #22c55e; display: flex; align-items: center; gap: 4px;">
                                            12.4% üî•</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div
                                            style="font-size: 0.65rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">
                                            TVL</div>
                                        <div style="font-size: 1.1rem; font-weight: 800; color: #2d1b4e;">$50.2K</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div
                                            style="font-size: 0.65rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">
                                            Your Deposit</div>
                                        <div style="font-size: 1.1rem; font-weight: 800; color: #2d1b4e;"
                                            id="vaultDeposit">
                                            $0.00</div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="document.getElementById('depositModal').classList.add('active')"
                                        style="flex: 1; padding: 12px 16px; background: linear-gradient(135deg, #22c55e, #10b981); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;">
                                        Deposit to Vault
                                    </button>
                                    <button onclick="document.getElementById('withdrawModal').classList.add('active')"
                                        style="flex: 1; padding: 12px 16px; background: white; color: #6b7280; border: 1px solid #e5e7eb; border-radius: 10px; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;">
                                        Withdraw from Vault
                                    </button>
                                </div>
                            </div>

                            <!-- RIGHT: Market Buy (Open Market LP) -->
                            <div class="glass-card"
                                style="background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(254,243,199,0.9)); border: 1px solid rgba(249,115,22,0.15); padding: 24px; position: relative; overflow: hidden;">
                                <!-- Header label -->
                                <div style="text-align: center; margin-bottom: 16px;">
                                    <span
                                        style="font-size: 0.7rem; font-weight: 600; color: #f97316; text-transform: uppercase; letter-spacing: 1px; background: rgba(249,115,22,0.1); padding: 4px 12px; border-radius: 100px;">Market
                                        Buy</span>
                                </div>

                                <!-- Icon + Title -->
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                    <!-- Stacked SUITE + ETH Icons -->
                                    <div style="position: relative; width: 52px; height: 48px;">
                                        <div
                                            style="width: 36px; height: 36px; position: absolute; top: 0; left: 0; border-radius: 50%; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                            <img src="assets/suite-token.png" alt="SUITE"
                                                style="width: 150%; height: 150%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        </div>
                                        <img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/color/eth.svg"
                                            alt="ETH"
                                            style="width: 32px; height: 32px; position: absolute; bottom: 0; right: 0; border-radius: 50%; background: white; padding: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                    </div>
                                    <div>
                                        <div style="font-size: 1.2rem; font-weight: 800; color: #2d1b4e;">Open Market
                                            (LP)
                                        </div>
                                        <div style="font-size: 0.8rem; color: #6b7280;">Buy SUITE directly via Aerodrome
                                        </div>
                                    </div>
                                </div>

                                <!-- LP Info Card -->
                                <div
                                    style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding: 14px 16px; background: rgba(249,115,22,0.05); border-radius: 12px; border: 1px solid rgba(249,115,22,0.1);">
                                    <div style="display: flex; align-items: center; gap: -8px;">
                                        <img src="assets/suite-token.png" alt="SUITE"
                                            style="width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/color/eth.svg"
                                            alt="ETH"
                                            style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; margin-left: -8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 0.9rem; font-weight: 700; color: #2d1b4e;">SUITE/ETH LP
                                        </div>
                                        <div style="font-size: 0.75rem; color: #6b7280;">‚ö° Aerodrome</div>
                                    </div>
                                </div>

                                <!-- Action Button -->
                                <a href="https://aerodrome.finance/swap?from=eth&to=0xSUITE" target="_blank"
                                    style="display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px 16px; background: linear-gradient(135deg, #f97316, #ea580c); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 0.9rem; cursor: pointer; text-decoration: none; transition: all 0.2s;">
                                    Buy SUITE on Aerodrome
                                </a>
                            </div>
                        </div>

                        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                        <!-- WALLET BALANCE CARD (Existing - Shows SUITE) -->
                        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                        <div class="glass-card vault-card" style="position: relative;">
                            <div class="vault-content-left">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px;">
                                    <img src="assets/suite-token.png" alt="SUITE"
                                        style="width: 80px; height: 80px; border-radius: 50%;"
                                        onerror="this.src='assets/suite-logo.png'">
                                    <div
                                        style="font-size: 0.85rem; font-weight: 700; color: #8b5cf6; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.9;">
                                        Your SUITE Wallet
                                    </div>
                                </div>
                                <div class="vault-balance-large" id="vaultBalanceHero"
                                    style="font-size: 2.5rem; margin: 0; margin-left: 52px;">
                                    0 SUITE</div>
                                <div style="color: #6b7280; font-weight: 600; font-size: 0.9rem; margin-left: 52px;">‚âà
                                    $0.00
                                    USD</div>
                            </div>

                            <div class="vault-content-right">
                                <!-- Auth buttons moved to global nav -->
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Bottom Grid -->
                    <div class="dashboard-bottom" style="width: 100%;">

                        <!-- 1. Yield & Arbitrage Grid -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%;">
                            <!-- Yield Status -->
                            <div class="glass-card"
                                style="display: flex; flex-direction: column; gap: 10px; padding: 16px;">
                                <div class="stat-card-row">
                                    <div style="font-weight: 700; color: #2d1b4e; font-size: 0.85rem;">Yield Status
                                    </div>
                                    <span class="info-pill" style="font-size: 0.65rem; padding: 2px 6px;">Active</span>
                                </div>
                                <div>
                                    <select id="yieldDestination"
                                        style="width: 100%; border: none; background: rgba(0,0,0,0.05); border-radius: 6px; font-size: 0.75rem; padding: 4px; font-weight: 600; color: #8b5cf6; cursor: pointer;"
                                        onchange="updateYieldDestination(this.value)">
                                        <option value="reinvest">üîÑ Reinvest</option>
                                        <option value="self">üí∞ Claim</option>
                                        <option value="water_org">üíß Donate</option>
                                    </select>
                                    <div
                                        style="width: 100%; height: 4px; background: rgba(0,0,0,0.05); border-radius: 100px; overflow: hidden; margin-top: 6px;">
                                        <div style="width: 75%; height: 100%; background: #22c55e;"></div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.75rem;">
                                    <span style="color: #9ca3af;">Next:</span>
                                    <span style="font-weight: 700; color: #2d1b4e;">14h 32m</span>
                                </div>
                            </div>

                            <!-- 2. Community Arbitrage -->
                            <div id="arbSection" class="glass-card"
                                style="border: 2px solid rgba(34, 197, 94, 0.2); background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(240, 253, 244, 0.95)); padding: 16px; display: flex; flex-direction: column; justify-content: center;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <div
                                        style="width: 40px; height: 40px; background: rgba(34, 197, 94, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
                                        üíπ</div>
                                    <div>
                                        <div style="position: relative;">
                                            <h3
                                                style="margin: 0; font-size: 1rem; font-weight: 800; color: #2d1b4e; display: flex; align-items: center; gap: 6px;">
                                                Community Arbitrage
                                                <button onclick="toggleTooltip('arbTooltip', event)"
                                                    style="background: rgba(34, 197, 94, 0.1); border: none; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.65rem; color: #22c55e; font-weight: 700;">
                                                    ‚ÑπÔ∏è
                                                </button>
                                            </h3>
                                            <div style="font-size: 0.8rem; color: #22c55e; font-weight: 600;">+24%
                                                Spread
                                                Live
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        style="display: flex; justify-content: space-around; text-align: center; margin-bottom: 12px;">
                                        <div>
                                            <div style="font-size: 0.7rem; color: #9ca3af;">DEX</div>
                                            <div id="arbDexPrice"
                                                style="font-weight: 700; font-size: 0.9rem; color: #22c55e;">
                                                $1.24</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.7rem; color: #9ca3af;">Floor</div>
                                            <div id="arbFloorPrice"
                                                style="font-weight: 700; font-size: 0.9rem; color: #3b82f6;">$1.00</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.7rem; color: #9ca3af;">Profit</div>
                                            <div id="arbReward"
                                                style="font-weight: 700; font-size: 0.9rem; color: #ff9500;">
                                                +120</div>
                                        </div>
                                    </div>
                                    <button onclick="executeArb()"
                                        style="width: 100%; padding: 8px; background: #22c55e; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 0.9rem;">
                                        Execute Trade
                                    </button>
                                </div>
                            </div>

                            <!-- Arbitrage Tooltip (Hidden by default, positioned near icon) -->
                            <div id="arbTooltip"
                                style="display: none; position: absolute; background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(240, 253, 244, 0.95)); border-radius: 12px; padding: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); max-width: 280px; z-index: 100; border: 2px solid rgba(34, 197, 94, 0.2);">
                                <div style="font-size: 0.85rem; font-weight: 700; color: #22c55e; margin-bottom: 8px;">
                                    üíπ
                                    Arbitrage Explained</div>
                                <div style="font-size: 0.8rem; color: #6b7280; line-height: 1.6;">
                                    When <span style="font-weight: 700; color: #22c55e;">DEX price</span> is above the
                                    <span style="font-weight: 700; color: #3b82f6;">floor price</span>, you can sell
                                    your SUITE at
                                    a profit!
                                </div>
                                <div
                                    style="font-size: 0.75rem; color: #9ca3af; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.06);">
                                    <strong style="color: #2d1b4e;">Click Execute Trade:</strong><br>
                                    Sells your SUITE on DEX ‚Üí Treasury buys it back at floor ‚Üí You pocket the
                                    difference! üéâ
                                </div>
                            </div>

                            <!-- 3. Tabs Section (Full Width) -->
                            <div id="earn" style="grid-column: 1 / -1;">
                                <div class="wallet-tabs" style="margin-bottom: 16px;">
                                    <div class="wallet-tab active" onclick="switchTab('earn')">Earn</div>
                                    <div class="wallet-tab" onclick="switchTab('activity')">Recent Activity</div>
                                    <div class="wallet-tab" onclick="switchTab('boosts')">Active Boosts</div>
                                    <div class="wallet-tab" onclick="switchTab('governance')">Governance</div>
                                </div>

                                <!-- Tab Content: Activity -->
                                <div id="tab-activity" class="tab-content" style="display: none;">
                                    <div class="glass-card"
                                        style="min-height: 150px; display: flex; align-items: center; justify-content: center; color: #9ca3af; flex-direction: column; gap: 8px;">
                                        <div style="font-size: 1.5rem;">üì≠</div>
                                        <div style="font-size: 0.9rem;">No recent activity.</div>
                                    </div>
                                </div>

                                <!-- Tab Content: Earn -->
                                <div id="tab-earn" class="tab-content active">
                                    <div class="glass-card" style="padding: 20px;">
                                        <h4
                                            style="margin: 0 0 16px 0; color: #2d1b4e; font-size: 1.1rem; font-weight: 800;">
                                            üí∞ Ways to Earn SUITE</h4>
                                        <div style="display: flex; flex-direction: column; gap: 12px;">
                                            <div style="display: flex; align-items: center; gap: 16px; padding: 14px 16px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(16, 185, 129, 0.05)); border-radius: 14px; cursor: pointer; transition: all 0.3s ease;"
                                                onmouseover="this.style.transform='translateX(4px)'"
                                                onmouseout="this.style.transform='translateX(0)'">
                                                <div
                                                    style="width: 44px; height: 44px; background: linear-gradient(135deg, #22c55e, #10b981); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem;">
                                                    üë•</div>
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 700; color: #2d1b4e; font-size: 0.95rem;">
                                                        Refer
                                                        Friends</div>
                                                    <div style="font-size: 0.8rem; color: #6b7280;">Invite others to
                                                        join
                                                        SUITE</div>
                                                </div>
                                                <div
                                                    style="background: linear-gradient(135deg, #22c55e, #10b981); color: white; padding: 6px 12px; border-radius: 100px; font-weight: 700; font-size: 0.8rem;">
                                                    +25 SUITE</div>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 16px; padding: 14px 16px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(37, 99, 235, 0.05)); border-radius: 14px; cursor: pointer; transition: all 0.3s ease;"
                                                onmouseover="this.style.transform='translateX(4px)'"
                                                onmouseout="this.style.transform='translateX(0)'">
                                                <div
                                                    style="width: 44px; height: 44px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem;">
                                                    üì∫</div>
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 700; color: #2d1b4e; font-size: 0.95rem;">
                                                        Watch
                                                        Ads</div>
                                                    <div style="font-size: 0.8rem; color: #6b7280;">View sponsored
                                                        content
                                                        for rewards</div>
                                                </div>
                                                <div
                                                    style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 6px 12px; border-radius: 100px; font-weight: 700; font-size: 0.8rem;">
                                                    +2 SUITE</div>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 16px; padding: 14px 16px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(217, 119, 6, 0.05)); border-radius: 14px; cursor: pointer; transition: all 0.3s ease;"
                                                onmouseover="this.style.transform='translateX(4px)'"
                                                onmouseout="this.style.transform='translateX(0)'">
                                                <div
                                                    style="width: 44px; height: 44px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem;">
                                                    üèÜ</div>
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 700; color: #2d1b4e; font-size: 0.95rem;">
                                                        Hold
                                                        SUITE</div>
                                                    <div style="font-size: 0.8rem; color: #6b7280;">Stake and earn
                                                        passive
                                                        yield (~18% APY)</div>
                                                </div>
                                                <div
                                                    style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 12px; border-radius: 100px; font-weight: 700; font-size: 0.8rem;">
                                                    üìà Yield</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab Content: Boosts -->
                                <div id="tab-boosts" class="tab-content" style="display: none;">
                                    <div class="glass-card">
                                        <h4 style="margin: 0 0 12px 0; color: #2d1b4e; font-size: 1rem;">Your Active
                                            Boosts
                                        </h4>
                                        <!-- Boosts Lists -->
                                        <div id="databaseBoostsList" style="margin-bottom: 16px;">
                                            <div
                                                style="font-size: 0.8rem; font-weight: 700; color: var(--text-medium); margin-bottom: 8px;">
                                                ?? Account Boosts</div>
                                            <div id="databaseBoostsContent"
                                                style="display: flex; flex-wrap: wrap; gap: 8px;">
                                                <span style="color: var(--text-tertiary); font-size: 0.8rem;">Connect
                                                    Discord</span>
                                            </div>
                                        </div>
                                        <div id="nftBoostsList">
                                            <div
                                                style="font-size: 0.8rem; font-weight: 700; color: var(--text-medium); margin-bottom: 8px;">
                                                ?? NFT Boosts</div>
                                            <div id="nftBoostsContent"
                                                style="display: flex; flex-wrap: wrap; gap: 8px;">
                                                <span style="color: var(--text-tertiary); font-size: 0.8rem;">Connect
                                                    wallet</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab Content: Governance -->
                                <div id="tab-governance" class="tab-content" style="display: none;">
                                    <div class="glass-card" style="text-align: center; padding: 24px;">
                                        <h3 style="font-size: 1.1rem; margin-bottom: 8px;">Governance Portal</h3>
                                        <p style="color: #6b7280; margin-bottom: 16px; font-size: 0.9rem;">Vote on
                                            treasury
                                            proposals.</p>
                                        <button
                                            style="padding: 8px 16px; background: rgba(0,0,0,0.05); border-radius: 100px; border: none; font-weight: 600; color: #6b7280; cursor: not-allowed; font-size: 0.8rem;">Coming
                                            Soon</button>
                                    </div>
                                </div>
                            </div>

                        </div>


                        <!-- Admin Panel (Only visible to contract owner) -->
                        <div class="wallet-section admin-panel" id="adminPanel" style="display: none;">
                            <h3>?? Treasury Admin</h3>
                            <p class="admin-notice">You are the Treasury contract owner.</p>

                            <div class="admin-stats">
                                <div class="admin-stat">
                                    <span class="admin-label">Accumulated Fees</span>
                                    <span class="admin-value" id="accumulatedFees">$0.00</span>
                                </div>
                                <div class="admin-stat">
                                    <span class="admin-label">Total Treasury ETH</span>
                                    <span class="admin-value" id="adminTreasuryEth">0 ETH</span>
                                </div>
                            </div>

                            <div class="admin-actions">
                                <button class="admin-btn" id="withdrawFeesBtn" onclick="withdrawFees()" disabled>
                                    ?? Withdraw Fees
                                </button>
                                <p class="admin-helper" id="withdrawFeesHelper"
                                    style="font-size: 12px; color: #888; margin-top: 4px;">
                                    Minimum 0.001 ETH in fees required to withdraw
                                </p>
                            </div>

                            <div class="admin-ownership">
                                <h4>Transfer Ownership</h4>
                                <input type="text" id="newOwnerAddress" placeholder="0x... new owner address"
                                    class="admin-input">
                                <button class="admin-btn secondary" onclick="transferOwnership()">
                                    Transfer Ownership
                                </button>
                            </div>
                        </div>

            </section>
        </div>
    </main>

    <!-- Add Funds Modal -->
    <div class="modal-overlay" id="depositModal">
        <div class="modal">
            <div class="modal-header">
                <h2>?? Get SUITE</h2>
                <button class="modal-close" onclick="closeModal('depositModal')">?</button>
            </div>



            <div class="payment-options">
                <div class="payment-option" onclick="handlePayment('card')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Credit / Debit Card</div>
                        <div class="payment-desc">Visa, Mastercard, Amex</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handlePayment('apple')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Apple Pay</div>
                        <div class="payment-desc">One-tap checkout</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handlePayment('crypto')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Crypto (USDC / ETH)</div>
                        <div class="payment-desc">Send from any wallet</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
            </div>

            <p class="fee-notice">0.5% deposit fee ? Your funds are always withdrawable</p>
        </div>
    </div>

    <!-- Crypto Deposit Modal -->
    <div class="modal-overlay" id="cryptoDepositModal">
        <div class="modal">
            <div class="modal-header">
                <h2>?? Deposit Crypto</h2>
                <button class="modal-close" onclick="closeModal('cryptoDepositModal')">?</button>
            </div>

            <!-- Network Warning -->
            <div class="network-warning" id="networkWarning" style="display: none;">
                <span></span>
                <span>Please switch to <strong>Base</strong> network in MetaMask</span>
                <button onclick="switchToBase()" class="switch-network-btn">Switch Network</button>
            </div>

            <!-- Wallet Balances -->
            <div class="wallet-balances-display">
                <div class="balance-header">Your Base Wallet</div>
                <div class="crypto-balance-row">
                    <div class="crypto-icon eth"></div>
                    <div class="crypto-info">
                        <span class="crypto-name">ETH</span>
                        <span class="crypto-balance" id="ethBalance">0.0000</span>
                    </div>
                    <span class="crypto-usd" id="ethUsdValue">~$0.00</span>
                </div>
                <div class="crypto-balance-row">
                    <div class="crypto-icon usdc"></div>
                    <div class="crypto-info">
                        <span class="crypto-name">USDC</span>
                        <span class="crypto-balance" id="usdcBalance">0.00</span>
                    </div>
                    <span class="crypto-usd" id="usdcUsdValue">~$0.00</span>
                </div>
            </div>

            <!-- Asset Selector -->
            <div class="asset-selector">
                <div class="asset-label">Deposit Asset:</div>
                <div class="asset-tabs">
                    <button class="asset-tab active" data-asset="eth" onclick="selectAsset('eth', this)">
                        ?? ETH
                    </button>
                    <button class="asset-tab" data-asset="usdc" onclick="selectAsset('usdc', this)">
                        ?? USDC
                    </button>
                </div>
            </div>

            <!-- Amount Input -->
            <div class="deposit-amount-section">
                <div class="amount-label">Amount to deposit:</div>
                <div class="crypto-amount-input-wrapper">
                    <button class="amount-adjust-btn minus" onclick="adjustAmount(-0.00001)">-</button>
                    <div class="crypto-amount-input">
                        <input type="number" id="cryptoDepositAmount" placeholder="0.000000" step="0.000001" min="0"
                            oninput="updateCryptoPreview()">
                        <span class="input-asset" id="inputAssetLabel">ETH</span>
                    </div>
                    <button class="amount-adjust-btn plus" onclick="adjustAmount(0.00001)">+</button>
                </div>
                <div class="percentage-buttons">
                    <button onclick="setPercentage(25)">25%</button>
                    <button onclick="setPercentage(50)">50%</button>
                    <button onclick="setPercentage(75)">75%</button>
                    <button onclick="setPercentage(100)">MAX</button>
                </div>
            </div>

            <!-- SUITE Preview -->
            <div class="suite-receive-preview">
                <div class="receive-label">You'll receive:</div>
                <div class="receive-value">
                    <span id="cryptoSuitePreview">0 SUITE</span>
                    <span class="receive-usd" id="cryptoUsdPreview">(~$0.00)</span>
                </div>
                <div class="receive-note">After 0.5% deposit fee ? Earning ~18% APY</div>
            </div>

            <!-- Deposit Button -->
            <button class="crypto-deposit-btn" id="cryptoDepositBtn" onclick="executeCryptoDeposit()">
                ?? Deposit Now
            </button>

            <p class="fee-notice">Funds are always withdrawable ? No lock-up period</p>
        </div>
    </div>

    <!-- Custom Notification Modal -->
    <div class="modal-overlay" id="notificationModal">
        <div class="modal notification-modal">
            <div class="notification-icon" id="notificationIcon">??</div>
            <h2 id="notificationTitle">Success!</h2>
            <p id="notificationMessage">Your transaction was submitted.</p>
            <div class="notification-details" id="notificationDetails"></div>
            <button class="notification-btn" onclick="closeNotification()">Got it</button>
        </div>
    </div>

    <style>
        /* Crypto Deposit Modal Styles */
        .network-warning {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .switch-network-btn {
            margin-left: auto;
            padding: 6px 12px;
            background: #ef4444;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .wallet-balances-display {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .balance-header {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .crypto-balance-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .crypto-balance-row:last-child {
            border-bottom: none;
        }

        .crypto-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .crypto-icon.eth {
            background: rgba(98, 126, 234, 0.2);
        }

        .crypto-icon.usdc {
            background: rgba(39, 117, 202, 0.2);
        }

        .crypto-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .crypto-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .crypto-balance {
            font-size: 1.1rem;
            font-weight: 700;
            font-family: monospace;
        }

        .crypto-usd {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .asset-selector {
            margin-bottom: 20px;
        }

        .asset-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .asset-tabs {
            display: flex;
            gap: 8px;
        }

        .asset-tab {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .asset-tab:hover {
            border-color: var(--accent-primary);
        }

        .asset-tab.active {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .deposit-amount-section {
            margin-bottom: 20px;
        }

        .crypto-amount-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .amount-adjust-btn {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: 2px solid var(--accent-primary);
            background: transparent;
            color: var(--accent-primary);
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .amount-adjust-btn:hover {
            background: var(--accent-primary);
            color: white;
            transform: scale(1.05);
        }

        .amount-adjust-btn:active {
            transform: scale(0.95);
        }

        .crypto-amount-input {
            flex: 1;
            display: flex;
            align-items: center;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .crypto-amount-input:focus-within {
            border-color: var(--accent-primary);
        }

        .crypto-amount-input input {
            flex: 1;
            padding: 14px 16px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .crypto-amount-input input:focus {
            outline: none;
        }

        .input-asset {
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .percentage-buttons {
            display: flex;
            gap: 8px;
        }

        .percentage-buttons button {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .percentage-buttons button:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .suite-receive-preview {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(232, 93, 59, 0.15), rgba(249, 115, 22, 0.1));
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .receive-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .receive-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .receive-usd {
            font-size: 1.1rem;
            font-weight: 500;
            color: #22c55e;
        }

        .receive-note {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        .crypto-deposit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .crypto-deposit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
        }

        .crypto-deposit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Notification Modal Styles */
        .notification-modal {
            text-align: center;
            padding: 30px;
            max-width: 400px;
        }

        .notification-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .notification-modal h2 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1.5rem;
        }

        .notification-modal p {
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .notification-details {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .notification-details:empty {
            display: none;
        }

        .notification-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .notification-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(232, 93, 59, 0.3);
        }
    </style>

    <!-- Cash Out Modal -->
    <div class="modal-overlay" id="withdrawModal">
        <div class="modal">
            <div class="modal-header">
                <h2>?? Cash Out</h2>
                <button class="modal-close" onclick="closeModal('withdrawModal')">?</button>
            </div>

            <div class="balance-display">
                <div class="balance-display-value" id="cashOutBalance">0 SUITE</div>
                <div class="balance-display-label">Available to cash out ? ? $0.00</div>
            </div>

            <div class="amount-selector">
                <div class="amount-label">How much would you like to cash out?</div>
                <div class="custom-amount">
                    <input type="number" id="withdrawAmount" placeholder="Amount in SUITE" value="0">
                    <button class="amount-option" onclick="document.getElementById('withdrawAmount').value = 0"
                        style="padding: 12px 20px;">MAX</button>
                </div>
            </div>

            <div class="payment-options">
                <div class="payment-option" onclick="handleWithdraw('paypal')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">PayPal</div>
                        <div class="payment-desc">Instant to your PayPal email</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handleWithdraw('card')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Original Card</div>
                        <div class="payment-desc">Refund to card you deposited with</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handleWithdraw('giftcard')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Gift Card</div>
                        <div class="payment-desc">Amazon, Visa Prepaid, more</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handleWithdraw('crypto')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Crypto Wallet</div>
                        <div class="payment-desc">Send USDC to any address</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
                <div class="payment-option" onclick="handleWithdraw('bank')">
                    <span class="payment-icon"></span>
                    <div class="payment-info">
                        <div class="payment-name">Bank Transfer</div>
                        <div class="payment-desc">Interac e-Transfer (Canada) or Wire</div>
                    </div>
                    <span class="payment-arrow">?</span>
                </div>
            </div>

            <p class="fee-notice">0.5% withdrawal fee applies</p>
        </div>
    </div>


    <script>
        // Tab switching function
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.wallet-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show the selected tab content
            const selectedTab = document.getElementById('tab-' + tabName);
            if (selectedTab) {
                selectedTab.style.display = 'block';
                selectedTab.classList.add('active');
            }

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Wallet Connection Logic
        const walletDashboard = document.getElementById('walletDashboard');
        const connectBtn = document.getElementById('connectWalletBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const addressDisplay = document.getElementById('walletAddressDisplay');
        const connectedInfo = document.getElementById('walletConnectedInfo');

        // Check if MetaMask is installed
        const isMetaMaskInstalled = () => typeof window.ethereum !== 'undefined';

        // Connect wallet
        connectBtn.addEventListener('click', async () => {
            if (!isMetaMaskInstalled()) {
                alert('Please install MetaMask to connect your wallet!');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }

            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length > 0) {
                    const address = accounts[0];
                    showConnectedState(address);
                }
            } catch (error) {
                console.error('Error connecting wallet:', error);
                alert('Failed to connect wallet. Please try again.');
            }
        });

        // Disconnect wallet
        disconnectBtn.addEventListener('click', () => {
            showDisconnectedState();
        });

        function showConnectedState(address) {
            const shortAddress = `${address.slice(0, 6)}...${address.slice(-4)}`;
            addressDisplay.textContent = shortAddress;

            // Show connected UI, hide connect button
            connectBtn.style.display = 'none';
            connectedInfo.style.display = 'flex';
            disconnectBtn.style.display = 'block';

            // Set initial balances to 0 (real values come from fetchTreasuryStats)
            document.getElementById('availableBalance').textContent = '0';
            document.getElementById('stakedBalance').textContent = '0';
            document.getElementById('totalValue').textContent = '$0.00';

            // Fetch real balance from chain
            fetchUserSuiteBalance(address);

            // Fetch and show wallet ETH balance
            fetchWalletEthBalance(address);

            // Check if connected wallet is the contract owner
            checkIfOwner(address);
        }

        async function fetchWalletEthBalance(address) {
            try {
                if (!window.ethereum) return;

                // Get ETH balance
                const balanceHex = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [address, 'latest']
                });

                const ethBalance = parseInt(balanceHex, 16) / 1e18;
                const usdValue = ethBalance * ETH_PRICE_USD;

                // Update UI
                document.getElementById('walletEthBalance').textContent = `${ethBalance.toFixed(6)} ETH`;
                document.getElementById('walletEthValue').textContent = `~$${usdValue.toFixed(2)}`;
                document.getElementById('walletEthSection').style.display = 'block';

            } catch (error) {
                console.error('Error fetching wallet ETH balance:', error);
            }
        }

        async function fetchUserSuiteBalance(address) {
            try {
                if (!window.ethereum) return;

                const provider = new ethers.BrowserProvider(window.ethereum);
                const suiteContract = new ethers.Contract(SUITE_TOKEN_ADDRESS, SUITE_ABI, provider);

                const balance = await suiteContract.balanceOf(address);
                const formattedBalance = ethers.formatUnits(balance, 18);
                const numericBalance = parseFloat(formattedBalance);
                const displayBalance = numericBalance.toLocaleString(undefined, { maximumFractionDigits: 2 });

                document.getElementById('availableBalance').textContent = displayBalance;

                // Calculate USD value based on backing rate from treasury
                // Get backing rate from displayed value or calculate
                const backingRateText = document.getElementById('backingRate').textContent;
                const backingRate = parseFloat(backingRateText.replace('$', '').replace('/SUITE', '')) || 0;

                // Total Value = balance * backing rate (after 0.5% fee)
                const totalUsdValue = numericBalance * backingRate * 0.995;
                document.getElementById('totalValue').textContent = `$${totalUsdValue.toFixed(2)}`;

            } catch (error) {
                console.log('Could not fetch SUITE balance:', error);
            }
        }

        // Add SUITE token to MetaMask
        async function addSuiteToWallet() {
            if (!isMetaMaskInstalled()) {
                showNotification('??', 'MetaMask Required', 'Please install MetaMask to add tokens to your wallet.');
                return;
            }

            try {
                const wasAdded = await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: SUITE_TOKEN_ADDRESS,
                            symbol: 'SUITE',
                            decimals: 18,
                            image: 'https://your-domain.com/suite-icon.png' // Optional: Add your logo URL
                        },
                    },
                });

                if (wasAdded) {
                    showNotification('?', 'Token Added!', 'SUITE has been added to your MetaMask wallet.');
                }
            } catch (error) {
                console.error('Error adding token:', error);
                showNotification('?', 'Failed to Add Token', error.message || 'Could not add SUITE to wallet.');
            }
        }

        function showDisconnectedState() {
            // Show connect button, hide connected UI
            connectBtn.style.display = 'block';
            connectedInfo.style.display = 'none';
            disconnectBtn.style.display = 'none';

            // Hide admin panel
            document.getElementById('adminPanel').style.display = 'none';

            // Reset balances to 0 but keep dashboard visible
            document.getElementById('availableBalance').textContent = '0';
            document.getElementById('stakedBalance').textContent = '0';
            document.getElementById('totalValue').textContent = '$0.00';
        }

        // Check if already connected
        async function checkConnection() {
            if (isMetaMaskInstalled()) {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    showConnectedState(accounts[0]);
                }
            }
        }

        // Listen for account changes
        if (isMetaMaskInstalled()) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    showDisconnectedState();
                } else {
                    showConnectedState(accounts[0]);
                }
            });
        }

        // Check connection on load
        checkConnection();

        // Modal Functions
        let selectedAmount = 50;

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Custom notification modal functions
        function showNotification(icon, title, message, details = '') {
            document.getElementById('notificationIcon').textContent = icon;
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            document.getElementById('notificationDetails').textContent = details;
            openModal('notificationModal');
        }

        function closeNotification() {
            closeModal('notificationModal');
            // Refresh balances after closing notification
            checkConnection();
            fetchTreasuryStats();
        }

        // Close modal when clicking overlay
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        function selectAmount(amount, element) {
            selectedAmount = amount;
            document.querySelectorAll('.amount-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            const customAmountEl = document.getElementById('customAmount');
            if (customAmountEl) customAmountEl.value = '';
            updateSuitePreview();
        }

        function updateSuitePreview() {
            const customAmountEl = document.getElementById('customAmount');
            const suitePreviewEl = document.getElementById('suitePreviewValue');
            if (!suitePreviewEl) return;

            const customAmount = customAmountEl ? parseFloat(customAmountEl.value) : '';
            const amount = customAmount ? parseFloat(customAmount) : selectedAmount;
            const suiteAmount = (amount * 1000).toLocaleString();
            suitePreviewEl.textContent = suiteAmount + ' SUITE';
        }

        function handlePayment(method) {
            // Get amount safely (customAmount might not exist in simplified modal)
            const customAmountEl = document.getElementById('customAmount');
            const amount = customAmountEl ? (parseFloat(customAmountEl.value) || selectedAmount) : selectedAmount;

            switch (method) {
                case 'card':
                    alert(`[STRIPE] Would open Stripe checkout for $${amount}\n\nThis will:\n1. Charge your card $${amount}\n2. Deposit to treasury\n3. Mint ${(amount * 1000).toLocaleString()} SUITE to your wallet\n4. ONE popup (approval + deposit bundled)`);
                    closeModal('depositModal');
                    break;
                case 'apple':
                    alert(`[APPLE PAY] Would trigger Apple Pay for $${amount}`);
                    closeModal('depositModal');
                    break;
                case 'crypto':
                    // Open the new crypto deposit modal
                    closeModal('depositModal');
                    openCryptoDepositModal();
                    break;
            }
        }

        // Open crypto deposit modal
        function openCryptoDepositModal() {
            showCryptoDeposit();
        }

        // ===== CRYPTO DEPOSIT FUNCTIONS =====

        // Configuration - DEPLOYED CONTRACTS
        const BASE_CHAIN_ID = '0x2105'; // Base Mainnet: 8453
        const BASE_SEPOLIA_CHAIN_ID = '0x14A34'; // Base Sepolia: 84532
        const ETH_PRICE_USD = 3650; // For UI display only - V4 uses proportional shares

        // ===== DEPLOYED SUITE CONTRACTS =====
        const SUITE_TOKEN_ADDRESS = '0xE6892803DF59D79cFB4794e7da9549df4eE70f71';
        const TREASURY_ADDRESS = '0xf121C51E18aD8f8C9B38EEAA377aD4393E16e3d1'; // TreasuryV4 with 0x
        const USDC_ADDRESS = '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'; // Base Mainnet USDC

        // ===== 0x API CONFIG =====
        // API key is optional - 0x has free public access
        // Get a key from https://dashboard.0x.org for higher rate limits
        const ZERO_X_API_KEY = ''; // Optional - leave empty for free tier
        const ZERO_X_API_URL = 'https://base.api.0x.org'; // Base mainnet endpoint

        // TreasuryV4 ABI (proportional share model with 0x)
        const TREASURY_ABI = [
            'function depositETH() external payable',
            'function depositWithSwap(address sellToken, uint256 sellAmount, bytes calldata swapCalldata) external',
            'function withdraw(uint256 suiteAmount) external',
            'function previewDeposit(uint256 ethAmount) external view returns (uint256)',
            'function previewWithdraw(uint256 suiteAmount) external view returns (uint256)',
            'function getTreasuryStats() external view returns (uint256 treasuryETH, uint256 totalSupply, uint256 suitePerETH)',
            'function totalTreasuryETH() external view returns (uint256)'
        ];

        // SUITE Token ABI
        const SUITE_ABI = [
            'function totalSupply() external view returns (uint256)',
            'function balanceOf(address account) external view returns (uint256)'
        ];

        // ERC-20 ABI for approvals and balances
        const ERC20_ABI = [
            'function approve(address spender, uint256 amount) external returns (bool)',
            'function allowance(address owner, address spender) external view returns (uint256)',
            'function balanceOf(address account) external view returns (uint256)',
            'function decimals() external view returns (uint8)'
        ];

        // Function to get 0x swap quote
        async function get0xQuote(sellToken, buyToken, sellAmount) {
            const params = new URLSearchParams({
                sellToken: sellToken,
                buyToken: buyToken,
                sellAmount: sellAmount,
                takerAddress: await getConnectedAddress()
            });

            // Build headers - only include API key if provided
            const headers = {};
            if (ZERO_X_API_KEY) {
                headers['0x-api-key'] = ZERO_X_API_KEY;
            }

            const response = await fetch(`${ZERO_X_API_URL}/swap/v1/quote?${params}`, { headers });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.reason || 'Failed to get 0x quote');
            }

            return await response.json();
        }

        async function getConnectedAddress() {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            return accounts[0];
        }

        let selectedCryptoAsset = 'eth';
        let walletBalances = { eth: 0, usdc: 0 };

        // Fetch and display live treasury values
        async function fetchTreasuryStats() {
            try {
                // Get ETH balance of treasury contract directly
                const treasuryBalanceHex = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [TREASURY_ADDRESS, 'latest']
                });
                const treasuryEth = treasuryBalanceHex ? parseInt(treasuryBalanceHex, 16) / 1e18 : 0;

                // Get total SUITE supply
                const supplyData = '0x18160ddd'; // totalSupply()
                const supplyHex = await window.ethereum.request({
                    method: 'eth_call',
                    params: [{ to: SUITE_TOKEN_ADDRESS, data: supplyData }, 'latest']
                });
                const totalSupply = supplyHex && supplyHex !== '0x' ? parseInt(supplyHex, 16) / 1e18 : 0;

                // Calculate total treasury value in USD
                const treasuryValueUsd = isNaN(treasuryEth) ? 0 : treasuryEth * ETH_PRICE_USD;
                const displayEth = isNaN(treasuryEth) ? 0 : treasuryEth;
                const displaySupply = isNaN(totalSupply) ? 0 : totalSupply;

                // Update UI - stacked display with precision
                document.getElementById('treasuryValueUsd').textContent = '$' + treasuryValueUsd.toFixed(6);
                document.getElementById('treasuryValueEth').textContent = displayEth.toFixed(10) + ' ETH';
                document.getElementById('totalSupply').textContent =
                    displaySupply.toLocaleString() + ' SUITE';

                // Calculate backing rate (floor price)
                const backingRate = displaySupply > 0 ? treasuryValueUsd / displaySupply : 0;
                document.getElementById('backingRate').textContent =
                    '$' + backingRate.toFixed(6) + '/SUITE';

                // Calculate market cap (floor price * supply = treasury value for now)
                // When DEX is live, this would be DEX price * supply
                const marketCap = treasuryValueUsd; // For now, market cap = treasury value
                document.getElementById('marketCap').textContent =
                    '$' + marketCap.toFixed(2);

                // Fees collected (placeholder - would come from contract events)
                document.getElementById('feesCollected').textContent = '$0.00';

            } catch (error) {
                console.error('Error fetching treasury stats:', error);
                // Show zeros if contract not ready
                document.getElementById('treasuryValueUsd').textContent = '$0.000000';
                document.getElementById('treasuryValueEth').textContent = '0.0000000000 ETH';
                document.getElementById('totalSupply').textContent = '0 SUITE';
                document.getElementById('backingRate').textContent = '$0.000000/SUITE';
            }
        }

        async function openCryptoDepositModal() {
            // First, just open the modal immediately
            openModal('cryptoDepositModal');

            // Then try to fetch data (don't block modal opening)
            try {
                await fetchWalletBalances();
            } catch (e) { console.log('fetchWalletBalances error:', e); }

            try {
                await checkNetwork();
            } catch (e) { console.log('checkNetwork error:', e); }

            try {
                await fetchTreasuryStats();
            } catch (e) { console.log('fetchTreasuryStats error:', e); }

            try {
                updateCryptoPreview();
            } catch (e) { console.log('updateCryptoPreview error:', e); }
        }

        async function checkNetwork() {
            if (!isMetaMaskInstalled()) return;

            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const isBase = chainId === BASE_CHAIN_ID || chainId === BASE_SEPOLIA_CHAIN_ID;

                document.getElementById('networkWarning').style.display = isBase ? 'none' : 'flex';
            } catch (error) {
                console.error('Error checking network:', error);
            }
        }

        async function switchToBase() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BASE_CHAIN_ID }],
                });
                document.getElementById('networkWarning').style.display = 'none';
                await fetchWalletBalances();
            } catch (switchError) {
                // Chain not added to MetaMask - add it
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: BASE_CHAIN_ID,
                                chainName: 'Base',
                                nativeCurrency: { name: 'Ethereum', symbol: 'ETH', decimals: 18 },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org'],
                            }],
                        });
                    } catch (addError) {
                        console.error('Error adding Base network:', addError);
                    }
                }
            }
        }

        async function fetchWalletBalances() {
            if (!isMetaMaskInstalled()) return;

            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) return;

                const address = accounts[0];

                // Fetch ETH balance
                const ethBalanceHex = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [address, 'latest']
                });
                const ethBalance = parseInt(ethBalanceHex, 16) / 1e18;
                walletBalances.eth = ethBalance;

                // Update UI
                document.getElementById('ethBalance').textContent = ethBalance.toFixed(4);
                document.getElementById('ethUsdValue').textContent = `~$${(ethBalance * ETH_PRICE_USD).toFixed(2)}`;

                // Fetch USDC balance (ERC-20)
                try {
                    const usdcBalanceHex = await window.ethereum.request({
                        method: 'eth_call',
                        params: [{
                            to: USDC_ADDRESS,
                            data: '0x70a08231000000000000000000000000' + address.slice(2)
                        }, 'latest']
                    });
                    const usdcBalance = parseInt(usdcBalanceHex, 16) / 1e6; // USDC has 6 decimals
                    walletBalances.usdc = usdcBalance;

                    document.getElementById('usdcBalance').textContent = usdcBalance.toFixed(2);
                    document.getElementById('usdcUsdValue').textContent = `~$${usdcBalance.toFixed(2)}`;
                } catch (e) {
                    // USDC might not be on the current network
                    document.getElementById('usdcBalance').textContent = '0.00';
                    document.getElementById('usdcUsdValue').textContent = '~$0.00';
                }

            } catch (error) {
                console.error('Error fetching balances:', error);
            }
        }

        function selectAsset(asset, element) {
            selectedCryptoAsset = asset;
            document.querySelectorAll('.asset-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            document.getElementById('inputAssetLabel').textContent = asset.toUpperCase();
            document.getElementById('cryptoDepositAmount').value = '';
            updateCryptoPreview();
        }

        function adjustAmount(delta) {
            const input = document.getElementById('cryptoDepositAmount');
            const currentValue = parseFloat(input.value) || 0;
            const newValue = Math.max(0, currentValue + delta);
            // Show 6 decimals for ETH, 2 for USDC
            const decimals = selectedCryptoAsset === 'eth' ? 6 : 2;
            input.value = newValue.toFixed(decimals);
            updateCryptoPreview();
        }

        function setPercentage(percent) {
            const balance = selectedCryptoAsset === 'eth' ? walletBalances.eth : walletBalances.usdc;
            const amount = (balance * percent / 100);

            // For ETH, leave a little for gas
            const finalAmount = selectedCryptoAsset === 'eth' && percent === 100
                ? Math.max(0, amount - 0.0005) // leave 0.0005 for gas
                : amount;

            // Show 6 decimals for ETH, 2 for USDC
            const decimals = selectedCryptoAsset === 'eth' ? 6 : 2;
            document.getElementById('cryptoDepositAmount').value = finalAmount.toFixed(decimals);
            updateCryptoPreview();
        }

        function updateCryptoPreview() {
            const amount = parseFloat(document.getElementById('cryptoDepositAmount').value) || 0;
            let usdValue = 0;

            if (selectedCryptoAsset === 'eth') {
                usdValue = amount * ETH_PRICE_USD;
            } else {
                usdValue = amount; // USDC is 1:1 with USD
            }

            // After 0.5% fee
            const afterFee = usdValue * 0.995;
            // 1000 SUITE per $1
            const suiteAmount = Math.floor(afterFee * 1000);

            document.getElementById('cryptoSuitePreview').textContent =
                suiteAmount.toLocaleString() + ' SUITE';

            // Show USD value
            document.getElementById('cryptoUsdPreview').textContent =
                `(~$${afterFee.toFixed(2)})`;

            // Enable/disable deposit button
            document.getElementById('cryptoDepositBtn').disabled = suiteAmount === 0;
        }

        async function executeCryptoDeposit() {
            const amount = parseFloat(document.getElementById('cryptoDepositAmount').value) || 0;
            if (amount <= 0) {
                showNotification('??', 'Enter an Amount', 'Please enter an amount to deposit.');
                return;
            }

            const btn = document.getElementById('cryptoDepositBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '? Processing...';
            btn.disabled = true;

            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) {
                    showNotification('??', 'Connect Wallet', 'Please connect your wallet first.');
                    return;
                }

                const fromAddress = accounts[0];

                if (selectedCryptoAsset === 'eth') {
                    // For ETH deposits - call depositETH() on Treasury
                    // This will mint SUITE tokens to the user
                    const amountWei = '0x' + Math.floor(amount * 1e18).toString(16);

                    // depositETH() function selector
                    const depositEthData = '0xf6326fb3'; // depositETH()

                    btn.innerHTML = '?? Depositing ETH...';

                    const txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: fromAddress,
                            to: TREASURY_ADDRESS,
                            value: amountWei,
                            data: depositEthData,
                        }],
                    });

                    const suiteReceived = Math.floor(amount * ETH_PRICE_USD * 0.995 * 1000);
                    closeModal('cryptoDepositModal');
                    showNotification(
                        '?',
                        'ETH Deposit Submitted!',
                        `You'll receive ~${suiteReceived.toLocaleString()} SUITE once the transaction confirms.`,
                        `Tx: ${txHash}`
                    );

                    // Refresh treasury stats after deposit
                    setTimeout(() => {
                        fetchTreasuryStats();
                        checkConnection();
                    }, 5000);

                } else {
                    // USDC deposits via Treasury contract
                    const amountUSDC = Math.floor(amount * 1e6); // USDC has 6 decimals

                    // Step 1: Check if we need to approve USDC spending
                    btn.innerHTML = '?? Checking approval...';

                    // Check current allowance
                    const allowanceData = '0xdd62ed3e' +
                        fromAddress.slice(2).padStart(64, '0') +
                        TREASURY_ADDRESS.slice(2).padStart(64, '0');

                    const allowanceHex = await window.ethereum.request({
                        method: 'eth_call',
                        params: [{ to: USDC_ADDRESS, data: allowanceData }, 'latest']
                    });

                    const currentAllowance = parseInt(allowanceHex, 16);

                    if (currentAllowance < amountUSDC) {
                        // Need to approve
                        btn.innerHTML = '?? Approve USDC...';

                        const approveData = '0x095ea7b3' +
                            TREASURY_ADDRESS.slice(2).padStart(64, '0') +
                            'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';

                        await window.ethereum.request({
                            method: 'eth_sendTransaction',
                            params: [{
                                from: fromAddress,
                                to: USDC_ADDRESS,
                                data: approveData,
                            }]
                        });

                        alert('? USDC Approved!\n\nNow click Deposit again to complete the deposit.');
                        btn.innerHTML = '?? Deposit Now';
                        btn.disabled = false;
                        return;
                    }

                    // Step 2: Deposit USDC to Treasury
                    btn.innerHTML = '?? Depositing...';

                    // Encode depositUSDC(amount) call
                    const depositData = '0x47e7ef24' +
                        amountUSDC.toString(16).padStart(64, '0');

                    const txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: fromAddress,
                            to: TREASURY_ADDRESS,
                            data: depositData,
                        }]
                    });

                    const suiteReceived = Math.floor(amount * 0.995 * 1000);
                    closeModal('cryptoDepositModal');
                    showNotification(
                        '?',
                        'USDC Deposit Submitted!',
                        `You'll receive ~${suiteReceived.toLocaleString()} SUITE once the transaction confirms.`,
                        `Tx: ${txHash}`
                    );

                    // Refresh after deposit
                    setTimeout(() => {
                        fetchTreasuryStats();
                        checkConnection();
                    }, 5000);
                }

            } catch (error) {
                console.error('Deposit error:', error);
                if (error.code === 4001) {
                    showNotification('?', 'Cancelled', 'Transaction was cancelled.');
                } else {
                    showNotification('?', 'Transaction Failed', 'Something went wrong. Please try again.', error.message || '');
                }
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function handleWithdraw(method) {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;

            // Get backing rate for precise calculation
            const backingRateText = document.getElementById('backingRate').textContent;
            const backingRate = parseFloat(backingRateText.replace('$', '').replace('/SUITE', '')) || 0;
            const usdValue = (amount * backingRate * 0.995); // After 0.5% fee
            const usdcValue = usdValue.toFixed(6); // 6 decimals for USDC precision

            switch (method) {
                case 'paypal':
                    closeModal('withdrawModal');
                    showNotification('???', 'PayPal Cash Out', `Would send $${usdcValue} to your PayPal email.`, 'Coming soon!');
                    break;
                case 'card':
                    closeModal('withdrawModal');
                    showNotification('??', 'Card Refund', `Would refund $${usdcValue} to your original card.`, 'Coming soon!');
                    break;
                case 'giftcard':
                    closeModal('withdrawModal');
                    showNotification('??', 'Gift Card', `Choose a gift card worth $${usdcValue}`, 'Coming soon!');
                    break;
                case 'crypto':
                    // Actually execute the crypto withdrawal
                    await executeCryptoWithdraw(amount);
                    break;
                case 'bank':
                    closeModal('withdrawModal');
                    showNotification('??', 'Bank Transfer', `Would initiate $${usdcValue} transfer.`, 'Coming soon!');
                    break;
            }
        }

        async function executeCryptoWithdraw(suiteAmount) {
            if (suiteAmount <= 0) {
                showNotification('??', 'Enter Amount', 'Please enter an amount to withdraw.');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) {
                    showNotification('??', 'Connect Wallet', 'Please connect your wallet first.');
                    return;
                }

                const fromAddress = accounts[0];

                closeModal('withdrawModal');
                showNotification('?', 'Processing Withdrawal', 'Please confirm the transaction in MetaMask...', '');

                // Convert SUITE amount to wei (18 decimals)
                const suiteWei = '0x' + Math.floor(suiteAmount * 1e18).toString(16);

                // First: Approve Treasury to spend SUITE tokens
                // approve(address spender, uint256 amount)
                const approveData = '0x095ea7b3' +
                    TREASURY_ADDRESS.slice(2).padStart(64, '0') +
                    suiteWei.slice(2).padStart(64, '0');

                await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: fromAddress,
                        to: SUITE_TOKEN_ADDRESS,
                        data: approveData,
                    }],
                });

                // Wait a bit for approval to process
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Second: Call withdraw(uint256 suiteAmount) on Treasury
                // Function selector for withdraw(uint256)
                const withdrawData = '0x2e1a7d4d' + suiteWei.slice(2).padStart(64, '0');

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: fromAddress,
                        to: TREASURY_ADDRESS,
                        data: withdrawData,
                    }],
                });

                // Calculate expected ETH received
                const backingRateText = document.getElementById('backingRate').textContent;
                const backingRate = parseFloat(backingRateText.replace('$', '').replace('/SUITE', '')) || 0;
                const expectedUsd = suiteAmount * backingRate * 0.995;
                const expectedEth = (expectedUsd / ETH_PRICE_USD).toFixed(8);

                showNotification(
                    '?',
                    'Withdrawal Submitted!',
                    `You'll receive ~${expectedEth} ETH (~$${expectedUsd.toFixed(6)}) once confirmed.`,
                    `Tx: ${txHash}`
                );

                // Refresh balances
                setTimeout(() => {
                    checkConnection();
                    fetchTreasuryStats();
                }, 5000);

            } catch (error) {
                console.error('Withdraw error:', error);
                if (error.code === 4001) {
                    showNotification('?', 'Cancelled', 'Transaction was cancelled.');
                } else {
                    showNotification('?', 'Withdrawal Failed', 'Something went wrong.', error.message || '');
                }
            }
        }

        // Wire up buttons
        document.getElementById('depositBtn').addEventListener('click', () => {
            openModal('depositModal');
        });

        document.getElementById('withdrawBtn').addEventListener('click', () => {
            // Get balance from the displayed available balance
            const availableBalanceText = document.getElementById('availableBalance').textContent;
            const availableBalance = parseFloat(availableBalanceText.replace(/,/g, '')) || 0;

            // Get backing rate for USD calculation
            const backingRateText = document.getElementById('backingRate').textContent;
            const backingRate = parseFloat(backingRateText.replace('$', '').replace('/SUITE', '')) || 0;
            const usdValue = (availableBalance * backingRate * 0.995).toFixed(2);

            // Update Cash Out modal with actual balance
            document.getElementById('cashOutBalance').textContent = `${availableBalance.toLocaleString()} SUITE`;
            document.querySelector('#withdrawModal .balance-display-label').textContent = `Available to cash out ? ? $${usdValue}`;
            document.getElementById('withdrawAmount').value = availableBalance;
            document.getElementById('withdrawAmount').max = availableBalance;

            // Update MAX button
            const maxBtn = document.querySelector('#withdrawModal .amount-option');
            if (maxBtn) {
                maxBtn.onclick = () => { document.getElementById('withdrawAmount').value = availableBalance; };
            }

            openModal('withdrawModal');
        });

        document.getElementById('stakeBtn').addEventListener('click', () => {
            showNotification('?', 'Staking Coming Soon', 'Stake your SUITE to earn voting power and unlock charity voting.');
        });

        // ===== ADMIN PANEL FUNCTIONS =====

        // Hardcoded admin addresses (can see admin panel)
        const ADMIN_ADDRESSES = [
            '0x92d67d8ad8b986e78b369be0272e121ae5acad59', // Stuart's primary wallet
            '0xdefc3ae5a990206101463d208e7e1446c58a72bd', // Treasury owner (deployer)
        ];

        async function checkIfOwner(connectedAddress) {
            try {
                const connectedLower = connectedAddress.toLowerCase();

                // Check if in admin list first
                const isAdmin = ADMIN_ADDRESSES.includes(connectedLower);

                // Also check contract owner
                const ownerData = '0x8da5cb5b'; // owner()
                const ownerHex = await window.ethereum.request({
                    method: 'eth_call',
                    params: [{ to: TREASURY_ADDRESS, data: ownerData }, 'latest']
                });

                // Extract address from response (remove 0x and leading zeros)
                const ownerAddress = '0x' + ownerHex.slice(26).toLowerCase();
                const isContractOwner = connectedLower === ownerAddress;

                console.log('Admin check:', { connectedLower, ownerAddress, isAdmin, isContractOwner });

                if (isAdmin || isContractOwner) {
                    document.getElementById('adminPanel').style.display = 'block';
                    updateAdminStats();
                } else {
                    document.getElementById('adminPanel').style.display = 'none';
                }

                return isAdmin || isContractOwner;
            } catch (error) {
                console.log('Could not check owner:', error);
                return false;
            }
        }

        async function updateAdminStats() {
            try {
                // Get treasury ETH balance
                const treasuryBalanceHex = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [TREASURY_ADDRESS, 'latest']
                });
                const treasuryEth = parseInt(treasuryBalanceHex, 16) / 1e18;
                const treasuryUsd = treasuryEth * ETH_PRICE_USD;

                // Get actual accumulatedFees from contract
                const feesData = '0x79ddb121'; // accumulatedFees()
                const feesHex = await window.ethereum.request({
                    method: 'eth_call',
                    params: [{ to: TREASURY_ADDRESS, data: feesData }, 'latest']
                });
                const accumulatedFeesWei = feesHex && feesHex !== '0x' ? parseInt(feesHex, 16) : 0;
                const accumulatedFeesEth = accumulatedFeesWei / 1e18;
                const accumulatedFeesUsd = accumulatedFeesEth * ETH_PRICE_USD;

                document.getElementById('adminTreasuryEth').textContent = treasuryEth.toFixed(10) + ' ETH';
                document.getElementById('accumulatedFees').textContent = '$' + accumulatedFeesUsd.toFixed(6);

                // Enable/disable withdraw button based on minimum threshold (0.001 ETH)
                const withdrawBtn = document.getElementById('withdrawFeesBtn');
                const withdrawHelper = document.getElementById('withdrawFeesHelper');
                const MIN_WITHDRAW_ETH = 0.001;

                if (accumulatedFeesEth >= MIN_WITHDRAW_ETH) {
                    withdrawBtn.disabled = false;
                    withdrawHelper.textContent = `${accumulatedFeesEth.toFixed(6)} ETH available to withdraw`;
                    withdrawHelper.style.color = '#2ecc71';
                } else {
                    withdrawBtn.disabled = true;
                    withdrawHelper.textContent = `Minimum ${MIN_WITHDRAW_ETH} ETH in fees required (current: ${accumulatedFeesEth.toFixed(6)} ETH)`;
                    withdrawHelper.style.color = '#888';
                }
            } catch (error) {
                console.log('Could not update admin stats:', error);
            }
        }

        async function withdrawFees() {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) return;

                showNotification('?', 'Processing', 'Please confirm in MetaMask...');

                // withdrawFees(address to) function selector: 0x476343ee + address
                // Send fees to the caller's address
                const withdrawFeesData = '0x476343ee' + accounts[0].slice(2).padStart(64, '0');

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: accounts[0],
                        to: TREASURY_ADDRESS,
                        data: withdrawFeesData,
                    }],
                });

                showNotification('?', 'Fees Withdrawn!', 'Transaction submitted.', `Tx: ${txHash}`);
                setTimeout(updateAdminStats, 5000);
            } catch (error) {
                if (error.code === 4001) {
                    showNotification('?', 'Cancelled', 'Transaction cancelled.');
                } else {
                    showNotification('?', 'Error', error.message || 'Failed to withdraw fees.');
                }
            }
        }

        // Community Arbitrage execution
        async function executeArb() {
            const btn = document.getElementById('executeArbBtn');
            const originalText = btn.innerHTML;

            try {
                // Update button to loading state
                btn.disabled = true;
                btn.innerHTML = '<span style="font-size: 1.2rem;">?</span> Executing...';
                btn.style.opacity = '0.7';

                // Mock execution - in production this would:
                // 1. Mint SUITE from Treasury at floor price
                // 2. Sell on DEX at market price
                // 3. Split profit 50/50 (user/treasury)

                await new Promise(resolve => setTimeout(resolve, 2000));

                // Show success
                showNotification('??', 'Arb Executed!', 'You earned +120 SUITE! Treasury received +120 SUITE.');

                // Update button to success
                btn.innerHTML = '<span style="font-size: 1.2rem;">?</span> Success! +120 SUITE';
                btn.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';

                // Reset after 3 seconds
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    btn.style.opacity = '1';
                }, 3000);

            } catch (error) {
                showNotification('?', 'Failed', error.message || 'Could not execute arb.');
                btn.disabled = false;
                btn.innerHTML = originalText;
                btn.style.opacity = '1';
            }
        }

        // Note: emergencyWithdraw removed - not supported in TreasuryV4

        async function transferOwnership() {
            const newOwner = document.getElementById('newOwnerAddress').value.trim();

            if (!newOwner || !newOwner.startsWith('0x') || newOwner.length !== 42) {
                showNotification('??', 'Invalid Address', 'Please enter a valid Ethereum address.');
                return;
            }

            if (!confirm(`Transfer ownership to:\n${newOwner}\n\nYou will lose admin access. Continue?`)) {
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) return;

                showNotification('?', 'Processing', 'Please confirm in MetaMask...');

                // transferOwnership(address) function selector + encoded address
                const transferData = '0xf2fde38b' + newOwner.slice(2).padStart(64, '0');

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: accounts[0],
                        to: TREASURY_ADDRESS,
                        data: transferData,
                    }],
                });

                showNotification('?', 'Ownership Transferred', `New owner: ${newOwner.slice(0, 10)}...`, `Tx: ${txHash}`);
                document.getElementById('adminPanel').style.display = 'none';
            } catch (error) {
                if (error.code === 4001) {
                    showNotification('?', 'Cancelled', 'Transaction cancelled.');
                } else {
                    showNotification('?', 'Error', error.message || 'Failed to transfer ownership.');
                }
            }
        }

        // Fetch treasury stats and check connection on page load
        if (window.ethereum) {
            fetchTreasuryStats();
            checkConnection(); // Auto-connect if already authorized
            // Refresh every 30 seconds
            setInterval(fetchTreasuryStats, 30000);
        }

        // Fetch ad revenue stats from Supabase
        async function fetchAdRevenueStats() {
            const SUPABASE_URL = 'https://rdsmdywbdiskxknluiym.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkc21keXdiZGlza3hrbmx1aXltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODk3MTgsImV4cCI6MjA4MzM2NTcxOH0.rTqKxT2LYhPt5nQEjLxMxdRDqvVoT7eILWHhBo1MVHU';

            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ad_events?created_at=gte.${today}T00:00:00&event_type=eq.credited&select=error_message,suite_amount`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                const events = await response.json();

                if (!Array.isArray(events)) return;

                // Calculate stats
                const totalSuite = events.length * 2; // 2 SUITE per ad
                const verified = events.filter(e => e.error_message?.includes('verified:true')).length;
                const verifiedPercent = events.length > 0 ? Math.round((verified / events.length) * 100) : 0;
                const estimatedRevenue = events.length * 0.002; // ~$0.002 per ad

                // Update UI
                const adRevenueEl = document.getElementById('adRevenueToday');
                const suiteIssuedEl = document.getElementById('suiteIssuedAds');
                const verifiedEl = document.getElementById('verifiedAdsPercent');

                if (adRevenueEl) adRevenueEl.textContent = '$' + estimatedRevenue.toFixed(2);
                if (suiteIssuedEl) suiteIssuedEl.textContent = totalSuite;
                if (verifiedEl) {
                    verifiedEl.textContent = verifiedPercent + '%';
                    // Color based on percentage
                    if (verifiedPercent >= 80) verifiedEl.style.color = '#22c55e';
                    else if (verifiedPercent >= 50) verifiedEl.style.color = '#f59e0b';
                    else verifiedEl.style.color = '#ef4444';
                }
            } catch (error) {
                console.log('Could not fetch ad stats:', error);
            }
        }

        // Load ad stats on page load
        fetchAdRevenueStats();
        setInterval(fetchAdRevenueStats, 60000); // Refresh every minute

        // ============================================
        // BOOST NFT SYSTEM
        // ============================================

        const SUITE_BOOSTS_ADDRESS = null; // TODO: Set after deployment
        const SUITE_BOOSTS_ABI = [
            "function balanceOf(address account, uint256 id) view returns (uint256)",
            "function getAllBoostBalances(address account) view returns (uint256[5])",
            "function redeem(uint256 boostType, uint256 amount)"
        ];

        const BOOST_TYPES = {
            1: { name: 'Priority Queue', icon: '?', dbType: 'priority-queue' },
            2: { name: 'AI Pack', icon: '??', dbType: 'ai-pack' },
            3: { name: 'App Slot', icon: '??', dbType: 'app-slot' },
            4: { name: 'Featured Week', icon: '?', dbType: 'featured-week' },
            5: { name: '2x Earn', icon: '2??', dbType: '2x-earn' }
        };

        // Load database boosts (from Discord/Supabase)
        async function loadDatabaseBoosts() {
            const container = document.getElementById('databaseBoostsContent');
            if (!container) return;

            // Check for Discord user in localStorage
            const savedUser = localStorage.getItem('suiteUser');
            if (!savedUser) {
                container.innerHTML = '<span style="color: var(--text-tertiary); font-size: 0.9rem;">Connect Discord on <a href="earn.html" style="color: var(--accent-orange);">Earn page</a> to view boosts</span>';
                return;
            }

            const user = JSON.parse(savedUser);

            try {
                const SUPABASE_URL = 'https://rdsmdywbdiskxknluiym.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkc21keXdiZGlza3hrbmx1aXltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODk3MTgsImV4cCI6MjA4MzM2NTcxOH0.rTqKxT2LYhPt5nQEjLxMxdRDqvVoT7eILWHhBo1MVHU';

                const response = await fetch(`${SUPABASE_URL}/rest/v1/user_boosts?discord_id=eq.${user.id}&status=eq.active&select=*`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });

                const boosts = await response.json();

                if (!Array.isArray(boosts) || boosts.length === 0) {
                    container.innerHTML = '<span style="color: var(--text-tertiary); font-size: 0.9rem;">No account boosts. <a href="boost.html" style="color: var(--accent-orange);">Buy some ?</a></span>';
                    return;
                }

                container.innerHTML = boosts.map(boost => {
                    const boostInfo = Object.values(BOOST_TYPES).find(b => b.dbType === boost.boost_type) || { name: boost.boost_type, icon: '??' };
                    return `
                        <div class="boost-item">
                            <span class="boost-item-icon">${boostInfo.icon}</span>
                            <div class="boost-item-info">
                                <div class="boost-item-name">${boostInfo.name}</div>
                                <div class="boost-item-status">Active ? ${boost.status}</div>
                            </div>
                            <button class="boost-item-btn mint" onclick="mintBoostAsNFT('${boost.id}')" ${!walletAddress ? 'disabled title="Connect wallet first"' : ''}>
                                Mint NFT
                            </button>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading database boosts:', error);
                container.innerHTML = '<span style="color: #ef4444; font-size: 0.9rem;">Error loading boosts</span>';
            }
        }

        // Load NFT boosts (from wallet)
        async function loadNFTBoosts() {
            const container = document.getElementById('nftBoostsContent');
            if (!container) return;

            if (!walletAddress || !SUITE_BOOSTS_ADDRESS) {
                container.innerHTML = '<span style="color: var(--text-tertiary); font-size: 0.9rem;">' +
                    (!walletAddress ? 'Connect wallet to view NFT boosts' : 'NFT contract not deployed yet') + '</span>';
                return;
            }

            try {
                const boostsContract = new ethers.Contract(SUITE_BOOSTS_ADDRESS, SUITE_BOOSTS_ABI, provider);
                const balances = await boostsContract.getAllBoostBalances(walletAddress);

                let html = '';
                for (let i = 0; i < 5; i++) {
                    const count = Number(balances[i]);
                    if (count > 0) {
                        const boostType = BOOST_TYPES[i + 1];
                        html += `
                            <div class="boost-item">
                                <span class="boost-item-icon">${boostType.icon}</span>
                                <div class="boost-item-info">
                                    <div class="boost-item-name">${boostType.name}</div>
                                    <div class="boost-item-status">NFT ? ${count}x owned</div>
                                </div>
                                <button class="boost-item-btn redeem" onclick="redeemNFTBoost(${i + 1})">
                                    Redeem
                                </button>
                            </div>
                        `;
                    }
                }

                container.innerHTML = html || '<span style="color: var(--text-tertiary); font-size: 0.9rem;">No NFT boosts. Mint from account boosts above.</span>';

            } catch (error) {
                console.error('Error loading NFT boosts:', error);
                container.innerHTML = '<span style="color: var(--text-tertiary); font-size: 0.9rem;">NFT contract not deployed yet</span>';
            }
        }

        // Mint a database boost as NFT
        async function mintBoostAsNFT(boostId) {
            if (!walletAddress) {
                alert('Please connect your wallet first');
                return;
            }

            try {
                const btn = event.target;
                btn.disabled = true;
                btn.textContent = 'Minting...';

                // Call backend to mint (backend handles state machine + on-chain minting)
                const response = await fetch('/api/boost-mint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        boost_id: boostId,
                        wallet_address: walletAddress
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('? Boost minted as NFT! Check your wallet.');
                    await loadDatabaseBoosts();
                    await loadNFTBoosts();
                } else {
                    throw new Error(result.error || 'Minting failed');
                }

            } catch (error) {
                console.error('Mint error:', error);
                alert('Error: ' + error.message);
            }
        }

        // Redeem an NFT boost back to database
        async function redeemNFTBoost(boostType) {
            if (!walletAddress || !signer) {
                alert('Please connect your wallet first');
                return;
            }

            try {
                const boostsContract = new ethers.Contract(SUITE_BOOSTS_ADDRESS, SUITE_BOOSTS_ABI, signer);

                // User burns the NFT
                const tx = await boostsContract.redeem(boostType, 1);
                alert('Transaction submitted. Please wait...');
                await tx.wait();

                // Tell backend to credit the database boost
                const savedUser = localStorage.getItem('suiteUser');
                if (savedUser) {
                    const user = JSON.parse(savedUser);
                    await fetch('/api/boost-redeem', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            discord_id: user.id,
                            boost_type: boostType,
                            tx_hash: tx.hash
                        })
                    });
                }

                alert('? Boost redeemed to your account!');
                await loadDatabaseBoosts();
                await loadNFTBoosts();

            } catch (error) {
                console.error('Redeem error:', error);
                alert('Error: ' + error.message);
            }
        }

        // Load boosts when wallet connects or page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadDatabaseBoosts();
            loadNFTBoosts();
        });

        // Refresh boosts when wallet connects
        const originalUpdateUI = typeof updateUI === 'function' ? updateUI : null;
        if (originalUpdateUI) {
            window.updateUI = async function () {
                await originalUpdateUI.apply(this, arguments);
                await loadDatabaseBoosts();
                await loadNFTBoosts();
            };
        }

        // ========== DISCORD BRIDGE FUNCTIONS ==========

        const BRIDGE_ADDRESS = '0x0000000000000000000000000000000000000000'; // TODO: Deploy and update
        const DISCORD_CLIENT_ID = '1457474266390986865';
        const BRIDGE_REDIRECT_URI = window.location.origin + '/wallet.html';

        const BRIDGE_ABI = [
            "function deposit(string calldata discordId, uint256 amount) external",
            "function bridgeBalance() view returns (uint256)"
        ];

        // ERC20_ABI already declared above - reuse it for bridge

        // Check Discord connection for bridge on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkBridgeDiscordConnection();
            loadBridgeBalances();
        });

        function checkBridgeDiscordConnection() {
            const savedUser = localStorage.getItem('suiteUser');
            const statusEl = document.getElementById('bridgeDiscordStatus');
            const connectBtn = document.getElementById('bridgeConnectDiscord');
            const userEl = document.getElementById('bridgeDiscordUser');

            if (savedUser) {
                const user = JSON.parse(savedUser);
                if (statusEl) statusEl.style.display = 'block';
                if (userEl) userEl.textContent = `? Connected as ${user.username}`;
                if (connectBtn) connectBtn.style.display = 'none';
            } else {
                if (statusEl) statusEl.style.display = 'none';
                if (connectBtn) connectBtn.style.display = 'flex';
            }
        }

        function connectDiscordForBridge() {
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(BRIDGE_REDIRECT_URI)}&response_type=token&scope=identify`;
            window.location.href = authUrl;
        }

        async function loadBridgeBalances() {
            // Load wallet SUITE balance (will be updated when wallet connects)
            const walletBalanceEl = document.getElementById('bridgeWalletBalance');
            const discordBalanceEl = document.getElementById('bridgeDiscordBalance');

            // Wallet balance (from existing availableBalance element)
            const availableBal = document.getElementById('availableBalance');
            if (availableBal && walletBalanceEl) {
                walletBalanceEl.textContent = availableBal.textContent || '0';
            }

            // Discord balance from Supabase
            const savedUser = localStorage.getItem('suiteUser');
            if (savedUser && discordBalanceEl) {
                const user = JSON.parse(savedUser);
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/user_balances?discord_id=eq.${user.id}&select=balance`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    });
                    const data = await response.json();
                    if (data && data[0]) {
                        discordBalanceEl.textContent = Number(data[0].balance).toLocaleString();
                    }
                } catch (error) {
                    console.error('Error loading Discord balance:', error);
                }
            }
        }

        async function depositToDiscord() {
            const amountInput = document.getElementById('bridgeAmount');
            const amount = amountInput?.value;

            if (!amount || amount <= 0) {
                alert('Please enter an amount');
                return;
            }

            // Check Discord connection
            const savedUser = localStorage.getItem('suiteUser');
            if (!savedUser) {
                alert('Please connect Discord first');
                return;
            }
            const user = JSON.parse(savedUser);

            // Check wallet connection
            if (!window.ethereum) {
                alert('Please install MetaMask');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) {
                    alert('Please connect your wallet first');
                    return;
                }

                const provider = new ethers.BrowserProvider(window.ethereum);
                const signer = await provider.getSigner();
                const amountWei = ethers.parseEther(amount.toString());

                // Get SUITE token address from treasury
                const suiteToken = new ethers.Contract(SUITE_TOKEN_ADDRESS, ERC20_ABI, signer);

                // Check allowance
                const allowance = await suiteToken.allowance(accounts[0], BRIDGE_ADDRESS);
                if (allowance < amountWei) {
                    showNotification('?', 'Approving', 'Please approve SUITE spending...');
                    const approveTx = await suiteToken.approve(BRIDGE_ADDRESS, ethers.MaxUint256);
                    await approveTx.wait();
                }

                // Deposit to bridge
                showNotification('?', 'Depositing', 'Please confirm the deposit...');
                const bridgeContract = new ethers.Contract(BRIDGE_ADDRESS, BRIDGE_ABI, signer);
                const depositTx = await bridgeContract.deposit(user.id, amountWei);
                await depositTx.wait();

                showNotification('?', 'Success!', `Deposited ${amount} SUITE to Discord. It will appear in your balance shortly.`);
                amountInput.value = '';

                // Reload balances after a short delay
                setTimeout(loadBridgeBalances, 5000);

            } catch (error) {
                console.error('Deposit error:', error);
                if (error.code === 4001) {
                    showNotification('?', 'Cancelled', 'Transaction cancelled');
                } else {
                    showNotification('?', 'Error', error.message || 'Deposit failed');
                }
            }
        }

        // Handle OAuth callback for bridge
        (function handleBridgeOAuth() {
            const hash = window.location.hash.substring(1);
            if (!hash) return;

            const params = new URLSearchParams(hash);
            const accessToken = params.get('access_token');

            if (accessToken) {
                fetch('https://discord.com/api/users/@me', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                })
                    .then(res => res.json())
                    .then(user => {
                        const userData = {
                            id: user.id,
                            username: user.username,
                            avatar: user.avatar
                                ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
                                : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`
                        };
                        localStorage.setItem('suiteUser', JSON.stringify(userData));
                        window.history.replaceState(null, '', window.location.pathname);
                        checkBridgeDiscordConnection();
                        loadBridgeBalances();
                    });
            }
        })();

        // Tab Switching Logic
        window.switchTab = function (tabId) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(el => {
                el.style.display = 'none';
                el.classList.remove('active');
            });

            // Show target content
            const target = document.getElementById('tab-' + tabId);
            if (target) {
                target.style.display = 'block';
                setTimeout(() => target.classList.add('active'), 10);
            }

            // Update tabs
            document.querySelectorAll('.wallet-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('onclick')?.includes(`'${tabId}'`)) {
                    tab.classList.add('active');
                }
            });
        };

        window.openLockModal = function () {
            alert("? Staking for Reputation is coming soon!");
        };
    </script>

    <!-- Stu Helper Widget -->
    <link rel="stylesheet" href="stu-helper.css">
    <script src="stu-helper.js"></script>
    <script>
        // ========== USER CREDITS SYSTEM ==========
        async function loadUserCredits() {
            const currentUser = JSON.parse(localStorage.getItem('suiteDev') || 'null');
            if (!currentUser || !currentUser.id) return;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/user_credits?discord_id=eq.${currentUser.id}&select=*`,
                    { headers: { 'apikey': SUPABASE_ANON_KEY } }
                );
                const data = await response.json();

                if (data && data.length > 0) {
                    const credits = parseFloat(data[0].credits) || 0;
                    const creditsEl = document.getElementById('userCredits');
                    if (creditsEl && credits > 0) {
                        creditsEl.innerHTML = `${credits.toFixed(0)} <button onclick="claimCredits(${credits})" style="background: linear-gradient(135deg, #22c55e, #10b981); color: white; border: none; padding: 4px 12px; border-radius: 100px; font-size: 0.7rem; font-weight: 700; cursor: pointer; margin-left: 8px;">Claim</button>`;
                    } else if (creditsEl) {
                        creditsEl.textContent = '0';
                    }
                }
            } catch (err) {
                console.error('Error loading credits:', err);
            }
        }

        async function claimCredits(amount) {
            if (!amount || amount <= 0) { alert('No credits to claim!'); return; }
            const currentUser = JSON.parse(localStorage.getItem('suiteDev') || 'null');
            if (!currentUser) { alert('Please log in via Discord first.'); return; }
            if (!userAddress) { alert('Please connect your wallet first.'); return; }

            if (!confirm(`Claim ${amount} credits?\n\nWill send ${amount} SUITE to ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`)) return;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/claim_credits`, {
                    method: 'POST',
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ p_discord_id: currentUser.id, p_amount: amount })
                });
                const success = await response.json();
                if (!success) { alert('Failed - insufficient balance.'); return; }

                alert(`Claimed ${amount} credits! SUITE transfer pending Treasury integration.`);
                loadUserCredits();
            } catch (err) {
                alert('Error claiming credits.');
            }
        }

        document.addEventListener('DOMContentLoaded', loadUserCredits);
        window.loadUserCredits = loadUserCredits;

        // ========== DISCORD LOGIN ==========
        function loginWithDiscord() {
            // Discord OAuth2 URL - using the same flow as developer portal
            const DISCORD_CLIENT_ID = '1311757088540311633'; // Your Discord App Client ID
            const REDIRECT_URI = encodeURIComponent(window.location.origin + '/oauth-callback.html');
            const SCOPE = encodeURIComponent('identify email');

            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=code&scope=${SCOPE}`;

            // Open Discord auth in a popup
            const popup = window.open(authUrl, 'Discord Login', 'width=500,height=700');

            // Listen for the callback
            window.addEventListener('message', function handleAuthMessage(event) {
                if (event.origin !== window.location.origin) return;
                if (event.data && event.data.type === 'discord-auth-success') {
                    const user = event.data.user;
                    localStorage.setItem('suiteDev', JSON.stringify(user));
                    updateAuthUI(user);
                    popup.close();
                    window.removeEventListener('message', handleAuthMessage);
                }
            });
        }

        function updateAuthUI(user) {
            const discordBtn = document.getElementById('discordLoginBtn');
            if (discordBtn && user) {
                discordBtn.innerHTML = `<img src="${user.avatar ? 'https://cdn.discordapp.com/avatars/' + user.id + '/' + user.avatar + '.png' : 'https://cdn.discordapp.com/embed/avatars/0.png'}" style="width: 24px; height: 24px; border-radius: 50%;"> ${user.username}`;
                discordBtn.onclick = () => {
                    if (confirm('Log out of Discord?')) {
                        localStorage.removeItem('suiteDev');
                        location.reload();
                    }
                };
            }
        }

        // Check if already logged in on page load
        document.addEventListener('DOMContentLoaded', function () {
            const currentUser = JSON.parse(localStorage.getItem('suiteDev') || 'null');
            if (currentUser) {
                updateAuthUI(currentUser);
            }
        });

        // ========== WALLET CONNECTION ==========
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('Please install MetaMask or another Web3 wallet to connect.');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const address = accounts[0];

                // Store connected wallet
                localStorage.setItem('suiteWallet', address);

                // Update UI
                const walletBtn = document.getElementById('connectWalletBtn');
                if (walletBtn) {
                    walletBtn.innerHTML = `‚úÖ ${address.slice(0, 6)}...${address.slice(-4)}`;
                    walletBtn.onclick = disconnectWallet;
                }

                // Update global wallet address if it exists
                if (typeof userAddress !== 'undefined') {
                    window.userAddress = address;
                }

                console.log('Connected wallet:', address);
            } catch (error) {
                console.error('Wallet connection failed:', error);
                alert('Failed to connect wallet. Please try again.');
            }
        }

        function disconnectWallet() {
            localStorage.removeItem('suiteWallet');
            const walletBtn = document.getElementById('connectWalletBtn');
            if (walletBtn) {
                walletBtn.innerHTML = 'üîó Connect Wallet';
                walletBtn.onclick = connectWallet;
            }
        }

        // Toggle tooltip visibility and position near the clicked button
        function toggleTooltip(tooltipId, event) {
            event.stopPropagation();
            const tooltip = document.getElementById(tooltipId);
            const button = event.target.closest('button');

            if (tooltip && button) {
                const isVisible = tooltip.style.display === 'block';

                // Hide all tooltips first
                document.querySelectorAll('#howItWorksTooltip, #arbTooltip').forEach(t => {
                    t.style.display = 'none';
                });

                if (!isVisible) {
                    // Position tooltip near the button
                    const rect = button.getBoundingClientRect();
                    tooltip.style.left = (rect.left + window.scrollX - 10) + 'px';
                    tooltip.style.top = (rect.bottom + window.scrollY + 8) + 'px';
                    tooltip.style.display = 'block';
                }
            }
        }

        // Close tooltips when clicking outside
        document.addEventListener('click', function (e) {
            const tooltips = document.querySelectorAll('#howItWorksTooltip, #arbTooltip');
            const isInfoButton = e.target.closest('button[onclick*="toggleTooltip"]');

            if (!isInfoButton) {
                tooltips.forEach(tooltip => {
                    if (!tooltip.contains(e.target)) {
                        tooltip.style.display = 'none';
                    }
                });
            }
        });

        // Restore wallet connection on page load
        document.addEventListener('DOMContentLoaded', function () {
            const savedWallet = localStorage.getItem('suiteWallet');
            if (savedWallet) {
                const walletBtn = document.getElementById('connectWalletBtn');
                if (walletBtn) {
                    walletBtn.innerHTML = `‚úÖ ${savedWallet.slice(0, 6)}...${savedWallet.slice(-4)}`;
                    walletBtn.onclick = disconnectWallet;
                }
            }
        });
    </script>
</body>

</html>