<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SUITE Shell</title>
    <link rel="icon" type="image/png" href="/assets/suite-logo-new.png">
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a1a">
    <link rel="apple-touch-icon" href="/assets/suite-logo-new.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/nav.css">
    <!-- Ethers.js for wallet interactions -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.umd.min.js"></script>
    <!-- QRCode.js for deposit address QR -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* Dark theme override for nav on this page */
        .nav-inner {
            background: rgba(26, 26, 46, 0.95) !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-logo {
            color: #ffffff !important;
        }
        .nav-links a {
            color: #9ca3af !important;
        }
        .nav-links a:hover,
        .nav-links a.active {
            color: #ffffff !important;
        }
        .mobile-menu-btn span {
            background: #ffffff !important;
        }
        .connect-btn {
            background: linear-gradient(135deg, #ff9500, #ff6b9d) !important;
        }

        /* Global reset - same as homepage.css */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #1a1a2e;
            --accent-orange: #ff9500;
            --accent-green: #4ade80;
            --accent-purple: #a855f7;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 70px;
            position: relative;
        }

        /* Faint grid overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
        }

        /* Animated glow pulses */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse 600px 400px at 20% 30%, rgba(168, 85, 247, 0.08) 0%, transparent 70%),
                radial-gradient(ellipse 500px 350px at 80% 70%, rgba(249, 115, 22, 0.06) 0%, transparent 70%),
                radial-gradient(ellipse 400px 300px at 60% 20%, rgba(34, 197, 94, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
            animation: glowPulse 8s ease-in-out infinite alternate;
        }

        @keyframes glowPulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* Learn More dropdown animation */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #learnMoreContent.showing {
            animation: slideDown 0.3s ease-out forwards;
        }

        /* Ensure content is above the overlays */
        .shell-header, .main-content, .bottom-nav, .apps-grid-container, .modal-overlay {
            position: relative;
            z-index: 1;
        }

        /* Shell Header */
        .shell-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-card);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            flex-shrink: 0;
        }

        .shell-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shell-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--accent-orange);
            text-decoration: none;
            cursor: pointer;
        }

        .shell-logo img {
            width: 28px;
            height: 28px;
            border-radius: 6px;
        }

        .shell-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .credits-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 149, 0, 0.15);
            border: 1px solid rgba(255, 149, 0, 0.3);
            padding: 8px 14px;
            border-radius: 100px;
            color: var(--accent-orange);
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .credits-btn:hover {
            background: rgba(255, 149, 0, 0.25);
            transform: translateY(-1px);
        }

        .credits-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Credits button in main nav (light background) */
        .nav-actions .credits-btn {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            border: none;
            color: white;
            font-size: 0.85rem;
            padding: 8px 14px;
        }

        .nav-actions .credits-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
        }

        .nav-actions .credits-btn svg {
            fill: white;
        }

        /* Connect Button (not logged in) */
        .connect-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #818cf8, #6366f1);
            border: none;
            border-radius: 100px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(129, 140, 248, 0.4);
        }

        .connect-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Auth Display (logged in) */
        .auth-display {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auth-credits {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #ff9500, #f97316);
            border-radius: 100px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
        }

        .auth-credits:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
        }

        .auth-credits svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        .auth-identity {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 100px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auth-identity:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .auth-identity.telegram {
            color: #29b6f6;
        }

        .auth-identity.wallet {
            color: #a78bfa;
        }

        /* Link wallet prompt */
        .link-wallet-hint {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            margin-left: 4px;
        }

        /* Connect Modal */
        .connect-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .connect-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .connect-modal {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 28px;
            width: 90%;
            max-width: 380px;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .connect-modal-overlay.active .connect-modal {
            transform: scale(1);
        }

        .connect-modal h3 {
            margin: 0 0 8px;
            font-size: 1.2rem;
            color: var(--text-primary);
            text-align: center;
        }

        .connect-modal-subtitle {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .connect-option {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .connect-option:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .connect-option-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .connect-option-icon.wallet {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        }

        .connect-option-icon.telegram {
            background: linear-gradient(135deg, #29b6f6, #0288d1);
        }

        .connect-option-text {
            flex: 1;
        }

        .connect-option-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .connect-option-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .connect-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
            color: var(--text-tertiary);
            font-size: 0.75rem;
        }

        .connect-divider::before,
        .connect-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .connect-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        /* User info display */
        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .user-badge img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        /* ===== TOP NAV BAR (App Open State) ===== */
        .top-nav {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            overflow-x: auto;
            background: var(--bg-card);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            scrollbar-width: none;
            flex-shrink: 0;
        }

        .top-nav::-webkit-scrollbar {
            display: none;
        }

        .top-nav.active {
            display: flex;
        }

        .nav-app, .nav-home {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.08);
            font-size: 1.4rem;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-home {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
            margin-right: 4px;
        }

        .nav-home:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .nav-app.active {
            border-color: var(--accent-orange);
            background: rgba(255, 149, 0, 0.2);
            transform: scale(1.05);
        }

        .nav-app:hover:not(.active) {
            background: rgba(255, 255, 255, 0.12);
        }

        .nav-app .app-icon-img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .nav-divider {
            width: 1px;
            height: 32px;
            background: rgba(255, 255, 255, 0.15);
            flex-shrink: 0;
            margin: 0 4px;
        }

        #navApps {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* ===== APPS GRID (Home State) ===== */
        .apps-grid-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Shell main content area padding */
        .shell-main {
            padding: 24px;
        }

        .apps-grid-header {
            text-align: center;
            margin-bottom: 24px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .apps-grid-header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .apps-grid-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-width: 100%;
            margin: 0 0 40px;
        }

        @media (max-width: 768px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Filter & Sort Bar */
        .apps-filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 700px;
            margin: 0 auto 20px;
            padding: 0 8px;
            gap: 12px;
        }

        .filter-types {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }

        .filter-btn.active {
            background: #f97316;
            border-color: #f97316;
            color: #000;
        }

        .sort-options select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .sort-options select:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Featured Apps Section */
        .featured-apps-section {
            max-width: 700px;
            margin: 0 auto 24px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(168, 85, 247, 0.05) 100%);
            border-radius: 16px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .featured-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .featured-badge {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .featured-title {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text);
        }

        .featured-apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        /* Tabs Navigation */
        .apps-tabs {
            display: inline-flex;
            justify-content: center;
            gap: 4px;
            margin: 24px auto;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 100px;
            width: fit-content;
        }

        .apps-tab {
            flex: 0 0 auto;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 700;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }

        .apps-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .apps-tab.active {
            background: linear-gradient(135deg, var(--accent-orange), #f97316);
            color: white;
        }

        .apps-tab-icon {
            font-size: 0.9rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 149, 0, 0.3);
        }

        .leaderboard-rank {
            font-size: 1.5rem;
            font-weight: 900;
            min-width: 40px;
            text-align: center;
        }

        .leaderboard-rank.gold { color: #fbbf24; }
        .leaderboard-rank.silver { color: #9ca3af; }
        .leaderboard-rank.bronze { color: #cd7c32; }

        .leaderboard-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-purple));
        }

        .leaderboard-icon img {
            width: 100%;
            height: 100%;
            border-radius: 14px;
            object-fit: cover;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .leaderboard-tagline {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .leaderboard-stats {
            text-align: right;
        }

        .leaderboard-revenue {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--accent-green);
        }

        .leaderboard-funders {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .leaderboard-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .leaderboard-empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        /* Ideas Kanban Styles */
        .ideas-container {
            padding: 12px;
            display: flex;
            justify-content: center;
            margin-bottom: 100px;
        }

        .ideas-kanban {
            display: flex;
            gap: 12px;
        }

        .ideas-column {
            flex: 0 0 200px;
            min-width: 200px;
            max-height: 500px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
        }

        .ideas-column-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .ideas-column-content::-webkit-scrollbar {
            width: 4px;
        }

        .ideas-column-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .ideas-column-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .ideas-column-header {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .ideas-column-header .count {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 100px;
            font-size: 0.7rem;
        }

        .idea-card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .idea-card.building {
            border-left: 3px solid #ff9500;
        }

        .idea-card.live {
            border-left: 3px solid #22c55e;
        }

        .idea-card.rejected {
            opacity: 0.5;
        }

        .idea-card.considering {
            border-left: 3px solid #818cf8;
        }

        .idea-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .idea-tagline {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .idea-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 0.65rem;
            color: var(--text-tertiary);
        }

        .idea-reason {
            font-size: 0.7rem;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 6px 8px;
            border-radius: 4px;
            margin-top: 6px;
        }

        .idea-link {
            display: inline-block;
            margin-top: 6px;
            padding: 4px 8px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-decoration: none;
        }

        /* Voting Styles */
        .idea-votes {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .vote-btn {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .vote-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .vote-btn.upvote:hover {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .vote-btn.downvote:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .vote-btn.voted-up {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .vote-btn.voted-down {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .vote-count {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 24px;
            text-align: center;
        }

        .vote-count.positive {
            color: #22c55e;
        }

        .vote-count.negative {
            color: #ef4444;
        }

        /* Admin Controls */
        .admin-controls {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .admin-btn {
            flex: 1;
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.2s ease;
        }

        .admin-btn.reject-quick {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .admin-btn.reject-quick:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .admin-btn.reject-reason {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        .admin-btn.reject-reason:hover {
            background: rgba(251, 191, 36, 0.3);
        }

        /* Reject Reason Modal */
        .reject-reason-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .reject-reason-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .reject-reason-content {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            border: 1px solid var(--border);
        }

        .reject-reason-content h3 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
        }

        .reject-reason-content textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--background);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 16px;
        }

        .reject-reason-buttons {
            display: flex;
            gap: 12px;
        }

        .reject-reason-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .reject-reason-buttons .cancel-btn {
            background: var(--surface-light);
            color: var(--text-secondary);
        }

        .reject-reason-buttons .confirm-btn {
            background: #ef4444;
            color: white;
        }

        /* Add Idea Button */
        .ideas-header {
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
        }

        .add-idea-btn {
            background: linear-gradient(135deg, #818cf8, #6366f1);
            color: white;
            border: none;
            border-radius: 100px;
            padding: 10px 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .add-idea-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(129, 140, 248, 0.3);
        }

        /* Add Idea Modal */
        .idea-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .idea-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .idea-modal {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .idea-modal-overlay.active .idea-modal {
            transform: scale(1);
        }

        .idea-modal h3 {
            margin: 0 0 20px;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .idea-form-group {
            margin-bottom: 16px;
        }

        .idea-form-group label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .idea-form-group input,
        .idea-form-group select,
        .idea-form-group textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 0.85rem;
            box-sizing: border-box;
        }

        .idea-form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .idea-modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .idea-modal-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .idea-cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .idea-submit-btn {
            background: linear-gradient(135deg, #818cf8, #6366f1);
            color: white;
        }

        .idea-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .idea-auth-prompt {
            text-align: center;
            padding: 20px;
        }

        .idea-auth-prompt p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 16px;
        }

        .telegram-login-btn {
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Similarity Warning */
        .similarity-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 16px;
        }

        .similarity-warning-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #ef4444;
            margin-bottom: 10px;
        }

        .similarity-warning-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .rejected-idea-box {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
        }

        .rejected-idea-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .rejected-idea-reason {
            font-size: 0.75rem;
            color: #ef4444;
        }

        .similarity-warning-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .similarity-warning-actions button {
            flex: 1;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .modify-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .submit-anyway-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* ===== SIDEBAR NAVIGATION (App Store Style) ===== */
        .shell-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .shell-sidebar {
            width: 200px;
            min-width: 200px;
            background: var(--bg-card);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            padding: 0 16px;
            margin-bottom: 8px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .sidebar-item.active {
            background: rgba(255, 149, 0, 0.15);
            color: var(--accent-orange);
            font-weight: 600;
        }

        .sidebar-item-icon {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        .shell-main {
            flex: 1;
            overflow-y: auto;
        }

        /* Hide sidebar on mobile, show mobile tabs */
        @media (max-width: 768px) {
            .shell-sidebar {
                display: none;
            }
            .mobile-tabs-wrapper {
                display: block !important;
            }
        }

        /* App Card - Horizontal App Store Style */
        .app-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 14px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .app-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 149, 0, 0.3);
        }

        .app-card:active {
            transform: scale(0.99);
        }

        .app-card .app-icon {
            width: 56px;
            height: 56px;
            min-width: 56px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .app-card .app-icon .app-icon-img {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            object-fit: cover;
        }

        .app-card .app-info {
            flex: 1;
            min-width: 0;
        }

        .app-card .app-name {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .app-card .app-tagline {
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .app-card .view-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: #3b82f6;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .app-card .view-btn:hover {
            background: #3b82f6;
            color: white;
        }

        /* Expanded card section */
        .app-card-expanded {
            display: none;
            width: 100%;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .app-card.expanded .app-card-expanded {
            display: block;
        }

        .app-card.expanded .view-btn {
            background: #3b82f6;
            color: white;
        }

        .expanded-view-options {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .view-option-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-option-btn:hover {
            background: rgba(255, 149, 0, 0.15);
            border-color: rgba(255, 149, 0, 0.3);
        }

        .view-option-btn .option-icon {
            font-size: 1.1rem;
        }

        .expanded-tier-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .tier-badge-small {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .tier-badge-small.seed {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .tier-badge-small.sprout {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .tier-badge-small.growth {
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
        }

        .tier-badge-small.scale {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
        }

        .tier-progress-mini {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .tier-progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .tier-progress-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .tier-progress-text {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Hide old funding elements */
        .app-funding, .funding-bar, .funding-fill, .funding-text, .funding-next, .app-buttons {
            display: none !important;
        }

        .funding-meta {
            display: none;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 6px;
            gap: 8px;
        }

        .funder-count {
            font-size: 0.7rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .app-buttons {
            display: flex;
            width: calc(100% + 26px);
            margin: 12px -13px -1px;
            gap: 1px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 0 0 16px 16px;
            overflow: hidden;
        }

        .open-app-btn {
            flex: 2;
            padding: 14px 12px;
            font-size: 0.85rem;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #22c55e, #10b981);
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .open-app-btn:hover {
            filter: brightness(1.1);
        }

        .fund-btn {
            flex: 1;
            padding: 14px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            background: rgba(45, 27, 78, 0.95);
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fund-btn:hover {
            background: rgba(255, 149, 0, 0.2);
            color: var(--accent-orange);
        }

        /* Mystery/Teaser Card */
        .app-card.mystery-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.4), rgba(30, 20, 50, 0.6));
            border: 2px dashed rgba(168, 85, 247, 0.3);
            cursor: pointer;
            padding: 20px 20px 20px;
            justify-content: flex-start;
        }

        .app-card.mystery-card:hover {
            border-color: rgba(168, 85, 247, 0.6);
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.5), rgba(30, 20, 50, 0.7));
        }

        .mystery-icon {
            font-size: 4rem;
            opacity: 0.5;
            animation: pulse-mystery 2s ease-in-out infinite;
        }

        @keyframes pulse-mystery {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .mystery-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            opacity: 0.8;
            text-align: center;
        }

        .mystery-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 4px;
        }

        .mystery-buttons {
            display: flex;
            width: calc(100% + 40px);
            margin-top: auto;
            margin-left: -20px;
            margin-right: -20px;
            margin-bottom: -20px;
            border-radius: 0 0 14px 14px;
            overflow: hidden;
        }

        .mystery-btn {
            flex: 1;
            padding: 14px 12px;
            font-size: 0.85rem;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #a855f7, #8b5cf6);
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mystery-btn:hover {
            filter: brightness(1.1);
        }

        /* App revenue display */
        .app-revenue {
            font-size: 0.75rem;
            color: var(--accent-green);
            font-weight: 600;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            text-align: center;
        }

        /* Fund Modal Styles */
        /* App View Mode Choice Modal */
        .view-choice-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .view-choice-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .view-choice-modal {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 28px;
            max-width: 380px;
            width: 90%;
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .view-choice-overlay.active .view-choice-modal {
            transform: translateY(0);
        }

        .view-choice-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .view-choice-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .view-choice-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .view-choice-btn {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.03);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .view-choice-btn:hover {
            border-color: var(--accent-orange);
            background: rgba(255, 149, 0, 0.1);
        }

        .view-choice-btn-icon {
            font-size: 2rem;
        }

        .view-choice-btn-text {
            flex: 1;
        }

        .view-choice-btn-title {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .view-choice-btn-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .view-choice-cancel {
            margin-top: 16px;
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .view-choice-cancel:hover {
            color: var(--text-primary);
        }

        .fund-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .fund-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .fund-modal {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            width: 100%;
            max-width: 420px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .fund-modal-overlay.active .fund-modal {
            transform: translateY(0);
        }

        .fund-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fund-modal-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .fund-modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }

        .fund-modal-body {
            padding: 24px;
        }

        .fund-tier-compact {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .fund-tier-left, .fund-tier-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tier-emoji {
            font-size: 1.2rem;
        }

        .tier-name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .tier-name.current {
            color: #22c55e;
        }

        .tier-name.next {
            color: #a855f7;
        }

        .fund-tier-progress-text {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .fund-tier-benefits-compact {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.8rem;
        }

        .fund-tier-benefits-compact .benefits-label {
            color: #a855f7;
            font-weight: 600;
        }

        .fund-tier-benefits-compact .benefits-text {
            color: #e5e7eb;
        }

        .fund-revenue-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            margin-bottom: 12px;
            font-size: 0.85rem;
            color: #22c55e;
        }

        .fund-progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }

        .fund-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-green));
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .fund-option {
            padding: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fund-option:hover {
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.03);
        }

        .fund-option.selected {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.1);
        }

        .fund-option-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .fund-option-icon {
            font-size: 1.5rem;
        }

        .fund-option-title {
            font-weight: 700;
            font-size: 1rem;
        }

        .fund-option-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .fund-option-input {
            margin-top: 12px;
        }

        .fund-option-input input,
        .fund-option-input select {
            width: 100%;
            padding: 12px 16px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: var(--text-primary);
        }

        .fund-option-input input:focus,
        .fund-option-input select:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .fund-warning {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            margin-top: 16px;
            font-size: 0.85rem;
            color: #fca5a5;
        }

        .fund-warning-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .fund-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .fund-cancel-btn {
            flex: 1;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .fund-submit-btn {
            flex: 2;
            padding: 14px;
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-purple));
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fund-submit-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(255, 149, 0, 0.3);
        }

        .fund-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Revenue Streams Section */
        .fund-revenue-streams {
            margin-bottom: 16px;
        }

        .fund-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
        }

        .fund-streams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 8px;
        }

        .fund-stream-card {
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            text-align: center;
        }

        .fund-stream-icon {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }

        .fund-stream-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .fund-stream-desc {
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        /* Financials Section */
        .fund-financials {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .fund-stat {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .fund-stat-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .fund-stat-value.green { color: #22c55e; }
        .fund-stat-value.purple { color: #a855f7; }

        .fund-stat-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* Documentation Links */
        .fund-docs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .fund-doc-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-size: 0.75rem;
            color: #60a5fa;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fund-doc-link:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        /* Collapsible investment details */
        .fund-details-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            margin-bottom: 12px;
        }

        .fund-details-toggle:hover {
            color: var(--text-primary);
        }

        .fund-investment-details {
            display: none;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 16px;
        }

        .fund-investment-details.expanded {
            display: block;
        }

        /* Ecosystem Explainer Section */
        .ecosystem-section {
            max-width: 700px;
            margin: 0 auto 40px;
            padding: 24px;
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.08), rgba(168, 85, 247, 0.08));
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 20px;
        }

        .ecosystem-title {
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 16px;
            text-align: center;
        }

        .ecosystem-steps {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .eco-step {
            text-align: center;
            padding: 12px 8px;
        }

        .eco-step-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .eco-step-num {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: var(--accent-orange);
            color: #0a0a1a;
            font-size: 0.75rem;
            font-weight: 800;
            line-height: 20px;
            border-radius: 50%;
            margin-bottom: 6px;
        }

        .eco-step-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .eco-step-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .ecosystem-goal {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .goal-amount {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-green);
        }

        .goal-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Build Your Own App Section */
        .build-section {
            max-width: 700px;
            margin: 0 auto 40px;
            padding: 28px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            text-align: center;
        }

        .build-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-purple), #ec4899);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 100px;
            margin-bottom: 12px;
        }

        .build-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .build-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .build-features {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .build-feature {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .build-feature-icon {
            color: var(--accent-green);
        }

        .build-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--accent-purple), #ec4899);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 100px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .build-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(168, 85, 247, 0.4);
        }

        .build-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .build-learn-more {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .build-learn-more:hover {
            color: var(--accent-purple);
        }

        /* App Request Modal */
        .app-request-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .app-request-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .app-request-content {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 28px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .app-request-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .app-request-header h2 {
            font-size: 1.4rem;
            margin-bottom: 8px;
        }

        .app-request-header p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .app-request-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group select {
            cursor: pointer;
            color: var(--text-primary);
            background-color: #1a1a2e;
        }

        .form-group select option {
            background-color: #1a1a2e;
            color: var(--text-primary);
        }

        .app-request-buttons {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .app-request-submit {
            flex: 1;
            padding: 14px;
            border-radius: 100px;
            border: none;
            background: linear-gradient(135deg, var(--accent-purple), #ec4899);
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .app-request-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(168, 85, 247, 0.4);
        }

        .app-request-cancel {
            padding: 14px 24px;
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .app-request-cancel:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .complexity-scale {
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }

        .complexity-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .complexity-option input {
            display: none;
        }

        .complexity-box {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }

        .complexity-option:hover .complexity-box {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .complexity-option input:checked + .complexity-box {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
        }

        .complexity-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: center;
        }

        /* Deployment Options */
        .deployment-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .deployment-option {
            cursor: pointer;
        }

        .deployment-option input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .deployment-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: 14px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }

        .deployment-option:hover .deployment-card {
            border-color: rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.08);
        }

        .deployment-option input:checked + .deployment-card {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.15);
        }

        .deployment-icon {
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .deployment-info {
            flex: 1;
        }

        .deployment-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .deployment-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .app-request-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
            padding: 12px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        /* Influencer Section */
        .influencer-section {
            max-width: 700px;
            margin: 0 auto 40px;
            padding: 28px;
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 20px;
            text-align: center;
        }

        .influencer-header {
            margin-bottom: 20px;
        }

        .influencer-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .influencer-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .influencer-subtitle {
            font-size: 0.9rem;
            color: var(--accent-orange);
            font-weight: 600;
        }

        .influencer-explainer {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .influencer-explainer p {
            margin-bottom: 8px;
        }

        .influencer-explainer strong {
            color: var(--text-primary);
        }

        .influencer-cta {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .influencer-email-input {
            padding: 12px 16px;
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 0.9rem;
            width: 250px;
            max-width: 100%;
        }

        .influencer-email-input:focus {
            outline: none;
            border-color: var(--accent-orange);
        }

        .influencer-email-input::placeholder {
            color: var(--text-secondary);
        }

        .influencer-notify-btn {
            background: linear-gradient(135deg, #ff9500, #ff6b9d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 100px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .influencer-notify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 149, 0, 0.4);
        }

        .influencer-note {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* App Development Tiers Section */
        .tiers-section {
            max-width: 1000px;
            margin: 0 auto 40px;
            padding: 28px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.08), rgba(236, 72, 153, 0.05));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 20px;
            text-align: center;
        }

        .tiers-header {
            margin-bottom: 24px;
        }

        .tiers-badge {
            display: inline-block;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 100px;
            margin-bottom: 12px;
        }

        .tiers-title {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .tiers-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .tiers-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .tiers-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 400px) {
            .tiers-grid {
                grid-template-columns: 1fr;
            }
        }

        .tier-card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 12px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .tier-card:hover {
            transform: translateY(-2px);
        }

        .tier-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .tier-name {
            font-size: 1rem;
            font-weight: 800;
            margin-bottom: 2px;
        }

        .tier-range {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .tier-benefits {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: left;
            line-height: 1.6;
        }

        /* Tier-specific colors */
        .tier-seed { border-color: rgba(34, 197, 94, 0.3); }
        .tier-seed:hover { border-color: #22c55e; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.2); }
        .tier-seed .tier-name { color: #22c55e; }

        .tier-sprout { border-color: rgba(74, 222, 128, 0.3); }
        .tier-sprout:hover { border-color: #4ade80; box-shadow: 0 4px 20px rgba(74, 222, 128, 0.2); }
        .tier-sprout .tier-name { color: #4ade80; }

        .tier-growth { border-color: rgba(59, 130, 246, 0.3); }
        .tier-growth:hover { border-color: #3b82f6; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2); }
        .tier-growth .tier-name { color: #3b82f6; }

        .tier-launch { border-color: rgba(168, 85, 247, 0.3); }
        .tier-launch:hover { border-color: #a855f7; box-shadow: 0 4px 20px rgba(168, 85, 247, 0.2); }
        .tier-launch .tier-name { color: #a855f7; }

        .tier-scale { border-color: rgba(255, 149, 0, 0.3); }
        .tier-scale:hover { border-color: #ff9500; box-shadow: 0 4px 20px rgba(255, 149, 0, 0.2); }
        .tier-scale .tier-name { color: #ff9500; }

        .tiers-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 20px;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 12px;
            margin-top: 8px;
        }

        .tiers-footer-icon {
            font-size: 1.5rem;
        }

        .tiers-footer-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: left;
        }

        .tiers-footer-text strong {
            color: #22c55e;
        }

        @media (max-width: 600px) {
            .ecosystem-steps {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Tablet app buttons */
            .app-buttons {
                width: calc(100% + 20px);
                margin: 10px -10px 0;
            }

            .open-app-btn {
                padding: 12px 8px;
                font-size: 0.8rem;
            }

            .fund-btn {
                padding: 12px 8px;
                font-size: 0.75rem;
            }

            .mystery-buttons {
                width: calc(100% + 20px);
                margin-left: -10px;
                margin-right: -10px;
                margin-bottom: -10px;
            }

            .mystery-btn {
                padding: 12px 8px;
                font-size: 0.8rem;
            }

            .app-card.mystery-card {
                padding: 20px 10px 10px;
            }

            .app-card {
                padding: 18px 10px 0;
            }
        }

        /* Old app-icon styles removed - using scoped .app-card .app-icon instead */

        .apps-loading {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px;
        }

        .apps-loading .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255, 149, 0, 0.2);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        /* ===== APP CONTAINER (iframe) ===== */
        .app-container {
            display: none;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .app-container.active {
            display: block;
        }

        .app-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-dark);
            /* Hide scrollbar but allow scrolling */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        .app-iframe::-webkit-scrollbar {
            display: none; /* Chrome/Safari/Opera */
        }

        /* Fullscreen exit button */
        .fullscreen-exit-btn {
            display: none;
            position: fixed;
            top: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1001;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }

        .fullscreen-exit-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Mobile: always fullscreen when app is open */
        @media (max-width: 899px) {
            .app-container.active {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                background: #000;
            }

            .app-container.active .fullscreen-exit-btn {
                display: flex;
            }

            .app-container.active .app-iframe {
                width: 100%;
                height: 100%;
            }
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            z-index: 50;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 149, 0, 0.2);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ===== DESKTOP APP VIEWER (Phone Frame + Side Panel) ===== */
        @media (min-width: 900px) {
            .app-container.active {
                display: flex;
                justify-content: center;
                align-items: flex-start;
                gap: 24px;
                padding: 24px;
                background: linear-gradient(135deg, #0a0a1a 0%, #16213e 100%);
            }

            .app-container.focus-mode {
                gap: 0;
            }
        }

        /* Phone Frame */
        .phone-frame {
            display: none;
        }

        @media (min-width: 900px) {
            .phone-frame {
                display: flex;
                flex-direction: column;
                width: 375px;
                height: calc(100vh - 200px);
                max-height: 750px;
                min-height: 500px;
                background: #000;
                border-radius: 40px;
                padding: 12px;
                box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5),
                            inset 0 0 0 2px #333,
                            inset 0 0 0 4px #1a1a1a;
                flex-shrink: 0;
                position: relative;
                transition: all 0.3s ease;
            }

            .phone-frame::before {
                content: "";
                position: absolute;
                top: 8px;
                left: 50%;
                transform: translateX(-50%);
                width: 80px;
                height: 24px;
                background: #1a1a1a;
                border-radius: 12px;
                z-index: 10;
            }

            .phone-frame .app-iframe {
                flex: 1;
                border-radius: 28px;
                overflow: hidden;
            }

            .app-container.focus-mode .phone-frame {
                width: 420px;
                max-height: 820px;
            }

            /* True Fullscreen Mode */
            .app-container.fullscreen-mode {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                padding: 0;
                z-index: 1000;
                background: #000;
            }

            .app-container.fullscreen-mode .phone-frame {
                display: none;
            }

            .app-container.fullscreen-mode .side-panel {
                display: none;
            }

            .app-container.fullscreen-mode > .app-iframe {
                display: block !important;
                width: 100%;
                height: 100%;
                border-radius: 0;
            }

            .app-container.fullscreen-mode .fullscreen-exit-btn {
                display: flex;
            }

            /* Hide direct iframe, show phone frame instead */
            .app-container.active > .app-iframe {
                display: none;
            }

            .app-container.active > .loading-overlay {
                border-radius: 28px;
                left: 12px;
                right: 12px;
                top: 12px;
                bottom: 12px;
            }
        }

        /* Side Panel */
        .side-panel {
            display: none;
        }

        @media (min-width: 900px) {
            .side-panel {
                display: flex;
                flex-direction: column;
                width: 360px;
                height: calc(100vh - 200px);
                max-height: 850px;
                background: var(--bg-card);
                border-radius: 20px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                overflow-y: auto;
                overflow-x: hidden;
                scrollbar-width: thin;
                scrollbar-color: rgba(255,255,255,0.2) transparent;
                transition: all 0.3s ease;
            }

            .side-panel::-webkit-scrollbar {
                width: 4px;
            }

            .side-panel::-webkit-scrollbar-track {
                background: transparent;
            }

            .side-panel::-webkit-scrollbar-thumb {
                background: rgba(255,255,255,0.2);
                border-radius: 2px;
            }

            .side-panel.collapsed {
                width: 56px;
            }

            .app-container.focus-mode .side-panel {
                width: 56px;
            }
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .panel-app-info {
            flex: 1;
            min-width: 0;
        }

        .side-panel.collapsed .panel-app-info {
            display: none;
        }

        .panel-app-name {
            font-size: 1.1rem;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .panel-funding {
            margin-top: 8px;
        }

        .panel-funding-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .panel-funding-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-green));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .panel-funding-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .panel-toggle {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .panel-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
        }

        .side-panel.collapsed .panel-toggle {
            margin: 0 auto;
        }

        /* Panel Content */
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .side-panel.collapsed .panel-content {
            display: none;
        }

        /* Collapsed Icons */
        .panel-collapsed-icons {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
        }

        .side-panel.collapsed .panel-collapsed-icons {
            display: flex;
        }

        .collapsed-icon-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .collapsed-icon-btn:hover {
            background: rgba(255, 149, 0, 0.2);
        }

        .collapsed-progress {
            width: 6px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .collapsed-progress-fill {
            width: 100%;
            background: linear-gradient(180deg, var(--accent-green), var(--accent-orange));
            border-radius: 3px;
            transition: height 0.3s ease;
        }

        /* Input Sections */
        .input-section {
            margin-bottom: 20px;
        }

        .input-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .input-section-icon {
            font-size: 1.1rem;
        }

        .input-section-title {
            font-size: 0.9rem;
            font-weight: 700;
        }

        .input-textarea {
            width: 100%;
            min-height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .input-textarea:focus {
            border-color: var(--accent-orange);
        }

        .input-textarea::placeholder {
            color: var(--text-secondary);
        }

        .input-submit {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: var(--accent-orange);
            border: none;
            border-radius: 8px;
            color: #0a0a1a;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .input-submit:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .input-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Requests List */
        .requests-section {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .requests-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .requests-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .requests-tabs {
            display: flex;
            gap: 4px;
        }

        .requests-tab {
            padding: 4px 10px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .requests-tab.active {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
            color: #0a0a1a;
        }

        .requests-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            /* No max-height - show all requests */
        }

        .request-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
        }

        .request-text {
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .request-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .request-type {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 100px;
            font-weight: 600;
        }

        .request-type.feature {
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
        }

        .request-type.bug {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .request-vote {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .vote-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .vote-btn:hover {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-green);
        }

        .vote-btn.voted {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-green);
        }

        .vote-count {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Focus Mode Button */
        .focus-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            z-index: 60;
            transition: all 0.2s ease;
        }

        @media (min-width: 900px) {
            .focus-btn {
                display: flex;
            }
        }

        .focus-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            color: var(--text-primary);
        }

        /* Empty State */
        .requests-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* ===== MOBILE REFINE BUTTON & BOTTOM SHEET ===== */
        .nav-refine {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 12px;
            background: linear-gradient(135deg, var(--accent-purple), #ec4899);
            border: none;
            border-radius: 100px;
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: auto;
        }

        .nav-refine:active {
            transform: scale(0.95);
        }

        @media (min-width: 900px) {
            .nav-refine {
                display: none;
            }
        }

        /* Bottom Sheet Overlay */
        .bottom-sheet-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .bottom-sheet-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            z-index: 501;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .bottom-sheet.active {
            transform: translateY(0);
        }

        @media (min-width: 900px) {
            .bottom-sheet,
            .bottom-sheet-overlay {
                display: none !important;
            }
        }

        .sheet-drag-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 12px auto;
            flex-shrink: 0;
        }

        .sheet-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .sheet-app-info {
            flex: 1;
        }

        .sheet-app-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .sheet-funding {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sheet-funding-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .sheet-funding-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-green));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .sheet-funding-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .sheet-close {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-left: 16px;
        }

        .sheet-close:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
        }

        .sheet-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 40px;
        }

        /* Sheet Input Sections */
        .sheet-input-section {
            margin-bottom: 20px;
        }

        .sheet-input-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .sheet-input-icon {
            font-size: 1.1rem;
        }

        .sheet-input-title {
            font-size: 0.9rem;
            font-weight: 700;
        }

        .sheet-textarea {
            width: 100%;
            min-height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            resize: none;
            outline: none;
        }

        .sheet-textarea:focus {
            border-color: var(--accent-orange);
        }

        .sheet-textarea::placeholder {
            color: var(--text-secondary);
        }

        .sheet-submit {
            margin-top: 10px;
            width: 100%;
            padding: 12px;
            background: var(--accent-orange);
            border: none;
            border-radius: 10px;
            color: #0a0a1a;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .sheet-submit:active {
            opacity: 0.9;
        }

        .sheet-submit:disabled {
            opacity: 0.5;
        }

        /* Sheet Requests Section */
        .sheet-requests {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sheet-requests-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .sheet-requests-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .sheet-requests-tabs {
            display: flex;
            gap: 4px;
        }

        .sheet-tab {
            padding: 4px 10px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }

        .sheet-tab.active {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
            color: #0a0a1a;
        }

        .sheet-requests-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sheet-request-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
        }

        .sheet-request-text {
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .sheet-request-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sheet-request-type {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 100px;
            font-weight: 600;
        }

        .sheet-request-type.feature {
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
        }

        .sheet-request-type.bug {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .sheet-vote {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sheet-vote-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
        }

        .sheet-vote-btn.voted {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-green);
        }

        .sheet-vote-count {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .sheet-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* ===== DEPOSIT MODAL ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            width: 100%;
            max-width: 420px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        /* Wallet Status */
        .wallet-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .wallet-status.connected {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .wallet-status .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #6b7280;
        }

        .wallet-status.connected .dot {
            background: #22c55e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .wallet-info {
            flex: 1;
        }

        .wallet-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .wallet-address {
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .connect-wallet-btn {
            background: linear-gradient(135deg, var(--accent-orange), #ff6b9d);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 100px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .connect-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 149, 0, 0.3);
        }

        /* Deposit Tabs */
        .deposit-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .deposit-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .deposit-tab.active {
            background: rgba(255, 149, 0, 0.15);
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }

        .deposit-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Amount Input */
        .amount-section {
            margin-bottom: 20px;
        }

        .amount-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .amount-input-wrapper {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
        }

        .amount-input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 700;
            padding: 12px 16px;
            outline: none;
        }

        .amount-input-wrapper input::placeholder {
            color: var(--text-secondary);
        }

        .asset-selector {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-right: 8px;
            cursor: pointer;
        }

        .asset-selector img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .asset-selector span {
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* Quick amounts */
        .quick-amounts {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .quick-amount {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .quick-amount:hover {
            background: rgba(255, 149, 0, 0.15);
            border-color: var(--accent-orange);
        }

        /* Credits preview */
        .credits-preview {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.1), rgba(168, 85, 247, 0.1));
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .credits-preview-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .credits-preview-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-orange);
        }

        /* Deposit button */
        .deposit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent-orange), #ff6b9d);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .deposit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(255, 149, 0, 0.4);
        }

        .deposit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* QR Code Section */
        .qr-section {
            text-align: center;
        }

        .qr-code-container {
            background: white;
            border-radius: 16px;
            padding: 16px;
            display: inline-block;
            margin-bottom: 16px;
        }

        .qr-code-container canvas {
            display: block;
        }

        .deposit-address {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .deposit-address code {
            flex: 1;
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
            word-break: break-all;
        }

        .copy-btn {
            background: var(--accent-orange);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .copy-btn:hover {
            opacity: 0.9;
        }

        .qr-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .qr-note strong {
            color: var(--accent-orange);
        }

        /* Network badge */
        .network-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 0.8rem;
            color: #60a5fa;
            margin-bottom: 16px;
        }

        .network-badge img {
            width: 16px;
            height: 16px;
        }

        /* Mobile adjustments */
        @media (max-width: 480px) {
            .shell-header {
                padding: 10px 12px;
            }

            .shell-logo span {
                display: none;
            }

            .credits-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .user-badge span {
                display: none;
            }

            /* Mobile: Single column horizontal cards */
            .apps-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .app-card {
                padding: 10px 12px;
                gap: 12px;
            }

            .app-card .app-icon {
                width: 48px;
                height: 48px;
                min-width: 48px;
                font-size: 1.6rem;
            }

            .app-card .app-icon .app-icon-img {
                width: 48px;
                height: 48px;
            }

            .app-card .app-name {
                font-size: 0.9rem;
            }

            .app-card .app-tagline {
                font-size: 0.75rem;
            }

            .app-card .view-btn {
                padding: 6px 14px;
                font-size: 0.8rem;
            }

            .mystery-btn {
                padding: 10px 6px;
                font-size: 0.7rem;
            }

            /* Mobile tier badges */
            .tier-badge {
                font-size: 0.55rem;
                padding: 2px 6px;
                top: -6px;
                right: -4px;
            }

            .nav-app, .nav-home {
                width: 44px;
                height: 44px;
            }

            /* Mobile fund modal */
            .fund-modal-overlay {
                padding: 10px;
            }

            .fund-modal {
                border-radius: 20px;
            }

            .fund-modal-header {
                padding: 16px 18px;
            }

            .fund-modal-body {
                padding: 18px;
            }

            .fund-tier-compact {
                padding: 8px 10px;
            }

            .tier-emoji {
                font-size: 1rem;
            }

            .tier-name {
                font-size: 0.75rem;
            }

            .fund-tier-benefits-compact {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            /* Mobile tiers section */
            .tiers-section {
                padding: 20px 16px;
                margin: 0 auto 30px;
            }

            .tiers-title {
                font-size: 1.1rem;
            }

            .tiers-subtitle {
                font-size: 0.8rem;
            }

            .tiers-grid {
                gap: 10px;
            }

            .tier-card {
                padding: 12px 8px;
            }

            .tier-icon {
                font-size: 1.5rem;
            }

            .tier-name {
                font-size: 0.85rem;
            }

            .tier-range {
                font-size: 0.7rem;
            }

            .tier-benefits {
                font-size: 0.65rem;
            }

            /* Mobile build section */
            .build-section {
                padding: 20px 16px;
                margin: 0 auto 30px;
            }

            .build-title {
                font-size: 1.1rem;
            }

            .build-desc {
                font-size: 0.8rem;
            }

            .build-features {
                gap: 6px;
            }

            .build-feature {
                font-size: 0.75rem;
            }

            .build-cta-btn {
                padding: 12px 24px;
                font-size: 0.85rem;
            }

            /* Mobile header */
            .apps-grid-header h1 {
                font-size: 1.4rem;
            }

            .apps-grid-header p {
                font-size: 0.85rem;
            }
        }

        /* Very small screens - 2 columns */
        @media (max-width: 380px) {
            /* Very small screens: compact horizontal cards */
            .app-card {
                padding: 8px 10px;
                gap: 10px;
            }

            .app-card .app-icon {
                width: 40px;
                height: 40px;
                min-width: 40px;
                font-size: 1.4rem;
            }

            .app-card .app-icon .app-icon-img {
                width: 40px;
                height: 40px;
            }

            .app-card .app-name {
                font-size: 0.85rem;
            }

            .app-card .app-tagline {
                font-size: 0.7rem;
            }

            .app-card .view-btn {
                padding: 5px 12px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>

<body>
    <!-- Main Site Navigation (injected by nav-component.js) -->
    <nav id="main-nav"></nav>
    <script src="/nav-component.js"></script>

    <!-- Top Nav Bar (visible when app is open) -->
    <nav class="top-nav" id="topNav">
        <button class="nav-home" onclick="goHome()" title="Back to Apps">
            <span>&#x1F3E0;</span>
        </button>
        <div class="nav-divider"></div>
        <div id="navApps"></div>
        <button class="nav-refine" onclick="openBottomSheet()">
            <span>&#x1F4A1;</span> Refine
        </button>
    </nav>

    <!-- Apps Grid Container (Home State) -->
    <div class="apps-grid-container" id="appsGridContainer">

        <!-- Featured App of the Day -->
        <div class="featured-app-section" id="featuredAppSection" style="display: none;">
            <div class="featured-app-badge">
                <span class="badge-icon"></span>
                <span>Latest Build</span>
            </div>
            <div class="featured-app-card" id="featuredAppCard">
                <div class="featured-app-glow"></div>
                <div class="featured-app-content">
                    <div class="featured-app-icon" id="featuredAppIcon"></div>
                    <div class="featured-app-info">
                        <h2 class="featured-app-name" id="featuredAppName">Loading...</h2>
                        <p class="featured-app-tagline" id="featuredAppTagline">AI-powered app</p>
                        <div class="featured-app-stats">
                            <span class="featured-stat" id="featuredAppStake"> $0 staked</span>
                            <span class="featured-stat" id="featuredAppAge"> New today</span>
                        </div>
                    </div>
                    <div class="featured-app-actions">
                        <button class="featured-btn primary" id="featuredTryBtn">Try It</button>
                        <button class="featured-btn secondary" id="featuredStakeBtn">Fund</button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .featured-app-section {
                max-width: 800px;
                margin: 0 auto 32px auto;
                padding: 0 20px;
            }

            .featured-app-badge {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 16px;
                background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(168, 85, 247, 0.2));
                border: 1px solid rgba(255, 149, 0, 0.3);
                border-radius: 100px;
                font-size: 0.85rem;
                font-weight: 700;
                color: #ff9500;
                margin-bottom: 16px;
            }

            .badge-icon {
                animation: sparkle 2s ease-in-out infinite;
            }

            @keyframes sparkle {
                0%, 100% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.7; transform: scale(1.1); }
            }

            .featured-app-card {
                position: relative;
                background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(30, 30, 50, 0.95));
                border: 1px solid rgba(255, 149, 0, 0.3);
                border-radius: 24px;
                padding: 32px;
                overflow: hidden;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .featured-app-card:hover {
                transform: translateY(-4px);
                border-color: rgba(255, 149, 0, 0.5);
                box-shadow: 0 20px 60px rgba(255, 149, 0, 0.15);
            }

            .featured-app-glow {
                position: absolute;
                top: -50%;
                right: -20%;
                width: 300px;
                height: 300px;
                background: radial-gradient(circle, rgba(255, 149, 0, 0.15) 0%, transparent 70%);
                pointer-events: none;
            }

            .featured-app-content {
                position: relative;
                display: flex;
                align-items: center;
                gap: 24px;
                z-index: 1;
            }

            .featured-app-icon {
                width: 120px;
                height: 120px;
                border-radius: 24px;
                background: linear-gradient(135deg, #ff9500, #f97316);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                flex-shrink: 0;
                box-shadow: 0 8px 32px rgba(255, 149, 0, 0.3);
            }

            .featured-app-icon img {
                width: 100%;
                height: 100%;
                border-radius: 24px;
                object-fit: cover;
            }

            .featured-app-info {
                flex: 1;
            }

            .featured-app-name {
                font-size: 1.8rem;
                font-weight: 800;
                color: white;
                margin: 0 0 8px 0;
            }

            .featured-app-tagline {
                font-size: 1rem;
                color: #9ca3af;
                margin: 0 0 16px 0;
            }

            .featured-app-stats {
                display: flex;
                gap: 16px;
            }

            .featured-stat {
                font-size: 0.9rem;
                color: #9ca3af;
            }

            .featured-app-actions {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .featured-btn {
                padding: 14px 32px;
                border-radius: 100px;
                font-size: 1rem;
                font-weight: 700;
                border: none;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .featured-btn.primary {
                background: linear-gradient(135deg, #ff9500, #f97316);
                color: white;
                box-shadow: 0 4px 20px rgba(255, 149, 0, 0.3);
            }

            .featured-btn.primary:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 28px rgba(255, 149, 0, 0.4);
            }

            .featured-btn.secondary {
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .featured-btn.secondary:hover {
                background: rgba(255, 255, 255, 0.15);
            }

            @media (max-width: 768px) {
                .featured-app-content {
                    flex-direction: column;
                    text-align: center;
                }

                .featured-app-icon {
                    width: 100px;
                    height: 100px;
                }

                .featured-app-name {
                    font-size: 1.5rem;
                }

                .featured-app-stats {
                    justify-content: center;
                }

                .featured-app-actions {
                    flex-direction: row;
                    width: 100%;
                }

                .featured-btn {
                    flex: 1;
                    padding: 12px 20px;
                }
            }
        </style>

        <!-- Shell Layout with Sidebar -->
        <div class="shell-layout">
            <!-- Sidebar Navigation -->
            <aside class="shell-sidebar" id="shellSidebar">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Browse</div>
                    <button class="sidebar-item active" onclick="filterApps('all'); updateSidebarActive(this)" data-filter="all">
                        <span class="sidebar-item-icon"></span>
                        All Apps
                    </button>
                    <button class="sidebar-item" onclick="filterApps('app'); updateSidebarActive(this)" data-filter="app">
                        <span class="sidebar-item-icon"></span>
                        Apps
                    </button>
                    <button class="sidebar-item" onclick="filterApps('game'); updateSidebarActive(this)" data-filter="game">
                        <span class="sidebar-item-icon"></span>
                        Games
                    </button>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Explore</div>
                    <button class="sidebar-item" onclick="switchAppsTab('leaderboard')">
                        <span class="sidebar-item-icon"></span>
                        Funding
                    </button>
                    <button class="sidebar-item" onclick="openVotingSection()">
                        <span class="sidebar-item-icon"></span>
                        Vote
                    </button>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Sort By</div>
                    <button class="sidebar-item" onclick="sortApps('funded'); updateSortActive(this)" data-sort="funded">
                        <span class="sidebar-item-icon"></span>
                        Most Funded
                    </button>
                    <button class="sidebar-item" onclick="sortApps('newest'); updateSortActive(this)" data-sort="newest">
                        <span class="sidebar-item-icon"></span>
                        Newest
                    </button>
                    <button class="sidebar-item" onclick="sortApps('name'); updateSortActive(this)" data-sort="name">
                        <span class="sidebar-item-icon"></span>
                        A-Z
                    </button>
                </div>
            </aside>

            <!-- Main Content Area -->
            <div class="shell-main">
                <!-- Tabs Navigation (hidden on desktop with sidebar) -->
                <div class="mobile-tabs-wrapper" style="display: none;">
                    <div style="display: flex; justify-content: center; padding: 16px 0;">
                        <div class="apps-tabs">
                            <button class="apps-tab active" onclick="switchAppsTab('apps')" id="tabApps">
                                <span class="apps-tab-icon"></span>
                                All Apps
                            </button>
                            <button class="apps-tab" onclick="switchAppsTab('leaderboard')" id="tabLeaderboard">
                                <span class="apps-tab-icon"></span>
                                Funding
                            </button>
                        </div>
                    </div>
                </div>

                <!-- All Apps Tab Content -->
                <div class="tab-content active" id="contentApps">
                    <!-- Filter Bar (hidden - using sidebar now) -->
                    <div class="apps-filter-bar" id="appsFilterBar" style="display: none !important;">
                <div class="filter-types">
                    <button class="filter-btn active" onclick="filterApps('all')" data-filter="all">All</button>
                    <button class="filter-btn" onclick="filterApps('app')" data-filter="app">Apps</button>
                    <button class="filter-btn" onclick="filterApps('game')" data-filter="game">Games</button>
                </div>
                <div class="sort-options">
                    <select id="appsSortSelect" onchange="sortApps(this.value)">
                        <option value="funded">Most Funded</option>
                        <option value="newest">Newest</option>
                        <option value="name">A-Z</option>
                    </select>
                </div>
            </div>

            <!-- Featured Apps (Scale Tier) -->
            <div class="featured-apps-section" id="featuredAppsSection" style="display: none;">
                <div class="featured-header">
                    <span class="featured-badge"> Scale Tier</span>
                    <span class="featured-title">Featured Apps</span>
                </div>
                <div class="featured-apps-grid" id="featuredAppsGrid"></div>
            </div>

            <div class="apps-loading" id="appsLoading">
                <div class="spinner"></div>
                <div>Loading apps...</div>
            </div>
            <div class="apps-grid" id="appsGrid" style="display: none;"></div>
        </div>

        <!-- Leaderboard Tab Content -->
        <div class="tab-content" id="contentLeaderboard">
            <div class="leaderboard-container" id="leaderboardContainer">
                <div class="leaderboard-empty">
                    <div class="leaderboard-empty-icon"></div>
                    <div>Loading funding...</div>
                </div>
            </div>
        </div>

        <!-- Build Your Own App -->
        <div class="build-section">
            <div class="build-badge">For Businesses</div>
            <div class="build-title">Build Your Own App</div>
            <div class="build-desc">
                Get a custom AI-powered app for your business. Your branding, your customers, your revenue. Perfect for clinics, studios, coaches, and service providers.
            </div>
            <div class="build-features">
                <div class="build-feature">
                    <span class="build-feature-icon">&#x2713;</span>
                    <span>Your Brand</span>
                </div>
                <div class="build-feature">
                    <span class="build-feature-icon">&#x2713;</span>
                    <span>90% Revenue Share</span>
                </div>
                <div class="build-feature">
                    <span class="build-feature-icon">&#x2713;</span>
                    <span>AI-Powered</span>
                </div>
                <div class="build-feature">
                    <span class="build-feature-icon">&#x2713;</span>
                    <span>No Coding Required</span>
                </div>
                <div class="build-feature" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(168, 85, 247, 0.15)); border: 1px solid rgba(59, 130, 246, 0.3);">
                    <span class="build-feature-icon"></span>
                    <span>Cadence AI Marketing <span style="font-size: 0.7rem; opacity: 0.7; text-decoration: line-through;">$99/mo</span></span>
                </div>
            </div>
            <div class="build-buttons">
                <button class="build-cta" onclick="openAppRequestModal()">
                    &#x1F4DD; Request Your App
                </button>
                <a href="docs/white-label-apps.html" class="build-learn-more">
                    Learn More &#x2192;
                </a>
            </div>
        </div>

        <!-- Influencer Section -->
        <div class="influencer-section">
            <div class="influencer-header">
                <div class="influencer-icon">&#x1F4E2;</div>
                <div class="influencer-title">Become an Influencer Partner</div>
                <div class="influencer-subtitle">Earn revenue share when apps graduate</div>
            </div>

            <div class="influencer-explainer">
                <p>When apps reach <strong> Launch tier ($5K+)</strong>, they get their own websites, AI social media, and marketing.</p>
                <p>As an influencer partner, you'll earn <strong>10% of revenue</strong> from users you refer to launched apps.</p>
            </div>

            <div class="influencer-cta">
                <input type="email" id="influencerEmail" placeholder="Enter your email" class="influencer-email-input">
                <button class="influencer-notify-btn" onclick="subscribeInfluencer()">
                    Notify Me
                </button>
            </div>

            <div class="influencer-note">
                We'll email you when apps reach Launch tier so you can be a partner.
            </div>
        </div>

            </div><!-- End shell-main -->
        </div><!-- End shell-layout -->
    </div>

    <!-- App Container with iframe -->
    <main class="app-container" id="appContainer">
        <!-- Fullscreen Exit Button -->
        <button class="fullscreen-exit-btn" onclick="exitFullscreenMode()" title="Exit Fullscreen"></button>

        <!-- Mobile: Direct iframe -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Loading app...</div>
        </div>
        <iframe class="app-iframe" id="appIframe" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"></iframe>

        <!-- Desktop: Phone Frame -->
        <div class="phone-frame" id="phoneFrame">
            <button class="focus-btn" onclick="toggleFocusMode()" title="Toggle Focus Mode">
                <span id="focusIcon">&#x26F6;</span>
            </button>
            <iframe class="app-iframe" id="appIframeDesktop" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"></iframe>
        </div>

        <!-- Desktop: Side Panel -->
        <div class="side-panel" id="sidePanel">
            <div class="panel-header">
                <div class="panel-app-info">
                    <div class="panel-app-name" id="panelAppName">App Name</div>
                    <div class="panel-funding">
                        <div class="panel-funding-bar">
                            <div class="panel-funding-fill" id="panelFundingFill" style="width: 0%"></div>
                        </div>
                        <div class="panel-funding-text" id="panelFundingText">$0 / $5,000</div>
                    </div>
                </div>
                <button class="panel-toggle" onclick="toggleSidePanel()" title="Toggle Panel">
                    <span id="panelToggleIcon">&#x276E;</span>
                </button>
            </div>

            <!-- Collapsed State Icons -->
            <div class="panel-collapsed-icons">
                <div class="collapsed-progress">
                    <div class="collapsed-progress-fill" id="collapsedProgressFill" style="height: 0%"></div>
                </div>
                <button class="collapsed-icon-btn" onclick="toggleSidePanel()" title="Expand Panel"></button>
                <a href="/factory" class="collapsed-icon-btn" title="Governance" style="text-decoration: none;"></a>
            </div>

            <!-- Expanded Content -->
            <div class="panel-content">
                <!-- Investment & Funding Section -->
                <div class="input-section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(34, 197, 94, 0.2);">
                    <div class="input-section-header">
                        <span class="input-section-icon"></span>
                        <span class="input-section-title">Invest in This App</span>
                    </div>

                    <!-- Tier Badge -->
                    <div id="panelTierBadge" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <span id="panelTierIcon" style="font-size: 1.2rem;"></span>
                        <span id="panelTierName" style="font-weight: 700; color: #22c55e;">Seed</span>
                        <span style="color: var(--text-secondary); font-size: 0.8rem;"></span>
                        <span id="panelNextTier" style="font-size: 0.8rem; color: var(--text-secondary);">Sprout</span>
                    </div>

                    <!-- Revenue Streams Preview -->
                    <div id="panelStreamsPreview" style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Quick Stats -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
                        <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                            <div id="panelRevenue" style="font-weight: 700; color: #22c55e; font-size: 0.9rem;">$0</div>
                            <div style="font-size: 0.65rem; color: var(--text-secondary);">REVENUE</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                            <div id="panelFunders" style="font-weight: 700; color: var(--text-primary); font-size: 0.9rem;">0</div>
                            <div style="font-size: 0.65rem; color: var(--text-secondary);">FUNDERS</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                            <div style="font-weight: 700; color: #a855f7; font-size: 0.9rem;">100%</div>
                            <div style="font-size: 0.65rem; color: var(--text-secondary);">TO FUNDERS</div>
                        </div>
                    </div>

                    <!-- Fund Button -->
                    <button id="panelFundBtn" onclick="openPanelFundModal()" style="width: 100%; padding: 14px; font-size: 1rem; font-weight: 700; background: linear-gradient(135deg, #ff9500, #a855f7); border: none; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s ease;">
                        <span></span> Fund This App
                    </button>
                </div>

                <!-- App Features Section -->
                <div class="input-section" id="appFeaturesSection" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.05)); border: 1px solid rgba(59, 130, 246, 0.2);">
                    <div class="input-section-header">
                        <span class="input-section-icon"></span>
                        <span class="input-section-title">What You Can Do</span>
                    </div>

                    <div id="appFeaturesList" style="display: flex; flex-direction: column; gap: 8px;">
                        <!-- Features populated by JS -->
                        <div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.85rem;">
                            Loading features...
                        </div>
                    </div>

                    <!-- Features Summary -->
                    <div id="featuresSummary" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; font-size: 0.75rem;">
                        <span style="color: #22c55e;"><span id="freeFeatureCount">0</span> free</span>
                        <span style="color: #a855f7;"><span id="paidFeatureCount">0</span> premium</span>
                    </div>
                </div>

                <!-- Governance Link -->
                <div class="input-section" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(99, 102, 241, 0.2);">
                    <div class="input-section-header">
                        <span class="input-section-icon"></span>
                        <span class="input-section-title">Community Governance</span>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.5;">
                        Have a feature request or bug report? Submit it to the Factory where the community votes on priorities.
                    </p>
                    <a href="/factory" class="input-submit" style="display: block; text-align: center; text-decoration: none; background: linear-gradient(135deg, #6366f1, #a855f7);">
                         Go to Governance
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Bottom Sheet -->
    <div class="bottom-sheet-overlay" id="bottomSheetOverlay" onclick="closeBottomSheet()"></div>
    <div class="bottom-sheet" id="bottomSheet">
        <div class="sheet-drag-handle"></div>
        <div class="sheet-header">
            <div class="sheet-app-info">
                <div class="sheet-app-name" id="sheetAppName">App Name</div>
                <div class="sheet-funding">
                    <div class="sheet-funding-bar">
                        <div class="sheet-funding-fill" id="sheetFundingFill" style="width: 0%"></div>
                    </div>
                    <div class="sheet-funding-text" id="sheetFundingText">$0 / $5,000</div>
                </div>
            </div>
            <button class="sheet-close" onclick="closeBottomSheet()">&#x2715;</button>
        </div>
        <div class="sheet-content">
            <!-- Governance Link -->
            <div class="sheet-input-section" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 12px; padding: 16px;">
                <div class="sheet-input-header">
                    <span class="sheet-input-icon"></span>
                    <span class="sheet-input-title">Community Governance</span>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 12px 0; line-height: 1.5;">
                    Have a feature request or bug report? Submit it to the Factory where the community votes on priorities.
                </p>
                <a href="/factory" class="sheet-submit" style="display: block; text-align: center; text-decoration: none; background: linear-gradient(135deg, #6366f1, #a855f7);">
                     Go to Governance
                </a>
            </div>
        </div>
    </div>

    <!-- App Request Modal -->
    <div class="app-request-modal" id="appRequestModal" onclick="if(event.target === this) closeAppRequestModal()">
        <div class="app-request-content">
            <div class="app-request-header">
                <h2>&#x1F4DD; Request Your App</h2>
                <p>Tell us about your business and we'll send you a quote within 1-2 days</p>
            </div>
            <form class="app-request-form" onsubmit="submitAppRequest(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Your Name</label>
                        <input type="text" id="requestName" placeholder="John Smith" required>
                    </div>
                    <div class="form-group">
                        <label>Telegram</label>
                        <input type="text" id="requestTelegram" placeholder="@username" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Business Type</label>
                    <select id="requestBusinessType" required>
                        <option value="">Select your industry...</option>
                        <option value="healthcare">Healthcare / Medical</option>
                        <option value="fitness">Fitness / Wellness</option>
                        <option value="education">Education / Coaching</option>
                        <option value="professional">Professional Services</option>
                        <option value="retail">Retail / E-commerce</option>
                        <option value="food">Food & Beverage</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>App Complexity</label>
                    <div class="complexity-scale">
                        <label class="complexity-option">
                            <input type="radio" name="complexity" value="1" required>
                            <span class="complexity-box">1</span>
                            <span class="complexity-label">Simple</span>
                        </label>
                        <label class="complexity-option">
                            <input type="radio" name="complexity" value="2">
                            <span class="complexity-box">2</span>
                            <span class="complexity-label">Basic</span>
                        </label>
                        <label class="complexity-option">
                            <input type="radio" name="complexity" value="3">
                            <span class="complexity-box">3</span>
                            <span class="complexity-label">Medium</span>
                        </label>
                        <label class="complexity-option">
                            <input type="radio" name="complexity" value="4">
                            <span class="complexity-box">4</span>
                            <span class="complexity-label">Complex</span>
                        </label>
                        <label class="complexity-option">
                            <input type="radio" name="complexity" value="5">
                            <span class="complexity-box">5</span>
                            <span class="complexity-label">Enterprise</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Deployment Type</label>
                    <div class="deployment-options">
                        <label class="deployment-option">
                            <input type="radio" name="deployment" value="suite_shell" required checked>
                            <div class="deployment-card">
                                <div class="deployment-icon"></div>
                                <div class="deployment-info">
                                    <div class="deployment-title">SUITE Shell</div>
                                    <div class="deployment-desc">Public launch with community testing, user feedback, and exposure to SUITE users</div>
                                </div>
                            </div>
                        </label>
                        <label class="deployment-option">
                            <input type="radio" name="deployment" value="private">
                            <div class="deployment-card">
                                <div class="deployment-icon"></div>
                                <div class="deployment-info">
                                    <div class="deployment-title">Private</div>
                                    <div class="deployment-desc">White-label app with your own branding, not listed on SUITE Shell</div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>What would your app do?</label>
                    <textarea id="requestDescription" placeholder="Describe your ideal app - what problems would it solve for your customers? What features are must-haves?" required></textarea>
                </div>
                <div class="app-request-note">
                    We'll message you on Telegram within 1-2 days to discuss your app and provide a quote.
                </div>
                <div class="app-request-buttons">
                    <button type="button" class="app-request-cancel" onclick="closeAppRequestModal()">Cancel</button>
                    <button type="submit" class="app-request-submit">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Fund App Modal -->
    <div class="fund-modal-overlay" id="fundModal" onclick="if(event.target === this) closeFundModal()">
        <div class="fund-modal">
            <div class="fund-modal-header">
                <h2 id="fundModalTitle">Fund App</h2>
                <button class="fund-modal-close" onclick="closeFundModal()">&times;</button>
            </div>
            <div class="fund-modal-body">
                <!-- Compact Tier Status Section -->
                <div class="fund-tier-compact">
                    <div class="fund-tier-left">
                        <span id="fundTierBadge" class="tier-emoji"></span>
                        <span id="fundTierName" class="tier-name current">Seed</span>
                    </div>
                    <div class="fund-tier-progress-text" id="fundProgressText">$0 / $1,000</div>
                    <div class="fund-tier-right">
                        <span id="fundNextTierName" class="tier-name next">Sprout</span>
                        <span id="fundNextTierBadge" class="tier-emoji"></span>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="fund-progress-bar" style="margin-bottom: 12px;">
                    <div class="fund-progress-fill" id="fundProgressFill" style="width: 0%"></div>
                </div>

                <!-- Next Tier Benefits (inline) -->
                <div id="fundTierBenefits" class="fund-tier-benefits-compact">
                    <span class="benefits-label">Next:</span>
                    <span id="fundBenefitsList" class="benefits-text">Polished user experience</span>
                </div>

                <!-- Investment Details Toggle -->
                <div class="fund-details-toggle" onclick="toggleInvestmentDetails()">
                    <span></span>
                    <span id="fundDetailsToggleText">View Investment Details</span>
                    <span id="fundDetailsArrow"></span>
                </div>

                <!-- Investment Details (Collapsible) -->
                <div class="fund-investment-details" id="fundInvestmentDetails">
                    <!-- Revenue Streams -->
                    <div class="fund-revenue-streams">
                        <div class="fund-section-title">
                            <span></span> Revenue Streams
                        </div>
                        <div class="fund-streams-grid" id="fundStreamsGrid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Financials -->
                    <div class="fund-financials" id="fundFinancials">
                        <div class="fund-stat">
                            <div class="fund-stat-value green" id="fundCurrentRevenue">$0</div>
                            <div class="fund-stat-label">Revenue</div>
                        </div>
                        <div class="fund-stat">
                            <div class="fund-stat-value" id="fundFunderCount">0</div>
                            <div class="fund-stat-label">Funders</div>
                        </div>
                        <div class="fund-stat">
                            <div class="fund-stat-value purple" id="fundAvgReturn">--</div>
                            <div class="fund-stat-label">Avg ROI</div>
                        </div>
                    </div>

                    <!-- Documentation Links -->
                    <div class="fund-docs" id="fundDocs">
                        <a class="fund-doc-link" onclick="openAppDocs('model')">
                            <span></span> Business Model
                        </a>
                        <a class="fund-doc-link" onclick="openAppDocs('projections')">
                            <span></span> Projections
                        </a>
                        <a class="fund-doc-link" onclick="openAppDocs('terms')">
                            <span></span> Terms
                        </a>
                    </div>
                </div>

                <!-- Yield Allocation Option -->
                <div class="fund-option" id="yieldOption" onclick="selectFundOption('yield')">
                    <div class="fund-option-header">
                        <span class="fund-option-icon">&#x1F4C8;</span>
                        <span class="fund-option-title">Allocate Yield</span>
                    </div>
                    <div class="fund-option-desc">
                        Direct a percentage of your vault's yield to this app. You can change this allocation anytime.
                    </div>
                    <div class="fund-option-input" id="yieldInputContainer" style="display: none;">
                        <select id="yieldPercentage">
                            <option value="10">10% of my yield</option>
                            <option value="25">25% of my yield</option>
                            <option value="50">50% of my yield</option>
                            <option value="75">75% of my yield</option>
                            <option value="100">100% of my yield</option>
                        </select>
                    </div>
                </div>

                <!-- Direct Deposit Option -->
                <div class="fund-option" id="directOption" onclick="selectFundOption('direct')">
                    <div class="fund-option-header">
                        <span class="fund-option-icon">&#x1F4B5;</span>
                        <span class="fund-option-title">Direct Deposit</span>
                    </div>
                    <div class="fund-option-desc">
                        Deposit funds directly to this app. <strong style="color: #22c55e;">You'll earn 100% of app revenue</strong> proportional to your contribution.
                    </div>
                    <div class="fund-option-input" id="directInputContainer" style="display: none;">
                        <input type="number" id="directAmount" placeholder="Enter amount in $" min="1" step="1">
                    </div>
                </div>

                <!-- Revenue Share Banner -->
                <div class="fund-revenue-banner">
                    <span style="font-size: 1.2rem;"></span>
                    <span><strong>100% Revenue Share</strong>  All app revenue goes to funders</span>
                </div>

                <!-- Actions -->
                <div class="fund-actions">
                    <button class="fund-cancel-btn" onclick="closeFundModal()">Cancel</button>
                    <button class="fund-submit-btn" id="fundSubmitBtn" onclick="submitFunding()" disabled>Select an option</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal-overlay" id="depositModal">
        <div class="modal">
            <div class="modal-header">
                <h2>&#x26A1; Top Up Credits</h2>
                <button class="modal-close" onclick="closeDepositModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Wallet Status -->
                <div class="wallet-status" id="walletStatus">
                    <div class="dot"></div>
                    <div class="wallet-info">
                        <div class="wallet-label">Wallet</div>
                        <div class="wallet-address" id="walletAddressDisplay">Not connected</div>
                    </div>
                    <button class="connect-wallet-btn" id="connectWalletBtn" onclick="connectWallet()">
                        Connect
                    </button>
                </div>

                <!-- Deposit Tabs -->
                <div class="deposit-tabs">
                    <button class="deposit-tab active" data-tab="crypto" onclick="switchTab('crypto')">
                        &#x1F4B0; Crypto
                    </button>
                    <button class="deposit-tab" data-tab="qr" onclick="switchTab('qr')">
                        &#x1F4F1; QR Code
                    </button>
                </div>

                <!-- Crypto Deposit Tab -->
                <div class="tab-content active" id="cryptoTab">
                    <div class="network-badge">
                        <img src="https://raw.githubusercontent.com/base-org/brand-kit/main/logo/symbol/Base_Symbol_Blue.svg" alt="Base">
                        Base Network
                    </div>

                    <div class="amount-section">
                        <div class="amount-label">Amount</div>
                        <div class="amount-input-wrapper">
                            <input type="number" id="depositAmount" placeholder="0.00" step="0.001" min="0" oninput="updateCreditsPreview()">
                            <div class="asset-selector" onclick="toggleAsset()">
                                <img id="assetIcon" src="https://cryptologos.cc/logos/ethereum-eth-logo.png" alt="ETH">
                                <span id="assetSymbol">ETH</span>
                            </div>
                        </div>
                    </div>

                    <div class="quick-amounts">
                        <button class="quick-amount" onclick="setAmount(0.01)">0.01</button>
                        <button class="quick-amount" onclick="setAmount(0.05)">0.05</button>
                        <button class="quick-amount" onclick="setAmount(0.1)">0.1</button>
                        <button class="quick-amount" onclick="setAmount(0.5)">0.5</button>
                    </div>

                    <div class="credits-preview">
                        <div class="credits-preview-label">You'll receive</div>
                        <div class="credits-preview-value" id="creditsPreview">0 credits</div>
                    </div>

                    <button class="deposit-btn" id="depositBtn" onclick="executeDeposit()" disabled>
                        &#x1F680; Deposit
                    </button>
                </div>

                <!-- QR Code Tab -->
                <div class="tab-content" id="qrTab">
                    <div class="qr-section">
                        <div class="network-badge">
                            <img src="https://raw.githubusercontent.com/base-org/brand-kit/main/logo/symbol/Base_Symbol_Blue.svg" alt="Base">
                            Base Network (ETH or USDC)
                        </div>

                        <div class="qr-code-container" id="qrCodeContainer"></div>

                        <div class="deposit-address">
                            <code id="treasuryAddress">0x...</code>
                            <button class="copy-btn" onclick="copyAddress()">Copy</button>
                        </div>

                        <p class="qr-note">
                            Send <strong>ETH</strong> or <strong>USDC</strong> on <strong>Base</strong> to this address.<br>
                            Credits will be added to your account within minutes.<br><br>
                            <strong>$1 = 1,000 credits</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- App View Mode Choice Modal -->
    <div class="view-choice-overlay" id="viewChoiceModal" onclick="if(event.target === this) closeViewChoiceModal()">
        <div class="view-choice-modal">
            <div class="view-choice-title" id="viewChoiceAppName">Open App</div>
            <div class="view-choice-subtitle">Choose how to view this app</div>
            <div class="view-choice-options">
                <button class="view-choice-btn" onclick="openAppInMode('mobile')">
                    <span class="view-choice-btn-icon"></span>
                    <div class="view-choice-btn-text">
                        <div class="view-choice-btn-title">Mobile Preview</div>
                        <div class="view-choice-btn-desc">Test the mobile experience in a phone frame</div>
                    </div>
                </button>
                <button class="view-choice-btn" onclick="openAppInMode('fullscreen')">
                    <span class="view-choice-btn-icon"></span>
                    <div class="view-choice-btn-text">
                        <div class="view-choice-btn-title">Fullscreen</div>
                        <div class="view-choice-btn-desc">Use the app in full browser window</div>
                    </div>
                </button>
            </div>
            <button class="view-choice-cancel" onclick="closeViewChoiceModal()">Cancel</button>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const TREASURY_ADDRESS = '0x036A77Ed6896Fa21C3faBBee36a1a90f30650ffc';
        const SUPABASE_URL = 'https://rdsmdywbdiskxknluiym.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkc21keXdiZGlza3hrbmx1aXltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODk3MTgsImV4cCI6MjA4MzM2NTcxOH0.DcLpWs8Lf1s4Flf54J5LubokSYrd7h-XvI_X0jj6bLM';
        const ETH_PRICE_USD = 3200;

        // Emoji fallbacks for apps
        const APP_ICONS = {
            'foodvitals': '&#x1F957;',      // 
            'cheshbon': '&#x1F4B0;',        // 
            'trueform': '&#x1F3CB;',        // 
            'remcast': '&#x1F4A4;',         // 
            'opticrep': '&#x1F441;',        // 
            'revibe': '&#x1F3B5;',          // 
            'mindmap': '&#x1F9E0;',         // 
            'default': '&#x2728;'           // 
        };

        // Graduation threshold in USD
        const GRADUATION_THRESHOLD = 5000;
        const ADMIN_WALLET = '0x3fb53bc498abe67132bdce0d5f5569f5dcf1f748';

        // ===== STATE =====
        let currentUser = null;
        let currentCredits = 0;
        let connectedWallet = null;
        let selectedAsset = 'ETH';
        let apps = [];
        let currentApp = null;
        let currentFilter = 'all';
        let currentSort = 'funded';

        // ===== FILTER & SORT FUNCTIONS =====
        function filterApps(filter) {
            currentFilter = filter;
            // Update active button in filter bar (legacy)
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            // Update sidebar filter items
            document.querySelectorAll('.sidebar-item[data-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            renderAppsGrid();
        }

        function sortApps(sort) {
            currentSort = sort;
            // Update sidebar sort items
            document.querySelectorAll('.sidebar-item[data-sort]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.sort === sort);
            });
            renderAppsGrid();
        }

        // Helper function to update sidebar filter active state
        function updateSidebarActive(element) {
            document.querySelectorAll('.sidebar-item[data-filter]').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
        }

        // Helper function to update sidebar sort active state
        function updateSortActive(element) {
            document.querySelectorAll('.sidebar-item[data-sort]').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
        }

        function getFilteredAndSortedApps() {
            let filtered = [...apps];

            // Apply type filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(app => {
                    const type = (app.type || app.category || 'app').toLowerCase();
                    return type === currentFilter || type.includes(currentFilter);
                });
            }

            // Apply sort
            switch (currentSort) {
                case 'funded':
                    filtered.sort((a, b) => (parseFloat(b.total_funded) || 0) - (parseFloat(a.total_funded) || 0));
                    break;
                case 'newest':
                    filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
                case 'name':
                    filtered.sort((a, b) => a.name.localeCompare(b.name));
                    break;
            }

            return filtered;
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async () => {
            // Parse URL params
            const params = new URLSearchParams(window.location.search);
            const appSlug = params.get('app');

            // Check for Telegram user data in URL
            const tgId = params.get('tg_id');
            const tgUsername = params.get('tg_username');
            const tgFirstName = params.get('tg_first_name');
            const tgPhoto = params.get('tg_photo');

            if (tgId) {
                currentUser = {
                    id: tgId,
                    username: tgUsername || '',
                    firstName: tgFirstName || 'User',
                    photoUrl: tgPhoto || null,
                    source: 'telegram'
                };
                saveUser(currentUser);
            } else {
                currentUser = loadUser();
            }

            // Update UI with user info
            if (currentUser) {
                updateUserDisplay();
                await loadCredits();
            }

            // Load apps from Supabase
            await loadApps();

            // If app param provided, open that app directly
            if (appSlug) {
                const app = apps.find(a => a.slug === appSlug);
                if (app) {
                    openApp(app.slug);
                }
            }

            // Generate QR code
            generateQRCode();

            // Check for existing wallet connection
            await checkWalletConnection();

            // Check for saved telegram user
            const savedTgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');
            if (savedTgUser && !currentUser) {
                currentUser = savedTgUser;
                // Check if telegram is linked to a wallet
                await checkTelegramWalletLink(savedTgUser.username);
            }

            // Update auth display (Connect button vs logged in state)
            updateAuthDisplay();

            // Listen for messages from iframe
            window.addEventListener('message', handleIframeMessage);

            // Handle back button / popstate
            window.addEventListener('popstate', handlePopState);

            // Sync wallet state when nav-component changes it
            // Override refreshNavCredits to also update suite-shell state
            const originalRefresh = window.refreshNavCredits;
            window.refreshNavCredits = function() {
                // Sync connectedWallet from localStorage
                connectedWallet = localStorage.getItem('connectedWallet');
                // Update suite-shell's auth display
                updateAuthDisplay();
                loadCredits();
                // Call original nav-component function
                if (originalRefresh) originalRefresh();
            };
        });

        // ===== APPS TABS SWITCHING =====
        function switchAppsTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.apps-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');

            // Load data based on tab
            if (tab === 'leaderboard') {
                renderLeaderboard();
            } else if (tab === 'ideas') {
                loadAndRenderIdeas();
            }
        }

        // ===== LEADERBOARD =====
        function renderLeaderboard() {
            const container = document.getElementById('leaderboardContainer');

            if (!apps || apps.length === 0) {
                container.innerHTML = `
                    <div class="leaderboard-empty">
                        <div class="leaderboard-empty-icon"></div>
                        <div>No apps yet</div>
                    </div>
                `;
                return;
            }

            // Sort apps by total_revenue (or total_staked as fallback) descending
            const sortedApps = [...apps].sort((a, b) => {
                const aRevenue = a.total_revenue || a.total_staked || 0;
                const bRevenue = b.total_revenue || b.total_staked || 0;
                return bRevenue - aRevenue;
            });

            let html = '';
            sortedApps.forEach((app, index) => {
                const rank = index + 1;
                let rankClass = '';
                if (rank === 1) rankClass = 'gold';
                else if (rank === 2) rankClass = 'silver';
                else if (rank === 3) rankClass = 'bronze';

                const revenue = app.total_revenue || app.total_staked || 0;
                const funders = app.funder_count || 0;
                const iconUrl = app.icon_url && !app.icon_url.includes('example.com') ? app.icon_url : null;
                const iconEmoji = app.icon_emoji || app.icon || '';

                const iconHtml = iconUrl
                    ? `<img src="${iconUrl}" alt="${app.name}">`
                    : iconEmoji;

                html += `
                    <div class="leaderboard-item" onclick="openApp('${app.slug}')">
                        <div class="leaderboard-rank ${rankClass}">#${rank}</div>
                        <div class="leaderboard-icon">${iconHtml}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${app.name}</div>
                            <div class="leaderboard-tagline">${app.tagline || app.category || ''}</div>
                        </div>
                        <div class="leaderboard-stats">
                            <div class="leaderboard-revenue">$${revenue.toLocaleString()}</div>
                            <div class="leaderboard-funders">${funders} funder${funders !== 1 ? 's' : ''}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ===== IDEAS =====
        let ideas = [];

        async function loadAndRenderIdeas() {
            const container = document.getElementById('ideasContainer');

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/ideas?select=*&order=created_at.desc`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                ideas = await response.json();
                console.log('Loaded ideas:', ideas);

                if (ideas.error || !Array.isArray(ideas)) {
                    throw new Error(ideas.message || 'Failed to load ideas');
                }

                renderIdeas(container);
            } catch (error) {
                console.error('Error loading ideas:', error);
                container.innerHTML = `
                    <div class="leaderboard-empty">
                        <div class="leaderboard-empty-icon"></div>
                        <div>No ideas yet</div>
                    </div>
                `;
            }
        }

        function renderIdeas(container) {
            // Sort considering by votes (highest first)
            const considering = ideas.filter(i => i.status === 'considering').sort((a, b) => (b.votes || 0) - (a.votes || 0));
            const rejected = ideas.filter(i => i.status === 'rejected');

            // Apps in testing/funding phase (not yet at $5000)
            const testingApps = apps.filter(a => (a.total_revenue || 0) < 5000);
            // Apps that hit $5000+ are "graduated"
            const graduatedApps = apps.filter(a => (a.total_revenue || 0) >= 5000);

            container.innerHTML = `
                <div class="ideas-kanban">
                    <div class="ideas-column">
                        <div class="ideas-column-header">
                             Rejected <span class="count">${rejected.length}</span>
                        </div>
                        <div class="ideas-column-content">
                            ${rejected.length > 0 ? rejected.map(renderIdeaCard).join('') : '<div style="color: var(--text-tertiary); font-size: 0.75rem; text-align: center; padding: 20px 0;">None</div>'}
                        </div>
                    </div>
                    <div class="ideas-column">
                        <div class="ideas-column-header">
                             Considering <span class="count">${considering.length}</span>
                        </div>
                        <button class="add-idea-btn" onclick="openAddIdeaModal()" style="width: 100%; margin-bottom: 8px; justify-content: center;">
                            <span></span> Submit Idea
                        </button>
                        <div class="ideas-column-content">
                            ${considering.length > 0 ? considering.map(renderIdeaCard).join('') : '<div style="color: var(--text-tertiary); font-size: 0.75rem; text-align: center; padding: 20px 0;">None</div>'}
                        </div>
                    </div>
                    <div class="ideas-column">
                        <div class="ideas-column-header">
                             Testing/Funding <span class="count">${testingApps.length}</span>
                        </div>
                        <div class="ideas-column-content">
                            ${testingApps.length > 0 ? testingApps.map(renderTestingAppCard).join('') : '<div style="color: var(--text-tertiary); font-size: 0.75rem; text-align: center; padding: 20px 0;">None</div>'}
                        </div>
                    </div>
                    <div class="ideas-column">
                        <div class="ideas-column-header">
                             Graduated <span class="count">${graduatedApps.length}</span>
                        </div>
                        <div class="ideas-column-content">
                            ${graduatedApps.length > 0 ? graduatedApps.map(renderTestingAppCard).join('') : '<div style="color: var(--text-tertiary); font-size: 0.75rem; text-align: center; padding: 20px 0;">None</div>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTestingAppCard(app) {
            const revenue = app.total_revenue || 0;
            const progress = Math.min((revenue / 5000) * 100, 100);
            const isGraduated = revenue >= 5000;

            return `
                <div class="idea-card ${isGraduated ? 'live' : 'considering'}" onclick="openApp('${app.slug}')" style="cursor: pointer;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <img src="${app.icon_url || '/assets/suite-icon.png'}"
                             style="width: 28px; height: 28px; border-radius: 6px; object-fit: cover;"
                             onerror="this.src='/assets/suite-icon.png'">
                        <div class="idea-name" style="margin-bottom: 0;">${app.name}</div>
                    </div>
                    <div class="idea-tagline">${app.tagline || app.description || ''}</div>
                    <div style="margin-top: 8px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                            <span>$${revenue.toLocaleString()}</span>
                            <span>$5,000</span>
                        </div>
                        <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                            <div style="height: 100%; width: ${progress}%; background: ${isGraduated ? '#22c55e' : '#818cf8'}; border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIdeaCard(idea) {
            const categoryEmojis = {
                productivity: '',
                health: '',
                finance: '',
                entertainment: '',
                education: '',
                utilities: '',
                social: ''
            };

            const categoryEmoji = categoryEmojis[idea.category] || '';
            const userVote = getUserVote(idea.id);
            const voteCount = idea.votes || 0;
            const voteColorClass = voteCount > 0 ? 'positive' : voteCount < 0 ? 'negative' : '';

            let extraContent = '';
            if (idea.status === 'rejected' && idea.rejection_reason) {
                extraContent = `<div class="idea-reason">${idea.rejection_reason}</div>`;
            }
            if (idea.status === 'live' && idea.app_slug) {
                extraContent = `<a href="javascript:openApp('${idea.app_slug}')" class="idea-link">Open App </a>`;
            }

            // Add voting for considering ideas
            let votingContent = '';
            if (idea.status === 'considering') {
                votingContent = `
                    <div class="idea-votes">
                        <button class="vote-btn upvote ${userVote === 1 ? 'voted-up' : ''}" onclick="voteIdea('${idea.id}', 1)"></button>
                        <span class="vote-count ${voteColorClass}">${voteCount}</span>
                        <button class="vote-btn downvote ${userVote === -1 ? 'voted-down' : ''}" onclick="voteIdea('${idea.id}', -1)"></button>
                    </div>
                `;
            }

            // Add admin controls for considering ideas
            let adminContent = '';
            if (idea.status === 'considering' && isAdmin()) {
                adminContent = `
                    <div class="admin-controls">
                        <button class="admin-btn reject-quick" onclick="event.stopPropagation(); rejectIdea('${idea.id}')" title="Quick reject">
                             Reject
                        </button>
                        <button class="admin-btn reject-reason" onclick="event.stopPropagation(); openRejectReasonModal('${idea.id}')" title="Reject with reason">
                             With Note
                        </button>
                    </div>
                `;
            }

            return `
                <div class="idea-card ${idea.status}">
                    <div class="idea-name">${idea.name}</div>
                    <div class="idea-tagline">${idea.tagline || idea.description || ''}</div>
                    <div class="idea-meta">
                        <span>${categoryEmoji} ${idea.category || ''}</span>
                        ${idea.complexity ? `<span>${idea.complexity}</span>` : ''}
                    </div>
                    ${extraContent}
                    ${votingContent}
                    ${adminContent}
                </div>
            `;
        }

        // ===== VOTING & ADD IDEA =====
        let userVotes = JSON.parse(localStorage.getItem('idea_votes') || '{}');

        function getUserVote(ideaId) {
            return userVotes[ideaId] || 0;
        }

        async function voteIdea(ideaId, direction) {
            // Check if user is logged in (wallet or telegram)
            const tgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');
            if (!tgUser && !connectedWallet) {
                openConnectModal(); // Show connect modal
                return;
            }

            const currentVote = getUserVote(ideaId);
            let newVote = direction;

            // Toggle off if same direction clicked
            if (currentVote === direction) {
                newVote = 0;
            }

            // Calculate vote delta
            const delta = newVote - currentVote;

            // Update local state
            userVotes[ideaId] = newVote;
            localStorage.setItem('idea_votes', JSON.stringify(userVotes));

            // Update in Supabase
            try {
                const idea = ideas.find(i => i.id === ideaId);
                const newVotes = (idea.votes || 0) + delta;

                await fetch(
                    `${SUPABASE_URL}/rest/v1/ideas?id=eq.${ideaId}`,
                    {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({ votes: newVotes })
                    }
                );

                // Update local ideas array
                idea.votes = newVotes;
            } catch (err) {
                console.error('Vote error:', err);
            }

            // Re-render
            const container = document.getElementById('ideasContainer');
            if (container) renderIdeas(container);
        }

        // ===== ADMIN FUNCTIONS =====
        function isAdmin() {
            return connectedWallet && connectedWallet.toLowerCase() === ADMIN_WALLET.toLowerCase();
        }

        async function rejectIdea(ideaId, reason = null) {
            if (!isAdmin()) return;

            try {
                const updateData = { status: 'rejected' };
                if (reason) {
                    updateData.rejection_reason = reason;
                }

                await fetch(
                    `${SUPABASE_URL}/rest/v1/ideas?id=eq.${ideaId}`,
                    {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify(updateData)
                    }
                );

                // Update local ideas array
                const idea = ideas.find(i => i.id === ideaId);
                if (idea) {
                    idea.status = 'rejected';
                    if (reason) idea.rejection_reason = reason;
                }

                // Re-render
                const container = document.getElementById('ideasContainer');
                if (container) renderIdeas(container);
            } catch (err) {
                console.error('Reject error:', err);
                alert('Failed to reject idea');
            }
        }

        function openRejectReasonModal(ideaId) {
            document.getElementById('rejectIdeaId').value = ideaId;
            document.getElementById('rejectReasonText').value = '';
            document.getElementById('rejectReasonModal').classList.add('active');
        }

        function closeRejectReasonModal() {
            document.getElementById('rejectReasonModal').classList.remove('active');
        }

        async function confirmRejectWithReason() {
            const ideaId = document.getElementById('rejectIdeaId').value;
            const reason = document.getElementById('rejectReasonText').value.trim();

            if (!reason) {
                alert('Please enter a reason for rejection');
                return;
            }

            await rejectIdea(ideaId, reason);
            closeRejectReasonModal();
        }

        function openAddIdeaModal() {
            const tgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');
            const modal = document.getElementById('ideaModalOverlay');
            const formContent = document.getElementById('ideaFormContent');
            const authPrompt = document.getElementById('ideaAuthPrompt');

            // Check if user is logged in (wallet or telegram)
            if (!tgUser && !connectedWallet) {
                // Not logged in - show connect modal instead
                openConnectModal();
                return;
            }

            // Logged in - show the idea form directly
            formContent.style.display = 'block';
            authPrompt.style.display = 'none';
            modal.classList.add('active');
        }

        function closeIdeaModal() {
            document.getElementById('ideaModalOverlay').classList.remove('active');
            // Reset form
            document.getElementById('ideaName').value = '';
            document.getElementById('ideaTagline').value = '';
            document.getElementById('ideaCategory').value = 'productivity';
        }

        // Check similarity between two strings (returns 0-1 score)
        function calculateSimilarity(str1, str2) {
            const s1 = str1.toLowerCase();
            const s2 = str2.toLowerCase();

            // Extract meaningful words (3+ chars)
            const words1 = s1.split(/\s+/).filter(w => w.length >= 3);
            const words2 = s2.split(/\s+/).filter(w => w.length >= 3);

            if (words1.length === 0 || words2.length === 0) return 0;

            // Count matching words
            let matches = 0;
            for (const w1 of words1) {
                for (const w2 of words2) {
                    // Check for exact match or one contains the other
                    if (w1 === w2 || w1.includes(w2) || w2.includes(w1)) {
                        matches++;
                        break;
                    }
                }
            }

            return matches / Math.max(words1.length, words2.length);
        }

        function findSimilarRejected(name, tagline) {
            const rejected = ideas.filter(i => i.status === 'rejected');
            const inputText = `${name} ${tagline}`.toLowerCase();

            for (const idea of rejected) {
                const rejectedText = `${idea.name} ${idea.tagline || ''} ${idea.description || ''}`;
                const similarity = calculateSimilarity(inputText, rejectedText);

                // Also check if key terms match directly
                const nameMatch = idea.name.toLowerCase().split(/\s+/).some(word =>
                    word.length >= 4 && inputText.includes(word)
                );

                if (similarity > 0.4 || nameMatch) {
                    return idea;
                }
            }
            return null;
        }

        let bypassSimilarityCheck = false;

        async function submitIdea() {
            const tgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');
            // Require either telegram or wallet to submit
            if (!tgUser && !connectedWallet) return;

            const name = document.getElementById('ideaName').value.trim();
            const tagline = document.getElementById('ideaTagline').value.trim();
            const category = document.getElementById('ideaCategory').value;

            if (!name) {
                alert('Please enter an idea name');
                return;
            }

            const submitBtn = document.querySelector('.idea-submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Analyzing...';

            // Check for similar rejected ideas (unless bypassed)
            if (!bypassSimilarityCheck) {
                const similarRejected = findSimilarRejected(name, tagline);
                if (similarRejected) {
                    showSimilarityWarning(similarRejected);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit Idea';
                    return;
                }
            }

            submitBtn.textContent = 'Submitting...';
            bypassSimilarityCheck = false; // Reset for next time

            try {
                await fetch(
                    `${SUPABASE_URL}/rest/v1/ideas`,
                    {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({
                            name,
                            tagline,
                            category,
                            status: 'considering',
                            votes: 0
                        })
                    }
                );

                closeIdeaModal();
                hideSimilarityWarning();
                // Reload ideas
                await loadAndRenderIdeas();
            } catch (err) {
                console.error('Submit error:', err);
                alert('Failed to submit idea');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Idea';
            }
        }

        function showSimilarityWarning(rejectedIdea) {
            const warning = document.getElementById('similarityWarning');
            const rejectedName = document.getElementById('rejectedIdeaName');
            const rejectedReason = document.getElementById('rejectedIdeaReason');

            rejectedName.textContent = rejectedIdea.name;
            rejectedReason.textContent = rejectedIdea.rejection_reason || 'No specific reason provided';
            warning.style.display = 'block';
        }

        function hideSimilarityWarning() {
            document.getElementById('similarityWarning').style.display = 'none';
        }

        function submitAnyway() {
            bypassSimilarityCheck = true;
            hideSimilarityWarning();
            submitIdea();
        }

        function saveTelegramUsername() {
            const username = document.getElementById('telegramUsername').value.trim().replace('@', '');
            if (!username) {
                alert('Please enter your Telegram username');
                return;
            }

            // Save to localStorage (preserve existing ID if present)
            const existing = JSON.parse(localStorage.getItem('telegram_user') || '{}');
            const tgUser = { ...existing, username: username, authType: 'telegram' };
            localStorage.setItem('telegram_user', JSON.stringify(tgUser));

            // Show the form
            document.getElementById('ideaAuthPrompt').style.display = 'none';
            document.getElementById('ideaFormContent').style.display = 'block';
        }

        // ===== APPS LOADING =====
        async function loadApps() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/apps?select=*&status=in.(live,approved,published)&order=created_at.desc`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                apps = await response.json();

                console.log('Loaded apps:', apps);

                if (apps.error) {
                    throw new Error(apps.message || 'Database error');
                }

                renderAppsGrid();
            } catch (error) {
                console.error('Failed to load apps:', error);
                document.getElementById('appsLoading').innerHTML = '<div>Failed to load apps. Check console for details.</div>';
            }
        }

        // App icon image paths
        const APP_ICON_IMAGES = {
            'foodvitals': '/assets/icons/foodvitals-icon.jpg',
            'cheshbon': '/assets/icons/cheshbon-icon.jpg',
            'opticrep': '/assets/icons/opticrep-icon.jpg',
            'remcast': '/assets/icons/remcast-icon.jpg',
            'trueform': '/assets/icons/trueform-icon.jpg',
            'notebox': '/assets/icons/notebox-icon.jpg',
            'cadence-ai': '/assets/icons/cadence-icon.jpg',
            'suitehub': '/assets/icons/suitehub-icon.jpg'
        };

        function getAppIcon(app) {
            // First check for icon_url in DB (admin-managed)
            if (app.icon_url) {
                return `<img src="${app.icon_url}" alt="${app.name}" class="app-icon-img">`;
            }
            // Then check for hardcoded image icon
            if (APP_ICON_IMAGES[app.slug]) {
                return `<img src="${APP_ICON_IMAGES[app.slug]}" alt="${app.name}" class="app-icon-img">`;
            }
            // Fallback to emoji
            if (app.emoji_icon) return app.emoji_icon;
            return APP_ICONS[app.slug] || APP_ICONS['default'];
        }

        // Tier calculation helper
        function getAppTier(funded) {
            if (funded >= 5000) return { name: 'Scale', icon: '', color: '#a855f7', next: null, nextAmount: null };
            if (funded >= 2500) return { name: 'Growth', icon: '', color: '#3b82f6', next: 'Scale', nextAmount: 5000 };
            if (funded >= 1000) return { name: 'Sprout', icon: '', color: '#4ade80', next: 'Growth', nextAmount: 2500 };
            return { name: 'Seed', icon: '', color: '#22c55e', next: 'Sprout', nextAmount: 1000 };
        }

        function renderAppsGrid() {
            const grid = document.getElementById('appsGrid');
            const loading = document.getElementById('appsLoading');
            const filterBar = document.getElementById('appsFilterBar');
            const featuredSection = document.getElementById('featuredAppsSection');
            const featuredGrid = document.getElementById('featuredAppsGrid');

            console.log('[renderAppsGrid] Starting, apps:', apps.length);

            if (!apps || apps.length === 0) {
                if (loading) loading.innerHTML = '<div>No apps available</div>';
                return;
            }

            try {
                // Show filter bar
                if (filterBar) filterBar.style.display = 'flex';

                // Get Scale tier apps (featured)
                const scaleApps = apps.filter(app => (parseFloat(app.total_funded) || 0) >= 5000);
                console.log('[renderAppsGrid] Scale apps:', scaleApps.length);

                // Hide featured section - using unified grid now
                if (featuredSection) {
                    featuredSection.style.display = 'none';
                }

                // Get filtered and sorted apps
                const allFilteredApps = getFilteredAndSortedApps();
                console.log('[renderAppsGrid] Filtered apps:', allFilteredApps.length);

            // Render all apps in new horizontal card layout with expandable section
            grid.innerHTML = allFilteredApps.map(app => {
                const tagline = app.tagline || app.description || 'AI-powered app';
                const shortTagline = tagline.length > 50 ? tagline.substring(0, 50) + '...' : tagline;
                const funded = parseFloat(app.total_funded) || 0;
                const tier = getAppTier(funded);
                const tierClass = tier.name.toLowerCase();
                const progressPercent = tier.nextAmount ? Math.min((funded / tier.nextAmount) * 100, 100) : 100;

                return `
                    <div class="app-card" data-slug="${app.slug}" onclick="toggleAppCard('${app.slug}')">
                        <div class="app-icon">${getAppIcon(app)}</div>
                        <div class="app-info">
                            <div class="app-name">${app.name}</div>
                            <div class="app-tagline">${shortTagline}</div>
                        </div>
                        <button class="view-btn" onclick="event.stopPropagation(); toggleAppCard('${app.slug}')">View</button>

                        <div class="app-card-expanded">
                            <div class="expanded-view-options">
                                <button class="view-option-btn" onclick="event.stopPropagation(); openAppMobile('${app.slug}')">
                                    <span class="option-icon"></span>
                                    Mobile
                                </button>
                                <button class="view-option-btn" onclick="event.stopPropagation(); openAppFullscreen('${app.slug}')">
                                    <span class="option-icon"></span>
                                    Web
                                </button>
                            </div>
                            <div class="expanded-tier-info">
                                <div class="tier-badge-small ${tierClass}">
                                    ${tier.icon} ${tier.name}
                                </div>
                                <div class="tier-progress-mini">
                                    <div class="tier-progress-bar">
                                        <div class="tier-progress-fill" style="width: ${progressPercent}%; background: ${tier.color};"></div>
                                    </div>
                                    <div class="tier-progress-text">$${Math.floor(funded).toLocaleString()}${tier.nextAmount ? ` / $${tier.nextAmount.toLocaleString()}` : ' - Max Tier'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add "What's Next?" card at the end
            grid.innerHTML += `
                <div class="app-card mystery-card" onclick="openVotingSection()">
                    <div class="app-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); font-size: 24px;"></div>
                    <div class="app-info">
                        <div class="app-name">What's Next?</div>
                        <div class="app-tagline">Vote for the next app to be built</div>
                    </div>
                    <button class="view-btn" onclick="event.stopPropagation(); openVotingSection()" style="background: #6366f1;">Vote</button>
                </div>
            `;

            loading.style.display = 'none';
            grid.style.display = 'grid';

            } catch (error) {
                console.error('[renderAppsGrid] Error:', error);
                if (loading) loading.innerHTML = '<div>Error loading apps</div>';
            }
        }

        function openVotingSection() {
            // Scroll to feature requests section or open a voting modal
            // For now, link to the homepage feature requests
            window.location.href = '/#feature-requests';
        }

        function renderGraduatedApps() {
            const grid = document.getElementById('graduatedGrid');
            const emptyState = document.getElementById('graduatedEmpty');

            // Filter graduated apps (funded >= $5000)
            const graduatedApps = apps.filter(app => {
                const funded = parseFloat(app.total_funded) || 0;
                return funded >= GRADUATION_THRESHOLD;
            });

            if (graduatedApps.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            grid.style.display = 'grid';

            grid.innerHTML = graduatedApps.map(app => {
                const funded = parseFloat(app.total_funded) || 0;

                // Build links (use fields from DB if available)
                let linksHtml = '';
                if (app.website_url) {
                    linksHtml += `<a href="${app.website_url}" target="_blank" class="graduated-link"><span class="graduated-link-icon">&#x1F310;</span> Website</a>`;
                }
                if (app.ios_url) {
                    linksHtml += `<a href="${app.ios_url}" target="_blank" class="graduated-link"><span class="graduated-link-icon">&#x1F34E;</span> iOS</a>`;
                }
                if (app.android_url) {
                    linksHtml += `<a href="${app.android_url}" target="_blank" class="graduated-link"><span class="graduated-link-icon">&#x1F4F1;</span> Android</a>`;
                }
                if (app.twitter_url) {
                    linksHtml += `<a href="${app.twitter_url}" target="_blank" class="graduated-link"><span class="graduated-link-icon">&#x1D54F;</span> </a>`;
                }

                // Fallback if no links yet
                if (!linksHtml) {
                    linksHtml = `<span class="graduated-link" style="opacity: 0.5;">Links coming soon</span>`;
                }

                return `
                    <div class="graduated-card">
                        <div class="graduated-card-header">
                            <div class="graduated-card-icon">${getAppIcon(app)}</div>
                            <div class="graduated-card-info">
                                <div class="graduated-card-name">${app.name}</div>
                                <div class="graduated-card-funded">&#x2705; $${Math.floor(funded).toLocaleString()} funded</div>
                            </div>
                        </div>
                        <div class="graduated-card-desc">${app.description || 'A SUITE-incubated app that graduated to a standalone product.'}</div>
                        <div class="graduated-card-links">${linksHtml}</div>
                    </div>
                `;
            }).join('');
        }

        // ===== APP CARD EXPANSION =====
        function toggleAppCard(slug) {
            const cards = document.querySelectorAll('.app-card');
            cards.forEach(card => {
                if (card.dataset.slug === slug) {
                    card.classList.toggle('expanded');
                } else {
                    card.classList.remove('expanded');
                }
            });
        }

        function openAppMobile(slug) {
            const app = apps.find(a => a.slug === slug);
            if (app) executeOpenApp(app, 'mobile');
        }

        function openAppFullscreen(slug) {
            const app = apps.find(a => a.slug === slug);
            if (app) executeOpenApp(app, 'fullscreen');
        }

        // ===== APP NAVIGATION =====
        let pendingAppSlug = null;

        function openApp(slug, forceMode = null) {
            const app = apps.find(a => a.slug === slug);
            if (!app) return;

            // Check if on mobile (< 900px) - always fullscreen
            const isMobile = window.innerWidth < 900;

            // Check URL for fullscreen param
            const params = new URLSearchParams(window.location.search);
            const urlFullscreen = params.get('fullscreen') === 'true';

            if (forceMode) {
                // Mode specified directly
                executeOpenApp(app, forceMode);
            } else if (isMobile || urlFullscreen) {
                // Mobile or URL specified fullscreen
                executeOpenApp(app, 'fullscreen');
            } else {
                // Desktop: show choice modal
                pendingAppSlug = slug;
                document.getElementById('viewChoiceAppName').textContent = app.name;
                document.getElementById('viewChoiceModal').classList.add('active');
            }
        }

        function openAppInMode(mode) {
            const slug = pendingAppSlug;  // Save before closing modal clears it
            closeViewChoiceModal();
            if (slug) {
                const app = apps.find(a => a.slug === slug);
                if (app) {
                    executeOpenApp(app, mode);
                }
            }
        }

        function executeOpenApp(app, mode) {
            currentApp = app;

            // Update URL without reload
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('app', app.slug);
            if (mode === 'fullscreen') {
                newUrl.searchParams.set('fullscreen', 'true');
            } else {
                newUrl.searchParams.delete('fullscreen');
            }
            history.pushState({ app: app.slug, mode }, '', newUrl);

            // Show top nav, hide grid
            document.getElementById('appsGridContainer').style.display = 'none';
            document.getElementById('topNav').classList.add('active');

            const container = document.getElementById('appContainer');
            container.classList.add('active');

            // Apply mode
            if (mode === 'fullscreen') {
                container.classList.add('fullscreen-mode');
                container.classList.remove('focus-mode');
            } else {
                container.classList.remove('fullscreen-mode');
            }

            // Render top nav
            renderTopNav();

            // Load app features (for side panel if in mobile preview mode)
            if (mode !== 'fullscreen') {
                loadAppFeatures(app);
            }

            // Load app in iframe
            loadAppInIframe(app);
        }

        function closeViewChoiceModal() {
            document.getElementById('viewChoiceModal').classList.remove('active');
            pendingAppSlug = null;
        }

        function exitFullscreenMode() {
            const container = document.getElementById('appContainer');

            // Check if on mobile - if so, go back to app grid
            if (window.innerWidth < 900) {
                goHome();
                return;
            }

            // On desktop, switch to mobile preview mode
            container.classList.remove('fullscreen-mode');

            // Update URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('fullscreen');
            history.replaceState({ app: currentApp?.slug, mode: 'mobile' }, '', newUrl);

            // Load features for side panel
            if (currentApp) {
                loadAppFeatures(currentApp);
            }
        }

        // Load and render app features in side panel
        async function loadAppFeatures(app) {
            const featuresList = document.getElementById('appFeaturesList');
            const freeCountEl = document.getElementById('freeFeatureCount');
            const paidCountEl = document.getElementById('paidFeatureCount');

            if (!featuresList) return;

            featuresList.innerHTML = '<div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.85rem;">Loading features...</div>';

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/app_features?app_id=eq.${app.id}&is_active=eq.true&order=sort_order,credits_cost,name`,
                    { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }
                );
                const features = await response.json();

                if (!features || features.length === 0) {
                    featuresList.innerHTML = '<div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.85rem;">No features listed yet</div>';
                    if (freeCountEl) freeCountEl.textContent = '0';
                    if (paidCountEl) paidCountEl.textContent = '0';
                    return;
                }

                const freeCount = features.filter(f => f.credits_cost === 0).length;
                const paidCount = features.filter(f => f.credits_cost > 0).length;

                if (freeCountEl) freeCountEl.textContent = freeCount;
                if (paidCountEl) paidCountEl.textContent = paidCount;

                featuresList.innerHTML = features.map(feature => {
                    const isFree = feature.credits_cost === 0;
                    const costText = isFree
                        ? '<span style="color: #22c55e; font-weight: 600;">FREE</span>'
                        : `<span style="color: #a855f7; font-weight: 600;">${feature.credits_cost} credits</span>`;

                    return `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(255,255,255,0.03); border-radius: 10px; border-left: 3px solid ${isFree ? '#22c55e' : '#a855f7'};">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.1rem;">${feature.icon || ''}</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem;">${feature.name}</div>
                                    ${feature.description ? `<div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;">${feature.description}</div>` : ''}
                                </div>
                            </div>
                            <div style="font-size: 0.8rem; white-space: nowrap;">${costText}</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Failed to load app features:', error);
                featuresList.innerHTML = '<div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.85rem;">Features unavailable</div>';
            }
        }

        function renderTopNav() {
            const navApps = document.getElementById('navApps');
            navApps.innerHTML = apps.map(app => `
                <button class="nav-app ${app.slug === currentApp?.slug ? 'active' : ''}"
                        onclick="switchApp('${app.slug}')"
                        title="${app.name}">
                    ${getAppIcon(app)}
                </button>
            `).join('');
        }

        function switchApp(slug) {
            if (currentApp && slug === currentApp.slug) return;

            const app = apps.find(a => a.slug === slug);
            if (!app) return;

            currentApp = app;

            // Update URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('app', slug);
            history.replaceState({ app: slug }, '', newUrl);

            // Update active state in nav
            renderTopNav();

            // Load app features for side panel
            loadAppFeatures(app);

            // Show loading and load app
            document.getElementById('loadingOverlay').classList.remove('hidden');
            loadAppInIframe(app);
        }

        function loadAppInIframe(app) {
            document.getElementById('loadingText').textContent = `Loading ${app.name}...`;
            document.title = `${app.name} | SUITE`;

            // Build app URL (check app_url first, then fallback to other fields)
            let appUrl = app.app_url || app.pwa_url || app.expo_link || app.url;

            if (!appUrl) {
                console.error('No URL found for app:', app.name);
                document.getElementById('loadingText').textContent = 'No URL configured for this app';
                return;
            }

            // Add user params if logged in
            if (currentUser) {
                const userParams = new URLSearchParams({
                    tg_id: currentUser.id,
                    tg_username: currentUser.username || '',
                    tg_first_name: currentUser.firstName || '',
                    tg_photo: currentUser.photoUrl || ''
                });
                appUrl += (appUrl.includes('?') ? '&' : '?') + userParams.toString();
            }

            // Load in mobile iframe
            const iframe = document.getElementById('appIframe');
            iframe.src = appUrl;

            // Load in desktop iframe too
            const desktopIframe = document.getElementById('appIframeDesktop');
            if (desktopIframe) {
                desktopIframe.src = appUrl;
            }

            iframe.onload = () => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            };

            // Update side panel
            updateSidePanel(app);
        }

        function goHome() {
            currentApp = null;

            // Update URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('app');
            newUrl.searchParams.delete('fullscreen');
            history.pushState({}, '', newUrl);

            // Hide app, show grid
            document.getElementById('topNav').classList.remove('active');
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('appContainer').classList.remove('focus-mode');
            document.getElementById('appContainer').classList.remove('fullscreen-mode');
            document.getElementById('appsGridContainer').style.display = 'block';

            // Clear iframes
            document.getElementById('appIframe').src = 'about:blank';
            const desktopIframe = document.getElementById('appIframeDesktop');
            if (desktopIframe) desktopIframe.src = 'about:blank';
            document.getElementById('loadingOverlay').classList.remove('hidden');

            // Reset side panel state
            const panel = document.getElementById('sidePanel');
            if (panel) panel.classList.remove('collapsed');

            // Reset title
            document.title = 'SUITE Shell';
        }

        function handlePopState(event) {
            const params = new URLSearchParams(window.location.search);
            const appSlug = params.get('app');

            if (appSlug) {
                const app = apps.find(a => a.slug === appSlug);
                if (app && (!currentApp || currentApp.slug !== appSlug)) {
                    openApp(appSlug);
                }
            } else if (currentApp) {
                goHome();
            }
        }

        // ===== USER MANAGEMENT =====
        function saveUser(user) {
            localStorage.setItem('suiteUser', JSON.stringify(user));
        }

        function loadUser() {
            // Prioritize telegram_user (has proper auth with ID)
            const tgUser = localStorage.getItem('telegram_user');
            if (tgUser) {
                try {
                    const parsed = JSON.parse(tgUser);
                    if (parsed.id) {
                        return {
                            id: parsed.id,
                            username: parsed.username || parsed.first_name,
                            firstName: parsed.first_name || parsed.username,
                            photoUrl: parsed.photo_url || null,
                            source: 'telegram'
                        };
                    }
                } catch (e) {}
            }

            // Fallback to suiteUser
            const stored = localStorage.getItem('suiteUser') || localStorage.getItem('suiteTelegramUser');
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    return null;
                }
            }
            return null;
        }

        function updateUserDisplay() {
            if (!currentUser) return;

            const badge = document.getElementById('userBadge');
            const avatar = document.getElementById('userAvatar');
            const name = document.getElementById('userName');

            // Guard against missing elements
            if (!badge || !avatar || !name) {
                console.log('[User Display] Elements not found, skipping update');
                return;
            }

            if (currentUser.photoUrl) {
                avatar.src = currentUser.photoUrl;
                avatar.style.display = 'block';
            } else {
                avatar.style.display = 'none';
            }

            name.textContent = currentUser.username ? `@${currentUser.username}` : currentUser.firstName;
            badge.style.display = 'flex';
        }

        async function loadCredits() {
            if (!currentUser?.id) return;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/user_credits?telegram_id=eq.${currentUser.id}&select=suite_balance`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                const data = await response.json();
                if (data && data.length > 0) {
                    currentCredits = parseFloat(data[0].suite_balance) || 0;
                }
            } catch (error) {
                console.error('Failed to load credits:', error);
            }

            document.getElementById('navCreditsDisplay').textContent = Math.floor(currentCredits).toLocaleString();
        }

        // ===== IFRAME COMMUNICATION =====
        function handleIframeMessage(event) {
            if (event.data.type === 'CREDITS_UPDATED') {
                loadCredits();
            } else if (event.data.type === 'OPEN_DEPOSIT') {
                openDepositModal();
            }
        }

        // ===== DEPOSIT MODAL =====
        function openDepositModal() {
            document.getElementById('depositModal').classList.add('active');
        }

        function closeDepositModal() {
            document.getElementById('depositModal').classList.remove('active');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.deposit-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            document.getElementById('cryptoTab').classList.toggle('active', tabName === 'crypto');
            document.getElementById('qrTab').classList.toggle('active', tabName === 'qr');
        }

        // ===== WALLET CONNECTION =====
        async function checkWalletConnection() {
            // Only auto-connect if user previously connected (stored in localStorage)
            const savedWallet = localStorage.getItem('connectedWallet');
            if (!savedWallet) {
                // No saved wallet - don't auto-connect
                return;
            }

            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0 && accounts[0].toLowerCase() === savedWallet.toLowerCase()) {
                        connectedWallet = accounts[0];
                        updateWalletDisplay();
                        await loadCreditsForWallet(connectedWallet);
                    } else {
                        // Wallet changed or disconnected in MetaMask - clear localStorage
                        localStorage.removeItem('connectedWallet');
                    }
                } catch (e) {
                    console.log('Wallet check failed:', e);
                }
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('Please install MetaMask or another Web3 wallet to connect.');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (accounts.length > 0) {
                    connectedWallet = accounts[0];

                    // Save to localStorage so we stay connected on page reload
                    localStorage.setItem('connectedWallet', connectedWallet);

                    updateWalletDisplay();
                    closeConnectModal();
                    updateAuthDisplay();

                    // Load credits for this wallet
                    await loadCreditsForWallet(connectedWallet);
                }
            } catch (error) {
                console.error('Wallet connection failed:', error);
            }
        }

        async function loadCreditsForWallet(walletAddress) {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/suite_credits?wallet_address=eq.${walletAddress.toLowerCase()}&select=balance,locked_balance,linked_telegram_username`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                const data = await response.json();

                if (data && data.length > 0) {
                    currentCredits = parseFloat(data[0].balance || 0) + parseFloat(data[0].locked_balance || 0);
                    // If wallet has linked telegram, store it (but don't overwrite if already has ID)
                    if (data[0].linked_telegram_username) {
                        const existing = JSON.parse(localStorage.getItem('telegram_user') || '{}');
                        if (!existing.id) {
                            // Only update if we don't already have a complete telegram user with ID
                            const tgUser = {
                                ...existing,
                                username: data[0].linked_telegram_username.replace('@', ''),
                                authType: 'telegram',
                                // Include telegram_id from DB if available
                                ...(data[0].linked_telegram_id ? { id: data[0].linked_telegram_id } : {})
                            };
                            localStorage.setItem('telegram_user', JSON.stringify(tgUser));
                        }
                    }
                } else {
                    // Create new wallet record with 0 balance
                    currentCredits = 0;
                    await fetch(`${SUPABASE_URL}/rest/v1/suite_credits`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({
                            wallet_address: walletAddress.toLowerCase(),
                            balance: 0,
                            locked_balance: 0
                        })
                    });
                }

                document.getElementById('navCreditsDisplay').textContent = Math.floor(currentCredits).toLocaleString();
            } catch (error) {
                console.error('Failed to load wallet credits:', error);
            }
        }

        function updateWalletDisplay() {
            const status = document.getElementById('walletStatus');
            const addressDisplay = document.getElementById('walletAddressDisplay');
            const connectBtn = document.getElementById('connectWalletBtn');

            if (connectedWallet) {
                status.classList.add('connected');
                addressDisplay.textContent = `${connectedWallet.slice(0, 6)}...${connectedWallet.slice(-4)}`;
                connectBtn.textContent = 'Connected';
                connectBtn.disabled = true;
                document.getElementById('depositBtn').disabled = false;
            } else {
                status.classList.remove('connected');
                addressDisplay.textContent = 'Not connected';
                connectBtn.textContent = 'Connect';
                connectBtn.disabled = false;
                document.getElementById('depositBtn').disabled = true;
            }
        }

        async function linkWalletToUser(walletAddress, telegramId) {
            // This is now handled via bot verification flow
            // Kept for backwards compatibility
            console.log('Link wallet to user - use bot verification flow');
        }

        // ===== UNIFIED AUTH FUNCTIONS =====
        // Use nav-component's connect modal (injected by nav-component.js)
        function openConnectModal() {
            if (typeof openNavConnectModal === 'function') {
                openNavConnectModal();
            }
        }

        function closeConnectModal() {
            if (typeof closeNavConnectModal === 'function') {
                closeNavConnectModal();
            }
        }

        // Telegram login widget - opens Telegram OAuth popup
        function loginWithTelegramWidget() {
            const botId = '8341049569';
            const origin = window.location.origin;

            // Calculate popup position (center of screen)
            const width = 550;
            const height = 470;
            const left = Math.max(0, (screen.width - width) / 2);
            const top = Math.max(0, (screen.height - height) / 2);

            // Open Telegram OAuth popup
            const authUrl = `https://oauth.telegram.org/auth?bot_id=${botId}&origin=${encodeURIComponent(origin)}&request_access=write`;

            const popup = window.open(
                authUrl,
                'telegram_auth',
                `width=${width},height=${height},left=${left},top=${top},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`
            );

            // Listen for the auth response
            window.addEventListener('message', function handleTelegramAuth(event) {
                if (event.origin !== 'https://oauth.telegram.org') return;

                try {
                    const data = JSON.parse(event.data);
                    if (data.event === 'auth_result' && data.result) {
                        const user = data.result;
                        const tgUser = {
                            id: user.id,
                            username: user.username || user.first_name,
                            first_name: user.first_name,
                            last_name: user.last_name,
                            photo_url: user.photo_url,
                            auth_date: user.auth_date,
                            hash: user.hash,
                            authType: 'telegram'
                        };

                        localStorage.setItem('telegram_user', JSON.stringify(tgUser));
                        currentUser = tgUser;

                        // Close modal and update display
                        closeConnectModal();
                        updateAuthDisplay();

                        // Check if this telegram is linked to a wallet
                        if (tgUser.username) {
                            checkTelegramWalletLink(tgUser.username);
                        }

                        window.removeEventListener('message', handleTelegramAuth);
                    }
                } catch (e) {
                    console.error('Telegram auth error:', e);
                }
            });

            // Fallback: check if popup was blocked
            if (!popup || popup.closed) {
                alert('Popup was blocked. Please allow popups for this site.');
            }
        }

        async function checkTelegramWalletLink(username) {
            try {
                // Check if telegram is linked to any wallet
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/suite_credits?linked_telegram_username=eq.@${username}&select=wallet_address,balance,locked_balance`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                const data = await response.json();

                if (data && data.length > 0) {
                    // Telegram is linked to a wallet - load those credits
                    currentCredits = parseFloat(data[0].balance || 0) + parseFloat(data[0].locked_balance || 0);
                    connectedWallet = data[0].wallet_address;
                } else {
                    // Not linked - show 0 credits
                    currentCredits = 0;
                }

                document.getElementById('navCreditsDisplay').textContent = Math.floor(currentCredits).toLocaleString();
                updateAuthDisplay();
            } catch (error) {
                console.error('Failed to check telegram link:', error);
            }
        }

        function updateAuthDisplay() {
            // Use nav-component's IDs (injected by nav-component.js)
            const connectBtn = document.getElementById('navConnectBtn');
            const authDisplay = document.getElementById('navAuthDisplay');
            const authIdentity = document.getElementById('navAuthIdentity');
            const authIdentityText = document.getElementById('navAuthIdentityText');
            const creditsDisplay = document.getElementById('navCreditsDisplay');

            // Elements may not exist yet if nav-component hasn't loaded
            if (!connectBtn || !authDisplay) return;

            const tgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');

            if (connectedWallet) {
                // Wallet connected - show full auth display
                connectBtn.style.display = 'none';
                authDisplay.style.display = 'flex';
                authIdentity.className = 'auth-identity wallet';
                authIdentityText.textContent = `${connectedWallet.slice(0, 6)}...${connectedWallet.slice(-4)}`;
            } else if (tgUser) {
                // Telegram only - show telegram identity
                connectBtn.style.display = 'none';
                authDisplay.style.display = 'flex';
                authIdentity.className = 'auth-identity telegram';
                authIdentityText.textContent = `@${tgUser.username}`;
            } else {
                // Not logged in - show connect button
                connectBtn.style.display = 'flex';
                authDisplay.style.display = 'none';
            }
        }

        function openProfileMenu() {
            // TODO: Show profile dropdown with options like:
            // - Link Telegram (if wallet only)
            // - Link Wallet (if telegram only)
            // - View Profile
            // - Disconnect
            const tgUser = JSON.parse(localStorage.getItem('telegram_user') || 'null');

            if (connectedWallet && !tgUser) {
                // Wallet connected but no telegram - offer to link
                if (confirm('Would you like to link your Telegram account?\n\nThis lets you access credits via Telegram login.')) {
                    window.open(`https://t.me/suitehubbot?start=link_${connectedWallet}`, '_blank');
                }
            } else if (tgUser && !connectedWallet) {
                // Telegram only - offer to connect wallet
                if (confirm('Would you like to connect a wallet?\n\nThis gives you access to deposits, withdrawals, and paid features.')) {
                    openConnectModal();
                }
            } else {
                // Both connected or just view profile
                window.location.href = 'wallet.html';
            }
        }

        function disconnectAuth() {
            connectedWallet = null;
            currentUser = null;
            currentCredits = 0;
            localStorage.removeItem('connectedWallet');
            localStorage.removeItem('telegram_user');
            localStorage.removeItem('suiteUser');
            updateAuthDisplay();
            document.getElementById('navCreditsDisplay').textContent = '0';
        }

        // ===== DEPOSIT FUNCTIONS =====
        function toggleAsset() {
            const icon = document.getElementById('assetIcon');
            const symbol = document.getElementById('assetSymbol');

            if (selectedAsset === 'ETH') {
                selectedAsset = 'USDC';
                icon.src = 'https://cryptologos.cc/logos/usd-coin-usdc-logo.png';
                symbol.textContent = 'USDC';
            } else {
                selectedAsset = 'ETH';
                icon.src = 'https://cryptologos.cc/logos/ethereum-eth-logo.png';
                symbol.textContent = 'ETH';
            }
            updateCreditsPreview();
        }

        function setAmount(amount) {
            document.getElementById('depositAmount').value = amount;
            updateCreditsPreview();
        }

        function updateCreditsPreview() {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            let usdValue = 0;

            if (selectedAsset === 'ETH') {
                usdValue = amount * ETH_PRICE_USD;
            } else {
                usdValue = amount;
            }

            const credits = Math.floor(usdValue * 1000);
            document.getElementById('creditsPreview').textContent = credits.toLocaleString() + ' credits';
        }

        async function executeDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            if (amount <= 0) {
                alert('Please enter an amount');
                return;
            }

            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }

            const btn = document.getElementById('depositBtn');
            btn.disabled = true;
            btn.innerHTML = '&#x23F3; Processing...';

            try {
                if (selectedAsset === 'ETH') {
                    const amountWei = '0x' + BigInt(Math.floor(amount * 1e18)).toString(16);

                    const txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: connectedWallet,
                            to: TREASURY_ADDRESS,
                            value: amountWei,
                            data: '0xf6326fb3'
                        }]
                    });

                    alert(`Deposit submitted!\n\nTx: ${txHash}\n\nCredits will be added once confirmed.`);
                    closeDepositModal();
                } else {
                    alert('USDC deposits coming soon! Please use ETH for now.');
                }
            } catch (error) {
                console.error('Deposit error:', error);
                alert(error.message || 'Deposit failed');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '&#x1F680; Deposit';
                updateCreditsPreview();
            }
        }

        // ===== QR CODE =====

        // ===== FUND APP MODAL =====
        let currentFundApp = null;
        let selectedFundOption = null;

        // Learn More Toggle
        function toggleLearnMore() {
            const content = document.getElementById('learnMoreContent');
            const arrow = document.getElementById('learnMoreArrow');
            const btn = document.getElementById('learnMoreBtn');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                content.classList.add('showing');
                arrow.style.transform = 'rotate(180deg)';
                btn.querySelector('span').textContent = 'Hide details';
            } else {
                content.classList.remove('showing');
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
                btn.querySelector('span').textContent = 'Learn how it works';
            }
        }

        // Scroll to element helper
        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Tier benefits for the modal
        const TIER_BENEFITS = {
            seed: [' Prototype in SUITE Shell', ' Core functionality', ' Community testing'],
            sprout: [' Polished user experience', ' Priority bug fixes', ' Feature requests'],
            growth: [' Full feature set', ' Production-ready', ' Performance optimized'],
            launch: [' Own website & domain', ' AI social media engine', ' Official X account'],
            scale: [' App Store listing', ' Crypto-free version', ' Real company']
        };

        // Revenue streams for each app
        const APP_REVENUE_STREAMS = {
            'foodvitals': [
                { icon: '', name: 'AI Credits', desc: '$0.02/scan' },
                { icon: '', name: 'Premium', desc: '$4.99/mo' },
                { icon: '', name: 'B2B API', desc: 'Enterprise' }
            ],
            'cheshbon': [
                { icon: '', name: 'AI Credits', desc: '$0.01/calc' },
                { icon: '', name: 'Premium', desc: '$2.99/mo' },
                { icon: '', name: 'Reports', desc: '$0.99/export' }
            ],
            'opticrep': [
                { icon: '', name: 'AI Credits', desc: '$0.05/analysis' },
                { icon: '', name: 'Premium', desc: '$9.99/mo' },
                { icon: '', name: 'Clinic API', desc: 'Enterprise' }
            ],
            'trueform': [
                { icon: '', name: 'AI Credits', desc: '$0.03/rep' },
                { icon: '', name: 'Premium', desc: '$6.99/mo' },
                { icon: '', name: 'Gym Plans', desc: 'B2B' }
            ],
            'remcast': [
                { icon: '', name: 'AI Credits', desc: '$0.02/dream' },
                { icon: '', name: 'Premium', desc: '$3.99/mo' },
                { icon: '', name: 'Art Export', desc: '$0.50/image' }
            ],
            'default': [
                { icon: '', name: 'AI Credits', desc: 'Per use' },
                { icon: '', name: 'Premium', desc: 'Monthly' },
                { icon: '', name: 'Enterprise', desc: 'Custom' }
            ]
        };

        function toggleInvestmentDetails() {
            const details = document.getElementById('fundInvestmentDetails');
            const arrow = document.getElementById('fundDetailsArrow');
            const text = document.getElementById('fundDetailsToggleText');

            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                arrow.textContent = '';
                text.textContent = 'View Investment Details';
            } else {
                details.classList.add('expanded');
                arrow.textContent = '';
                text.textContent = 'Hide Investment Details';
            }
        }

        function openAppDocs(docType) {
            const app = currentFundApp;
            if (!app) return;

            // For now, show alert - in future, link to actual docs
            const docInfo = {
                model: `${app.name} generates revenue through AI credit usage, premium subscriptions, and enterprise API access. Users pay per AI-powered feature usage, with premium users getting discounted rates.`,
                projections: `Based on current growth, ${app.name} is projected to generate $${Math.floor((app.funded || 0) * 0.15)} - $${Math.floor((app.funded || 0) * 0.25)} annually at current funding level. Reaching Launch tier typically 3x revenue potential.`,
                terms: `100% of app revenue is distributed to funders proportional to their contribution. Revenue is distributed monthly to your wallet.`
            };

            alert(docInfo[docType] || 'Documentation coming soon.');
        }

        function openFundModal(appId, appName, currentFunded, funderCount) {
            currentFundApp = { id: appId, name: appName, funded: currentFunded, funders: funderCount };

            // Get tier info
            const tier = getAppTier(currentFunded);

            // Update modal title
            document.getElementById('fundModalTitle').textContent = `Fund ${appName}`;

            // Update tier badges
            document.getElementById('fundTierBadge').textContent = tier.icon;
            document.getElementById('fundTierName').textContent = tier.name;
            document.getElementById('fundTierName').style.color = tier.color;

            // Update progress text and bar
            const progressText = tier.nextAmount
                ? `$${Math.floor(currentFunded).toLocaleString()} / $${tier.nextAmount.toLocaleString()}`
                : `$${Math.floor(currentFunded).toLocaleString()}`;
            document.getElementById('fundProgressText').textContent = progressText;

            const progressPercent = tier.nextAmount
                ? Math.min((currentFunded / tier.nextAmount) * 100, 100)
                : 100;
            document.getElementById('fundProgressFill').style.width = `${progressPercent}%`;
            document.getElementById('fundProgressFill').style.background = tier.color;

            // Update next tier info (compact layout)
            const tierRight = document.querySelector('.fund-tier-right');
            const tierBenefits = document.getElementById('fundTierBenefits');
            if (tier.next) {
                const nextTier = getAppTier(tier.nextAmount);
                document.getElementById('fundNextTierBadge').textContent = nextTier.icon;
                document.getElementById('fundNextTierName').textContent = tier.next;
                document.getElementById('fundNextTierName').style.color = nextTier.color;
                tierRight.style.display = 'flex';

                // Show benefits of next tier (compact single line)
                const nextTierKey = tier.next.toLowerCase();
                const benefits = TIER_BENEFITS[nextTierKey] || [];
                document.getElementById('fundBenefitsList').textContent = benefits[0] || '';
                tierBenefits.style.display = 'flex';
            } else {
                tierRight.style.display = 'none';
                tierBenefits.style.display = 'none';
            }

            // Reset selection
            selectedFundOption = null;
            document.getElementById('yieldOption').classList.remove('selected');
            document.getElementById('directOption').classList.remove('selected');
            document.getElementById('yieldInputContainer').style.display = 'none';
            document.getElementById('directInputContainer').style.display = 'none';
            document.getElementById('fundSubmitBtn').disabled = true;
            document.getElementById('fundSubmitBtn').textContent = 'Select an option';
            document.getElementById('directAmount').value = '';

            // Find app to get slug and revenue
            const app = apps.find(a => a.id === appId);
            const appSlug = app?.slug || 'default';
            const appRevenue = parseFloat(app?.total_revenue) || 0;

            // Populate revenue streams
            const streams = APP_REVENUE_STREAMS[appSlug] || APP_REVENUE_STREAMS['default'];
            document.getElementById('fundStreamsGrid').innerHTML = streams.map(s => `
                <div class="fund-stream-card">
                    <div class="fund-stream-icon">${s.icon}</div>
                    <div class="fund-stream-name">${s.name}</div>
                    <div class="fund-stream-desc">${s.desc}</div>
                </div>
            `).join('');

            // Populate financials
            document.getElementById('fundCurrentRevenue').textContent = `$${appRevenue.toFixed(0)}`;
            document.getElementById('fundFunderCount').textContent = funderCount.toString();

            // Calculate avg ROI (revenue / funded * 100)
            const avgROI = currentFunded > 0 && appRevenue > 0
                ? ((appRevenue / currentFunded) * 100).toFixed(1) + '%'
                : '--';
            document.getElementById('fundAvgReturn').textContent = avgROI;

            // Reset investment details to collapsed
            document.getElementById('fundInvestmentDetails').classList.remove('expanded');
            document.getElementById('fundDetailsArrow').textContent = '';
            document.getElementById('fundDetailsToggleText').textContent = 'View Investment Details';

            // Show modal
            document.getElementById('fundModal').classList.add('active');
        }

        function closeFundModal() {
            document.getElementById('fundModal').classList.remove('active');
            currentFundApp = null;
            selectedFundOption = null;
        }

        function selectFundOption(option) {
            selectedFundOption = option;

            // Update UI
            document.getElementById('yieldOption').classList.toggle('selected', option === 'yield');
            document.getElementById('directOption').classList.toggle('selected', option === 'direct');
            document.getElementById('yieldInputContainer').style.display = option === 'yield' ? 'block' : 'none';
            document.getElementById('directInputContainer').style.display = option === 'direct' ? 'block' : 'none';

            // Update submit button
            const submitBtn = document.getElementById('fundSubmitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = option === 'yield' ? 'Save Allocation' : 'Deposit Funds';

            // Focus input if direct
            if (option === 'direct') {
                setTimeout(() => document.getElementById('directAmount').focus(), 100);
            }
        }

        async function submitFunding() {
            if (!currentFundApp || !selectedFundOption || !currentUser) return;

            const submitBtn = document.getElementById('fundSubmitBtn');
            submitBtn.disabled = true;

            try {
                if (selectedFundOption === 'yield') {
                    // Save yield allocation
                    const percentage = parseInt(document.getElementById('yieldPercentage').value);

                    submitBtn.textContent = 'Saving...';

                    const response = await fetch(`${SUPABASE_URL}/rest/v1/yield_allocations`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'resolution=merge-duplicates'
                        },
                        body: JSON.stringify({
                            user_id: currentUser.id,
                            app_id: currentFundApp.id,
                            percentage: percentage,
                            updated_at: new Date().toISOString()
                        })
                    });

                    if (response.ok || response.status === 201) {
                        submitBtn.textContent = 'Allocation Saved!';
                        submitBtn.style.background = 'var(--accent-green)';

                        setTimeout(() => {
                            closeFundModal();
                            submitBtn.style.background = '';
                        }, 1500);
                    } else {
                        throw new Error('Failed to save allocation');
                    }

                } else if (selectedFundOption === 'direct') {
                    // Direct deposit
                    const amount = parseFloat(document.getElementById('directAmount').value);

                    if (!amount || amount <= 0) {
                        alert('Please enter a valid amount');
                        submitBtn.disabled = false;
                        return;
                    }

                    submitBtn.textContent = 'Processing...';

                    // Add funding record
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/app_funding`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({
                            app_id: currentFundApp.id,
                            user_id: currentUser.id,
                            amount: amount,
                            source: 'direct'
                        })
                    });

                    if (response.ok || response.status === 201) {
                        // Update app's total_funded (in a real system, use the DB function)
                        await fetch(`${SUPABASE_URL}/rest/v1/apps?id=eq.${currentFundApp.id}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=minimal'
                            },
                            body: JSON.stringify({
                                total_funded: currentFundApp.funded + amount,
                                funder_count: currentFundApp.funders + 1  // Simplified, should check if new funder
                            })
                        });

                        submitBtn.textContent = 'Funded!';
                        submitBtn.style.background = 'var(--accent-green)';

                        // Reload apps to show updated funding
                        await loadApps();
                        renderAppsGrid();

                        setTimeout(() => {
                            closeFundModal();
                            submitBtn.style.background = '';
                        }, 1500);
                    } else {
                        throw new Error('Failed to submit funding');
                    }
                }
            } catch (error) {
                console.error('Funding error:', error);
                alert('Failed to process funding. Please try again.');
                submitBtn.textContent = selectedFundOption === 'yield' ? 'Save Allocation' : 'Deposit Funds';
                submitBtn.disabled = false;
            }
        }

        // ===== APP REQUEST MODAL =====
        function openAppRequestModal() {
            document.getElementById('appRequestModal').classList.add('active');
        }

        function closeAppRequestModal() {
            document.getElementById('appRequestModal').classList.remove('active');
        }

        async function submitAppRequest(event) {
            event.preventDefault();

            const name = document.getElementById('requestName').value.trim();
            const telegram = document.getElementById('requestTelegram').value.trim();
            const businessType = document.getElementById('requestBusinessType').value;
            const complexity = document.querySelector('input[name="complexity"]:checked')?.value;
            const deployment = document.querySelector('input[name="deployment"]:checked')?.value;
            const description = document.getElementById('requestDescription').value.trim();

            if (!complexity) {
                alert('Please select an app complexity level');
                return;
            }

            const submitBtn = document.querySelector('.app-request-submit');
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/app_build_requests`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        name: name,
                        telegram: telegram,
                        business_type: businessType,
                        complexity: parseInt(complexity),
                        deployment_type: deployment,
                        description: description
                    })
                });

                if (response.ok || response.status === 201) {
                    submitBtn.textContent = 'Request Submitted!';
                    submitBtn.style.background = 'var(--accent-green)';

                    // Reset form and close after delay
                    setTimeout(() => {
                        document.getElementById('requestName').value = '';
                        document.getElementById('requestTelegram').value = '';
                        document.getElementById('requestBusinessType').value = '';
                        document.querySelectorAll('input[name="complexity"]').forEach(r => r.checked = false);
                        document.querySelector('input[name="deployment"][value="suite_shell"]').checked = true;
                        document.getElementById('requestDescription').value = '';
                        submitBtn.textContent = 'Submit Request';
                        submitBtn.style.background = '';
                        submitBtn.disabled = false;
                        closeAppRequestModal();
                    }, 2000);
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('App request error:', error);
                submitBtn.textContent = 'Submit Request';
                submitBtn.disabled = false;
                alert('Failed to submit request. Please try again or email us directly.');
            }
        }

        // ===== INFLUENCER SIGNUP =====
        async function subscribeInfluencer() {
            const emailInput = document.getElementById('influencerEmail');
            const btn = document.querySelector('.influencer-notify-btn');
            const email = emailInput.value.trim();

            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            btn.textContent = 'Subscribing...';
            btn.disabled = true;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/influencer_waitlist`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        email: email,
                        created_at: new Date().toISOString()
                    })
                });

                if (response.ok || response.status === 201) {
                    btn.textContent = 'Subscribed!';
                    btn.style.background = 'var(--accent-green)';
                    emailInput.value = '';
                    emailInput.placeholder = 'You\'re on the list!';
                } else {
                    throw new Error('Failed to subscribe');
                }
            } catch (error) {
                console.error('Subscription error:', error);
                btn.textContent = 'Notify Me';
                btn.disabled = false;
                alert('Already subscribed or error occurred. Try again later.');
            }
        }

        function generateQRCode() {
            const container = document.getElementById('qrCodeContainer');
            document.getElementById('treasuryAddress').textContent = TREASURY_ADDRESS;

            if (typeof QRCode !== 'undefined') {
                QRCode.toCanvas(TREASURY_ADDRESS, {
                    width: 180,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#ffffff'
                    }
                }, (error, canvas) => {
                    if (error) {
                        console.error('QR generation failed:', error);
                        container.innerHTML = '<p style="color: #ef4444;">QR code failed to load</p>';
                    } else {
                        container.innerHTML = '';
                        container.appendChild(canvas);
                    }
                });
            }
        }

        function copyAddress() {
            navigator.clipboard.writeText(TREASURY_ADDRESS).then(() => {
                const btn = event.target;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            });
        }

        // ===== ETHEREUM EVENT LISTENERS =====
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    connectedWallet = accounts[0];
                } else {
                    connectedWallet = null;
                }
                updateWalletDisplay();
            });
        }

        // ===== SIDE PANEL FUNCTIONS =====
        let appRequests = [];
        let requestFilter = 'all';

        function updateSidePanel(app) {
            // Update app name
            document.getElementById('panelAppName').textContent = app.name;

            // Calculate funding progress
            const funded = parseFloat(app.total_funded) || 0;
            const revenue = parseFloat(app.total_revenue) || 0;
            const funderCount = parseInt(app.funder_count) || 0;
            const tier = getAppTier(funded);

            // Calculate progress to next tier
            const progressTarget = tier.nextAmount || funded;
            const progressPercent = tier.nextAmount
                ? Math.min((funded / tier.nextAmount) * 100, 100)
                : 100;

            // Update progress bar
            document.getElementById('panelFundingFill').style.width = progressPercent + '%';
            document.getElementById('panelFundingFill').style.background = tier.color;
            document.getElementById('panelFundingText').textContent = tier.nextAmount
                ? `$${Math.floor(funded).toLocaleString()} / $${tier.nextAmount.toLocaleString()}`
                : `$${Math.floor(funded).toLocaleString()}`;

            // Update collapsed progress bar (vertical)
            document.getElementById('collapsedProgressFill').style.height = progressPercent + '%';
            document.getElementById('collapsedProgressFill').style.background = tier.color;

            // Update tier badge in panel
            document.getElementById('panelTierIcon').textContent = tier.icon;
            document.getElementById('panelTierName').textContent = tier.name;
            document.getElementById('panelTierName').style.color = tier.color;
            document.getElementById('panelNextTier').textContent = tier.next || 'Max Tier';

            // Update revenue streams preview
            const streams = APP_REVENUE_STREAMS[app.slug] || APP_REVENUE_STREAMS['default'];
            document.getElementById('panelStreamsPreview').innerHTML = streams.slice(0, 3).map(s => `
                <span style="padding: 4px 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 0.7rem; display: flex; align-items: center; gap: 4px;">
                    <span>${s.icon}</span> ${s.name}
                </span>
            `).join('');

            // Update panel stats
            document.getElementById('panelRevenue').textContent = `$${revenue.toFixed(0)}`;
            document.getElementById('panelFunders').textContent = funderCount.toString();
        }

        function openPanelFundModal() {
            if (!currentApp) return;
            const funded = parseFloat(currentApp.total_funded) || 0;
            const funderCount = parseInt(currentApp.funder_count) || 0;
            openFundModal(currentApp.id, currentApp.name, funded, funderCount);
        }

        function toggleSidePanel() {
            const panel = document.getElementById('sidePanel');
            const icon = document.getElementById('panelToggleIcon');
            const container = document.getElementById('appContainer');

            panel.classList.toggle('collapsed');

            if (panel.classList.contains('collapsed')) {
                icon.innerHTML = '&#x276F;'; // right arrow
            } else {
                icon.innerHTML = '&#x276E;'; // left arrow
            }

            // Exit focus mode if expanding panel
            if (!panel.classList.contains('collapsed')) {
                container.classList.remove('focus-mode');
                document.getElementById('focusIcon').innerHTML = '&#x26F6;';
            }
        }

        function toggleFocusMode() {
            const container = document.getElementById('appContainer');
            const panel = document.getElementById('sidePanel');
            const icon = document.getElementById('focusIcon');

            container.classList.toggle('focus-mode');

            if (container.classList.contains('focus-mode')) {
                icon.innerHTML = '&#x2716;'; // X to exit
                panel.classList.add('collapsed');
                document.getElementById('panelToggleIcon').innerHTML = '&#x276F;';
            } else {
                icon.innerHTML = '&#x26F6;'; // expand icon
            }
        }

        // ===== FEATURE REQUESTS & BUG REPORTS =====
        async function submitRequest(type) {
            if (!currentApp) return;
            if (!currentUser) {
                alert('Please log in to submit requests');
                return;
            }

            const inputId = type === 'feature' ? 'featureInput' : 'bugInput';
            const btnId = type === 'feature' ? 'featureSubmitBtn' : 'bugSubmitBtn';
            const input = document.getElementById(inputId);
            const btn = document.getElementById(btnId);
            const text = input.value.trim();

            if (!text) {
                alert('Please enter a description');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Submitting...';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/app_requests`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        app_slug: currentApp.slug,
                        type: type,
                        description: text,
                        user_id: currentUser.id,
                        user_name: currentUser.username || currentUser.firstName || 'Anonymous',
                        votes: 1,
                        voted_by: [currentUser.id]
                    })
                });

                if (response.ok) {
                    input.value = '';
                    loadAppRequests(currentApp.slug);
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('Submit error:', error);
                alert('Failed to submit. Please try again.');
            } finally {
                btn.disabled = false;
                btn.textContent = type === 'feature' ? 'Submit Feature' : 'Report Bug';
            }
        }

        async function loadAppRequests(appSlug) {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/app_requests?app_slug=eq.${appSlug}&order=votes.desc,created_at.desc&limit=20`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );
                appRequests = await response.json();
                renderRequests();
            } catch (error) {
                console.error('Failed to load requests:', error);
                appRequests = [];
                renderRequests();
            }
        }

        function filterRequests(filter) {
            requestFilter = filter;

            // Update tab states
            document.querySelectorAll('.requests-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });

            renderRequests();
        }

        function renderRequests() {
            const list = document.getElementById('requestsList');

            // Filter requests
            let filtered = appRequests;
            if (requestFilter !== 'all') {
                filtered = appRequests.filter(r => r.type === requestFilter);
            }

            if (filtered.length === 0) {
                list.innerHTML = `<div class="requests-empty">No ${requestFilter === 'all' ? 'requests' : requestFilter + 's'} yet. Be the first!</div>`;
                return;
            }

            list.innerHTML = filtered.map(request => {
                const hasVoted = currentUser && request.voted_by && request.voted_by.includes(currentUser.id);
                return `
                    <div class="request-item">
                        <div class="request-text">${escapeHtml(request.description)}</div>
                        <div class="request-meta">
                            <span class="request-type ${request.type}">${request.type === 'feature' ? 'Feature' : 'Bug'}</span>
                            <div class="request-vote">
                                <button class="vote-btn ${hasVoted ? 'voted' : ''}" onclick="voteOnRequest('${request.id}')" ${hasVoted ? 'disabled' : ''}>
                                    ${hasVoted ? '&#x2714;' : '&#x25B2;'}
                                </button>
                                <span class="vote-count">${request.votes || 0}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function voteOnRequest(requestId) {
            if (!currentUser) {
                alert('Please log in to vote');
                return;
            }

            const request = appRequests.find(r => r.id === requestId);
            if (!request) return;

            // Check if already voted
            if (request.voted_by && request.voted_by.includes(currentUser.id)) {
                return;
            }

            try {
                const newVotes = (request.votes || 0) + 1;
                const newVotedBy = [...(request.voted_by || []), currentUser.id];

                await fetch(`${SUPABASE_URL}/rest/v1/app_requests?id=eq.${requestId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        votes: newVotes,
                        voted_by: newVotedBy
                    })
                });

                // Update local state
                request.votes = newVotes;
                request.voted_by = newVotedBy;
                renderRequests();
            } catch (error) {
                console.error('Vote error:', error);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Keyboard shortcut for focus mode
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && currentApp) {
                const container = document.getElementById('appContainer');
                if (container.classList.contains('focus-mode')) {
                    toggleFocusMode();
                }
                // Also close bottom sheet on Escape
                closeBottomSheet();
            }
        });

        // ===== MOBILE BOTTOM SHEET =====
        let sheetFilter = 'all';

        function openBottomSheet() {
            if (!currentApp) return;

            // Update sheet with app info
            const funded = parseFloat(currentApp.total_funded) || 0;
            const progressPercent = Math.min((funded / GRADUATION_THRESHOLD) * 100, 100);

            document.getElementById('sheetAppName').textContent = currentApp.name;
            document.getElementById('sheetFundingFill').style.width = progressPercent + '%';
            document.getElementById('sheetFundingText').textContent = `$${Math.floor(funded).toLocaleString()} / $5,000`;

            // Show sheet
            document.getElementById('bottomSheetOverlay').classList.add('active');
            document.getElementById('bottomSheet').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Render requests
            renderSheetRequests();
        }

        function closeBottomSheet() {
            document.getElementById('bottomSheetOverlay').classList.remove('active');
            document.getElementById('bottomSheet').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function submitSheetRequest(type) {
            if (!currentApp) return;
            if (!currentUser) {
                alert('Please log in to submit requests');
                return;
            }

            const inputId = type === 'feature' ? 'sheetFeatureInput' : 'sheetBugInput';
            const btnId = type === 'feature' ? 'sheetFeatureBtn' : 'sheetBugBtn';
            const input = document.getElementById(inputId);
            const btn = document.getElementById(btnId);
            const text = input.value.trim();

            if (!text) {
                alert('Please enter a description');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Submitting...';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/app_requests`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        app_slug: currentApp.slug,
                        type: type,
                        description: text,
                        user_id: currentUser.id,
                        user_name: currentUser.username || currentUser.firstName || 'Anonymous',
                        votes: 1,
                        voted_by: [currentUser.id]
                    })
                });

                if (response.ok) {
                    input.value = '';
                    // Reload requests for both desktop and mobile
                    loadAppRequests(currentApp.slug);
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('Submit error:', error);
                alert('Failed to submit. Please try again.');
            } finally {
                btn.disabled = false;
                btn.textContent = type === 'feature' ? 'Submit Feature' : 'Report Bug';
            }
        }

        function filterSheetRequests(filter) {
            sheetFilter = filter;

            // Update tab states
            document.querySelectorAll('.sheet-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });

            renderSheetRequests();
        }

        function renderSheetRequests() {
            const list = document.getElementById('sheetRequestsList');

            // Filter requests
            let filtered = appRequests;
            if (sheetFilter !== 'all') {
                filtered = appRequests.filter(r => r.type === sheetFilter);
            }

            if (filtered.length === 0) {
                list.innerHTML = `<div class="sheet-empty">No ${sheetFilter === 'all' ? 'requests' : sheetFilter + 's'} yet. Be the first!</div>`;
                return;
            }

            list.innerHTML = filtered.map(request => {
                const hasVoted = currentUser && request.voted_by && request.voted_by.includes(currentUser.id);
                return `
                    <div class="sheet-request-item">
                        <div class="sheet-request-text">${escapeHtml(request.description)}</div>
                        <div class="sheet-request-meta">
                            <span class="sheet-request-type ${request.type}">${request.type === 'feature' ? 'Feature' : 'Bug'}</span>
                            <div class="sheet-vote">
                                <button class="sheet-vote-btn ${hasVoted ? 'voted' : ''}" onclick="voteOnRequest('${request.id}')" ${hasVoted ? 'disabled' : ''}>
                                    ${hasVoted ? '&#x2714;' : '&#x25B2;'}
                                </button>
                                <span class="sheet-vote-count">${request.votes || 0}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update both desktop and mobile when requests are loaded
        const originalRenderRequests = renderRequests;
        renderRequests = function() {
            originalRenderRequests();
            renderSheetRequests();
        };
    </script>

    <!-- Add Idea Modal -->
    <div class="idea-modal-overlay" id="ideaModalOverlay" onclick="if(event.target === this) closeIdeaModal()">
        <div class="idea-modal">
            <h3> Submit an App Idea</h3>

            <!-- Auth Prompt (shown if not logged in) -->
            <div id="ideaAuthPrompt" class="idea-auth-prompt" style="display: none;">
                <p>Enter your Telegram username to submit ideas and vote</p>
                <div class="idea-form-group" style="text-align: left;">
                    <label>Telegram Username</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="color: var(--text-secondary);">@</span>
                        <input type="text" id="telegramUsername" placeholder="username" style="flex: 1;">
                    </div>
                </div>
                <button class="telegram-login-btn" onclick="saveTelegramUsername()" style="width: 100%; justify-content: center;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.015-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.751-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.333-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.142.121.1.154.234.169.337.015.103.034.337.019.519z"/>
                    </svg>
                    Continue
                </button>
            </div>

            <!-- Form (shown if logged in) -->
            <div id="ideaFormContent">
                <!-- Similarity Warning (hidden by default) -->
                <div class="similarity-warning" id="similarityWarning" style="display: none;">
                    <div class="similarity-warning-header">
                         Similar to a Rejected Idea
                    </div>
                    <div class="similarity-warning-content">
                        Your idea seems similar to one that was previously rejected:
                        <div class="rejected-idea-box">
                            <div class="rejected-idea-name" id="rejectedIdeaName"></div>
                            <div class="rejected-idea-reason">Reason: <span id="rejectedIdeaReason"></span></div>
                        </div>
                        Consider making your idea more specific or different.
                    </div>
                    <div class="similarity-warning-actions">
                        <button class="modify-btn" onclick="hideSimilarityWarning()">Modify Idea</button>
                        <button class="submit-anyway-btn" onclick="submitAnyway()">Submit Anyway</button>
                    </div>
                </div>

                <div class="idea-form-group">
                    <label>App Name *</label>
                    <input type="text" id="ideaName" placeholder="e.g., Voice Memo AI">
                </div>
                <div class="idea-form-group">
                    <label>Tagline / Description</label>
                    <textarea id="ideaTagline" placeholder="What does it do? Why would people pay for it?"></textarea>
                </div>
                <div class="idea-form-group">
                    <label>Category</label>
                    <select id="ideaCategory">
                        <option value="productivity"> Productivity</option>
                        <option value="health"> Health & Fitness</option>
                        <option value="finance"> Finance</option>
                        <option value="entertainment"> Entertainment</option>
                        <option value="education"> Education</option>
                        <option value="utilities"> Utilities</option>
                        <option value="social"> Social</option>
                    </select>
                </div>
                <div class="idea-modal-actions">
                    <button class="idea-cancel-btn" onclick="closeIdeaModal()">Cancel</button>
                    <button class="idea-submit-btn" onclick="submitIdea()">Submit Idea</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Reason Modal -->
    <div class="reject-reason-modal" id="rejectReasonModal" onclick="if(event.target === this) closeRejectReasonModal()">
        <div class="reject-reason-content">
            <h3> Reject with Reason</h3>
            <input type="hidden" id="rejectIdeaId">
            <textarea id="rejectReasonText" placeholder="Explain why this idea is being rejected..."></textarea>
            <div class="reject-reason-buttons">
                <button class="cancel-btn" onclick="closeRejectReasonModal()">Cancel</button>
                <button class="confirm-btn" onclick="confirmRejectWithReason()">Reject Idea</button>
            </div>
        </div>
    </div>
</body>

</html>
